{"meta":{"title":"Yukino256ã®Blog","subtitle":"â€”â€”â€”â€”æˆ‘æ°¸è¿œå–œæ¬¢é›ªä¹‹ä¸‹é›ªä¹ƒ","description":"private records of CS study","author":"Yukino256","url":"https://Yukino256.github.io","root":"/"},"pages":[{"title":"æœç´¢","date":"2023-04-20T08:12:14.000Z","updated":"2024-03-31T00:48:51.002Z","comments":true,"path":"search/index.html","permalink":"https://yukino256.github.io/search/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2023-04-20T08:10:01.000Z","updated":"2024-03-31T00:49:02.777Z","comments":true,"path":"tags/index.html","permalink":"https://yukino256.github.io/tags/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2023-04-20T08:08:57.000Z","updated":"2024-03-31T00:48:37.781Z","comments":true,"path":"categories/index.html","permalink":"https://yukino256.github.io/categories/index.html","excerpt":"","text":""},{"title":"å‹é“¾","date":"2024-03-28T09:28:20.000Z","updated":"2024-03-31T00:48:21.701Z","comments":true,"path":"link/index.html","permalink":"https://yukino256.github.io/link/index.html","excerpt":"","text":""},{"title":"","date":"2024-03-28T09:51:20.593Z","updated":"2024-03-28T09:51:20.593Z","comments":true,"path":"css/modify.css","permalink":"https://yukino256.github.io/css/modify.css","excerpt":"","text":"#page-header { background: transparent !important; } #page-header.post-bg, #page-header.not-home-page { height: 280px !important; } #page-header #post-info { bottom: 40px !important; text-align: center; } #page-header #page-site-info { top: 140px !important; } @media screen and (max-width: 768px) { #page-header.not-home-page { height: 200px !important; } #page-header #post-info { bottom: 10px !important; } #page-header #page-site-info { top: 100px !important; } } .top-img { height: 250px; margin: -50px -40px 50px; border-top-left-radius: inherit; border-top-right-radius: inherit; background-position: center center; background-size: cover; -webkit-transition: all 0.3s; -moz-transition: all 0.3s; -o-transition: all 0.3s; -ms-transition: all 0.3s; transition: all 0.3s; } @media screen and (max-width: 768px) { .top-img { height: 230px; margin: -36px -14px 36px; } } [data-theme='dark'] .top-img { filter: brightness(0.8); } #footer:before { background-color: rgba(255,255,255,0.5); } [data-theme='dark'] #footer:before { background-color: rgba(0,0,0,0.5); } #footer-wrap, #footer-wrap a { color: #111; -webkit-transition: unset; -moz-transition: unset; -o-transition: unset; -ms-transition: unset; transition: unset; } [data-theme='dark'] #footer-wrap, [data-theme='dark'] #footer-wrap a { color: var(--light-grey); }"}],"posts":[{"title":"DailyRecord-June","slug":"DailyRecord-June","date":"2024-06-03T01:28:33.000Z","updated":"2024-06-11T07:01:43.641Z","comments":true,"path":"2024/06/03/DailyRecord-June/","link":"","permalink":"https://yukino256.github.io/2024/06/03/DailyRecord-June/","excerpt":"","text":"6.1-6.2å‘¨å…­ï¼Œä¸­åˆå’Œå¶é˜¿å§¨å’Œå¥¹çš„å¥³å„¿ä¸€èµ·åœ¨ä¸­å…³æ‘é™„è¿‘ä¸€ä¸ªé¥­åº—åƒé¥­ï¼Œçœ‹ä¸Šå»è¿˜æŒºé«˜æ¡£çš„ã€‚åƒäº†åŒ—äº¬çƒ¤é¸­ã€éº»è¾£ç‰›è›™ã€è±†è…ç…²ã€å®«ä¿é¸¡ä¸â€¦â€¦å‘³é“è¿˜å¯ä»¥ã€‚å’Œå¶é˜¿å§¨ã€å¥¹å¥³å„¿èŠå¤©ï¼ŒèŠäº†å¾ˆå¤šã€‚åœ¨æˆ‘çš„æœ¦æœ¦èƒ§èƒ§çš„å°è±¡é‡Œï¼ˆä¹Ÿè®¸ä¸æ˜¯å°è±¡ï¼Œè€Œæ˜¯æˆ‘è„‘éƒ¨çš„æœŸè®¸ï¼Ÿæ¯•ç«Ÿé‚£æ—¶å€™æˆ‘æ‰3ã€4å²ï¼‰ï¼Œå¶å§å§æ˜¯ä¸€ä¸ªæ¸©æŸ”è€Œæ´»æ³¼çš„å¤§å§å§ã€‚æ—¶è¿‡å¢ƒè¿ï¼Œåˆ°äº†ç°åœ¨ï¼Œæ¸©æŸ”ä»ç„¶æ˜¯æ¸©æŸ”ï¼Œå·²ç»ä¸å†æ´»æ³¼ã€‚ä»å¥¹çš„é¢åºä¸­ã€çœ¼ç¥é‡Œï¼Œä¼¼ä¹æ„Ÿè§‰åˆ°å¥¹ä¹Ÿæœ‰äº›æ„Ÿæ…¨ã€æˆ–æ˜¯æ‚²ä¼¤ï¼Œéšéšå¯è§æ³ªå…‰ã€‚å¶é˜¿å§¨çš„å¥³å„¿æ˜¯é«˜ä¸‰ï¼Œé©¬ä¸Šé«˜è€ƒã€‚ä½†æ˜¯å¥¹ä¼¼ä¹æœ‰å‹åŠ›ä½†ä¸å¤§ï¼Ÿæˆ–è®¸æ˜¯æˆ‘æ²¡èƒ½çœ‹å‡ºå¥¹ç¬‘å®¹ä¸‹é¢éšè—äº†ä»€ä¹ˆå§ã€‚æ€»ä¹‹ï¼Œæ˜¯ä¸€ä¸ªæ´»æ³¼å¯çˆ±çš„å°å§‘å¨˜ï¼Œç©¿æ­ã€çš®è‚¤è´¨é‡ä¹‹ç±»çš„ä¸æˆ‘ä»¬å½“æ—¶å®Œå…¨ä¸åŒã€‚è®°å¾—å½“æ—¶æ•´ä¸ªé«˜ä¸­ç”Ÿæ¶¯ä¼¼ä¹éƒ½æ˜¯ç˜¦å·´å·´ã€è‹¦å“ˆå“ˆçš„ï¼Œå“ˆå“ˆï¼ä»å§‘å¨˜çš„èº«ä¸Šï¼Œæˆ‘éšéšä¹Ÿçœ‹è§äº†è¿‡å»è‡ªå·±çš„å½±å­ï¼šæ— éœ€è€ƒè™‘ç”Ÿæ´»ï¼Œæœ‰ç€è®¸å¤šä¸åˆ‡å®é™…è€Œæœ‰è¶£çš„ç†æƒ³ã€å…´è¶£ï¼Œä¹Ÿè®¸ä¼šå®ç°ã€ä¹Ÿè®¸ä¸ä¼šå®ç°ã€‚ä¾‹å¦‚æ·±å±±è€æ—ç”Ÿå­˜å¼éšå±…ã€å‘¨æ¸¸ä¸–ç•Œâ€¦â€¦å½“ç„¶ï¼ŒåŒ—äº¬å°å§‘å¨˜çš„æ¡ä»¶è‚¯å®šæ¯”æˆ‘å°é•‡åšé¢˜å®¶å¥½å¾ˆå¤šï¼Œä¹Ÿè®¸éƒ½èƒ½å®ç°ä¹Ÿè¯´ä¸å®šï¼Ÿæ›´åŠ æ„Ÿå¹äººä¸äººçš„ä¸åŒï¼Œå°å§‘å¨˜ç›®å‰ä¸ºæ­¢å·²ç»å»è¿‡ä¸å°‘åœ°æ–¹äº†ï¼Œå»å¹´å¥½åƒè¿˜ç‹¬è‡ªå»æ—…æ¸¸è¿‡â€¦â€¦åƒå®Œé¥­ï¼Œå°å§‘å¨˜å¸¦ç€æˆ‘ä»¬å»æ‰“æ¡Œæ¸¸ï¼Œä¸€ä¸ªå«ä»€ä¹ˆæ³•å¸ˆçš„æ¡Œæ¸¸ã€‚ç©äº†å¤§æ¦‚ä¸€ä¸¤ä¸ªå°æ—¶ï¼ŒæŒºå¼€å¿ƒçš„ã€‚å¶é˜¿å§¨å¶å¾ˆæœ‰å‚ä¸åº¦ã€‚æ€»ä¹‹ç©åˆ°äº†ä¸‰ç‚¹ï¼Œç„¶åæˆ‘è¦å»åœ†æ˜å›­äº†ã€‚æœ¬æ¥æ‰“ç®—ååœ°é“ï¼Œä½†æ˜¯å¶é˜¿å§¨è®©å‡ºç§Ÿè½¦ç»•è·¯é€äº†æˆ‘ä¸€ä¸‹ã€‚å’ŒZZKé€›åœ†æ˜å›­ã€‚å›­å†…é“è·¯é”™ç»¼å¤æ‚ï¼Œæˆ‘å’Œä»–ä¹Ÿæ²¡æœ‰åšæ”»ç•¥ï¼Œèµ°åˆ°å“ªå„¿çœ‹åˆ°å“ªå„¿ï¼Œåªåœ¨æœ‰åœ°å›¾å‘Šç¤ºç‰Œçš„æ—¶å€™ç¨å¾®çœ‹ä¸€ä¸‹è‡ªå·±çš„ä½ç½®ã€‚å‰å¤©ï¼ŒåŒ—äº¬çš„å¼ºå¯¹æµå¤©æ°”å¾ˆçŒ›ï¼Œæˆ‘åœ¨å…¬å¸é‡Œæ²¡æ„Ÿè§‰åˆ°ï¼Œä½†åˆ·è§†é¢‘çš„æ—¶å€™çœ‹è§äº†å›½è´¸å¤§å¦çš„ç©ºä¸­é£äººï¼Œä»¥åŠè·¯å£è¢«å¤§æ ‘ç ¸æ‰çš„æ±½è½¦ï¼Œè¿˜æœ‰åœ†æ˜å›­é‡Œé¢å€’å¡Œçš„å¤§æ ‘ã€‚è€Œç°åœ¨ï¼Œåœ¨åœ†æ˜å›­é‡Œé¢é€›ï¼ŒçœŸæ˜¯å¤„å¤„å¯è§è¢«å¹æ–­çš„å¤§æ ‘ã€‚æœ‰çš„å·²ç»è¢«åˆ‡æ®µã€æŒªèµ°ã€å †ç§¯äº†ï¼Œè€Œæœ‰çš„è¿˜æ˜¯åŸåœ°èººåœ¨é‚£é‡Œï¼Œä¼¼ä¹åœ¨å‘æ¸¸äººè¯´ï¼šå¥½å“‡ï¼æˆ‘éƒ½è¿™æ ·äº†ï¼Œä½ ä»¬è¿˜å¼€å¼€å¿ƒå¿ƒçš„é€›å…¬å›­ï¼åœ¨å›­é‡Œé€›äº†çº¦è«3ä¸ªå°æ—¶ï¼Œçœ‹çœ‹æ ‘ã€çŸ³å¤´ã€æ¹–æ°´ã€å°åœŸå †ã€æ¹–ä¸­çš„é¸­å­å’Œæ°´é¸Ÿï¼Œè¯´åˆ°åº•åœ†æ˜å›­é‡Œé¢å°±å‰©è¿™äº›ä¸œè¥¿ã€‚æœ€æœ‰å°è±¡çš„ï¼Œè¿˜æ˜¯å†å²ä¹¦ä¸Šçš„åœ†æ˜å›­ç«çƒ§é—å€ï¼Œé‚£ä¸ªæ‹±é—¨å°±é‚£æ ·å­¤é›¶é›¶çš„ç«™åœ¨é‚£é‡Œï¼Œå’Œåå¹´å‰åœ¨å†å²ä¹¦ä¸Šçœ‹åˆ°çš„ä¸€æ¨¡ä¸€æ ·ã€‚ä»¥è¿™å„¿ä¸ºèƒŒæ™¯ï¼Œæ‹äº†å‡ å¼ ç…§ç‰‡ï¼Œç…§ç‰‡ä¸Šçš„æˆ‘ç¬‘æ„ç›ˆç›ˆåœ°ç«–èµ·äº†å¤§æ‹‡æŒ‡ï¼Œå¿ƒé‡Œæƒ³çš„æ˜¯ï¼Œæ€»ç®—åœ¨ç°å®ä¸­çœ‹è§äº†å†å²ã€‚ç»“æœç…§ç‰‡æ‹ä¸‹æ¥å‘ç»™å®¶äººå’Œæœ‹å‹ï¼Œå´è¢«å“¥ä»¬å„¿æŒ‡å‡ºåœ¨è¿™ä¸ªåœºæ™¯ä¸‹å¤šå°‘æœ‰ç‚¹ä¸æ­£ç¡®ğŸ¤£ğŸ¤£ğŸ¤£åˆ°äº†å…­ç‚¹å¤šï¼Œå…¶å®æ‰é€›äº†åœ†æ˜å›­çš„çº¦è«ä¸‰åˆ†ä¹‹ä¸€ã€‚ä½†æ˜¯å·²ç»ä¹°å¥½äº†8ï¼š20çš„ç”µå½±ç¥¨ï¼Œå› è€Œå¾—å‡†å¤‡å‡ºå›­ï¼Œå»åƒé¥­ç„¶åçœ‹ç”µå½±ã€‚æˆ‘ä»¬é€›çš„ä¸å¤šï¼Œä½†æ˜¯é€›çš„å¾ˆæ·±å…¥ï¼Œå› è€Œç¦»å‡ºå£çš„é—¨å¾ˆè¿œã€‚èµ°äº†å¤§æ¦‚å››äº”ååˆ†é’Ÿï¼Œæ‰ä»åœ†æ˜å›­é‡Œé¢å‡ºå»ã€‚è¿˜æ²¡æœ‰é€›å®Œï¼ä¸‹æ¬¡è¿˜æ¥ï¼ç”µå½±é™¢åœ¨ä¸Šåœ°ï¼Œä¸Šæ¬¡å’ŒNJæ¥è¿‡è¿™é‡Œã€‚è¿™æ¬¡ï¼Œæˆ‘å’ŒZZKåœ¨è¿™é‡Œï¼Œç‚¹äº†å–œèŒ¶ã€ç„¶åå»åƒè¨è‰äºšï¼ˆæå¦ˆï¼æ„å¤§åˆ©æ²™å¿å°åƒï¼ï¼‰ã€‚å€Ÿäº†æ²™æ¯”æ€ªå…½å……ç”µå®è¡€äº10Rï¼Œä¹°äº†å†°æ·‡æ·‹ï¼Œå¸¦åˆ°äº†ç”µå½±é™¢é‡Œé¢åƒã€‚çœ‹çš„æ˜¯ ã€Šå“†å•¦Aæ¢¦ï¼šå¤§é›„çš„åœ°çƒäº¤å“ä¹ã€‹ï¼Œ æˆ‘æ˜¯è“èƒ–å­çš„å¿ å®ç²‰ä¸ï¼é™¤äº†3Dç‰ˆä¹‹å¤–ï¼Œå…¶ä»–å‰§åœºç‰ˆå¯ä»¥è¯´æ˜¯ä¸€é›†ä¸æ¼å§ï¼ä»Šå¹´çš„å‰§åœºç‰ˆä¹Ÿä¸é”™ï¼Œæ¯”å»å¹´çš„æ²™æ¯”å¼ºè¡Œç…½æƒ…è®²é“ç†è¦å¥½å¤ªå¤šï¼æ­¤å¤–ï¼Œmikaä¹Ÿæ˜¯éå¸¸éå¸¸éå¸¸å¯çˆ±ï¼å°±æ˜¯å¥¹å¦¹å¦¹è¿™ä¸ªä¼ç¬”æ„Ÿè§‰æœ‰ç‚¹çªå…€ï¼Œè€Œä¸”å›æ”¶çš„ä¸æ˜¯å¾ˆå¥½ï¼Œç¾ä¸­ä¸è¶³å§ï¼çœ‹å®Œç”µå½±ï¼Œåç‚¹å¤šäº†ï¼Œæ€¥åŒ†åŒ†èµ¶åœ°é“ï¼Œç»“æœè¿˜æ˜¯ä»¥ä¸¤åˆ†é’Ÿä¹‹å·®é”™è¿‡äº†æœ€åä¸€ç­åœ°é“ï¼Œå”‰ï¼èŠ±äº†28Ræ‰“è½¦å›åˆ°äº†å‡ºç§Ÿå±‹ã€‚å‘¨æ—¥ï¼Œèººäº†ã€‚è¿˜æ˜¯æœ‰ç»å…¸çš„å¤§ä¹±æ–—ç¯èŠ‚ã€‚ 6.3 - 6.4è¿™ä¸¤å¤©çš„å·¥ä½œï¼Œæ˜¯æ”¹å¤šè·¯å¬å›é¡¹ç›®ã€‚ä¸»è¦æ˜¯åç«¯APIçš„è°ƒè¯•ä¸ä¿®æ”¹ã€‚æˆ‘è¿˜æ˜¯è¦è¯´ï¼Œæ²¡æœ‰é¡¹ç›®æ–‡æ¡£å’Œæ³¨é‡Šçš„ä»£ç çœŸæ˜¯å²ï¼è¿™ä¸¤å¤©åˆå¡äº†æ–°çš„éœ€æ±‚è¿‡æ¥ï¼Œé¢å¤–åœ°åŠ ã€æ”¹ã€‚æˆ‘çš„è¯„ä»·æ˜¯ç®—æ³•è½¬æµ‹å¼€ã€‚ å‘¨ä¸€çš„æ™šä¸Šï¼Œç»ˆäºä¸‹å®šå†³å¿ƒè·‘è·¯äº†ã€‚å› ä¸ºæ„Ÿè§‰åœ¨è¿™å­¦ä¸åˆ°ä¸œè¥¿ï¼Œåœ¨å…¬å¸åå¤´ä¸å¤§çš„æƒ…å†µä¸‹ï¼Œç»§ç»­å‘†ä¸‹å»åªä¼šåœ¨èˆ’é€‚åŒºé‡Œé¢æººæ­»ï¼Œç»“å±€å°±æ˜¯ç§‹æ‹›æ‰¾ä¸åˆ°å¥½å·¥ä½œã€‚åœ¨è¿™è¾¹ä¸Šç­æ‹¿é’±å›ºç„¶å¾ˆå¥½ï¼Œä½†æ˜¯æ²¡æ³•åˆ·é¢˜ã€é¢è¯•ã€‚ä¸‹å®šäº†è·‘è·¯çš„å†³å¿ƒï¼Œäºæ˜¯æ˜­å‘Šå¤©ä¸‹ï¼Œè·‘è·¯ï¼å‘¨äºŒä¸Šåˆï¼Œå‘è¿™è¾¹æ²ˆè€å¸ˆçš„å¸ˆå§è¯´äº†ç¦»èŒçš„äº‹æƒ…ã€‚ç„¶åå‘leaderã€äººäº‹æŠ¥å‘Šã€‚ä¸‹åˆå°±å»åŠäº†ä¸€ä¸‹é¢„ç¦»èŒçš„ç¨‹åºï¼Œæ‹¿äº†ä¸‰ä¸ªè¡¨å›æ¥ï¼Œä¸‹å‘¨çš„æ—¶å€™äº¤ã€‚æ™šä¸Šï¼ŒNJå’Œæˆ‘èŠäº†èŠç”³è¯·æ¾³æ´²åšå£«çš„äº‹æƒ…ï¼Œç»™äº†æˆ‘å¾ˆå¤šå»ºè®®ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä¸‹ä¸€é˜¶æ®µçš„ä»»åŠ¡æ˜¯ï¼š åˆ·leetcode hot 100ï¼Œä¸‰éï¼Œç„¶ååˆ·ç‰›å®¢çš„I&#x2F;Oæ¨¡å¼ å†™è‹±æ–‡ç®€å†ï¼Œå‘æ¾³æ´²é‚£è¾¹å¹¿æ’’ç½‘ å”‰â€¦â€¦ 6.5 - 6.7æ²¡ç¦»èŒä¹‹å‰è¿˜æœ‰ä¸æ–­çš„éœ€æ±‚è¦å»æ”¹â€¦â€¦æ€»çš„æ¥è¯´æ˜¯æ”¹æ”¹éœ€æ±‚ï¼Œè°ƒè°ƒAPIã€‚æ²¡ä»€ä¹ˆå€¼å¾—è¯´é“çš„ã€‚å¯èƒ½ä¸»è¦æ˜¯æ–°æ¥é‚£ä¸ªåç«¯å®ä¹ ç”Ÿå¹²çš„ï¼Œæ€»ä¹‹é—®ç­”å¯¹åº“çš„åˆ†çº§å®Œæˆäº†ï¼ŒçŸ¥è¯†åº“åˆ é™¤åŠŸèƒ½ä¹Ÿè°ƒæ•´å¥½äº†ã€‚å­¦åˆ°çš„æ¯”è¾ƒæœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œæ˜¯sessionè¿™ä¸ªæ•°æ®åº“æ“ä½œå¯¹è±¡ã€‚çŸ¥é“äº†è¿™ä¸ªæ˜¯å…ˆå®šä¹‰å¥½è¿æ¥ç„¶åè¿›è¡Œæ“ä½œã€‚ å·å·åˆ·äº†ä¸¤é“é¢˜å§ 6.8 - 6.10æ²¡æœ‰è°ƒä¼‘ï¼Œå¥½è€¶ï¼å‘¨å…­ä¸­åˆï¼Œååœ°é“å»ç‹åºœäº•ï¼Œå’ŒZZKæ±‡åˆï¼Œåœ¨ç‹åºœäº•é€›äº†é€›ï¼Œåªèƒ½è¯´å¾ˆå¤±æœ›ï¼Œå°±æ˜¯ä¸€æ¡æ­¥è¡Œè¡—æ„Ÿè§‰ã€‚è·¯å€’æ˜¯æŒºå®½æ•çš„ã€‚åœ¨ç‹åºœäº•ä¹°äº†ç¨»é¦™æ‘çš„ä¸€ç›’ç³•ç‚¹å¯„å›å®¶å»ï¼Œ-200ï¼›å½“åœºå¿«é€’ï¼Œ-42ï¼›çœŸä½›äº†è¿™ä¹ˆè´µçš„å¿«é€’ã€‚ä¹‹åï¼Œåœ¨KFCåƒäº†åˆé¥­ã€‚åˆåœ¨ç‹åºœäº•å‘¨å›´é€›äº†é€›ã€‚çœ‹è§äº†æ•™å ‚ï¼Œè¿˜ä¸é”™ã€‚ä¹‹åï¼Œä¹°äº†æ¯å–œèŒ¶ï¼Œååœ°é“å»å¤©å›å…¬å›­äº†ã€‚èµ°è¥¿é—¨è¿›çš„å¤©å›å…¬å›­ï¼Œä¸ä¸Šæ¬¡è¿›æ¥çš„é—¨ä¸åŒï¼Œå› è€Œéƒ½æ˜¯æ–°é£æ™¯ã€‚çœ‹è§äº†è·¯è¾¹ä¸€é¢—é¢—çš„å¤æ ‘ï¼Œæœ‰ç™¾å¹´çš„å°æ ‘ï¼Œä¹Ÿæœ‰å…­ç™¾å¹´çš„å¤§æ ‘ã€‚å¤©å“ªï¼å…­ç™¾å¹´ï¼å¤šä¹ˆå¤§çš„ä¸€ä¸ªæ•°å­—ï¼Œå¤šä¹ˆæ¼«é•¿çš„ä¸€æ®µå²æœˆï¼çœ‹ç€å¤æ ‘ï¼Œæˆ‘æƒ³æƒ³äº”ç™¾å¹´å‰ã€å››ç™¾å¹´å‰ï¼Œä¹Ÿæœ‰ä»€ä¹ˆäººä»å®ƒè¾¹ä¸Šèµ°è¿‡ï¼Œä¸€ç§å†å²çš„åšé‡æ„Ÿæ‰‘é¢è€Œæ¥â€¦â€¦ä¹‹åï¼Œå»çœ‹äº†ç¥ˆå¹´æ®¿ã€åœœä¸˜ã€å›éŸ³å£ã€‚å€’æ˜¯æ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼Œæ’é˜Ÿçš„äººå¾ˆå¤šï¼Œä½†æœ€åçœ‹åˆ°çš„ç»“æœä¸å¦‚æƒ³è±¡ä¸­é‚£ä¹ˆå®ä¼Ÿå£®è§‚ã€‚ä¹‹åï¼Œååœ¨é•¿æ¤…ä¸Šæ­‡äº†ä¸€ä¼šå„¿ï¼Œæ™šä¸Šåˆ°å•†åœºåƒäº†ç„–é”…ã€‚å–äº†æ˜Ÿå·´å…‹ã€æ¤°æ±â€¦â€¦åŠ³ç´¯ä½†æ˜¯å……å®å¿«ä¹çš„ä¸€å¤©ã€‚å‘¨æ—¥ï¼Œèººã€‚å‘¨ä¸€ï¼Œç«¯åˆèŠ‚ã€‚å’ŒSLã€NJã€LTä¸€èµ·åƒäº†æ¹˜èœã€‚åƒå®Œä¹‹åï¼Œåœ¨é™„è¿‘çš„å…¬å›­ï¼Œå¸­åœ°è€Œåï¼Œæ‰“äº†ä¸¤å°æ—¶çš„æ¼è›‹ã€‚å›æƒ³ä¸Šæ¬¡ï¼Œä¼¼ä¹å°±åªæ˜¯é«˜äºŒçš„æŸä¸ªå¤œé‡Œã€‚ä¹‹åå°±å†ä¹Ÿæ²¡æœ‰åƒè¿™æ ·èšé½æ‰“ç‰Œè¿‡ã€‚è®°å¾—å¤§äºŒçš„æ—¶å€™ï¼Œ112å®¿èˆçš„å…­äººè¿˜é›†é½è¿‡ï¼Œåœ¨XYä¸­å­¦å¯¹é¢ç”µç«å®¾é¦†æ‰“æ¸¸æˆï¼Œä½†æ˜¯ä¼¼ä¹æ²¡æ‰“ç‰Œã€‚åƒå®Œé¥­ï¼ŒLTè·Ÿæˆ‘å›å‡ºç§Ÿå±‹ã€‚æˆ‘ä»¬å°†è¦ä¸€èµ·å¯¹ä»˜ä¸€å‘¨è¿™æ ·ã€‚å¤šäº†ä¸€ä¸ªäººï¼Œè™½ç„¶å¾ˆæŒ¤ï¼Œä½†æœ‰äº†ç”Ÿæ°”ã€æœ‰äº†ä¸€ç‚¹å½’å±æ„Ÿã€‚ 6.11æ™šä¸Šæ²¡ç¡å¥½ï¼Œé†’äº†å‡ æ¬¡ï¼Œæ„Ÿè§‰ç¡å¾—æµ…ã€‚å¯èƒ½æ˜¯æ€•LTç¡è§‰ä¸è€å®å¯¹æˆ‘æ‚æ‚æŠ±æŠ±ä¹ƒè‡³æ’…æˆ‘ï¼Œå› è€Œå°å¿ƒç¿¼ç¿¼çš„æ„Ÿè§‰ï¼ˆä¸æ˜¯ä¸Šåˆï¼Œäº¤æ¥äº†ä¸€ä¸‹å¤šè·¯å¬å›çš„ä¸œè¥¿ã€‚æ„Ÿè§‰å¯ä»¥å‡†å¤‡æ¶¦äº†ã€‚åˆ·äº†ä¸çŸ­æ—¶é—´çš„æ‰‹æœºâ€¦â€¦","categories":[{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å¤§æ¨¡å‹","slug":"è®°å½•/å¤§æ¨¡å‹","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"},{"name":"å®ä¹ ","slug":"è®°å½•/å¤§æ¨¡å‹/å®ä¹ ","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%AE%9E%E4%B9%A0/"}],"tags":[{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://yukino256.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"éšæƒ³","slug":"éšæƒ³","permalink":"https://yukino256.github.io/tags/%E9%9A%8F%E6%83%B3/"},{"name":"å¿ƒæƒ…","slug":"å¿ƒæƒ…","permalink":"https://yukino256.github.io/tags/%E5%BF%83%E6%83%85/"}]},{"title":"DailyRecord-May","slug":"DailyRecord-May","date":"2024-05-02T12:40:09.000Z","updated":"2024-05-31T09:44:14.238Z","comments":true,"path":"2024/05/02/DailyRecord-May/","link":"","permalink":"https://yukino256.github.io/2024/05/02/DailyRecord-May/","excerpt":"","text":"5.1 â€”â€” 5.55.1 äº”ä¸€å‡æœŸçš„ç¬¬ä¸€å¤©ã€‚å†è¯´ä¸€éï¼šæˆ‘æ¨è°ƒä¼‘ï¼æˆ‘æ¨è°ƒä¼‘ï¼æ˜¨å¤©æ™šä¸Š21ï¼š46çš„ç«è½¦ï¼Œæ—©ä¸Š6ï¼š35ç«è½¦åˆ°ç«™ã€‚åªæœ‰ç«™ç¥¨ï¼Œæˆ‘å’ŒLTå¸¦äº†é©¬æ‰ä¸Šå»ï¼Œç»“æœå‘ç°èƒ½æ”¾é©¬æ‰çš„åœ°æ–¹ä¹Ÿå¾ˆå°‘ã€‚åœ¨4æœˆä¸­æ—¬çš„æ—¶å€™ï¼Œæˆ‘å’ŒLTè¯´ä¸€èµ·å›å®¶ï¼ŒèŠåˆ°ç«™ç¥¨ä¹°é©¬æ‰çš„äº‹æƒ…ï¼Œæˆ‘è¯´æˆ‘ä¹°ä¸¤ä¸ªï¼Œä»–ä¸ç”¨ä¹°ç›´æ¥è¿‡æ¥å°±è¡Œï¼Œç»“æœä»–å¿˜äº†è‡ªå·±ä¹Ÿä¹°äº†ä¸€ä¸ªã€‚äºæ˜¯å¤šå‡ºäº†ä¸ªå°é©¬æ‰ã€‚æˆ‘æ˜¯14è½¦ï¼ŒLTæ˜¯15è½¦ï¼Œä»–åœ¨15è½¦å¸®æˆ‘å äº†ä¸ªä½ç½®ï¼Œç»“æœå‘ç°æ˜¯å•æ‰€é—¨å£ï¼Œè€Œè¿™ä¸ªå•æ‰€çš„é—¨è¿˜åäº†ï¼Œä¹˜åŠ¡å‘˜è¿‡æ¥ä¿®åè€ŒæŠŠé—¨ç›´æ¥ç»™æä¸‹æ¥äº†ï¼›ä¸­é€”ï¼ŒLTè¯•å›¾å°†å¤šä½™çš„é©¬æ‰ä»¥15Ræ¨é”€å‡ºå»ï¼Œç»“æœå¤±è´¥äº†ğŸ¤£ğŸ¤£ğŸ¤£ğŸ¤£ã€‚æ¯èŠ‚è½¦å¢éƒ½å¸¦ä¸ªå•æ‰€ï¼Œå› è€Œç«™ç¥¨å¤§æŠµæ˜¯éƒ½è¦åœ¨å•æ‰€é™„è¿‘çªç€çš„æˆ‘æ˜¯ä¸æƒ³å½“è€å…«çš„ï¼Œæ­£å¥½å¬é—»è¯´é¤è½¦é‚£è¾¹æœ‰ç©ºä½ï¼Œå› è€Œæˆ‘æ‹ç€æˆ‘çš„ä¸¤ä¸ªå°é©¬æ‰è¿‡å»æ‰¾ä½å­ã€‚åˆ°é‚£å„¿å‘ç°é¤è½¦åæ»¡äº†ï¼Œä¼°è®¡éƒ½æ˜¯ç«™ç¥¨è¿‡æ¥ä¹°é¥­é€åº§ä½çš„ã€‚é¤è½¦çš„å°½å¤´æ¯”è¾ƒç©ºæ—·ï¼Œåªæœ‰ä¸€ä¸ªå“¥ä»¬å„¿åœ¨åœ°ä¸Šé“ºäº†ä¸ªçº¸èººç€ã€‚æˆ‘åœ¨è¿™å„¿è¹²äº†ä¸‹æ¥ï¼ŒLTæ€•è¢«èµ¶èµ°ï¼Œè®©æˆ‘çœ‹çœ‹æƒ…å†µï¼ŒåŠå°æ—¶æ²¡äººèµ¶å°±å«ä»–ã€‚ç¡®å®æ²¡äººèµ¶ï¼Œç„¶åä»–å°±è¿‡æ¥äº†ï¼Œè¿‡æ¥ä¸€åˆè®¡ï¼Œåƒç‚¹ä¸œè¥¿ï¼Œç„¶åå»é—®æœ‰æ²¡æœ‰ç©ºä½ã€‚ä¹˜åŠ¡å‘˜è…¾äº†ä¸¤ä¸ªç›¸é‚»çš„ä½å­ç»™æˆ‘ä»¬ï¼Œç„¶å96rï¼Œæ²¡å¾—é€‰æ‹©ï¼Œä¸¤äººåƒé±¼é¦™è‚‰ä¸é¥­ã€‚æˆ‘åƒäº†ä¸€ç¢—åŠï¼ŒLTåƒäº†ä¸¤ç¢—åŠã€‚åƒå®Œåï¼Œå¯ä»¥åæ­£è¨€é¡ºçš„å ç”¨é¤æ¡Œã€‚ç”±äºè·¨æœˆï¼Œå› è€Œç¢§è“èˆªçº¿è¦åˆ·ä¸€ä¸‹å¤§ä¸–ç•Œçš„å‰©ä½™ä½“åŠ›ï¼Œç©æ‰‹æœºåˆ°1ç‚¹ï¼ŒLTé»˜é»˜é™ªç€æˆ‘ä¸€èµ·ç©ï¼Œæˆ‘æ”¾ä¸‹æ‰‹æœºè¶´ä¸‹ä»–ä¹Ÿè¶´ä¸‹äº†ã€‚è¯´å®åœ¨è¯ï¼Œè™½ç„¶æœ‰åï¼Œä½†æ˜¯ä¸å®‰é™ï¼Œä¹˜åŠ¡å‘˜å˜ˆæ‚ï¼Œä»–ä»¬ä¸å…³å¿ƒä½ æ˜¯ä¸æ˜¯åœ¨ç¡è§‰ï¼›å°¤å…¶æ˜¯2ç‚¹å¤šä¹˜åŠ¡å‘˜é›†ä½“æ—©é¤ï¼Œæˆ‘ä»¬é‚£ä¸ªä½ç½®éœ€è¦æš‚æ—¶è®©ä¸€ä¸‹ç»™ä¹˜åŠ¡å‘˜åƒé¥­ï¼Œåƒå®Œé¥­ä¸€èˆ¬ç«‹åˆ»å°±èµ°äº†ï¼Œä½†æ˜¯æœ‰ä¸èµ°çš„ç•™åœ¨æ¡Œå­ä¸Šã€ä¸œç™¾å£éŸ³çš„ç”·çš„åœ¨å¹ç‰›é€¼ï¼Œä¸å‹ä½å£°éŸ³ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåˆ°4ã€5ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿåªç¡äº†è´¨é‡å¾ˆä½çš„æ–­æ–­ç»­ç»­çš„2å°æ—¶å·¦å³ã€‚ç„¶ååˆ°äº†å¼€æ—©é¥­çš„æ—¶å€™ï¼Œè¢«ä¹˜åŠ¡å‘˜æ’µèµ°äº†ï¼Œæˆ‘ä»¬åˆ°äº†é¤è½¦æœ«å°¾çš„åœ°æ–¹è¹²äº†ä¸€å°æ—¶ï¼Œåˆè¢«æ’µèµ°äº†ã€‚æ€»ä¹‹ï¼Œ6.35åˆ°è½¦ç«™ï¼Œç„¶åLTä»–å¦ˆå¦ˆå¼€è½¦æ¥å¸¦æˆ‘ä»¬ï¼ŒæŠŠæˆ‘é€åˆ°å®¶ã€‚å¦ˆå¦ˆåœ¨å®¶ç­‰æˆ‘ï¼Œæˆ‘æ´—äº†ä¸ªæ¾¡ï¼Œç„¶åä¸ƒç‚¹å¤šå¼€å§‹ç¡è§‰ï¼Œä¸€ä¸‹ç¡åˆ°ä¸­åˆ12.30ã€‚ç„¶åå»é—¨å¸‚åƒåˆé¥­ï¼Œç‰›è‚‰å•¥çš„ï¼Œå®¶å¸¸èœã€‚å•Šï¼å®¶çš„å‘³é“ï¼ä¸‹åˆï¼ŒLSHå«æˆ‘å‡ºå»ä¸Šç½‘ï¼Œæˆ‘ä»¬æŠŠLTå«ä¸Šäº†ã€‚çº¿ä¸Šå«äº†é“å“¥ï¼Œä»¥åŠæˆ‘çš„ç ”ç©¶ç”ŸåŒé—¨SHï¼Œå‡‘äº†äº”é»‘ï¼Œå¤§å¤§ä¹±æ–—ã€‚ä¸‹åˆä¸¤ç‚¹æ‰“åˆ°8ç‚¹ï¼Œåå‡ æŠŠè¾“äº†ä¸¤æŠŠï¼Œçˆ½èµ¢ï¼ç½‘å§æœ‰èŒ¶æ°´å”®å–ï¼Œå–äº†çº¢èŒ¶ã€‚ç„¶åï¼Œæˆ‘éª‘çš„è‡ªè¡Œè½¦ç•™åœ¨äº†ç½‘å§é—¨å£ï¼ŒLTå¼€è½¦å¸¦æˆ‘ã€LSHã€SXZä¸€èµ·å»æ­¥è¡Œè¡—åƒé¾™è™¾ã€‚å–å•¤é…’ã€åƒä¸‹é…’èœï¼Œå€¾è¯‰ä¸€ä¸‹ï¼ŒèŠèŠåœ¨åŒ—äº¬ä¸€ä¸ªæœˆçš„ä¸€äº›ç»å†å’Œæ„Ÿæƒ³ã€‚å•¤é…’å–æ™•äº†ï¼Œä»–ä»¬é©¾ç€æˆ‘æ‰“è½¦å»æµ™æ±Ÿå•†åŸé‚£å„¿çš„KTVå”±æ­Œã€‚æˆ‘çœŸä¸çŸ¥é“è‡ªå·±æ˜¯æ€ä¹ˆè¿‡å»çš„ï¼ŒåªçŸ¥é“è‡ªå·±è¢«äººé©¾ç€ã€‚åˆ°é‚£å„¿ï¼Œèººåˆ°äº†0ï¼š30ï¼Œé†’äº†ï¼Œå”±æ­Œåˆ°2ç‚¹ï¼Œèµ°è·¯å›å®¶ç¡è§‰ã€‚å’Œæœ‹å‹ä»¬å–é…’æ˜¯å¼€å¿ƒçš„ã€å”±æ­Œæ˜¯å¼€å¿ƒçš„ã€‚5.2 äº”ä¸€å‡æœŸç¬¬äºŒå¤©ã€‚ä¸­åˆå»æˆ‘çˆ¹é‚£å„¿åƒåˆé¥­ã€‚æˆ‘çš„å¤§çˆ·ã€æˆ‘çˆ¸çš„æ–°å¯¹è±¡å’Œé‚£ä¸ªå¥³å„¿ä¹Ÿæ¥äº†ï¼Œå–äº†ç‚¹å•¤é…’ï¼ŒèŠäº†èŠä¸€äº›çƒ¦æ¼ã€‚ä½†æ˜¯åœ¨è¿™é‡Œæ¥æ”¶åˆ°çš„åªæœ‰â€œåŠªåŠ›ï¼æ‹¼æï¼â€ä¸€ç±»çš„å¤§é“ç†ã€å¤§ç”·å­&#x2F;å¤§å®¶é•¿ä¸»ä¹‰çš„è¯´æ•™ã€‚æŒ«è´¥ï¼Œå†æ¬¡å†³å®šä¸åº”è¯¥å‘è¿™é‡Œå€¾è¯‰ä¸€äº›ä¸œè¥¿äº†ï¼Œåœ¨æ¯äº²é‚£å„¿æ›´æ”¾æ¾ä¸€ç‚¹ã€‚ä½†è¿™ä¸ªå®¶æ—æ°›å›´å°±æ˜¯è¿™æ ·ï¼Œæ€»ä½“ä¸Šè¿˜æ˜¯å’Œç¦çš„ã€è¾ƒå¥½çš„ï¼Œä¸€äº›ä¸œè¥¿åº”è¯¥å­¦ä¼šå»å¿å—ã€‚ä¸‹åˆï¼Œä¾æ—§æ˜¨å¤©çš„é…ç½®ã€æ˜¨å¤©çš„é˜µå®¹ï¼Œä»Šå¤©ç‚¹äº†æ¸æèŠèŠ±èŒ¶ï¼Œå› ä¸ºæ„Ÿè§‰è¿™ä¸ªå¥½åƒæ˜¯æ˜ç›®çš„ï¼Œæœ€è¿‘æ„Ÿè§‰è§†åŠ›æœ‰æ‰€ä¸‹é™ã€‚ä¸€å¼€å§‹è¿è·ªï¼Œæ²‰é»˜ä¸è¯­ï¼Œç„¶åè¿èƒœäº†ï¼Œæœ€åæ‰“åˆ°18ç‚¹å¤šï¼Œå…‰è£ä¸‹æ’­ï¼éª‘ç€è‡ªè¡Œè½¦åˆ°é—¨å¸‚åƒé¥­æï¼Œå®¶çš„å‘³é“ï¼*2ğŸ¥°ğŸ¥°5.3 äº”ä¸€å‡æœŸçš„ç¬¬ä¸‰å¤©ã€‚ä¸­åˆå»æˆ‘çˆ¹é‚£å„¿åƒé¥­ï¼Œä¸‹åˆè¿˜æ˜¯å’Œä»–ä»¬ä¸€èµ·å»ç½‘å§ã€‚æ™šä¸Šå»é—¨å¸‚åƒé¥­ï¼Œä¹‹åå»äº†èˆ…çˆ¹èˆ…å¥¶å®¶ã€‚çœ‹äº†çœ‹èœåœ°ã€èœåœ°è¾¹ä¸Šèˆ…çˆ¹æ™’å¤ªé˜³çš„ç ´æ²™å‘ã€‚æˆ‘å¦ˆçœ‹ç”Ÿèœé•¿å¾—å¥½è¦äº†ç‚¹å›å»ã€‚ä¹‹åï¼Œåœ¨åœ°ä¸‹å®¤çš„å±‹å­é‡Œé¢åç€èŠå¤©ï¼Œä¸´èµ°æ—¶ï¼Œæˆ‘æŠŠè£…åœ¨ä¿¡å°é‡Œé¢çš„ã€ä»é“¶è¡Œå–å‡ºæ¥çš„æ–°é’±2kç»™äº†èˆ…çˆ¹èˆ…å¥¶ï¼Œå®ä¹ å·¥èµ„çš„ä¸€éƒ¨åˆ†ï¼Œå¾ˆæœ‰çºªå¿µæ„ä¹‰ã€‚æ„Ÿåˆ°èˆ…çˆ¹èˆ…å¥¶æœ‰ç‚¹æ‰‹è¶³æ— æªã€åˆæœ‰ç‚¹å¤±è½ã€‚5.4 äº”ä¸€å‡æœŸç¬¬å››å¤©ã€‚ä¸­åˆå»é—¨å¸‚åƒé¥­ï¼Œç„¶ååœ¨å®¶é‡Œèººäº†ä¸€ä¼šå„¿ã€‚ä¸‹é›¨äº†ï¼ŒNZYå‘Šè¯‰æˆ‘ä»–åœ¨åˆä¸­éƒ¨é‚£å„¿å’Œåˆä¸­è€å¸ˆåƒé¥­ã€‚LTå¼€è½¦å»å¸¦äº†ä»–ï¼Œè¿˜å¸¦æ¥äº†HLã€‚æˆ‘ä»¬ä¸€èµ·åœ¨ç½‘å§æ‰“äº†ä¸€ä¸¤ç›˜ï¼Œä»–ä»¬å°±éƒ½èµ°äº†ã€‚HLæ„Ÿè§‰æ²¡å•¥ç²¾æ°”ç¥å„¿äº†ï¼Œè¿™ç­ä¸Šçš„ã€‚NZYä¹Ÿå¥½åƒæœ‰ç‚¹å¿ƒäº‹ï¼Œæ„Ÿè§‰ä»–ä¸åƒä»¥å‰é‚£æ ·å¼€å¿ƒäº†ã€‚æ™šä¸Šï¼Œåˆ°é—¨å¸‚åƒé¥­ï¼Œå’Œå¦ˆå¦ˆä¸€èµ·å›å®¶ã€‚5.5 ä»Šå¤©å›ç™¾äº¬ã€‚ä¸‹é›¨ï¼Œæ—©èµ·åä¸Šå»å®¿è¿çš„è½¦ï¼Œå¤§æ¦‚9ç‚¹åˆ°é«˜é“ç«™ã€‚13ç‚¹å¤šåˆ°ç™¾äº¬ï¼Œç‚¹äº†ä¸ªä¸œåŒ—é“ç›’é¥­å¤–å–ï¼Œåˆ°å‡ºç§Ÿå±‹çš„æ—¶å€™åƒã€‚ä¸‹åˆå’ŒSHæ‰“äº†å¤§ä¹±æ–—ï¼Œä¸€ç›´è¾“ã€‚åœ¨å‡ºç§Ÿå±‹æ²¡äº‹å¹²ï¼Œæ··æ—¥å­å‘—ã€‚ å®¶é‡ŒçœŸèˆ’æœå•Šï¼çœŸèˆ’æœå•Šï¼ 5.6å¤å·¥ã€‚æŸ¥çœ‹äº”ä¸€æœŸé—´è·‘çš„è®­ç»ƒæ€ä¹ˆæ ·äº†ã€‚å‘ç°è®­ç»ƒæ²¡è·‘å®Œï¼Œç„¶åvscodeè¿œç¨‹sshA800ä¹Ÿè¿ä¸ä¸Šäº†ï¼Œä½†æ˜¯bashå¯ä»¥è¿ã€‚ç™¾æ€ä¸å¾—å…¶è§£ã€‚ç»ˆäºå‘ç°åŸå› æ˜¯ä¿å­˜çš„checkpointæ–‡ä»¶å¤ªå¤šã€æŠŠç¡¬ç›˜å¡«æ»¡äº†ï¼ˆæœ¬æ¥å‰©ä¸‹å‡ ç™¾Gï¼‰ã€‚æµ‹è¯•checkpointçš„æ•ˆæœï¼Œæ­£å¸¸é—®ç­”å’ŒæŒ‡ä»¤é—®ç­”æ•ˆæœéƒ½å¾ˆå·®ã€‚çœ‹æ ·å­éœ€è¦é‡æ–°æ–Ÿé…Œã€‚éœ€è¦ä»”ç»†é€‰å–æ•°æ®ï¼Œè¿›è¡Œè°ƒæ•´ã€‚æˆ–è€…ç›´æ¥æ”¾å¼ƒæ”¹åº•å±‚æ¨¡å‹ï¼Œå› ä¸ºè¿™å¯¼è‡´è®­å¥½çš„æ¨¡å‹è¢«åˆ©ç”¨çš„å¾ˆå·®ã€‚ æ­¤å¤–ï¼ŒåŠ è½½æ¨¡å‹æ—¶å€™æœ‰è¿™ä¸ªæç¤ºï¼š 123456789Some weights of the model checkpoint at output_qwen/checkpoint-2000 were not used when initializing QWenLMHeadModel: [&#x27;transformer.h.0.attn.bias&#x27;, &#x27;transformer.h.1.attn.bias&#x27;, &#x27;transformer.h.10.attn.bias&#x27;, &#x27;transformer.h.11.attn.bias&#x27;, &#x27;transformer.h.12.attn.bias&#x27;, &#x27;transformer.h.13.attn.bias&#x27;, &#x27;transformer.h.14.attn.bias&#x27;, &#x27;transformer.h.15.attn.bias&#x27;, &#x27;transformer.h.16.attn.bias&#x27;, &#x27;transformer.h.17.attn.bias&#x27;, &#x27;transformer.h.18.attn.bias&#x27;, &#x27;transformer.h.19.attn.bias&#x27;, &#x27;transformer.h.2.attn.bias&#x27;, &#x27;transformer.h.20.attn.bias&#x27;, &#x27;transformer.h.21.attn.bias&#x27;, &#x27;transformer.h.22.attn.bias&#x27;, &#x27;transformer.h.23.attn.bias&#x27;, &#x27;transformer.h.24.attn.bias&#x27;, &#x27;transformer.h.25.attn.bias&#x27;, &#x27;transformer.h.26.attn.bias&#x27;, &#x27;transformer.h.27.attn.bias&#x27;, &#x27;transformer.h.28.attn.bias&#x27;, &#x27;transformer.h.29.attn.bias&#x27;, &#x27;transformer.h.3.attn.bias&#x27;, &#x27;transformer.h.30.attn.bias&#x27;, &#x27;transformer.h.31.attn.bias&#x27;, &#x27;transformer.h.4.attn.bias&#x27;, &#x27;transformer.h.5.attn.bias&#x27;, &#x27;transformer.h.6.attn.bias&#x27;, &#x27;transformer.h.7.attn.bias&#x27;, &#x27;transformer.h.8.attn.bias&#x27;, &#x27;transformer.h.9.attn.bias&#x27;]- This IS expected if you are initializing QWenLMHeadModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).- This IS NOT expected if you are initializing QWenLMHeadModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).Some weights of QWenLMHeadModel were not initialized from the model checkpoint at output_qwen/checkpoint-2000 and are newly initialized: [&#x27;transformer.h.0.attn.beta&#x27;, &#x27;transformer.h.1.attn.beta&#x27;, &#x27;transformer.h.10.attn.beta&#x27;, &#x27;transformer.h.11.attn.beta&#x27;, &#x27;transformer.h.12.attn.beta&#x27;, &#x27;transformer.h.13.attn.beta&#x27;, &#x27;transformer.h.14.attn.beta&#x27;, &#x27;transformer.h.15.attn.beta&#x27;, &#x27;transformer.h.16.attn.beta&#x27;, &#x27;transformer.h.17.attn.beta&#x27;, &#x27;transformer.h.18.attn.beta&#x27;, &#x27;transformer.h.19.attn.beta&#x27;, &#x27;transformer.h.2.attn.beta&#x27;, &#x27;transformer.h.20.attn.beta&#x27;, &#x27;transformer.h.21.attn.beta&#x27;, &#x27;transformer.h.22.attn.beta&#x27;, &#x27;transformer.h.23.attn.beta&#x27;, &#x27;transformer.h.24.attn.beta&#x27;, &#x27;transformer.h.25.attn.beta&#x27;, &#x27;transformer.h.26.attn.beta&#x27;, &#x27;transformer.h.27.attn.beta&#x27;, &#x27;transformer.h.28.attn.beta&#x27;, &#x27;transformer.h.29.attn.beta&#x27;, &#x27;transformer.h.3.attn.beta&#x27;, &#x27;transformer.h.30.attn.beta&#x27;, &#x27;transformer.h.31.attn.beta&#x27;, &#x27;transformer.h.4.attn.beta&#x27;, &#x27;transformer.h.5.attn.beta&#x27;, &#x27;transformer.h.6.attn.beta&#x27;, &#x27;transformer.h.7.attn.beta&#x27;, &#x27;transformer.h.8.attn.beta&#x27;, &#x27;transformer.h.9.attn.beta&#x27;]You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference. attentionçš„biaså’Œæˆ‘åé¢æ–°åŠ çš„betaå‚æ•°ï¼Œæ²¡æœ‰ä»æ¨¡å‹ä¸­åŠ è½½åˆ°ã€‚ä¸ºä»€ä¹ˆï¼Ÿbiasè¿™ä¸ªå¥½åƒä¸å½±å“ã€‚ä½†æ˜¯betaæ˜¯æ ¸å¿ƒå‚æ•°ï¼Œæ²¡äº†ç›´æ¥ä¹±è¯´ä¸€æ°”ã€‚ å¼€å‘å¤§å“¥é‚£è¾¹éœ€æ±‚è¿æ¥æœåŠ¡å™¨ï¼Œéœ€è¦æœåŠ¡å™¨æ¥ä¸Šwifiï¼ŒåŒæ—¶èƒ½å¤Ÿè¿æ¥A800ã€‚æœ¬ä»¥ä¸ºæ˜¯ä¸ªæ”¹è·¯ç”±çš„å¤§å·¥ç¨‹ï¼Œä½†æ˜¯æ²¡æƒ³åˆ°ç›´æ¥æ¥å…¥ç½‘ç»œå°±è¡Œäº†ã€‚ä¹Ÿè®¸æ˜¯æ¥å…¥ç½‘ç»œå…ˆåé¡ºåºçš„é—®é¢˜ï¼Ÿæä¸æ‡‚ã€‚ æ”¹äº†infinié‡Œé¢çš„ç»“æ„ï¼Œæœ¬æ¥æ˜¯èåˆååœ¨projectionï¼Œæˆ‘æŠŠprojectionæ”¾å‰é¢äº†ã€‚å› ä¸ºæˆ‘ä¸æƒ³åŠ¨è¿™ä¸ªprojectionçš„å‚æ•°ï¼Œåªæƒ³è®­ç»ƒèåˆçš„å‚æ•°ä¿¡æ¯ã€‚ä¸çŸ¥é“ç»“æœä¼šæ€æ ·ã€‚å¦‚æœåèåˆçš„è¯ï¼Œprojectionçš„å‚æ•°ä¹Ÿè¦å˜ï¼Œæ¨¡å‹æœ¬èº«èƒ½åŠ›ç›´æ¥å¯„ã€‚ æ™šä¸Šï¼Œå¼€äº†ä¾‹ä¼šã€‚å‰è¾ˆå“¥ç»™å‡ºäº†é—®é¢˜çš„å¯èƒ½è§£å†³æ–¹æ³•ï¼Œæ˜å¤©éœ€è¦æµ‹è¯•ä¸€ä¸‹ï¼š æ£€æŸ¥checkpointç›®å½•ä¸‹çš„config.jsonã€modeling_qwen.pyæ–‡ä»¶æ˜¯å¦ä¸é¢„æœŸä¸€è‡´ super().init(config) ç§»åˆ°æœ€åï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯ç»§æ‰¿ç±»çš„åˆå§‹åŒ–é—®é¢˜ æ­¤å¤–ï¼Œå¯¹äºc_projæ˜¯å¦éœ€è¦è°ƒæ•´ä½ç½®çš„é—®é¢˜ï¼Œå»ºè®®è¿˜æ˜¯å…ˆä¸è°ƒæ•´è¯•è¯•ï¼Œä¸€èˆ¬å½±å“ä¸å¤§ã€‚ æ™šä¸Šï¼Œå’ŒLTã€SHä¸€èµ·å¤§ä¹±æ–—ï¼Œèµ¢ï¼ æ˜æ—¥ä»»åŠ¡ï¼šæµ‹è¯•è§£å†³æ–¹æ¡ˆæ˜¯å¦å¯è¡Œ 5.7æµ‹è¯•æ˜¨æ™šå•†è®¨çš„è§£å†³æ–¹æ¡ˆã€‚æ— æ•ˆæœã€‚å°è¯•æ‰“å°æ¨¡å‹ç»“æ„å’Œå‚æ•°ï¼Œç»“æœæ˜¾ç¤ºattnå·²ç»ä¿®æ”¹ï¼Œä¸”æ¨¡å‹å‚æ•°é‡Œé¢æœ‰betaï¼šæ²¡åŠæ³•ï¼Œä¸Šä¸å»ä¸‹ä¸æ¥ï¼Œå¡åœ¨è¿™å„¿äº†ğŸ˜…çœ‹äº†ä¸€ä¸‹ç›¸å…³çš„issueï¼Œä¼¼ä¹æ˜¯åŠ è½½æ¨¡å‹çš„é—®é¢˜ï¼Œå¥½åƒè¦æ”¹from_pretrainedã€‚ æ¥è‡ªZYRçš„åœºå¤–æ”¯æ´ï¼å¼€äº†ä¸ªè…¾è®¯ä¼šè®®ï¼Œæ’æŸ¥äº†ä¸¤å°æ—¶ï¼Œç¡®å®šæ˜¯from_pretrainçš„é—®é¢˜ï¼æˆ‘åˆ°è¿™ä¸çŸ¥é“è¯¥æ€ä¹ˆåŠï¼Œä»–ç»™å‡ºäº†å¦ä¸€ç§åŠ è½½æ¨¡å‹çš„æ–¹å¼ï¼š 123456789101112from transformers import AutoConfigfrom safetensors.torch import load_modelconfig = AutoConfig.from_pretrained(&quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem&quot;)model = AutoModelForCausalLM.from_config(config)ckpt_file_1 = &quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem/model-00001-of-00004.ckpt&quot;model.load_state_dict(torch.load(ckpt_file_1), strict=False)ckpt_file_2 = &quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem/model-00002-of-00004.ckpt&quot;model.load_state_dict(torch.load(ckpt_file_2), strict=False)ckpt_file_3 = &quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem/model-00003-of-00004.ckpt&quot;model.load_state_dict(torch.load(ckpt_file_3), strict=False)ckpt_file_4 = &quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem/model-00004-of-00004.ckpt&quot;model.load_state_dict(torch.load(ckpt_file_4), strict=False) åœ¨æ­¤ä¹‹å‰ï¼Œéœ€è¦å°†safetensoré€ä¸ªè½¬åŒ–ä¸ºckptæ–‡ä»¶ï¼š 12345678910111213from safetensors.torch import load_fileimport torchimport sysimport ospath = sys.argv[1]if not os.path.exists(path): print(&#x27;path not exists&#x27;) sys.exit(0)device = &#x27;cpu&#x27;weights = load_file(path, device=device)weights[&quot;state_dict&quot;] = weightstorch.save(weights, os.path.splitext(path)[0] + &#x27;.ckpt&#x27;) å°†safetensorè½¬åŒ–æˆckptï¼Œç„¶ååŠ è½½ã€‚åŠ è½½çš„æ¯”from_pretrainæ…¢å¥½å¤šï¼ä½†æ˜¯é—®é¢˜è§£å†³äº†ï¼æˆ‘å¿…é¡»ç«‹åˆ»å»ç ”ç©¶ä¸€ä¸‹è¿™ä¸ªåŠ è½½æ–¹å¼çš„åŸç†ï¼çœŸå¾—ç»™æˆ‘æœ±å“¥ç£•ä¸€ä¸ªå§ï¼Œå¸®æˆ‘å¤ªå¤šäº†ï¼safetensoræ˜¯å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ºäº†ç¡®ä¿å®‰å…¨æ€§ã€ä¸åŒ…å«æ¶æ„ä»£ç ä¹‹ç±»çš„ï¼Œå°±è¦é™åˆ¶å…¶ä¸­çš„ä¸œè¥¿ï¼Œå› è€Œä¸è®©æ”¹åŠ¨ï¼Œä¹Ÿå¯ä»¥ç†è§£ã€‚ æˆ‘å®šä½åˆ°äº†é—®é¢˜ï¼Œä½†æ²¡èƒ½è§£å†³çš„åŸå› ï¼Œåœ¨äºå¯¹æƒé‡æ–‡ä»¶åŠå…¶åŠ è½½äº†è§£ä¸æ·±å…¥ï¼Œå®é™…ä¸Šè¿™å¯¹æˆ‘æ˜¯å‚»ç“œå¼çš„æ“ä½œã€é»‘ç®±ã€‚æ™šä¸Šæ²¡æœ‰æˆ˜æ–—ï¼Œæ··æ—¥å­æâ€¦â€¦æ„Ÿè§‰ä¸åˆ°å•¥æ‹¼æçš„åŠ¨åŠ›ï¼Œæµ‘æµ‘å™©å™©æœˆå…‰æ—ä¹Ÿæ˜¯æ´»ç€â€¦â€¦ æ˜æ—¥ä»»åŠ¡ï¼šæµ‹è¯•è®­ç»ƒå¥½æ¨¡å‹çš„æ•ˆæœ 5.8æ˜¨å¤©çš„ä»£ç ï¼Œé»˜è®¤æ˜¯åœ¨cpuä¸ŠåŠ è½½æ¨¡å‹çš„ï¼Œéœ€è¦æ”¹æˆå¦‚ä¸‹æ ¼å¼ 123device = torch.device(&quot;cuda&quot;)torch.load(ckpt_name, map_location=device) model.to(device) # è¿™ä¸€æ­¥ä¸çŸ¥é“ç©¶ç«Ÿæ˜¯å¦éœ€è¦ å¯¹è¯æ•ˆæœçƒ‚äº†ã€‚æˆ‘å†³å®šç…§ç€åŸè®ºæ–‡çš„ç»“æ„æ¥å¤ç°ï¼Œå†è®­ç»ƒä¸€éï¼Œçœ‹çœ‹åˆ°åº•æ€ä¹ˆå›äº‹ã€‚çœ‹äº†è¿‡ç¨‹ä¸­tensorçš„shapeï¼Œä¼¼ä¹ä¹‹å‰çš„ä»£ç shapeä¸å¯¹ï¼Ÿä¹Ÿè®¸æ•ˆæœä¸å¥½çš„åŸå› å°±åœ¨äºæ­¤ã€‚æ”¹äº†ä¹‹åå†è·‘è®­ç»ƒçœ‹çœ‹æ•ˆæœå­ï¼è¶ç€è®­ç»ƒçš„æ—¶å€™ï¼ŒæŸ¥çœ‹ckptå’Œsafetensorçš„åŒºåˆ«ã€‚ckptè¿™ç§æ–‡ä»¶ä¼¼ä¹æ˜¯torchçš„å®˜æ–¹ä¿å­˜æ–¹å¼ï¼Œä»¥dictå½¢å¼å­˜å‚¨torch.nn.moduleçš„æ¨¡å‹ç»“æ„åŠå…¶å¯¹åº”çš„å‚æ•°ï¼Œåœ¨åŠ è½½çš„æ—¶å€™ä½¿ç”¨torch.loadåŠ è½½ã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ˆç›´è§‚ç®€å•çš„ã€‚ï¼ˆæ­£å¸¸è®­ç»ƒç»“æŸçš„æ–‡ä»¶ï¼Œå¥½åƒåº”è¯¥æ˜¯.ptæˆ–è€….pthï¼Ÿï¼‰ä»¥ä¸‹å†…å®¹æ¥è‡ªç½‘ç»œï¼š .ckptæ–‡ä»¶æ˜¯Pytorch Lightningæ¡†æ¶ä¸­ä½¿ç”¨çš„æ¨¡å‹æ–‡ä»¶æ ¼å¼ä¹‹ä¸€ã€‚Pytorch Lightningæ˜¯ä¸€ä¸ªåŸºäºPytorchçš„è½»é‡çº§æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œå®ƒæä¾›äº†æ›´ç®€å•å’Œæ›´é«˜å±‚æ¬¡çš„APIï¼Œç”¨äºè®­ç»ƒå’Œç®¡ç†æ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚.ckptæ–‡ä»¶ä¿å­˜äº†æ¨¡å‹çš„å‚æ•°å’Œä¼˜åŒ–å™¨çš„çŠ¶æ€ï¼Œå¹¶ä¸”é€šå¸¸è¿˜åŒ…å«è®­ç»ƒçš„å…ƒæ•°æ®ä¿¡æ¯ã€‚ .pthæ–‡ä»¶æ˜¯Pytorchä¸­æœ€å¸¸è§çš„æ¨¡å‹æ–‡ä»¶æ ¼å¼ä¹‹ä¸€ã€‚å®ƒæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒ…å«äº†æ¨¡å‹çš„å‚æ•°å’ŒçŠ¶æ€ã€‚.pthæ–‡ä»¶ä¿å­˜äº†æ¨¡å‹çš„æƒé‡å’Œå„å±‚çš„å‚æ•°ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç”¨äºåŠ è½½å’Œæ¢å¤æ¨¡å‹ã€‚é€šè¿‡ä¿å­˜æ¨¡å‹ä¸º.pthæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦æ—¶é‡æ–°åŠ è½½æ¨¡å‹ï¼Œå¹¶ä½¿ç”¨å®ƒè¿›è¡Œé¢„æµ‹æˆ–ç»§ç»­è®­ç»ƒã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œpthæ˜¯baseï¼Œckptæ˜¯è¿›é˜¶ï¼Œsafetensoræ˜¯å†è¿›é˜¶ï¼ŸçŸ¥ä¹ä¸Šè¿™ç¯‡è§£é‡Šsafetensorè¿˜ä¸é”™ã€‚çœ‹äº†ä¸€äº›è®²è§£ï¼Œäº†è§£åˆ°ï¼Œä¸åŒç±»å‹çš„æ¨¡å‹ã€è®­ç»ƒæ–¹æ³•ä¼šè‡ªå®šä¹‰saveå’Œloadçš„æ–¹æ³•ï¼Œæ–‡ä»¶åä¹‹ç±»çš„ä¹Ÿæœ‰å·®åˆ«ï¼Œè¿™ç§è¦å…·ä½“æƒ…å†µå…·ä½“åˆ†æã€‚ ä¿®æ”¹æ¨¡å‹ä¹‹åï¼Œé‡æ–°è®­ç»ƒï¼Œç»“æœè¿˜æ˜¯åƒä»¥å‰é‚£æ ·ï¼Œåªèƒ½å›ç­”ç¬¬ä¸€å¥è¯ï¼Œåé¢çš„è¯æ— äº†ã€‚å…¶åŸå› åœ¨å“ªå„¿ï¼Ÿéœ€è¦printä»¥ä¸‹tensorçš„æƒ…å†µæ˜¯å¦å­˜åœ¨ä¹‹ç±»çš„ã€‚ç›®å‰çš„çŒœæƒ³æ˜¯ï¼šé¦–å…ˆï¼Œä¸å¯èƒ½æ˜¯è®­ç»ƒæ•°æ®åªæœ‰å•è½®å¯¹è¯çš„åŸå› ï¼Œå› ä¸ºè¿™æ— éæ˜¯è¾“å…¥é•¿çŸ­çš„é—®é¢˜ï¼Œä¸åº”è¯¥æ˜¯ä¸€ç‚¹è¾“å‡ºéƒ½æ²¡æœ‰ã€‚åœ¨å¤šè½®å¯¹è¯ä¸­ï¼Œä¸€ç‚¹ç»“æœéƒ½ä¸è¿”å›çš„è¯ï¼Œè¯´æ˜ç¬¬äºŒè½®åŠä»¥åçš„decodeéƒ½æ˜¯&lt;!iâ€™m end&gt;è¿™ç§ä¸œè¥¿ï¼›è¿™ä¸ªé—®é¢˜çš„åŸå› ï¼Œå¯èƒ½åœ¨äºé­”æ”¹æ¨¡å‹çƒ‚äº†ï¼ŒMå’Œzå¯¹åç»­è¾“å‡ºé€ æˆäº†å¾ˆåçš„è´Ÿé¢åº”ç”¨ï¼Œè¿™ä¸ªæ–¹æ³•ä¸é€šï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯ftçš„æ–¹æ³•ã€é‡çº§ä¸å¯¹ã€‚äº¦æˆ–è€…ï¼Œä¸€ä¸ªåŸå› æ˜¯Må’Œzä½¿ç”¨ã€æ›´æ–°çš„é¡ºåºå‡ºé—®é¢˜ï¼Œå¯¼è‡´åç»­decodeæ— æ³•è¿›è¡Œä¹‹ç±»çš„ã€‚å› è€Œï¼Œç›®å‰é¦–å…ˆéœ€è¦printæ‰€æœ‰decodeçš„ç»“æœï¼Œè€Œéå¯¹è¯è¾“å…¥ä¹‹åï¼Œprintå‡ºmake_contextä¸­raw_contextçš„ç»“æœï¼Œå‘ç°decodeçš„ç»“æœæ˜¯ç›´æ¥æ— äº†ã€‚æ€è€ƒè¿™ä¸ªç°è±¡å‡ºç°çš„åŸå› ï¼Œåº”è¯¥æ˜¯é­”æ”¹æ¨¡å‹+ftå¯¼è‡´æ¨¡å‹æœ¬èº«çš„èƒ½åŠ›è¢«ç ´åæ®†å°½ï¼›è®­ç»ƒæ•°æ®ä¸­éƒ½æ˜¯å•è½®å¯¹è¯çš„æ•°æ®ï¼Œå› è€Œæ— æ³•decodeå‡ºå¤šè½®å¯¹è¯çš„ç»“æœï¼Œå®ƒè¾“å…¥è¿›å»çš„éƒ½åªæ˜¯ä¸€ä¸ªsystem+userçš„å¯¹è¯ï¼Œè¿‡æ‹Ÿåˆå¯¼è‡´åªèƒ½è¾“å‡ºä¸€è½®å¯¹è¯çš„ç»“æœï¼Œåé¢ç›´æ¥decodeæˆendäº†ã€‚è¿™ä¸ªçŒœæƒ³çš„å¯èƒ½æ€§æ˜¯å¾ˆå¤§çš„ã€‚ç›®å‰ï¼Œä¸èƒ½ç¡®å®šè‡ªå·±é­”æ”¹çš„ä»£ç åœ¨æ€è·¯ä¸Šæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå› è€Œï¼š å¯èƒ½éœ€è¦å†ä»”ç»†æ–Ÿé…Œä¸€ä¸‹ä»£ç ä¿®æ”¹ï¼Œéœ€è¦æŸ¥çœ‹è¿™ä¸ªdecodeè¿‡ç¨‹ä¸­çš„tensor(å¥å­ã€Mã€z)ï¼› ä¹Ÿæœ‰å¯èƒ½ä»£ç æ²¡é—®é¢˜ï¼Œçº¯å› ä¸ºè¿™ä¸ªæ–¹æ³•éœ€å°±æ˜¯çƒ‚ï¼Œæ°´å‡ºæ¥çš„ï¼› ä¹Ÿæœ‰å¯èƒ½æ˜¯éœ€è¦å¤§é‡æ•°æ®å–‚è¿›å»æ‰èƒ½çœ‹åˆ°æ•ˆæœã€‚ ä¹Ÿæœ‰å¯èƒ½ï¼Œæ˜¯safetensorå‘ckptè½¬åŒ–è¿‡ç¨‹ä¸­æŸå¤±äº†å‚æ•°ï¼›å› ä¸ºä¼¼ä¹ckpt to safetensoræ˜¯å¯ä»¥æ— æŸçš„ï¼Œè€Œåè¿‡æ¥ä¸è¡Œï¼Œå› ä¸ºsafetensoræ˜¯ä¸€ç§å‹ç¼©ã€ç²¾ç®€çš„æ ¼å¼ï¼› æŸ¥çœ‹Må’Œzåœ¨forwardè¿‡ç¨‹ä¸­çš„æ•°å€¼æ›´æ–°ï¼šæŸ¥çœ‹Må’Œzçš„å…·ä½“æ•°å­—åï¼Œå‘ç°å…¶è¿‡å¤§ï¼Œæ²¡æ”¶æ•›åœ¨ä¸€ä¸ªå›ºå®šèŒƒå›´å†…ğŸ˜¡ã€‚ä½†æ˜¯ã€ä¼¼ä¹ã€å¥½åƒã€Attnçš„ç»“æœï¼Œæ˜¯Må’Œzé™¤ï¼›å› è€ŒAttnä¸ä¼šå—åˆ°å¤ªå¤§å½±å“æ‰å¯¹ï¼Ÿæ„Ÿè§‰è„‘å­ä¸å¤Ÿç”¨äº†ï¼Œä¸€å¤©èƒ½è®¤çœŸæ€è€ƒçš„æ—¶é—´å¥½çŸ­æã€‚æ€è€ƒå¤šäº†å¤´æ™•ã€‚ï¼ˆtmdä¸æ˜¯å› ä¸ºæˆ‘èŠ‚é£Ÿäº†è¥å…»è¿™ä¸€å—å„¿æ²¡äººç»™æˆ‘è¡¥å§ï¼Ÿï¼‰å¥½å§ï¼Œç¡®å®šä¸€ä¸‹æ€è·¯ï¼šä¿®æ­£Må’Œzçš„æ›´æ–°å…¬å¼ï¼Œä½¿å¾—å…¶ç¨³å®šï¼Œéœ€è¦å‚è€ƒå¦ä¸€ä¸ªè®ºæ–‡å®ç°çš„å¼€æºé¡¹ç›®ï¼Œè¿™ä¸ªé¡¹ç›®é€‚é…äº†llamaå’ŒGemmaï¼Œåº”è¯¥æ˜¯å¥½çš„ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šä¿®æ­£Må’Œzçš„æ›´æ–°å…¬å¼ï¼ŒåŠ›æ±‚å°†å…¶é™å®šåœ¨ä¸€å®šèŒƒå›´å†…æ³¢åŠ¨ï¼Œé¿å…æ•°å€¼æº¢å‡ºã€‚ 5.9æŸ¥çœ‹ä¸Šé¢è¯´çš„å¼€æºé¡¹ç›®llamaç‰ˆæœ¬çš„æ”¹åŠ¨ï¼Œå‘ç°å…¶åœ¨åˆå§‹åŒ–é˜¶æ®µåªåˆå§‹åŒ–äº†betaï¼Œä¸”betaæ˜¯ä¸€ä¸ªå’ŒMHAçš„shapeç›¸åŒ¹é…çš„tensorè€Œéå•ç‹¬çš„æ•°å€¼ã€‚è¿™æ ·ï¼Œæ¯ä¸ªå¤´æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä¼¼ä¹æ›´åŠ ç¬¦åˆè®ºæ–‡ä¸­çš„åšæ³•ï¼š 1self.gate = nn.Parameter(torch.full((1, self.num_heads, 1, 1), 0.0)) modelingçš„ä»£ç ä¸­æœ‰past_kvï¼ŒæŸ¥çœ‹è¿™ä¸ªtensoræ˜¯å¦å­˜åœ¨ã€shapeæ˜¯å¦åˆç†ï¼›æŒ‰ç†æ¥è¯´è¿™ä¸ªåº”è¯¥æ˜¯è‡ªå¢çš„ã€‚ç¡®å®æ˜¯éšç€tokençš„é€æ­¥decodeé€’å¢çš„ï¼Œç¬¬äºŒä¸ªç»´åº¦æ˜¯query_lenï¼Œè¾“å…¥+promptå¤§å·®ä¸å·®æ˜¯è¿™ä¸ªæ•°ã€‚åˆå›é¡¾äº†Må’Œzçš„å…·ä½“æ•°å€¼ï¼Œå‘ç°ä¸»è¦æ˜¯zè¿‡å¤§ï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å¯¹zåšnormï¼Œä½†æ˜¯è¿™ä¸ªæ“ä½œæ²¡å‡ºç°åœ¨è®ºæ–‡ä¸­ï¼Œæœ€å¥½è¿˜æ˜¯å†åˆ†æä¸€ä¸‹ä»£ç æ˜¯å¦æœ‰é—®é¢˜ã€‚å†å»çœ‹ä¸€ä¸‹è®ºæ–‡ï¼šåŸæ¥zåªæ˜¯å½’ä¸€åŒ–çš„åˆ†æ¯ï¼Œå®ƒå°±åº”è¯¥æ˜¯å¤§çš„ï¼Œæ— æ‰€è°“ï¼›ä½†æ˜¯Mä¸åº”è¯¥æ˜¯å¤§çš„ï¼Œè¿™ä¸ªé—®é¢˜å‡ºç°çš„åŸå› ï¼Œå¯èƒ½æ˜¯ä»£ç å®ç°ä¸­æ²¡æœ‰å…³æ³¨ â€œelement-wiseâ€ è¿™ä¸ªæ“ä½œä¿®æ”¹å®Œä¹‹åï¼Œå†æ¬¡è®­ç»ƒï¼Œé¢„è®¡ä¸‹ç­åèƒ½è®­å¥½ã€‚è¿™æ¬¡è®­ç»ƒæŸ¥çœ‹æ•ˆæœï¼Œè¿˜æ˜¯é‡ç‚¹å…³æ³¨ä¸¤æ–¹é¢çš„å†…å®¹ï¼š å¯¹è¯æ˜¯å¦æ­£å¸¸ å¦‚æœå¯¹è¯ä¸æ­£å¸¸ï¼Œåˆ™æŸ¥çœ‹Må’Œzï¼Œå°¤å…¶æ˜¯Mï¼Œéœ€è¦æ§åˆ¶å…¶åœ¨ä¸€å®šèŒƒå›´å†… Mä¸ºä»€ä¹ˆä¼šçªå‘æ€§çš„è¿‡å¤§ï¼Ÿè¿™ä¸ªMçš„å…¬å¼ä¸Šçœ‹ï¼Œå¢é‡æ›´æ–°åº”è¯¥æ²¡é—®é¢˜ï¼Œä¹Ÿè®¸æ˜¯ä»£ç å†™çš„ä¸å¯¹ï¼ŸæŸ¥çœ‹ä»£ç ï¼Œæ„Ÿè§‰æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå†ä»”ç»†çœ‹ä¸€ä¼šå„¿ï¼ŒçœŸæ²¡é—®é¢˜é‚£å°±æ²¡åŠæ³•äº†ã€‚è®­ç»ƒä¸­æ–­ï¼ŒåŠ è½½checkpoints-1000çš„å‚æ•°çœ‹çœ‹èƒ½å¦å¤šè½®å¯¹è¯ï¼Œä¼¼ä¹æœ‰å¤šè½®å¯¹è¯çš„èƒ½åŠ›ï¼›ä½†æ˜¯æ²¡æœ‰çœ‹Må’Œzçš„å…·ä½“æ•°å€¼ã€‚åˆæ”¹äº†ä»£ç ã€‚æŠŠbetaæ”¹æˆäº†shapeä¸º[1, 1, self.num_heads, 1]çš„tensorï¼Œå†æ¬¡è®­ç»ƒï¼Œçœ‹çœ‹æ•ˆæœã€‚é¢„è®¡æ˜å¤©çœ‹çœ‹ä»Šå¤©è®­çš„ä¸¤ä¸ªæ¨¡å‹çš„æ•ˆæœå’ŒMã€zçš„å…·ä½“æ•°å€¼ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šæŸ¥çœ‹ä¸¤æ¬¡ä¿®æ”¹çš„ftæ•ˆæœï¼Œæ˜ç¡®æ˜¯å¦æ˜¯æ•°æ®é‡ä¸è¶³çš„åŸå› ï¼›æ€è€ƒé™åˆ¶Må’ŒzèŒƒå›´çš„æ–¹æ³•ï¼› 5.10æ˜¨æ™šè·‘ä¸€åŠæœåŠ¡å™¨æ–­äº†ï¼Œä»Šæ—©å‘ç°è¿ä¸ä¸ŠæœåŠ¡å™¨äº†ï¼Œsshä¹Ÿä¸è¡Œã€‚é™è§‚å…¶å˜ï¼Œç›¸æœºè€ŒåŠ¨ï¼ç»§ç»­çœ‹ä¸€ä¸‹streaming-llmçš„è®ºæ–‡å’Œæºä»£ç ï¼Œè¿™ä¸ªé¡¹ç›®çš„staræ¶¨çš„å¥½å¿«ï¼Œç°åœ¨å·²ç»æœ‰6.2käº†ï¼Œçœ‹æ ·å­å¾ˆæœ‰å¯å–ä¹‹å¤„ã€‚è¿™ä¸ªè®ºæ–‡çš„æ ¸å¿ƒæ€æƒ³è¿˜æ˜¯sparse attentionæœºåˆ¶ï¼Œåªä¸è¿‡æ˜¯åœ¨è§‚å¯Ÿäº†attention logitsçš„æ•°å€¼åˆ†å¸ƒç‰¹å¾ä¹‹åï¼Œæå‡ºçš„é’ˆå¯¹è¿™ä¸ªç‰¹å¾çš„sparseæ–¹æ¡ˆã€‚å¦ï¼šwin11ä¸Šé…ç½®ssh serverçš„æ•™ç¨‹ï¼Œå°±æ˜¯nmå‡ mbçš„ä¸œè¥¿ä¸ºä»€ä¹ˆå®‰è£…çš„é‚£ä¹ˆæ…¢ï¼Ÿè€Œä¸”è¿˜å®‰è£…å¤±è´¥ï¼Ÿâ€”â€”â€”â€”å¥½å§ï¼Œä¼¼ä¹æ˜¯æ¢¯å­çš„é—®é¢˜ï¼ŒæŠŠæ¢¯å­å…³äº†ä¹‹åæ­£å¸¸å®‰è£…äº†ã€‚å’Œpipæ¢æ¸…åæºä¹‹åä¸èƒ½å¼€æ¢¯å­installæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚ streaming-llmå¯¹positio embeddingä¹Ÿåšäº†è°ƒæ•´ï¼Œæ„Ÿè§‰å¦‚æœæ”¹qwen1çš„è¯ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºå®ƒçš„ä»£ç ä¸æ˜æ™°ã€‚ åˆ†æä¸€ä¸‹streaming-llmç§modify_llama.pyæ–‡ä»¶çš„æ€è·¯ï¼š 12345678def apply_rotary_pos_emb_single(x, cos, sin, position_ids): # The first two dimensions of cos and sin are always 1, so we can `squeeze` them. cos = cos.squeeze(1).squeeze(0) # [seq_len, dim] sin = sin.squeeze(1).squeeze(0) # [seq_len, dim] cos = cos[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] sin = sin[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] x_embed = (x * cos) + (rotate_half(x) * sin) return x_embed è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼Œé¡¾åæ€ä¹‰æ˜¯è¿›è¡ŒRoPEï¼›è€Œâ€œsingleâ€çš„æ„ä¹‰åœ¨äºï¼ŒæŒ‡å®šä½ç½®è¿›è¡ŒRoPEï¼Œè€Œä¸æ˜¯ä¸€æ•´ä¸ªraw contextã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ­£å¥½å’Œè®ºæ–‡ä¸­çš„ â€œæ ¹æ®cacheè¿›è¡Œä½ç½®ç¼–ç â€ ç›¸å¯¹åº”ã€‚é€šè¿‡è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥è‡ªç”±é€‰å®šã€æ„å»ºtokenç»„è¿›è¡ŒRoPEã€‚æˆ‘ä¹ŸæŸ¥çœ‹äº†qwen1ä¸­çš„RoPEï¼Œåº”è¯¥å°±æ˜¯è¿™æ ·ï¼Œæ²¡æœ‰é—®é¢˜ã€‚ ä¸‹åˆnmç»™æ‹‰å‡ºå»å¹²æ‚æ´»ï¼Œè¯´æ˜å¤©æ—©èµ·å»é‚£å„¿æ‰“ä¸‹æ‰‹ç°åœ¨å»è¸©ç‚¹ğŸ˜…ï¼ŒæŒ¤åœ¨å‡ºç§Ÿè½¦ä¸Šæœ‰ç‚¹æ™•ï¼›ç„¶ånmåˆ°ä¸­å…³æ‘ä¼šè®®ä¸­å¿ƒé‚£å„¿å•¥äº‹å„¿æ²¡å¹²ï¼Œè¹²äº†ä¸€ä¼šå„¿å‡ºå»æ‰¾é¥­åƒï¼Œåƒäº†31çš„å¤§ç›˜é¸¡æ‹Œé¢ï¼Œå‘³é“ä¸€èˆ¬ï¼Œæ¯”ä¸ä¸Šå—äº¬ä¸€æ ¹ï¼›ç„¶ååƒä¸€åŠæ‰“ç”µè¯æ¥è¯´ä¸ç”¨å†å›å»äº†ç›´æ¥å›å®¶ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ï¼Œçº¯dirty workäº†å±äºæ˜¯ã€‚å®ä¹ ç”Ÿç‰›é©¬å¿æ°”åå£°ingã€‚ æ˜æ—¥ä»»åŠ¡ï¼šå½“æ‚æ´»ã€ç¾¤æ¼”ã€ç‰›é©¬ğŸ˜…ğŸ˜… 5.11ä»Šæ—¥ï¼Œåœ¨ä¸­å…³æ‘ä¼šè®®ä¸­å¿ƒå½“ç¾¤æ¼”å’Œè¿å®¾ã€‚çº¯ç‰›é©¬ã€‚ä¸­åˆåŒ…é¥­ï¼Œé£Ÿå ‚æ¯”å…¬å¸çš„å¥½ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„ä¸€ç‚¹å°±æ˜¯é…¸å¥¶å±…ç„¶éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”éƒ½æ˜¯æ‘èµ·æ¥ç»™ä½ è‡ªå–ã€‚å¯æƒœä¹‹å‰åƒäº†ä¸ªå·é¥¼å’Œè±†æµ†ï¼Œä¸å¤ªé¥¿äº†ã€‚å¼€ä¼šè®®ï¼Œæ— äº‹å‘ç”Ÿã€‚å¤§ä½¬è®²çš„â€œä½ç©ºç»æµâ€è¿™ä¸ªè¯å„¿æœ‰ç‚¹æ„æ€ã€‚ ä¸‹å‘¨ä»»åŠ¡ï¼šçœ‹ftæ•ˆæœï¼›æ”¹æ¨¡å‹ 5.12å†è¯´ä¸€éï¼šæˆ‘æ¨è°ƒä¼‘ï¼æˆ‘æ¨è°ƒä¼‘ï¼æ”¾ä¸€å¤©çœŸçš„å•¥äº‹å„¿ä¹Ÿä¸æƒ³å¹²ï¼Œä¹Ÿä¸æƒ³å‡ºå»ç©ã€åƒé¥­ï¼Œçº¯åœ¨å‡ºç§Ÿå±‹èººä¸€å¤©ã€‚æ™šä¸Šå’ŒSHã€LSHã€LTä¸€èµ·å¤§ä¹±æ–—ï¼Œä»Šå¤©èµ¢å¾—æ¯”è¾ƒå¤šã€‚ZZKä»ä¸Šæµ·çš„æ»´æ»´å®ä¹ è·‘åˆ°äº†åŒ—äº¬çš„å¿«æ‰‹å®ä¹ ï¼Œ5.10å…¥çš„èŒã€‚è¿™å‡ å¤©å’Œä»–èŠäº†èŠå·¥ä½œæ€ä¹ˆæ ·å•¥çš„ã€‚ä»–æ˜¯æ—©ä¸Š10:30ï¼Œæ™šä¸Š9ç‚¹è¿˜æ˜¯10ç‚¹æ¥ç€ã€‚åœ¨è¥¿äºŒæ——é‚£è¾¹ã€‚é¢„æœŸä¸‹å‘¨å’Œä»–åƒä¸ªé¥­ï¼Œä»–æœ¬ç§‘å°±æ˜¯åŒ—äº¬çš„ï¼Œä¹Ÿåœ¨ç™¾äº¬å®ä¹ è¿‡ï¼Œå› è€Œæ¸¸åˆƒæœ‰ä½™ä¸€ç‚¹ã€‚èŠåˆ°WXFã€ZWçš„å®ä¹ ï¼Œè¯¢é—®è¿‡åå‘ç°ä»–ä»¬è¿˜åœ¨æ‰¾ã€‚å”‰ã€åç«¯æ˜¯ä¸å¥½æ´»ï¼ŒZXQä¹Ÿåœ¨å­¦æ ¡èººå°¸æ²¡æ‰¾åˆ°å®ä¹ â€¦â€¦ 5.13å†è¯´ä¸€éï¼šæˆ‘æ¨è°ƒä¼‘ï¼æˆ‘æ¨è°ƒä¼‘ï¼æ—©ä¸Šæµ‹è¯•äº†A800è¿˜è¿ä¸ä¸ŠğŸ˜…ã€‚æ¥ä¸‹æ¥ç»§ç»­åˆ†æä¸€ä¸‹modify_llama.pyæ–‡ä»¶çš„å‡½æ•°ä½œç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131def llama_pos_shift_attention_forward( self, hidden_states: torch.Tensor, attention_mask: Optional[torch.Tensor] = None, position_ids: Optional[torch.LongTensor] = None, # è¿™ä¸ªå‚æ•°åº”è¯¥æ˜¯æ–°å¢çš„ past_key_value: Optional[Tuple[torch.Tensor]] = None, output_attentions: bool = False, use_cache: bool = False,) -&gt; Tuple[torch.Tensor, Optional[torch.Tensor], Optional[Tuple[torch.Tensor]]]: bsz, q_len, _ = hidden_states.size() #è·å–batch_sizeå’Œquery_len if self.config.pretraining_tp &gt; 1: # æ˜¯å¦å¹¶è¡Œï¼Œtensor parallel key_value_slicing = ( self.num_key_value_heads * self.head_dim ) // self.config.pretraining_tp query_slices = self.q_proj.weight.split( (self.num_heads * self.head_dim) // self.config.pretraining_tp, dim=0 ) key_slices = self.k_proj.weight.split(key_value_slicing, dim=0) value_slices = self.v_proj.weight.split(key_value_slicing, dim=0) # å¯¹queryã€keyã€valueè¿›è¡Œåˆ‡åˆ†ï¼Œç›®çš„æ˜¯å¹¶è¡Œè®¡ç®—ï¼› è®¡ç®—tensorçš„sliceå¤§å°ï¼Œç„¶åå¯¹å„ä¸ªåˆ‡ç‰‡è¿›è¡Œprojï¼Œç„¶åç»“æœconcatèµ·æ¥ query_states = [ F.linear(hidden_states, query_slices[i]) for i in range(self.config.pretraining_tp) ] query_states = torch.cat(query_states, dim=-1) key_states = [ F.linear(hidden_states, key_slices[i]) for i in range(self.config.pretraining_tp) ] key_states = torch.cat(key_states, dim=-1) value_states = [ F.linear(hidden_states, value_slices[i]) for i in range(self.config.pretraining_tp) ] value_states = torch.cat(value_states, dim=-1) else: #ä¸å¹¶è¡Œ ç®€å•çš„projä¸€ä¸‹å³å¯ query_states = self.q_proj(hidden_states) key_states = self.k_proj(hidden_states) value_states = self.v_proj(hidden_states) query_states = query_states.view( bsz, q_len, self.num_heads, self.head_dim ).transpose(1, 2) key_states = key_states.view( bsz, q_len, self.num_key_value_heads, self.head_dim ).transpose(1, 2) value_states = value_states.view( bsz, q_len, self.num_key_value_heads, self.head_dim ).transpose(1, 2) kv_seq_len = key_states.shape[-2] # key_statesçš„seq_lenï¼Œä¸Šé¢transposeä¸€ä¸‹ä¹‹åï¼Œshapeåº”è¯¥æ˜¯[bsz, self.num_key_value_heads, q_len, self.head_dim] if past_key_value is not None: kv_seq_len += past_key_value[0].shape[-2] # ä»è¿™å¯ä»¥çœ‹å‡ºï¼Œpast kvçš„shapeåº”è¯¥ä¹Ÿæ˜¯[bsz, self.num_key_value_heads, q_len, self.head_dim]ï¼Œæˆ–è€…è‡³å°‘å€’æ•°ç¬¬äºŒä¸ªæ˜¯q_lenï¼Ÿ cos, sin = self.rotary_emb(value_states, seq_len=kv_seq_len) # RoPEcoså’Œsinå‚æ•° ### Shift Pos: query pos is min(cache_size, idx) # query_states, key_states = apply_rotary_pos_emb(query_states, key_states, cos, sin, position_ids) query_states = apply_rotary_pos_emb_single(query_states, cos, sin, position_ids) ### æ­¤å¤„çš„shapeåº”è¯¥æ²¡å˜ if past_key_value is not None: # reuse k, v, self_attention key_states = torch.cat([past_key_value[0], key_states], dim=2) value_states = torch.cat([past_key_value[1], value_states], dim=2) # å¯¹pastè¿›è¡Œconcatï¼Œç»“æœåº”è¯¥å¾—åˆ°q_lençš„statesï¼Œå› ä¸ºå½“å‰çš„æ—¶é—´æ­¥åªä¼šå¤„ç†å½“å‰çš„tokenï¼Œè¦å¾—åˆ°å®Œæ•´çš„q_lenè¿˜å¾—è¦concatå‰é¢çš„cacheã€‚ past_key_value = (key_states, value_states) if use_cache else None ### Shift Pos: key pos is the pos in cache key_position_ids = torch.arange(kv_seq_len, device=position_ids.device).unsqueeze(0) key_states = apply_rotary_pos_emb_single(key_states, cos, sin, key_position_ids) ### ä¸Šé¢æ”¹çš„RoPEåœ¨æ­¤è¿›è¡Œäº†åº”ç”¨ # repeat k/v heads if n_kv_heads &lt; n_heads GQAçš„åšæ³•ï¼Œtensor shapeæ˜¯(batch, num_key_value_heads * n_rep, slen, head_dim) key_states = repeat_kv(key_states, self.num_key_value_groups) value_states = repeat_kv(value_states, self.num_key_value_groups) attn_weights = torch.matmul(query_states, key_states.transpose(2, 3)) / math.sqrt( self.head_dim ) if attn_weights.size() != (bsz, self.num_heads, q_len, kv_seq_len): # åä¸¤ç»´çš„shape raise ValueError( f&quot;Attention weights should be of size &#123;(bsz, self.num_heads, q_len, kv_seq_len)&#125;, but is&quot; f&quot; &#123;attn_weights.size()&#125;&quot; ) if attention_mask is not None: if attention_mask.size() != (bsz, 1, q_len, kv_seq_len): raise ValueError( f&quot;Attention mask should be of size &#123;(bsz, 1, q_len, kv_seq_len)&#125;, but is &#123;attention_mask.size()&#125;&quot; ) attn_weights = attn_weights + attention_mask # upcast attention to fp32 attn_weights = nn.functional.softmax(attn_weights, dim=-1, dtype=torch.float32).to( query_states.dtype ) attn_output = torch.matmul(attn_weights, value_states) # (batch, num_key_value_heads * n_rep, slen, head_dim) åº”è¯¥ä¹Ÿæ˜¯è¿™ä¸ªshape if attn_output.size() != (bsz, self.num_heads, q_len, self.head_dim): raise ValueError( f&quot;`attn_output` should be of size &#123;(bsz, self.num_heads, q_len, self.head_dim)&#125;, but is&quot; f&quot; &#123;attn_output.size()&#125;&quot; ) attn_output = attn_output.transpose(1, 2).contiguous() attn_output = attn_output.reshape(bsz, q_len, self.hidden_size) if self.config.pretraining_tp &gt; 1: # å¦‚æœå¹¶è¡Œï¼Œåˆ™åˆ‡åˆ†åè®¡ç®— attn_output = attn_output.split( self.hidden_size // self.config.pretraining_tp, dim=2 ) o_proj_slices = self.o_proj.weight.split( self.hidden_size // self.config.pretraining_tp, dim=1 ) attn_output = sum( [ F.linear(attn_output[i], o_proj_slices[i]) for i in range(self.config.pretraining_tp) ] ) else: attn_output = self.o_proj(attn_output) # å¦åˆ™ç›´æ¥proj if not output_attentions: attn_weights = None return attn_output, attn_weights, past_key_value # è¾“å‡ºæ²¡å•¥å¥½è¯´çš„ï¼Œæ ‡å‡†è¾“å‡ºç½¢äº† è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†å‰é¢çš„ä¿®æ”¹åçš„ã€å¸¦position_idçš„ä½ç½®ä¿¡æ¯çš„RoPEåº”ç”¨åˆ°attentionæ¨¡å—çš„forwardä¸Šã€‚ä»å‘½åä¸­å¯ä»¥çœ‹å‡ºè¿™ä¸ªç”¨æ³•ã€‚è¿™ä¸ªå…³é”®åœ¨äºï¼Œå¯¹forwardæ–°å¢äº†ä¸€ä¸ªposition_idså‚æ•°ï¼Œç„¶åRoPEçš„å‡½æ•°é‡æ„ä¸€ä¸‹ï¼Œå…¶ä»–æµç¨‹æ˜¯å’ŒåŸç”Ÿä¸€æ ·çš„ã€‚ç›®å‰ï¼Œæ²¡æœ‰åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢çœ‹è§åŸºäºcacheçš„RoPEï¼Œä¹Ÿæ²¡æœ‰çœ‹è§sink attnçš„è®¾ç½®ã€‚ è‰ï¼A800è¿ä¸ä¸Šçš„åŸå› æ˜¯å®‰å¾½é‚£è¾¹çš„çœ‹æœºå™¨çš„äººç”¨rootè´¦æˆ·æŠŠä¸œè¥¿æçƒ‚äº†ï¼Œç°åœ¨æ­£åœ¨ä¿®ï¼Œç¯å¢ƒå•¥çš„éƒ½æ²¡äº†ï¼Œéƒ½è¦é‡æ–°é…ç½®ï¼ŒçœŸNMæ— è¯­äº†ï¼Œæœ‰è¿™ç§äº‹å•Šï¼Ÿ åœ¨åˆ†æä¸Šé¢ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œçªç„¶å¯¹è‡ªå·±ä¹‹å‰ä¿®æ”¹çš„modeläº§ç”Ÿäº†è´¨ç–‘ï¼štensorçš„shapeæ˜¯å¦æ­£ç¡®ï¼Ÿæˆ‘éœ€è¦æŸ¥çœ‹åŸç”Ÿçš„output tensor shapeå’Œä¿®æ”¹åçš„output tensor shapeæ˜¯å¦ä¸€è‡´ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦è¾“å‡ºä¸€ä¸‹past_key_valueçš„shapeï¼Œè¿™æˆ‘ä¹‹å‰å’‹æ²¡æƒ³åˆ°çœ‹å‘¢ï¼Ÿä¹Ÿè®¸æ˜¯model_qwené‡Œé¢æ²¡æœ‰?å¥½å§ï¼Œä¹‹å‰çœ‹è¿‡ï¼Œä½†æ˜¯æ—¶é—´å¤ªé•¿æˆ‘ç»™å¿˜äº†ï¼Œå˜»ğŸ¤—ğŸ¤—ã€‚ 1torch.Size([1, 407, 16, 128]) # past_key_value[0][0].shape è¿™ä¸ªä¹Ÿè®¸æ˜¯kçš„shapeï¼Œå¦‚æœæ˜¯[1][0]åˆ™æ˜¯vçš„shapeï¼Ÿ è€ŒåŸç”Ÿmodelï¼Œprint attn_outputçš„ç»“æœæ˜¯ï¼š 12attn_output.shape:torch.Size([1, 404, 2048])attn_output.shape:torch.Size([1, 1, 2048]) å‰é¢q_lenä¸€ç›´æ˜¯404ï¼Œåé¢ä¸€ç›´æ˜¯1ã€‚ä½†æ˜¯è¿™ä¸ªæ²¡åˆ†å¼€num_headsï¼Œæå¦ˆæˆ‘æ”¹çš„ä»£ç ä¸ä¼šå°±æ˜¯å› ä¸ºè¿™ä¸ªæ‰€ä»¥æ•ˆæœä¸å¥½çš„å§ï¼Ÿèµ¶ç´§æŸ¥çœ‹ï¼š 1attn_output before c_proj.shape:torch.Size([1, 419, 16, 128]) è™šæƒŠä¸€åœºï¼Œä»£ç é‡Œé¢attnä¸€ç›´æ˜¯è¿™ä¸ªå½¢çŠ¶ï¼Œä¸­é—´çš„mergeåçš„å½¢çŠ¶æ˜¯context_layerè¿™ä¸ªä¸­é—´å‚æ•°ï¼›modelingä»£ç é‡Œé¢çš„shapeä¹Ÿæ²¡é—®é¢˜ã€‚ modify_llama.pyä¸‰ä¸ªå‡½æ•°ä¸­çš„æœ€åä¸€ä¸ªå‡½æ•°æ˜¯ï¼š 1234567891011def enable_llama_pos_shift_attention(model): for name, module in reversed(model._modules.items()): if len(list(module.children())) &gt; 0: enable_llama_pos_shift_attention( module, ) # ä¸€ä¸ªé€’å½’ï¼Œä¼¼ä¹æ˜¯ä¸ºäº†å¤„ç†ä¸€ä¸ªç½‘ç»œä¸­çš„æ‰€æœ‰å±‚ï¼›transformerçš„ç½‘ç»œç»“æ„å¤§æŠµæ˜¯nn.moduleåŠå…¶åµŒå¥—ã€‚ if isinstance(module, LlamaAttention): model._modules[name].forward = types.MethodType( llama_pos_shift_attention_forward, model._modules[name] ) # æ‰¾åˆ°ç½‘ç»œä¸­çš„LlamaAttentionï¼Œæ›¿æ¢forwardå‡½æ•° è¿™ä¸ªå‡½æ•°çš„ä½œç”¨å¾ˆç®€å•ã€‚ çœ‹ä¸‹æ¥ä¹‹åï¼Œæ„Ÿè§‰è®ºæ–‡ä¸­æåˆ°çš„sinkå’ŒåŸºäºcacheçš„RoPEä¼¼ä¹æ²¡æœ‰å®ç°ï¼Ÿæ­¤å¤–ï¼Œsoftmaxçš„ä¿®æ”¹ä¹Ÿæ²¡ä½“ç°ã€‚ æœåŠ¡å™¨ä¸Šé¢çš„ä»£ç å¤±å»äº†ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰å¤‡ä»½ï¼›å¹¸å¥½ä¸€äº›å…³é”®ä»£ç ä¸å¤šï¼Œæˆ‘è¿˜è®°å¾—ï¼š safetensoré€ä¸ªè½¬åŒ–ä¸ºckptæ–‡ä»¶ï¼š 12345678910111213141516from safetensors.torch import load_fileimport torchimport sysimport osimport globDEFAULT_CKPT_PATH = &#x27;Qwen-7B-Chat&#x27;CUDA_VISIBLE_DEVICES = &#x27;2,3,4,5,6,7&#x27; # 0ã€1å¡å·²ç»éƒ¨ç½²äº†ç ”ç©¶é™¢é‚£è¾¹sftå¥½çš„æ¨¡å‹çš„apidevice = &#x27;cuda&#x27;file_paths = glob.glob(os.path.join(DEFAULT_CKPT_PATH, &#x27;/*.safetensors&#x27;))for path in file_paths: weights = load_file(path, device=device) weights[&quot;state_dict&quot;] = weights torch.save(weights, os.path.splitext(path)[0] + &#x27;.ckpt&#x27;) æ„å»ºè®­ç»ƒæ•°æ®make_train_data.pyï¼šæ­¤ä»£ç åœ¨å››æœˆä»½çš„è®°å½•ä¸­å·²å­˜ï¼Œå…·ä½“æ˜¯4.28çš„è®°å½• ä¿®æ”¹cli_demo.pyä¸­çš„åŠ è½½æ¨¡å‹éƒ¨åˆ†ï¼š 1234567891011121314from transformers import AutoConfigfrom safetensors.torch import load_modelimport globconfig = AutoConfig.from_pretrained(&quot;/home/zhangshuo/Qwen-main/Qwen-7B-Chat-Mem&quot;)model = AutoModelForCausalLM.from_config(config)DEFAULT_CKPT_PATH = &#x27;Qwen-7B-Chat-Mem&#x27;file_paths = glob.glob(os.path.join(DEFAULT_CKPT_PATH, &#x27;/*.ckpt&#x27;))CUDA_VISIBLE_DEVICES = &#x27;2,3,4,5,6,7&#x27;device = &#x27;cuda&#x27;for path in file_paths: model.load_state_dict(torch.load(path), strict=False)model.to(device) æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»kv_cache.pyï¼Œåƒé€æ€»ä½“ä¸Šçš„ä»£ç é€»è¾‘ 5.14æ˜¨å¤©å¤œé‡Œé¢†å¯¼çªç„¶å‘Šè¯‰æˆ‘ï¼Œè®©æˆ‘åˆ°æ˜Œå¹³åŒºçš„é‚£ä¸ªåœ°æ–¹çš„å…¬å¸å»å¸®å¿™ï¼Œè¯´é‚£è¾¹ä»»åŠ¡ç´§æ€¥ã€‚ç„¶åå°±è¿‡å»äº†ï¼Œæ—©ä¸Šåäº†ä¸€ä¸ªå¤šå°æ—¶çš„åœ°é“ï¼Œ9ç‚¹æ‰å°†å°†èµ¶ä¸Šåˆ°é‚£ä¸ªå›­åŒºé‡Œé¢ï¼Œæ—©é¥­ä¹Ÿæ²¡åƒã€‚åˆ°é‚£å„¿ï¼Œåœ¨æ‰¾ä¸­å¿ƒBåº§çš„æ—¶å€™é‡è§åšæ•°æ®çš„å®ä¹ å…„å¼ŸSï¼ŒåŸæ¥ä»–ä¹Ÿè¢«æ´¾æ¥äº†ã€‚ä¿ºä»¬åœ¨å›­åŒºé‡Œé¢è¿·äº†ä¸€é˜µå­è·¯ï¼Œæœ€åæ‰¾åˆ°äº†ã€‚åˆ°é‚£å„¿ï¼Œç»™æˆ‘ä»¬å®‰æ’åˆ°ä¸€æ¥¼çš„å·¥ä½ï¼Œä¼¼ä¹æ˜¯å› ä¸ºå…¬å¸éƒ¨é—¨åœ¨ä¸‰æ¥¼çš„å·¥ä½ä¸å¤Ÿäº†ã€‚è¯´æ˜¯æœ‰ä¸‹è½½huggingfaceæ•°æ®çš„ä»»åŠ¡ï¼Œä½†æ˜¯ä¸€æ¥¼å·¥ä½åˆç»™æˆ‘ä»¬ç”³è¯·äº†å·¥ä½œè´¦å·ï¼Œç”¨æ¥æ´¾å‘æ•°æ®æ ¡éªŒå®¡æŸ¥çš„ä»»åŠ¡ï¼Œé€šä¿—æ¥è¯´å°±æ˜¯æ‰“èµ›åšèºä¸ğŸ˜…ğŸ˜…ã€‚è¿™è¾¹çš„äººå€’æ˜¯æŒºå¥½çš„ï¼Œç»™æˆ‘ä»¬è®²è§£æ€ä¹ˆåšï¼Œç„¶åæ—¶ä¸æ—¶æ¥é—®é—®æœ‰æ²¡æœ‰é‡åˆ°é—®é¢˜ï¼Œä½†æ˜¯è·‘å¤§è€è¿œçš„ç´§æ€¥ä»»åŠ¡å°±æ˜¯æ‰“èµ›åšèºä¸çœŸæ˜¯è®©äººæ— å¤§è¯­ã€‚ä¸­åˆï¼Œä¹Ÿä¸çŸ¥é“æœ‰å•¥åœ°æ–¹åƒé¥­ï¼Œå…¬å¸åœ¨è¿™è¾¹å¸¦æˆ‘ä»¬çš„Få¤§å“¥çš„è¯ï¼Œæˆ‘å’ŒSå…„è·Ÿç€äººæµï¼Œåˆ°äº†å›­åŒºå¤–é¢çš„é¥­é¦†ã€‚å“ªå„¿æ˜¯ä¸€æ’é¢é¦†çš„èšé›†åœ°ï¼Œä½†æ˜¯ä¹Ÿå–ç›–æµ‡é¥­ä»€ä¹ˆçš„ï¼Œæ€»ä¹‹æ˜¯æ¥åœ°æ°”çš„å¿«é¤ã€‚äººå¾ˆå¤šï¼Œæˆ‘ç‚¹äº†è¾£å­é¸¡ä¸ç›–æµ‡é¥­ï¼Œç­‰äº†å¥½ä¹…æ‰åƒä¸Šï¼Œå‘³é“å’Œåˆ†é‡éƒ½ä¸é”™ã€‚ä»·æ ¼ä¹Ÿæ¯”è¾ƒä¾¿å®œï¼Œæ¯”å®£æ­¦é—¨å…¬å¸å’Œå‡ºç§Ÿå±‹é‚£è¾¹éƒ½ä¾¿å®œï¼Œè€Œä¸”æ˜¯ç°ç‚’çš„ï¼Œæœ‰é”…æ°”ã€‚åƒå®Œé¥­ï¼Œä¹°äº†ç“¶é¥®æ–™ï¼Œå›å»å·¥ä½ï¼Œå‹‰å‹‰å¼ºå¼ºç¡äº†ä¸€é˜µå­ã€‚ä¸‹åˆç»§ç»­æ‰“èºä¸ã€‚ä¸´åˆ°ä¸‹ç­é—®Få¤§å“¥ï¼Œæ•°æ®é›†ä¸‹è½½çš„ç¡¬ç›˜åœ¨å“ªå„¿ï¼Œå¤§å“¥è¯´æ˜å¤©ç»™ğŸ˜…ğŸ˜…ï¼Œåˆç€ä»Šå¤©æ¥çœŸæ˜¯å°±æ‰“èµ›åšèºä¸å•Šï¼å“ï¼å®£æ­¦é—¨é‚£è¾¹å·¥ä½ä¸Šçš„é”®ç›˜ã€è¢«å­ã€è¯ã€æ‰‹æœºå……ç”µå™¨éƒ½æ²¡å¸¦æ¥ï¼å‘¨è¾¹çš„ç»¿åŒ–å€’æ˜¯æŒºå¥½çš„ï¼Œæ¥¼é¡¶å¾ˆé«˜ã€æ¥¼å¾ˆå¤§ã€ç»™äººç©ºæ—·å¼€é˜”çš„æ„Ÿè§‰ï¼Œæ¯•ç«Ÿæ˜¯éƒŠåŒºã€‚çœ‹äº†çœ‹å‘¨å›´çš„æˆ¿ä»·ï¼Œå‘ç°è‡ªå¦‚ä¸Šçš„ä¸ä¾¿å®œã€‚ç„¶åNJæ‰¾çš„58åŒåŸä¸Šçš„å·¨ä¾¿å®œï¼Œè¿˜æ˜¯å•é—´ï¼ä¸è´µï¼æ¯”ç°åœ¨å‡ºç§Ÿå±‹é‚£è¾¹æ¡ä»¶å¥½å¤ªå¤šäº†ï¼æˆ‘è‰tmdè‡ªå¦‚ï¼ï¼ï¼å¦‚æœè¦å‘†åœ¨è¿™è¾¹æ—¶é—´é•¿ï¼Œé‚£è‚¯å®šæ˜¯è¦æ¬å®¶çš„ã€‚ä½†æ˜¯ä¸€åˆ‡æœªå®šã€‚é—®åˆ°åº•åœ¨è¿™å¹²å¤šä¹…ï¼Œé¢†å¯¼ä¹Ÿè¯´ä¸ç¡®å®šğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ã€‚å®ä¹ ç”Ÿç‰›é©¬å‘—ï¼å¿«ä¸‹ç­çš„æ—¶å€™å‘Šè¯‰æˆ‘æ˜å¤©å›å®£æ­¦é—¨é‚£è¾¹èŠä¸€ä¸‹åˆ°åº•æ€ä¹ˆåšã€åç»­åšå•¥ã€æ˜¯åœ¨å“ªè¾¹çš„å…¬å¸ğŸ˜…ğŸ˜…ã€‚çœŸæ˜¯æŠ˜è…¾äººï¼ä¸èƒ½ä»Šå¤©æ­£å¸¸ä¸Šç­è·Ÿæˆ‘èŠå—ï¼æ€ä¹ˆè¯´å‘¢ï¼Œä»Šå¤©çš„ç»å†ï¼Œç»™äº†æˆ‘å¾ˆå¼ºçš„è·‘è·¯ç†ç”±ï¼Œä¹‹å‰é¡¾è™‘åˆ°æ²ˆè€å¸ˆå¸ˆå§è¿™è¾¹ï¼Œæ€»æƒ³ç€å¿ä¸€ä¸‹å§ï¼Œå¿å¿è¿‡å»äº†ï¼ä½†æ˜¯ä»Šå¤©å‘ç°ï¼Œæ­£å¸¸çš„ç ”ç©¶éƒ½ä¸æ‰“ç®—è®©æˆ‘åšäº†ï¼Œå›½ä¼è¿™è¾¹ç®¡ç†æ··ä¹±ã€æ²¡æœ‰ä¸»çº¿ã€‚é‚£æˆ‘è·‘èµ·æ¥æ˜¯å¿ƒå®‰ç†å¾—ï¼Œå¿ƒæƒ…åå€’æ„Ÿåˆ°è½»æ¾äº†ä¸å°‘ğŸ¤—ğŸ¤—ã€‚ç¢ç£¨ç¢ç£¨åé¢èƒ½æŠ•å“ªå„¿çš„å…¬å¸æ~~åæ­£ä¸æƒ³å¾…ç™¾äº¬äº† æ˜æ—¥ä»»åŠ¡ï¼šå¯„ï¼å¼€æ‘†å–½ï¼ 5.15å…³äºsink attnå’Œcache RoPEçš„éƒ¨åˆ†ï¼Œå®ç°ä¼¼ä¹åœ¨kv_cache.pyä¸­ï¼Œè¿™é‡Œè®°å½•å¹¶åˆ†æä¸€ä¸‹è¿™ä¸ªä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119import torchdef slice2d(x, start, end): return x[:, :, start:end, ...]def slice3d(x, start, end): return x[:, :, :, start:end, ...]def slice1d(x, start, end): return x[:, start:end, ...]# è¿™ä¸‰ä¸ªæ˜¯å¯¹tensorçš„æŸä¸ªç»´åº¦è¿›è¡Œcutï¼Œä¼¼ä¹å°±æ˜¯è®ºæ–‡ä¸­å¯¹attnå®è¡Œsink+windowä¸­windowçš„éƒ¨åˆ†DIM_TO_SLICE = &#123; 1: slice1d, 2: slice2d, 3: slice3d,&#125;class StartRecentKVCache: def __init__( self, start_size=4, # sinkå¤§å° 4 + 508æ„æˆæ€»windowï¼Œè®ºæ–‡é‡Œæ˜¯è¿™æ ·å†™çš„ï¼Œä½†ä»£ç å®ç°å¥½åƒæ˜¯4+512=516ï¼Ÿ recent_size=512, # windowå¤§å° k_seq_dim=2, v_seq_dim=2, # tensorçš„shapeåº”è¯¥æ˜¯[batch, num_heads, seq_len, head_dim] ): print(f&quot;StartRecentKVCache: &#123;start_size&#125;, &#123;recent_size&#125;&quot;) self.start_size = start_size self.recent_size = recent_size self.cache_size = start_size + recent_size self.k_seq_dim = k_seq_dim self.v_seq_dim = v_seq_dim self.k_slice = DIM_TO_SLICE[k_seq_dim] # ç»“åˆä¸Šé¢å®šä¹‰çš„å‡½æ•°å’Œdictï¼Œè¿™é‡Œç¡®å®šseqæ‰€åœ¨çš„dimï¼Œä»è€Œé€‰å¥½sliceå‡½æ•° self.v_slice = DIM_TO_SLICE[v_seq_dim] def __call__(self, past_key_values): if past_key_values is None: return None seq_len = past_key_values[0][0].size(self.k_seq_dim) # è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯è®¡ç®—past_key_valuesä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªå­tensorçš„å¤§å°ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨seq_lenå˜é‡ä¸­ã€‚å…·ä½“åœ°è¯´ï¼Œå®ƒä½¿ç”¨sizeæ–¹æ³•æ¥è·å–ç‰¹å®šç»´åº¦ä¸Šçš„å°ºå¯¸ã€‚ä¾‹å¦‚ï¼Œå‡è®¾past_key_values[0][0]æ˜¯ä¸€ä¸ªå½¢çŠ¶ä¸º(3, 4, 5)çš„3Då¼ é‡ï¼Œä¸”k_seq_dimçš„å€¼ä¸º2ï¼Œåˆ™è¯¥ä»£ç å°†è®¡ç®—ç¬¬2ä¸ªç»´åº¦ï¼ˆä»0å¼€å§‹è®¡æ•°ï¼‰ä¸Šçš„å°ºå¯¸ï¼Œå³5ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨seq_lenå˜é‡ä¸­ã€‚ if seq_len &lt;= self.cache_size: # å¦‚æœç›®å‰çš„seqé•¿åº¦å°äºç­‰äºæˆ‘ä»¬é¢„å…ˆå®šä¹‰çš„sink+windowçš„æ€»å¤§å°ï¼Œåˆ™ä¸éœ€è¦å¯¹past_key_valuesè¿›è¡Œä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å›ã€‚ return past_key_values return [ # å¦åˆ™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹past_key_valuesè¿›è¡Œå¤„ç†ï¼Œæ¯ä¸ªseqç»´åº¦å¯¹åº”çš„kvéƒ½å‰ªåˆ‡sink+windowçš„é•¿åº¦ï¼Œå…¶ä½™éƒ½åˆ å»ï¼Œæœ€åconcatèµ·æ¥ [ torch.cat( [ self.k_slice(k, 0, self.start_size), self.k_slice(k, seq_len - self.recent_size, seq_len), ], dim=self.k_seq_dim, ), torch.cat( [ self.v_slice(v, 0, self.start_size), self.v_slice(v, seq_len - self.recent_size, seq_len), ], dim=self.v_seq_dim, ), ] for k, v in past_key_values ] def evict_for_space(self, past_key_values, num_coming): # é€å‡º_for_space if past_key_values is None: return None seq_len = past_key_values[0][0].size(self.k_seq_dim) if seq_len + num_coming &lt;= self.cache_size: # å¦‚æœseq + é¢„å¤‡åŠ å…¥çš„tokenæ•°é‡ å°äºç­‰äºcacheå¤§å° return past_key_values return [ [ torch.cat( [ self.k_slice(k, 0, self.start_size), self.k_slice( k, seq0._len - self.recent_size + num_coming, seq_len # å’Œä¸Šé¢çš„__call__ç›¸æ¯”ï¼Œä¸åŒåœ¨äº + num_coming ), ], dim=self.k_seq_dim, ), torch.cat( [ self.v_slice(v, 0, self.start_size), self.v_slice( v, seq_len - self.recent_size + num_coming, seq_len # åŒä¸Š ), ], dim=self.v_seq_dim, ), ] for k, v in past_key_values ] def evict_range(self, past_key_values, start, end): if past_key_values is None: return None seq_len = past_key_values[0][0].size(self.k_seq_dim) # è¿™ä¸€æ­¥ä¸‰ä¸ªå‡½æ•°éƒ½æ˜¯ä¸€æ ·çš„ã€‚ assert start &lt;= end and end &lt;= seq_len return [ [ torch.cat( [ self.k_slice(k, 0, start), self.k_slice(k, end, seq_len), # è¿™ä¸ªæ–¹æ³•åº”è¯¥æ˜¯è‡ªå®šä¹‰ä»å“ªå„¿åˆ°å“ªå„¿çš„æ–¹æ³•ã€‚ ], dim=self.k_seq_dim, ), torch.cat( [ self.v_slice(v, 0, start), self.v_slice(v, end, seq_len), ], dim=self.v_seq_dim, ), ] for k, v in past_key_values ] é˜…è¯»å®Œæ¯•ä¹‹åï¼Œå‘ç°è¿˜æ˜¯æœ‰ç‚¹æä¸æ‡‚ä»–è¿™ä¸ªä»£ç æ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œè¿˜å¾—çœ‹ä¸€ä¸‹å®ƒè¿™ä¸ªè¿è¡Œçš„run_streaming_llama.pyçš„ä»£ç ã€‚éœ€è¦æ˜æ™°çš„æ˜¯ï¼Œè¿™ä¸ªæ€»ä½“ä¸Šçš„æ€è·¯åº”è¯¥æ˜¯ï¼šå†™classã€methodæ»¡è¶³åŸºäºcacheè¿›è¡ŒRoPEçš„éœ€æ±‚ã€åŠ¨æ€ç»´æŠ¤ä¸€ä¸ªsink + windowçš„cacheéœ€æ±‚ï¼Œç„¶ååœ¨llamaæ¨¡å‹ä¸­è¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨ç”Ÿæˆçš„forwardè¿‡ç¨‹ä¸­ï¼Œæ›¿æ¢æˆsink + window æŸ¥çœ‹ä¸€ä¸‹å®˜æ–¹å®ç°çš„ä»¥streamingå½¢å¼è¿è¡Œllamaçš„ä»£ç ï¼š 1234567891011121314151617181920212223242526import warningswarnings.filterwarnings(&quot;ignore&quot;)import torchimport argparseimport jsonimport osimport timeimport reimport sysfrom tqdm import tqdmfrom streaming_llm.utils import load, download_url, load_jsonlfrom streaming_llm.enable_streaming_llm import enable_streaming_llm@torch.no_grad()def greedy_generate(model, tokenizer, input_ids, past_key_values, max_gen_len): # qwené‡Œé¢çš„QwenLMHeadModelé‡Œé¢æœ‰generateå‡½æ•°ï¼Œllamaé‡Œé¢æ²¡æœ‰ï¼Œè¿™ä¸ªgreedy_generateåº”è¯¥æ˜¯ç±»ä¼¼qwené‡Œé¢çš„åŠŸèƒ½ï¼Ÿ outputs = model( # è¿™ä¸ªå…³é”®åº”è¯¥æ˜¯åœ¨input_idsè¿™ä¸ªå‚æ•°ä¸Šï¼Ÿé€šè¿‡è¿™ä¸ªå‚æ•°æ¥è¿›è¡Œ..ï¼Ÿ input_ids=input_ids, past_key_values=past_key_values, use_cache=True, ) past_key_values = outputs.past_key_values pred_token_idx = outputs.logits[:, -1, :].argmax(dim=-1).unsqueeze(1) è¿™é‡Œæˆ‘å»çœ‹äº†ä¸€ä¸‹qwené‡Œé¢çš„logitsçš„ç›¸å…³æ•°æ®ï¼š 12345678910111213141516171819202122232425262728293031323334print(lm_logits)print(lm_logits.shape)print(lm_logits[..., :-1, :])print(lm_logits[..., :-1, :].shape)tensor([[[ 7.6367, 4.5312, 4.6406, ..., -2.9141, -2.9141, -2.9141], [ 7.6797, 4.5391, 4.5664, ..., -2.9512, -2.9512, -2.9512], [ -5.9531, -11.9766, -8.3281, ..., -1.5859, -1.5869, -1.5869], ..., [ -4.7500, -3.5156, -4.6289, ..., -2.9043, -2.9043, -2.9062], [ 3.0527, 6.7930, -0.4011, ..., -3.6289, -3.6289, -3.6289], [ 3.1152, 7.9453, 0.1495, ..., -2.8750, -2.8750, -2.8750]]], device=&#x27;cuda:0&#x27;, dtype=torch.float16)torch.Size([1, 404, 151936])tensor([[[ 7.6367, 4.5312, 4.6406, ..., -2.9141, -2.9141, -2.9141], [ 7.6797, 4.5391, 4.5664, ..., -2.9512, -2.9512, -2.9512], [ -5.9531, -11.9766, -8.3281, ..., -1.5859, -1.5869, -1.5869], ..., [ -7.8203, -4.4961, -4.9688, ..., -0.6299, -0.6323, -0.6323], [ -4.7500, -3.5156, -4.6289, ..., -2.9043, -2.9043, -2.9062], [ 3.0527, 6.7930, -0.4011, ..., -3.6289, -3.6289, -3.6289]]], device=&#x27;cuda:0&#x27;, dtype=torch.float16)torch.Size([1, 403, 151936])tensor([[[ 1.8477, 1.7461, 1.9453, ..., -2.3418, -2.3418, -2.3418]]], device=&#x27;cuda:0&#x27;, dtype=torch.float16)torch.Size([1, 1, 151936])tensor([], device=&#x27;cuda:0&#x27;, size=(1, 0, 151936), dtype=torch.float16)torch.Size([1, 0, 151936]) ä¸€å¼€å§‹seq_lenç»´åº¦çš„æ˜¯queryçš„é•¿åº¦ï¼Œç„¶å[â€¦, :-1, :]è¿™ä¸ªæ“ä½œæ­£å¦‚ä¹‹å‰æ‰€è¯´çš„ï¼Œå‡äº†ä¸€ä¸ªç»´åº¦ï¼ŒåªæŠŠæœ€åä¸€ä¸ªæ—¶é—´æ­¥ä½œä¸ºé¢„æµ‹ç»“æœã€‚åœ¨ç¬¬äºŒä¸ªæ—¶é—´æ­¥ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°printçš„ç»“æœï¼Œseqè¿™ä¸ªç»´åº¦æ˜¯1ï¼Œå‰Šå‡ä¹‹åæ˜¯0ï¼›ä¹‹åå°±ä¸€ç›´æ˜¯[1][0]å¾ªç¯äº†ã€‚[â€¦, :-1, :]å°±çº¯æ²¡æœ‰ç»“æœã€‚é‚£ä¹ˆï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå†…éƒ¨è¿™ä¸ªlm_logitsåœ¨ç¬¬ä¸€æ­¥è¾“å…¥çš„æ—¶å€™ä¼šè¿›è¡Œä¸€ä¸ªæ•´çš„è®¡ç®—ï¼Œç„¶ååˆ°äº†ç”Ÿæˆtokençš„æ—¶å€™ï¼Œè¿™ä¸ªlm_logitså°±æ˜¯ä¸€ä¸ªå•è¯è¡¨é•¿åº¦çš„æ¦‚ç‡åˆ†å¸ƒäº†ï¼Œç›´æ¥ä»è¿™ä¸ªæ¦‚ç‡softmaxå†decodeå•¥çš„å‡ºä¸€ä¸ªtokenã€‚é‚£ä¹ˆpred_token_idxå°±æ˜¯æ ¹æ®logitsè€Œdecodeå‡ºæ¥çš„tokenäº†ã€‚ 12345678910111213141516171819202122232425262728293031generated_ids = [pred_token_idx.item()] # è¿™é‡Œå–å‡ºé¢„æµ‹å‡ºæ¥çš„idpos = 0for _ in range(max_gen_len - 1): # ä¸Šé¢é‚£ä¸ªä¼¼ä¹æ˜¯å•ç‹¬é¢„æµ‹ç¬¬ä¸€ä¸ªtokenï¼Ÿè¿™é‡Œé¢„æµ‹åé¢çš„tokenç›´åˆ°åˆ°è¾¾æ¨¡å‹è®¾ç½®çš„max_gen_lenä¸ºæ­¢ã€‚ä¸ºå•¥è¦åˆ†å¼€å‘¢ï¼Ÿéš¾é“æ˜¯ä¸ºäº†åˆå§‹åŒ–listï¼Ÿé‚£ä¸ºå•¥ä¸ç”¨ç©ºlistå‘¢ï¼Ÿ outputs = model( input_ids=pred_token_idx, past_key_values=past_key_values, use_cache=True, ) past_key_values = outputs.past_key_values pred_token_idx = outputs.logits[:, -1, :].argmax(dim=-1).unsqueeze(1) generated_ids.append(pred_token_idx.item()) # æ–°decodeå‡ºæ¥çš„tokenå¯¹åº”çš„idåŠ å…¥äº† generated_text = ( tokenizer.decode( # decodeæˆtokenï¼Œ id -&gt; token generated_ids, skip_special_tokens=True, clean_up_tokenization_spaces=True, spaces_between_special_tokens=False, ) .strip() .split(&quot; &quot;) ) now = len(generated_text) - 1 # å¥½å§ï¼Œå•ç‹¬ç”Ÿæˆç¬¬ä¸€ä¸ªtokenæ˜¯ä¸ºäº†è¿™ä¸€æ­¥çš„å¾ªç¯ if now &gt; pos: print(&quot; &quot;.join(generated_text[pos:now]), end=&quot; &quot;, flush=True) pos = now # é¢„æµ‹å‡ºç»ˆæ­¢ç¬¦ if pred_token_idx == tokenizer.eos_token_id: breakprint(&quot; &quot;.join(generated_text[pos:]), flush=True)return past_key_values # ä¸‹é¢é‚£ä¸ªmethodéœ€è¦è¿™ä¸ªè¿”å›å€¼ã€‚è¿­ä»£çš„kvæ›´æ–°ä¹Ÿéœ€è¦past_key_valuesè¿™ä¸ªå‚æ•°ã€‚ æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªmethodæ˜¯ä¸€ä¸ªè·å–modelè¾“å‡ºæ¦‚ç‡å¹¶è¿›è¡Œgreedy decodeçš„è¿‡ç¨‹ã€‚æ²¡æœ‰çœ‹è§ä¹‹å‰æ”¹çš„kv cacheåœ¨æ­¤æœ‰åº”ç”¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364@torch.no_grad()def streaming_inference(model, tokenizer, prompts, kv_cache=None, max_gen_len=1000): past_key_values = None for idx, prompt in enumerate(prompts): # è¿­ä»£å¼å•è½®å¯¹è¯ï¼Ÿ prompt = &quot;USER: &quot; + prompt + &quot;\\n\\nASSISTANT: &quot; print(&quot;\\n&quot; + prompt, end=&quot;&quot;) input_ids = tokenizer(prompt, return_tensors=&quot;pt&quot;).input_ids # é€šè¿‡tokenizeræŠŠpromptè½¬æˆptï¼ˆpytorchï¼‰å½¢å¼çš„tensorï¼Œç„¶åä»ä¸­æå–input_ids input_ids = input_ids.to(model.device) seq_len = input_ids.shape[1] # ç¬¬äºŒä¸ªç»´åº¦æ˜¯seq_len if kv_cache is not None: # å¦‚æœå­˜åœ¨kv cacheï¼Œå³ä¸æ˜¯ç¬¬ä¸€ä¸ªtoken space_needed = seq_len + max_gen_len past_key_values = kv_cache.evict_for_space(past_key_values, space_needed) # åœ¨è¿™é‡Œå®ç°past_key_valuesçš„sink + windowçš„cacheçš„ç»´æŠ¤ã€‚ past_key_values = greedy_generate( # è°ƒç”¨ä¸Šé¢é‚£ä¸ªmethodè¿›è¡Œgreedy decoding model, tokenizer, input_ids, past_key_values, max_gen_len=max_gen_len )def main(args): model_name_or_path = args.model_name_or_path model, tokenizer = load(model_name_or_path) test_filepath = os.path.join(args.data_root, &quot;mt_bench.jsonl&quot;) print(f&quot;Loading data from &#123;test_filepath&#125; ...&quot;) # å¯¼å…¥æ¨¡å‹å’Œæ•°æ® if not os.path.exists(test_filepath): download_url( &quot;https://raw.githubusercontent.com/lm-sys/FastChat/main/fastchat/llm_judge/data/mt_bench/question.jsonl&quot;, args.data_root, ) os.rename(os.path.join(args.data_root, &quot;question.jsonl&quot;), test_filepath) list_data = load_jsonl(test_filepath) prompts = [] for sample in list_data: prompts += sample[&quot;turns&quot;] if args.enable_streaming: kv_cache = enable_streaming_llm( model, start_size=args.start_size, recent_size=args.recent_size )# è¿™ä¸ªmethodçš„ä½œç”¨å¤§æ¦‚æ˜¯ï¼šæ›¿æ¢llamaä¸­çš„RoPEä»¥åŠforwardéƒ¨åˆ†ï¼Œä»è€Œå¯ä»¥å®ç°sink + windowsï¼Œä»¥åŠcache RoPEçš„åŠŸèƒ½ï¼Œç„¶åä¼šè¿”å›ä¸€ä¸ªåº”ç”¨äº†ä¸Šé¢é‚£äº›ä¿®æ”¹çš„kv cacheï¼Œå³sink + window else: kv_cache = None # å¦‚æœä¸å¯ç”¨streamingï¼Œä¸ºå•¥kv_cacheè®¾ç½®ä¸ºnoneï¼ŸåŸå› åœ¨äºï¼Œå•è½®å¯¹è¯ä¸éœ€è¦cacheï¼Œå¦‚æœæ˜¯å¤šè½®ï¼Œåˆ™æœ‰historyå‚æ•°ä¼ å…¥ï¼Œä½œä¸ºqueryåŠ åˆ°æˆ‘ä»¬å½“å‰è½®çš„å¯¹è¯ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´kv cacheæ²¡å¿…è¦å­˜ã€‚ # ä½†æ˜¯ï¼Œåœ¨streamingçš„æƒ…å†µä¸‹ï¼Œä¼¼ä¹å¯ä»¥æŠŠmax_gen_lenè®¾ç½®æˆå¾ˆå¤§ï¼Œä¸€ç›´æ— é™åœ°å¯¹è¯ä¸‹å»ã€‚ streaming_inference( model, tokenizer, prompts, kv_cache, )if __name__ == &quot;__main__&quot;: parser = argparse.ArgumentParser() parser.add_argument( &quot;--model_name_or_path&quot;, type=str, default=&quot;lmsys/vicuna-13b-v1.3&quot; ) parser.add_argument(&quot;--data_root&quot;, type=str, default=&quot;data/&quot;) parser.add_argument(&quot;--enable_streaming&quot;, action=&quot;store_true&quot;) parser.add_argument(&quot;--start_size&quot;, type=int, default=4) parser.add_argument(&quot;--recent_size&quot;, type=int, default=2000) args = parser.parse_args() main(args) å®ç°streaming-llmï¼Œä¸»è¦æ˜¯å¯¹æ¨¡å‹çš„kv_cacheåŠå…¶forwardæœºåˆ¶è¿›è¡Œä¿®æ”¹ï¼Œå¯¹modelçš„forwardä¹Ÿä¼šè¿›è¡Œä¿®æ”¹ï¼›æ­¤å¤–ï¼Œåœ¨generateä¸Šä¹Ÿéœ€è¦è¿›è¡Œç›¸åº”çš„è°ƒæ•´ã€‚è€Œåƒæ˜¯qwenä¸­çš„cli_demo.pyï¼Œå…¶å¯¹è¯çš„printä¹‹ç±»çš„ä¸œè¥¿ä¹Ÿè¦è°ƒæ•´ï¼Œæ€»çš„æ¥è¯´æ„Ÿè§‰è¿™ä¸ªè°ƒæ•´æ˜¯å…¨é¢çš„ï¼Œè€Œéå•ä¸€æ”¹ç®—æ³•ã€‚ é‚£ä¹ˆï¼Œé¡¹ç›®å…¨éƒ¨é˜…è¯»å®Œæ¯•ä¹‹åï¼Œç¡®å®šä¸€ä¸‹modeling_qwenä¿®æ”¹çš„æ€è·¯ï¼šæ€»çš„æ¥è¯´ï¼Œå„ç§æ–‡ä»¶å¤§æŠµéƒ½å¯ä»¥ç»“åˆmodeling_qwen.pyçš„æºæ–‡ä»¶ç›¸å…³éƒ¨åˆ†è¿›è¡Œä¸€äº›è°ƒæ•´ï¼›greedy_generateè¿™ä¸ªä¿®æ”¹ï¼Œåœ¨qwenä¸­åº”è¯¥æ˜¯chat&#x2F;chat_streamï¼Œè€Œégenerate ä¸­åˆï¼Œå’ŒZå“¥ä¸€èµ·å»åƒæ²™å¿å°åƒï¼Œé¢‡æœ‰æ„Ÿæ…¨ã€‚æƒ³èµ·è‡ªå·±åˆä¸­çš„æ—¶å€™ï¼Œå¾ˆå–œæ¬¢åƒå°åŒºé—¨å£é‚£å®¶æ²™å¿å°åƒçš„è‚‰ä¸é¥­ï¼Œ11å—ï¼Œç»å¸¸å»åƒï¼Œæœ‰æ—¶å€™å®¶é‡Œåšäº†é¥­ï¼Œä½†é¦‹é‚£ä¸€å£ï¼Œä¹Ÿä¼šå»åƒï¼›è®°å¾—æœ‰ä¸€æ¬¡ï¼Œæˆ‘å·²ç»è¿‡ä¸–çš„å¥¶å¥¶åšå¥½äº†é¥­å«æˆ‘åƒï¼Œæˆ‘è¯´ä¸åƒï¼Œå»ä¹°æ²™å¿å°åƒåƒï¼Œä¹°å›æ¥å¥¹çœ‹åˆ°ï¼Œè¯´â€œå°±è¿™ä¸ªä¸œè¥¿å•Šâ€ã€‚å“ˆå“ˆï¼Œå¥¹ä¹Ÿæ²¡æœ‰é€¼æˆ‘åƒå®¶é‡Œçš„é¥­ã€‚å€’æ˜¯ç°åœ¨ï¼Œæƒ³åƒä¸€å£ï¼Œç»ˆç©¶ä¹Ÿæ˜¯åƒä¸ä¸Šäº†ã€‚ä¸Šäº†é«˜ä¸­ï¼Œç”±äºå­¦ä¸šå‹åŠ›å¤§ï¼ŒåŠ ä¹‹æ²¡å•¥é’±ï¼Œæœ‰é’±ä¼šå»ä¸Šç½‘å§ï¼Œä¼¼ä¹å°±å†ä¹Ÿæ²¡åƒè¿‡é‚£å®¶æ²™å¿ã€‚å¤§å­¦å†å»ï¼Œå‘ç°å·²ç»å…³é—¨äº†ï¼Œåƒå…¶ä»–æ²™å¿ä¹Ÿæ‰¾å›ä¸äº†è®°å¿†é‡Œçš„æ„Ÿè§‰ã€‚æƒ³æ¥ï¼Œæ²™å¿æˆ–è®¸æ˜¯æˆ‘åˆä¸­ç”Ÿæ´»çš„ä¸€ä¸ªç¼©å½±ï¼Œæœ‰å’Œæœ‹å‹åœ¨æ²™å¿åƒçš„è®°å¿†ã€æœ‰ååœ¨ç”µè„‘å‰æ‰“æ¸¸æˆåƒæ²™å¿çš„è«åå…¶å¦™çš„å¾ˆèˆ’é€‚çš„æ„Ÿè§‰ã€‚ç„¶è€Œä¸€åˆ‡éƒ½å·²è¿‡å»ï¼Œæˆ‘ä¹Ÿæ‰¾ä¸å›é‚£ç§æ‡µæ‡‚ã€çº¯ç²¹å¿«ä¹çš„æ„Ÿè§‰ã€‚ æ™šä¸Šï¼Œçº¿ä¸Šä¼šè®®ï¼Œçº¯çœ‹å®¢ã€‚å¼€å®Œå’ŒLTï¼ŒNZYå’Œå¥¹å¯¹è±¡æ‰“å¤§ä¹±æ–—ã€‚æå¦ˆï¼Œå‘Nå¼€ç‚®ä¼¼ä¹ç»™äººå§‘å¨˜å“ç€äº†ï¼Œåé¢éº¦éƒ½æ²¡å•¥å£°éŸ³ğŸ˜¨ğŸ˜¨ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šå°†streaming-llmå®ç°åˆ°qwenä¸­ or æ¥æ‰‹ä»Šæ—©æ‰è·Ÿæˆ‘è¯´çš„å¤šè·¯å¬å›æ£€ç´¢ä¼˜åŒ–é¡¹ç›® æ­¤å¤„è®°å½•streaming-llmåº”ç”¨åˆ°qwenä¸Šçš„ä¸€äº›å…·ä½“ä¿®æ”¹ enable_streaming_llm.py 123456789101112# åœ¨elifæ–°å¢ï¼š elif &quot;qwen&quot; in model.config.model_type: # qwenç»“æ„å’Œllamaç±»ä¼¼ï¼Œåº”è¯¥copy llamaçš„è®¾ç½®å°±è¡Œã€‚ k_seq_dim = v_seq_dim = 1 from .pos_shift.modify_falcon import ( enable_falcon_pos_shift_attention, ) enable_falcon_pos_shift_attention(model)# qwenç»“æ„å’Œllamaç±»ä¼¼ï¼Œä½†æ˜¯llamaä¸­ attn_output.sizeçš„shapeæ˜¯(bsz, self.num_heads, q_len, self.head_dim)# è€Œæ­£å¦‚ä¹‹å‰æ‰€æåˆ°çš„ï¼Œqwené‡Œé¢åº”è¯¥æ˜¯(bsz, q_len, self.num_heads, self.head_dim)ï¼Œå› è€Œseq_dimåº”è¯¥æ˜¯1# æ­¤å¤–ï¼Œæ ¹æ®ç›®å½•ï¼Œfrom streaming_llm.kv_cache import StartRecentKVCache è¿™ç§æˆ–è®¸è¦æ”¹æˆ from .kv_cache import StartRecentKVCache kv_cache.py + utils.py ä¼¼ä¹ä¸éœ€è¦æ”¹åŠ¨ï¼›kv_cache.pyæ˜¯æ„Ÿè§‰æ²¡æœ‰éœ€è¦æ”¹çš„ï¼›utils.pyæ˜¯ä¸‹è½½ã€åŠ è½½æ•°æ®çš„classï¼Œæš‚æ—¶æ²¡æ‰“ç®—ç”¨è¿™ä¸ªã€‚è€Œä¸”åº”è¯¥å¯ä»¥ç…§æ¬è¿‡æ¥ç”¨ pos_shift&#x2F;modify_llama.py è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œé’ˆå¯¹æ¯ä¸ªmodelæ–‡ä»¶éƒ½å†™äº†ä¸€ä¸ªmodify_xxx.pyï¼Œé‚£ä¹ˆqwenéœ€è¦åœ¨è¿™ä¸‹é¢å†™ä¸ªæ–‡ä»¶modify_qwen.pyï¼Œåº”è¯¥æ˜¯åœ¨llamaçš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å³å¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202# å°šæœªåšå®Œï¼Œqwen1çš„modelæ–‡ä»¶å¤ªæ··ä¹±äº†ï¼Œæœ‰å¾ˆå¤šå¤šæ­¤ä¸€ä¸¾çš„ä¸¾åŠ¨ï¼Œæœ‰å¾ˆå¤šæ“ä½œç›´æ¥ä½¿ç”¨pytorchçš„åŸç”Ÿæ–¹æ³•å°±å¯ä»¥ç›´æ¥å®Œæˆï¼Œå®ƒéè¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼›ä¼ å‚ä»€ä¹ˆçš„è·Ÿllamaå¾ˆä¸ç›¸åŒï¼›è€Œqwen1.5çš„modelæ–‡ä»¶å°±å’Œllamaå¾ˆè¿‘ä¼¼ã€‚ # æš‚æ—¶æ²¡æ—¶é—´æ”¹äº†ï¼Œå·¥ä½œå†…å®¹æœ‰å˜ã€‚æ•ˆæœå°šæœªéªŒè¯ã€‚import mathfrom typing import Optional, Tupleimport torchfrom torch import nnimport torch.utils.checkpointimport torch.nn.functional as Ffrom ..modeling_qwen import ( QWenAttention, _rotate_half, apply_rotary_pos_emb,)import types__all__ = [&quot;enable_qwen_pos_shift_attention&quot;]def apply_rotary_pos_emb_single(x, cos, sin, position_ids): # The first two dimensions of cos and sin are always 1, so we can `squeeze` them. cos = cos.squeeze(1).squeeze(0) # [seq_len, dim] sin = sin.squeeze(1).squeeze(0) # [seq_len, dim] cos = cos[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] sin = sin[position_ids].unsqueeze(1) # [bs, 1, seq_len, dim] x_embed = (x * cos) + (_rotate_half(x) * sin) return x_embeddef qwen_pos_shift_attention_forward( self, hidden_states: Optional[Tuple[torch.FloatTensor]], rotary_pos_emb_list: Optional[List[List[torch.Tensor]]] = None, layer_past: Optional[Tuple[torch.Tensor]] = None, attention_mask: Optional[torch.FloatTensor] = None, head_mask: Optional[torch.FloatTensor] = None, encoder_hidden_states: Optional[torch.Tensor] = None, encoder_attention_mask: Optional[torch.FloatTensor] = None, output_attentions: Optional[bool] = False, use_cache: Optional[bool] = False,) -&gt; Tuple[torch.Tensor, Optional[torch.Tensor], Optional[Tuple[torch.Tensor]]]: bsz, q_len, _ = hidden_states.size() mixed_x_layer = self.c_attn(hidden_states) query, key, value = mixed_x_layer.split(self.split_size, dim=2) query = self._split_heads(query, self.num_heads, self.head_dim) key = self._split_heads(key, self.num_heads, self.head_dim) value = self._split_heads(value, self.num_heads, self.head_dim) past_len = 0 if layer_past is not None: past_len = layer_past[0].shape[1] if rotary_pos_emb_list is not None: # cur_len = query.shape[1] if len(rotary_pos_emb_list) == 1: rotary_pos_emb = rotary_pos_emb_list[0] rotary_pos_emb = [i[:, -past_len:, :, :] for i in rotary_pos_emb] rotary_pos_emb = (rotary_pos_emb,) * 2 q_pos_emb, k_pos_emb = rotary_pos_emb # Slice the pos emb for current inference query = apply_rotary_pos_emb(query, q_pos_emb) key = apply_rotary_pos_emb(key, k_pos_emb) else: query_list = [] key_list = [] for i, rotary_pos_emb in enumerate(rotary_pos_emb_list): rotary_pos_emb = [i[:, -past_len:, :, :] for i in rotary_pos_emb] rotary_pos_emb = (rotary_pos_emb,) * 2 q_pos_emb, k_pos_emb = rotary_pos_emb # Slice the pos emb for current inference query_list += [apply_rotary_pos_emb(query[i:i+1, :, :], q_pos_emb)] key_list += [apply_rotary_pos_emb(key[i:i+1, :, :], k_pos_emb)] query = torch.cat(query_list, dim=0) key = torch.cat(key_list, dim=0) if self.use_cache_quantization: key = quantize_cache_v(key.permute(0, 2, 1, 3), bits=8, qmin=self.cache_qmin, qmax=self.cache_qmax) value = quantize_cache_v(value.permute(0, 2, 1, 3), bits=8, qmin=self.cache_qmin, qmax=self.cache_qmax) if layer_past is not None: past_key, past_value = layer_past[0], layer_past[1] if self.use_cache_quantization: # use_cache_quantization: # present=((q_key,key_scale,key_zero_point), # (q_value,value_scale,value_zero_point)) key = (torch.cat((past_key[0], key[0]), dim=2), torch.cat((past_key[1], key[1]), dim=2), torch.cat((past_key[2], key[2]), dim=2)) value = (torch.cat((past_value[0], value[0]), dim=2), torch.cat((past_value[1], value[1]), dim=2), torch.cat((past_value[2], value[2]), dim=2)) else: # not use_cache_quantization: # present=(key,value) key = torch.cat((past_key, key), dim=1) value = torch.cat((past_value, value), dim=1) if use_cache: present = (key, value) else: present = None key_size = key[0].size(2) if self.use_cache_quantization else key.size(1) if key_size &gt; self.seq_length and self.use_logn_attn and not self.training: if self.use_cache_quantization: seq_start = key[0].size(2) - query.size(1) seq_end = key[0].size(2) else: seq_start = key.size(1) - query.size(1) seq_end = key.size(1) logn_tensor = self.logn_tensor[:, seq_start:seq_end, :, :].type_as(query) query = query * logn_tensor.expand_as(query) if ( self.use_flash_attn and flash_attn_unpadded_func is not None and not self.is_fp32 and query.is_cuda ): q, k, v = query, key, value attn_output = self.core_attention_flash(q, k, v, attention_mask=attention_mask) else: key_size = key[0].size(2) if self.use_cache_quantization else key.size(1) if query.size(1) == key_size: causal_mask = torch.tril( torch.ones((key_size, key_size), dtype=torch.bool, device=query.device) ).view(1, 1, key_size, key_size) else: causal_mask = None query = query.permute(0, 2, 1, 3) if not self.use_cache_quantization: key = key.permute(0, 2, 1, 3) value = value.permute(0, 2, 1, 3) if ( causal_mask is None and self.use_flash_attn and flash_attn_unpadded_func is not None and not self.is_fp32 and not query.is_cuda ): raise Exception(_ERROR_INPUT_CPU_QUERY_WITH_FLASH_ATTN_ACTIVATED) if not self.use_cache_quantization and SUPPORT_TORCH2: if attention_mask is not None: attention_mask = attention_mask.expand(-1, -1, query.size(2), -1) if causal_mask is not None: attention_mask = attention_mask.masked_fill(~causal_mask, torch.finfo(query.dtype).min) else: attention_mask = causal_mask attn_output = F.scaled_dot_product_attention( query, key, value, attn_mask=attention_mask ).transpose(1, 2) attn_weight = None else: attn_output, attn_weight = self._attn( query, key, value, causal_mask, attention_mask, head_mask ) context_layer = self._merge_heads( attn_output, self.num_heads, self.head_dim ) # print(&#x27;attn_output before c_proj.shape:&#123;&#125;&#x27;.format(attn_output.shape)) attn_output = self.c_proj(context_layer) # print(&#x27;attn_output.shape:&#123;&#125;&#x27;.format(attn_output.shape)) outputs = (attn_output, present) if output_attentions: if ( self.use_flash_attn and flash_attn_unpadded_func is not None and not self.is_fp32 ): raise ValueError(&quot;Cannot output attentions while using flash-attn&quot;) elif not self.use_cache_quantization and SUPPORT_TORCH2: raise ValueError(&quot;Cannot output attentions while using scaled_dot_product_attention&quot;) else: outputs += (attn_weight,) return outputsdef enable_qwen_pos_shift_attention(model): for name, module in reversed(model._modules.items()): if len(list(module.children())) &gt; 0: enable_llama_pos_shift_attention( module, ) if isinstance(module, LlamaAttention): model._modules[name].forward = types.MethodType( llama_pos_shift_attention_forward, model._modules[name] ) 5.16ä»Šå¤©ç»§ç»­å°è¯•å°†streaming-llmé€‚é…qwen1ï¼Œä½†æ˜¯è¿›å±•ä¸ç†æƒ³ï¼Œå…·ä½“å†…å®¹å¦‚ä¸Šé¢çš„ä»£ç æ³¨é‡Šæ‰€ç¤ºã€‚é—®é¢˜å‡ºç°åœ¨streaming-llmçš„æ ¸å¿ƒä»£ç ï¼Œå…¶ä¸­ä½¿ç”¨çš„åŸºäºcacheçš„RoPEåœ¨qwenä¸­åº”ç”¨éš¾åº¦è¾ƒå¤§ã€‚å› ä¸ºqwenattentionçš„forwardä¸­æ²¡ç”¨position_idè¿™ä¸ªå‚æ•°ï¼Œäºæ˜¯å»å‚è€ƒå¦ä¸€ä¸ªmodify_falcon.pyæ–‡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªçš„modelæ–‡ä»¶ä¹Ÿæ˜¯æ²¡æœ‰position idçš„ã€‚ä½†æ˜¯ï¼Œç»“åˆå…¶modifyæ–‡ä»¶å’Œmodelæ–‡ä»¶ä¹‹åï¼Œæ²¡å‘ç°æœ‰å¾ˆæ˜æ˜¾çš„åº”ç”¨åŸºäºcacheçš„RoPEåšæ³•ã€‚ä»…ä»…æ˜¯åŸºäºpast lenåšäº†ä¸€äº›è°ƒæ•´ã€‚æˆ–è®¸ï¼Œmodeling_qwençš„ä¿®æ”¹ï¼Œåœ¨attentionéƒ¨åˆ†ï¼Œåº”è¯¥ä¹Ÿæ˜¯åƒfalconä¸­è¿›è¡Œpast_lenè¿™ä¸ªå‚æ•°çš„è®¾ç½®å’Œåº”ç”¨ã€‚ç„¶åï¼Œå¯¹äºkv_cache.pyè¿™ä¸ªæ–‡ä»¶ç›´æ¥ä½¿ç”¨ï¼Œç„¶åå†æ”¹å†™chatæ–¹æ³•ï¼ŒåŸºäºæ”¹å†™åçš„chatæ–¹é¢å†™cli_demo.pyã€‚æ­£å¦‚ä¹‹å‰æ‰€è¯´ï¼Œè¿™ä¸ªæµç¨‹åº”è¯¥æ˜¯ä¸€ä¸ªç»¼åˆçš„è¿‡ç¨‹ã€‚æˆ–è®¸qwen1é‡Œé¢åªè¦åº”ç”¨kv_cache.pyå¯¹å®ƒè¿™ä¸ªæ¨¡å‹çš„kv_cacheè¿›è¡Œä¿®æ”¹åï¼Œè‡ªåŠ¨RoPEå°±æ˜¯æ°´åˆ°æ¸ æˆçš„åŸºäºcacheäº†ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šåº”ç”¨ä»Šå¤©çš„æ€è·¯ï¼Œä¿®æ”¹qwen 5.17æŠŠRoPEä¸­cur_lençš„éƒ¨åˆ†ï¼Œå‚ç…§modify_falcon.pyä¸­ï¼Œä¿®æ”¹æˆäº†past_lenã€‚ä½†æ˜¯åº”è¯¥æœ€å¥½è¿˜æ˜¯qwen1.5ä¿®æ”¹ä¸ºä½³ã€‚è¿™ä¸ªé¡¹ç›®è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯greedy decodingï¼Œæ²¡æœ‰æ¸©åº¦ã€éšæœºæ€§å•¥çš„ã€‚ æ— å¥ˆäº†ï¼Œç»ˆç©¶ä¸èƒ½æé•¿æ–‡æœ¬äº†ã€‚é¢†å¯¼è¦çœ‹åˆ°æ•ˆæœï¼Œç«‹åˆ»è½¬æˆ˜å¤šè·¯å¬å›æ£€ç´¢ä¼˜åŒ–ã€‚æœ¬ä»¥ä¸ºé€æ¸ç¨³å®šæ­¥å…¥æ­£è½¨ï¼Œç»ˆç©¶æ˜¯ä¸€å¢æƒ…æ„¿ã€‚äººåœ¨æ±Ÿæ¹–ï¼Œèº«ä¸ç”±å·±ï¼ çœ‹äº†é¡¹ç›®å·²ç»å†™å¥½çš„åŸºäºllamaindex + fastapiçš„ä»£ç ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰readmeï¼Œä»£ç ä¹Ÿæ²¡ç”¨æ³¨é‡Šï¼Œæ‰€ä»¥çœ‹çš„ä¸€å¤´é›¾æ°´ã€‚ ä¸‹å‘¨ä»»åŠ¡ï¼šäººåœ¨æ±Ÿæ¹–å™œ~~ç ”ç©¶å¤šè·¯å¬å›çš„å®ç°ï¼Œä»è¯»æ‡‚ä»£ç å¼€å§‹ï¼æ²¡å¼€å‘è§„èŒƒçœŸæ˜¯çƒ¦äººï¼è‰å°ç­å­è¯´æ˜¯ï¼ 5.18 - 5.19å‘¨å…­ï¼Œæœ¬æ¥å’ŒZZKè¶Šå¥½ä¸‹åˆä¸‰ç‚¹åŠåœ¨åŒ—äº¬åŠ¨ç‰©å›­ç¢°é¢ï¼Œç»“æœæˆ‘ä¸€ç‚¹ç¡åˆè§‰ç¡è¿‡äº†ï¼Œè¿˜æ˜¯ä»–æ‰“ç”µè¯è¿‡æ¥æˆ‘æ‰é†’ã€‚æ€¥æ€¥å¿™å¿™åœ°èµ¶è¿‡å»ï¼Œå·²ç»å››ç‚¹åŠäº†ã€‚ä»–å»ä¹°äº†é¥®æ–™ï¼Œç„¶åæˆ‘ä»¬åˆ·ç¥¨è¿›åŠ¨ç‰©å›­ã€‚è¿›ç†ŠçŒ«é¦†çš„æ—¶å€™ï¼Œå‘ç°ZZKä¹°çš„æ˜¯ä¸å¸¦ç†ŠçŒ«é¦†çš„ç¥¨ï¼Œç»“æœä»–åˆä¹°äº†ä¸€ä»½ï¼Œç„¶åå°è¯•é€€ä¹‹å‰çš„ç¥¨ï¼Œå¤±è´¥ï¼›å°è¯•é€€åˆšä¹°çš„ç¥¨ï¼Œå¤±è´¥ï¼›å› ä¸ºä¸¤å¼ ç¥¨éƒ½å·²ç»è¢«å®é™…ä¸Šä½¿ç”¨è¿‡äº†ğŸ¤£ğŸ¤£ï¼Œé“¸å¸å§ã€‚ä¸‹åˆï¼Œè¿™ä¸ªæ—¶é—´åŠ¨ç‰©ä»¬éƒ½æ²¡ä»€ä¹ˆç²¾ç¥ï¼Œç†ŠçŒ«è¶´åœ¨é‚£å„¿ç¡è§‰ï¼Œçœ‹ä¸è§æ­£è„¸ã€‚æœ‰å¥½é•¿çš„é˜Ÿåœ¨æ’ä¸€ä¸ªå¥½åƒæ˜¯ç½‘çº¢ç†ŠçŒ«çš„é¦†ï¼Œæˆ‘ä»¬å«Œå¤ªé•¿å°±æ²¡å‡‘çƒ­é—¹ã€‚å¹¸è¿çš„æ˜¯ï¼Œåœ¨ç†ŠçŒ«é¦†é‡Œé¢é€›äº†ä¸€é˜µå­ï¼Œæ­£å¥½é‡è§ä¸€ä¸ªå¤§ç†ŠçŒ«æ‰“ç›¹ç»“æŸå‡ºæ¥é€›é€›ï¼Œæ‹ä¸‹æ¥äº†ã€‚ä¹‹åï¼Œåœ¨åŠ¨ç‰©å›­é‡Œé¢å…¶ä»–åœ°æ–¹é€›ï¼Œè¾¹é€›è¾¹å’ŒZZKèŠå¤©ã€‚çœ‹äº†é¹¦é¹‰ã€ç‹¼ã€ç¾šç¾Šã€åŒ—æç†Šå•¥çš„ã€‚éƒ½æ˜¯æ‡’è¶´è¶´çš„ã€‚èµ°åˆ°å¤§æ¦‚å…­ç‚¹å¤šï¼Œé€›ç´¯äº†ï¼Œäºæ˜¯æˆ‘ä»¬èµ°å»å¾·å‡¯mallåƒä¸€å®¶ç»¿èŒ¶é¤å…ï¼Œå¥½åƒæ˜¯æ­å·èœğŸ˜…ï¼ŒçœŸæ˜¯æ˜çŸ¥ç¾é£Ÿè’æ¼ ï¼Œåå‘è’æ¼ è¡Œå‘€ã€‚ç‚¹äº†è”æè™¾çƒå’ŒæŠ¹èŒ¶é¥¼ä¸¤ä¸ªç”œå“ï¼Œå¯æƒœè¿™ä¸ªè™¾çƒå¾ˆä¸€èˆ¬ï¼Œä¸æ˜¯æˆ‘è®°å¿†åŠ›é«˜ä¸‰æš‘å‡å’ŒZZCä¸€èµ·å»æ­å·åœ¨æ–°å‘¨è®°åƒçš„é‚£ç§ã€‚æ‹›ç‰Œèœä¸€ä¸ªç³–é†‹å£çš„æ’éª¨ï¼Œéš¾åƒğŸ˜…ï¼›çƒ¤é¸¡ã€çƒ¤è‚‰ç‰‡ã€ç«¹ç¬‹è¿™ä¸‰é“èœä¸­è§„ä¸­çŸ©ï¼Œä½†è¿™tmå¥½åƒä¹Ÿä¸æ˜¯æ­å·èœï¼Œæ— è¯­å­â€¦â€¦é“¸å¸ZZKä¸€å¼€å§‹è¿˜æƒ³ç‚¹è¥¿æ¹–é†‹é±¼ï¼Œå¹¸å¥½ç»™æˆ‘æ‹¦ä½äº†ã€‚ä¹‹åï¼Œåœ¨å•†åœº-1å±‚çš„è¶…å¸‚é€›äº†é€›ï¼Œç„¶åå‡†å¤‡å›å»äº†ã€‚åœ¨luckyinä¹°äº†ä¸¤æ¯å’–å•¡ï¼Œä¸­é€”èŠåˆ°WXFï¼Œå’Œä»–æ‰“ç”µè¯ï¼Œçº¦äº†ä¸‹å‘¨ä¿ºä»¬ä¸‰ä¸€èµ·å»çˆ¬å…«è¾¾å²­é•¿åŸå™œã€‚æ™šä¸Šåˆ°å‡ºç§Ÿå±‹ï¼Œå’ŒLSHã€LTã€SHæ‰“æ¸¸æˆï¼Œåç‚¹å¤šçš„æ—¶å€™æŠŠå’–å•¡å–å®Œäº†ã€‚ç»“æœï¼Œæ™šä¸Šï¼Œä¸çŸ¥é“æ˜¯çƒ­çš„è¿˜æ˜¯å› ä¸ºå’–å•¡ï¼Œç¡ä¸ç€ï¼Œå¼€ç©ºè°ƒèˆ’æœç‚¹ï¼Œä½†æ˜¯ä¹Ÿç¡ä¸ç€ã€‚è¿·è¿·ç³Šç³Šåˆ°ä¸‰ç‚¹å¤šä¼¼ä¹æ‰ç¡ç€ï¼Œç»“æœå…­ç‚¹å¤šå¥½åƒå°±é†’äº†ã€‚æå¦ˆçš„ï¼Œä¸€ä¸Šåˆéƒ½çŠ¶æ€ä¸å¤ªå¯¹ï¼Œè¿˜å¥½ä¸ä¸Šç­ï¼å‘¨æ—¥ï¼Œæ··ã€‚æ”¹äº†ç®€å†ï¼ŒæŠ•äº†TXå®ä¹ ã€‚æ™šä¸Šå’ŒLSHã€SHã€LTã€NZYã€WSæ‰“å¤§ä¹±æ–—ã€‚æ„Ÿè§‰å¾—æ§åˆ¶ä¸€ä¸‹è‡ªå·±çš„è„¾æ°”çš„ï¼Œå”‰ï¼Œä¸¥äºå¾‹äººå®½ä»¥å¾…å·±ã€‚æ„Ÿè§‰æ²¡æœ‰ä»€ä¹ˆå¤–å–ç‚¹äº†ï¼Œé™„è¿‘çš„å¤–å–æ²¡æœ‰æƒ³åƒçš„ã€‚ä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µï¼Œæä¸èµ·åŠ²ï¼Œæ„å•Šï¼ ã€ 5.20æ—©ä¸Šçœ‹æ˜¨å¤©æŠ•çš„ç»“æœï¼Œç§’æŒ‚äº†å°¼ç›çš„ï¼Œç®€å†ç§’æŒ‚ï¼ç»§ç»­çœ‹é¡¹ç›®ä»£ç ï¼Œä¼¼ä¹æœ‰ç‚¹æ˜ç™½ç»“æ„å’Œç”¨æ³•äº†ã€‚ä¸‹åˆå‘ç°è¢«txæäº†ï¼Œæå¦ˆæ˜å¤©é¢è¯•ã€‚ ä¼¼ä¹æ‡‚äº†ä¸€ç‚¹è¿™ä¸ªé¡¹ç›®çš„ç»“æ„ã€‚llamaindexä¼¼ä¹å¯ä»¥ç›´æ¥å¯¼å…¥é¢„å…ˆæ„å»ºçš„ç´¢å¼•ï¼Œç„¶åè®¾ç½®ä¸ºmodel chatçš„å‚æ•°ï¼Œå°±å¯ä»¥å®ç°ragã€‚é‚£ä¹ˆï¼Œæˆ‘å°±è¦åœ¨è¿™ä¸ªindexçš„ç”Ÿæˆä¸Šåšæ‰‹è„šï¼Ÿå…·ä½“çš„æ˜å¤©å†è¯´å§ã€‚ æ™šä¸Šä»–ä»¬æ‰“æ¸¸æˆï¼Œæˆ‘æ²¡å»ã€‚çœ‹leetcodeä¸Šçš„hot 100ä¸­çš„æœ€å¤§æ­£æ–¹å½¢é¢ç§¯ï¼Œå†™äº†ä¸€ç§è§£æ³•ï¼Œç»“æœå’Œä¹‹å‰çš„ä¸€æ ·ï¼Œéƒ½åªæ‰“è´¥äº†5%çš„äººã€‚çœ‹æ¥è¦çœ‹é¢˜è§£äº†ï¼Œå”‰â€¦â€¦ç»™SHå¼€äº†ä¸ªè…¾è®¯ä¼šè®®ï¼Œè®²äº†ä¸€ä¸‹LLMçš„çŸ¥è¯†å’Œç»†èŠ‚ï¼Œç»™ä»–äº§å“ç»ç†AIæ–¹å‘çš„è¡¥ä¸€ä¸‹ç›²ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šå¤šè·¯å¬å› 5.21æµ‹è¯•é¡¹ç›®é‡Œé¢fastapiçš„åŠŸèƒ½ï¼Œå‘ç°è¿™ä¸ªåŠé¡¹ç›®åŸºæœ¬ä¸Šè·‘ä¸é€šï¼Œdocumentçš„å‘é‡åŒ–ä»¥åŠåŸºäºçŸ¥è¯†åº“çš„chatéƒ½nmè·‘ä¸é€šã€‚é—®å¼€å‘çš„ï¼Œä¹Ÿæ”¯æ”¯å¾å¾çš„ï¼Œè‰ï¼è¿™è¿˜è®©æˆ‘åŠ ç­è¿™å‘¨æŠŠè¿™å¤šè·¯å¬å›è·‘é€šå‘¢ï¼Ÿè¿™ä¸çº¯å‘äººå‘¢å˜›ï¼ä¸‹åˆæœ‰é¢è¯•ï¼Œä¸­åˆå›å‡ºç§Ÿå±‹ï¼Œå‘ç°é—¨å¸åˆ°äº†ï¼Œå®‰ä¸Šä¹‹åï¼Œä¼¼ä¹æœ‰ç‚¹æ•ˆæœï¼Œä½†æ¯”è¾ƒéº»çƒ¦ï¼›ç¾ç¾ç¡äº†ä¸€è§‰ã€‚2.30é¢è¯•ï¼ŒåŠå°æ—¶ç»“æŸï¼Œé¢è¯•å®˜æ‘„åƒå¤´éƒ½æ²¡å¼€ã€‚è®©æˆ‘å†™äºŒå‰æ ‘å…ˆåºéå†ï¼Œæå¦ˆçš„éé€’å½’å½¢å¼æ²¡å†™å‡ºæ¥ï¼Œè¿˜æ˜¯å¾—åˆ·é¢˜ï¼æ„Ÿè§‰æ˜¯kpié¢ï¼Œè‰ä»–å¦ˆæ»´ï¼é¢å®Œï¼Œåƒäº†ä¸ªæ²™å¿å°åƒé¸­è…¿é¥­ï¼Œç„¶åå›ç­ä¸Šå¹²æ´»ã€‚ å…¨æ˜¯å‘å•Šå…„å¼Ÿä»¬ï¼æ²¡æœ‰å¼€å‘è§„èŒƒï¼Œæ²¡æœ‰äº§å“æ–‡æ¡£ï¼Œæˆ‘çœŸæ˜¯æ“äº†ï¼ ä¸€ä¸ªç°åœ¨æ‰æ˜ç™½çš„å°çŸ¥è¯†: 12345678# a/b/c.pyä¸­# .ä»£è¡¨bç›®å½•ï¼Œå¯ä»¥./xxxå¯ä»¥è®¿é—®bç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼›from . importæ˜¯ä»bç›®å½•å¼•å…¥# ..ä»£è¡¨aç›®å½•# power_system_aiqa-develop/server/configs/db_config.pyä¸­local_embedding_model_path = &quot;../embed_models/m3e&quot;# å¦‚æœåœ¨serverä¸‹çš„æ–‡ä»¶é‡Œé¢ï¼Œè¿è¡Œç¨‹åºï¼Œé—´æ¥è°ƒç”¨äº†è¿™ä¸ªconfigï¼Œæ— è®ºåµŒå¥—å¤šå°‘å›ï¼Œéƒ½ä¼šä»¥pwd = serverè¿›è¡Œä¸Šçº§ç›®å½•å¯»å€å’Œè¿”å›ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæƒ…å†µä¸‹åˆ™ä¼šè®¿é—®power_system_aiqa-develop/embed_models/m3e æ˜æ—¥ä»»åŠ¡ï¼šå¤šè·¯å¬å› 5.22 - 5.23æ²¡å•¥å¥½è¯´çš„ï¼Œæ”¹é‚£ä¸ªé¡¹ç›®çš„å¤šè·¯å¬å›éƒ¨åˆ†ã€‚åŠ ç­æ”¹ã€‚å‘ç°æ²¡è·‘é€šçš„é—®é¢˜åœ¨äºï¼Œä¼¼ä¹æ˜¯å®˜æ–¹å®ç°çš„ä»£ç æœ‰ç¼ºé™·ï¼ŒchromaDBè½¬åŒ–ä¸ºvector storeçš„æ—¶å€™è½¬åŒ–ä¸å®Œå…¨&#x2F;æ²¡æ³•æ­£ç¡®è½¬åŒ–ï¼Œå› è€Œè¿›è¡Œæ£€ç´¢çš„æ—¶å€™æ˜¯ç©ºé›†ã€‚åªèƒ½å†™æ­»äº†ï¼ŒæŒ‡å®šæ–‡æ¡£åº“çš„æ–‡ä»¶å¤¹ï¼Œç„¶åç›´æ¥ä»æ–‡æ¡£è½¬åŒ–ä¸ºvector indexç„¶åè¿›è¡Œåç»­æ“ä½œã€‚å®é™…ä¸Šï¼Œæ›´ç²¾ç»†çš„æ“ä½œï¼Œè¿˜éœ€è¦ç›´æ¥ä»documentåŠ è½½æˆnodeï¼Œç„¶ååƒæ˜¯summary indexã€graph indexéƒ½å¯ä»¥ä»è¿™ä¸ªnodeåˆ›å»ºã€‚è¿™æ ·ï¼Œå°±å¯ä»¥æ„å»ºä¸èƒ½ç”±vector indexç›´æ¥è½¬åŒ–çš„indexã€‚åç»­ï¼Œå¯ä»¥åœ¨chaté‡Œé¢åŠ è½½å„ç§indexï¼Œæ„å»ºå¤šæ ·åŒ–çš„retrieverï¼Œç„¶åæ•´åˆèµ·æ¥ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šå¤šè·¯å¬å› 5.24æ—©ä¸Šæ”¹retrieverï¼Œä¹‹å‰å…¶ä»–ç±»å‹çš„index to retrieverçš„éƒ¨åˆ†æ²¡æœ‰è·‘é€šï¼Œå¯èƒ½æ˜¯ä¸å…¼å®¹æˆ–è€…æ•°æ®æ ¼å¼ä¸å¯¹ï¼Ÿå¼€äº†ä¸ªä¼šã€‚å‘ç°åœ¨å›½ä¼é‡Œé¢å¼€å‘åªéœ€è¦åšåº”å£°è™«å°±å¯ä»¥äº†ï¼Œæçš„æ„è§å’Œæƒ³æ³•äººå®¶éƒ½å½“æ²¡å¬åˆ°ã€‚çº¯æŒ‰ç…§å…ˆå…¥ä¸ºä¸»çš„ç†è§£åœ¨èŠã€æ´¾ä»»åŠ¡ã€‚åæ­£æˆ‘å®ä¹ ç”Ÿä¸èƒŒé”…ï¼Œä½ å’‹è¯´æˆ‘å’‹åšå‘—ï¼åæ­£æ˜¯å‡†å¤‡è·‘è·¯äº†ï¼Œè¿™è¾¹æœ¬æ¥è¯´çš„å¡ç°åœ¨ä¹Ÿæ²¡äº†ï¼Œç§‘ç ”ä¹Ÿä¸è®©åšäº†ï¼Œåšå¼€å‘è¿˜nmæ²¡äººå¸¦ï¼Œæ²¡æœ‰åŸ¹å…»æœºåˆ¶ï¼Œè¿˜nmå‚¬è¿›åº¦ã€‚æˆ‘çš„è¯„ä»·æ˜¯è‰å°ç­å­ä¸€æ‹–å››ã€‚ å›é¡¾è¿™æ®µæ—¶é—´ï¼Œæœ¬æ¥åˆšæ¥çš„æ—¶å€™å’Œæ²ˆè€å¸ˆé‚£è¾¹ä¼šå¼€ä¼šï¼Œä¹Ÿæœ‰ä¸€äº›æŒ‡å¯¼ï¼Œä½†æ˜¯æ¸æ¸ä¼šä¹Ÿä¸å¼€äº†ã€‚æœ¬æ¥è¯´æ²ˆè€å¸ˆé‚£è¾¹çš„å­¦ç”Ÿä»¬èƒ½ä¸€èµ·èŠä¸€èŠï¼Œç»“æœé‚£è¾¹çš„å­¦ç”Ÿä¹Ÿå°±å¼€äº†ä¸€ä¸¤æ¬¡ä¼šï¼Œå°±å†ä¹Ÿæ²¡æ¥ã€‚ç”±äºè·ç¦»é¥è¿œï¼Œæ„Ÿè§‰æ²Ÿé€šçš„æ—¶å€™ä¹Ÿå¾ˆè´¹åŠ²ã€‚æ€»è€Œè¨€ä¹‹ï¼Œåˆšå¼€å§‹çš„æ—¶å€™è¿˜å…¢å…¢ä¸šä¸šï¼Œæ…¢æ…¢å‘ç°è¿™è¾¹æ˜¯ä¸ªè‰å°ç­å­ã€ç ”å‘é˜Ÿä¼å’Œç®¡ç†æœºåˆ¶æ··ä¹±ã€ç¼ºé™·è¾ƒå¤§ã€‚è™½ç„¶å­¦åˆ°äº†ç‚¹ä¸œè¥¿ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å¤šã€‚éœ€è¦ä¸€ä¸ªæ–°ç¯å¢ƒã€æ­£å¼çš„ã€æœ‰æ˜ç¡®åŸ¹å…»æœºåˆ¶çš„ç¯å¢ƒã€‚ é¢„è®¡å…­æœˆåˆè¾èŒï¼Œç„¶åé¢é¢å…¶ä»–çš„å§å”‰ã€‚æ€»å½’æ˜¯ä¸€æ­¥æ…¢ã€æ­¥æ­¥æ…¢ã€‚ç†æƒ³æƒ…å†µä¸‹æ˜¯ä¸€æœˆä»½å°±å¼€å§‹å®ä¹ ï¼Œç„¶å4æœˆè¾èŒæˆ–æ˜¯è¯·å‡ä»€ä¹ˆçš„æŠ•æš‘æœŸå®ä¹ ï¼Œç„¶åä¸­é€”ä¼‘æ¯ä¸€ä¸‹ã€æ—…ä¸ªæ¸¸å•¥çš„ï¼Œç„¶åæš‘æœŸå®ä¹ å›æ¥æŠ•ç§‹æ‹›ã€‚ä½†æ˜¯ç°åœ¨ï¼Œæ— å¯å¥ˆä½•åœ°æ™šäº†ä¸¤ä¸ªæœˆï¼Œåªèƒ½æ­¥æ­¥ç´§é€¼ï¼Œå´åˆæ€»æ˜¯èµ¶ä¸åŠâ€¦â€¦å›é¡¾ä»é«˜ä¸­æ¯•ä¸šåˆ°ç°åœ¨çš„æ—¶é—´ï¼Œå› ä¸ºæ‡’æƒ°ã€æ„šè ¢è€Œå¯¼è‡´çš„ä¿¡æ¯å·®ï¼Œé”™è¿‡äº†è®¸å¤šæœºä¼šã€æœ‰è®¸å¤šå¯ä»¥æ›´å¥½çš„é€‰æ‹©æ²¡æœ‰åšå‡ºã€‚æ‚²å¹æ²¡æœ‰æ„ä¹‰äº†ï¼Œåªèƒ½åƒæ›´å¤šçš„è‹¦â€¦â€¦ å‘é¡¹ç›®é‡Œé¢åŠ å…¥äº†document summary retrieverï¼Œè¿™ä¸ªéœ€è¦è°ƒç”¨llmè§£ææ–‡æ¡£ï¼Œå› è€Œæ…¢ï¼Œæˆ–è®¸æ¢æˆembeddingä¼šå¥½ä¸€äº›ã€‚æ¢æˆembeddingçš„å†™æ³•ï¼š 1234retriever = DocumentSummaryIndexEmbeddingRetriever( doc_summary_index, # similarity_top_k=1,) ä½†æ˜¯æ²¡æœ‰æµ‹è¯•ï¼Œä¸‹å‘¨å†æï¼llmè§£ææ—¶è¿è¡Œæ—¶æŠ¥é”™ï¼š 1ValueError: invalid literal for int() with base 10: &#x27;Doc&#x27; ä¸‹å‘¨ä»»åŠ¡ï¼šå¤šè·¯å¬å› 5.25 - 5.26å‰ä¸¤å¤©ï¼Œæƒ³èµ·ZZKçš„æ¨èï¼Œåœ¨ç¾å›¢çš„å°è±¡è¶…å¸‚ä¸Šä¹°äº†åº·å¸ˆå‚…æ–¹ä¾¿é¢ã€ä¸€æ¡¶é…¸å¥¶ã€ä¸€åŒ…ç‹ä¸­ç‹ç«è…¿ã€ä¸€ä¸ª2Lå†°çº¢èŒ¶ã€‚å‘¨å…­ï¼Œä¸‹é›¨ï¼Œé¢„è®¡çš„é•¿åŸä¹‹æ—…ç§»åˆ°æ˜å¤©ã€‚åœ¨å‡ºç§Ÿå±‹æ­‡ç€ï¼Œç©ç©åƒåœ¾é¡µæ¸¸ï¼Œä¸­åˆç‚¹äº†é¸¡å…¬ç…²ï¼Œæ²¹æ²¹çš„ï¼Œåƒåˆ°ä¸€åŠï¼Œå¼€äº†ä¸€åŒ…å‰ä¸¤å¤©åœ¨ç¾å›¢å°è±¡è¶…å¸‚ä¸Šä¹°çš„åº·å¸ˆå‚…æ–¹ä¾¿é¢åŠ äº†è¿›å»ï¼Œåƒæ’‘äº†ã€‚ä¸‹é¥­çš„ç‰‡æ˜¯ã€Šå“†å•¦Aæ¢¦ï¼šå¤§é›„çš„å®‡å®™å°æˆ˜äº‰ã€‹ã€‚ä¸‹åˆå’ŒLTã€SHã€WSã€NZYæ‰“äº†å¤§ä¹±æ–—ã€‚æ™šä¸Šï¼Œè¿˜åƒé‚£ä¸ªé¸¡å…¬ç…²ã€‚è¿™æ¬¡æ„Ÿè§‰ä¸å¤ªè¡Œäº†ï¼Œä¹Ÿè®¸æ˜¯æˆ‘ç»ˆäºåƒè…»äº†ï¼Œä¸‹é¥­çš„ç‰‡æ˜¯ã€Šå“†å•¦Aæ¢¦ï¼šå¤§é›„ä¸æœºå™¨äººç‹å›½ã€‹ï¼Œä½†æ˜¯åªçœ‹äº†å¤§æ¦‚ä¸‰åˆ†ä¹‹ä¸€ï¼Ÿä»Šå¤©ä¸€å¤©çˆ½å–å†°é•‡å†°çº¢èŒ¶ï¼Œç®€ç›´å°±æ˜¯ä»™é…¿ï¼å‘¨æ—¥ï¼Œæ—©èµ·ï¼Œå»åŒ—äº¬åŒ—åé«˜é“åˆ°å…«è¾¾å²­ã€‚ä¸ZZKã€WXFæ±‡åˆã€‚ä¹¦åŒ…é‡Œé¢å¸¦äº†æ˜¨æ™šåœ¨å°è±¡è¶…å¸‚ä¹°çš„ä¸‰ä¸ªä¸‰æ˜æ²»å’Œä¸€ä¸ªé¢åŒ…ï¼Œä»¥åŠä¸‰ç“¶ç›æ±½æ°´ï¼Œä¸€ç“¶å¤§ç“¶æ€¡å®ã€‚åˆ°ç«™é¥¿äº†å…ˆåƒä¸€ä¸ªé¢åŒ…ï¼Œåœ¨ä¸Šé•¿åŸçš„è·¯ä¸Šç»è¿‡å•†åŒºï¼Œçœ‹è§æœ‰è‚¯å¾·åŸºã€èœœé›ªå†°åŸâ€¦â€¦èœœé›ªå†°åŸç¨å¾®è´µä¸€ä¸¤å—é’±ï¼Œç¥ï¼ä½†æ˜¯é¥®æ–™å¸¦å¤Ÿäº†ï¼Œæ²¡ä¹°ã€‚æ˜¨æ™šè¿˜ä¹°äº†ä¸¤æ¿é…¸å¥¶ï¼Œä½†æ˜¯å¿˜å¸¦äº†ï¼Œå˜»å˜»ã€‚è¿‡äº†ä¹æ›²åå…«å¼¯çš„å®‰æ£€ï¼Œåˆèµ°äº†ä¸€æ®µï¼Œæ‰éªŒç¥¨è¿›å…¥åŸå¢™ã€‚å‘ä¸Šçˆ¬ã€‚æˆ–è®¸æ˜¯ç”±äºæ˜¨å¤©ä¸‹äº†ä¸€å¤©çš„é›¨ã€äº¦æˆ–è®¸æ˜¯å› ä¸ºå¤„äºå±±æ—ä¹‹é—´ï¼Œé•¿åŸä¸Šçš„åŒ—é£å¾ˆå¤§ï¼Œåœ¨åŸå¢™å£å¹çš„å¾ˆå‡‰çˆ½ï¼Œè¶³ä»¥æŠµæ¶ˆçƒˆæ—¥ã€‚åŸå¢™ä¸Šäººå¾ˆå¤šï¼Œæ…¢æ…¢åœ°èµ°ã€æ…¢æ…¢åœ°çˆ¬ã€‚å¯æƒœçš„æ˜¯ï¼ŒZZKä¼¼ä¹å› ä¸ºä½è¡€ç³–ï¼Œçˆ¬äº†ä¸€é˜µå­å°±æ’‘ä¸ä½ï¼Œå‘æ™•å‘•åï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯çˆ¬é•¿åŸå‰åˆšåƒä¸œè¥¿æ‰€ä»¥è¿åŠ¨å¯¼è‡´èƒƒéƒ¨ä¸é€‚åº”ï¼Ÿæ€»ä¹‹ï¼Œåœ¨çˆ¬åˆ°çš„å¥½æ±‰çŸ³é‚£é‡Œï¼Œå¤§æ¦‚æ˜¯åŒ—å››æ®µï¼Ÿï¼ˆæ€»å…±æ˜¯12æ®µï¼‰ï¼Œæˆ‘ä»¬å¿…é¡»ä¸‹å»äº†ã€‚èŠ±äº†80rä¸€äººä¹°äº†ä¸‹å±±çš„ç¼†è½¦ã€æŠ‘æˆ–æ˜¯è¿‡å±±è½¦çš„ç¥¨ï¼Ÿå“å“å“ä¸€é¡¿å†²ï¼Œæ²¡å‡ åˆ†é’Ÿå°±åˆ°å‡ºå£äº†ã€‚åœ¨å‡ºå£ï¼Œçœ‹çœ‹äº†ä¸€ä¸‹é»‘ç†Šï¼Œè¿™ä¸ªå‡ºå£æ­£å¥½æ˜¯â€œå…«è¾¾å²­é»‘ç†Šä¹å›­â€ã€‚è¯´æ˜¯ä¹å›­ï¼Œåªæœ‰ä¸‰å››åªå°é»‘ç†Šæ‡’æ‡’çš„è¶´åœ¨é‚£é‡Œæ™’å¤ªé˜³ã€‚åä¸Šäº†å›å»çš„å…¬äº¤ï¼ŒæŠŠé¢„å®šçš„ä¸¤ç‚¹å¤šçš„é«˜é“ç¥¨é€€äº†ã€‚å”‰ï¼Œè¿™ä¸¤å¤©ä¸ºäº†è¿™é•¿åŸçš„æ¥å›ï¼Œæ¨äº†ä¸‰å›ç¥¨ï¼Œ-11rã€‚å…¬äº¤ä¸€ä¸ªå¤šå°æ—¶ååˆ°äº†å•¥é—¨ï¼Œå¿˜äº†ï¼Œæˆ‘ä¹Ÿä¸æƒ³å»ç…ä¸€çœ¼ï¼Œæ€»è€Œè¨€ä¹‹æ˜¯åœ¨æ­ç‹åºœé™„è¿‘ã€‚åœ¨é™„è¿‘æ‰¾äº†é¥­åº—ï¼Œæ’äº†é˜Ÿï¼Œä¸€ç‚¹å¤šæ‰åƒä¸Šé¥­ï¼Œé¥­åº—åå­—å¥½åƒæ˜¯é•¿äº­é…’é¦†ã€‚ç‚¹äº†éŸ­èœç‚’è™¾ç±³ï¼Œç‚’ä¸€ä¸ªå•¥è‡ï¼Œè¿™ä¿©èœæ˜¯å®¶é‡Œçš„å£å‘³ã€‚è¿˜æœ‰ç‰›æ‚ç…²ã€ç”Ÿèœã€å°é…¥è‚‰ï¼Œæˆ‘çš„è¯„ä»·æ˜¯å›¢è´­ç»å…¸å¥—é¤ã€‚æœ¬æ¥ç‚¹äº†ç¾Šè‚‰ä¸²ï¼Œç»“æœä¸Šæ¥å‘ç°nmæ˜¯å°ä¸²ï¼Œè€Œä¸”nmè¿˜æ˜¯é…¸çš„ï¼Œç»™é€€äº†ã€‚åƒå®Œï¼ŒWXFå»çœ‹çœ‹ä»–çš„å¦ä¸€äº›åŒå­¦ã€‚æˆ‘å’ŒZZKä¸€èµ·ï¼Œæ²¿ç€åæµ·é€›ï¼Œé€›åˆ°äº†åœ°é“ç«™ï¼ŒèŠèŠå¤©ï¼Œè›®æƒ¬æ„çš„ï¼Œæœ€ååˆ†é“æ‰¬é•³ï¼Œå¤§æ¦‚å››ç‚¹å¤šï¼Œæˆ‘å›åˆ°äº†å‡ºç§Ÿå±‹ã€‚æ™šä¸Šè¦å’ŒZYRã€LFä¸€èµ·åƒé¥­ï¼Œæ‰€ä»¥å…­ç‚¹å¼€å§‹ç¡è§‰è¡¥ä¸€è¡¥ã€‚æœ¬æ¥é¢„è®¡çš„æ˜¯ä¹ç‚¹åƒæµ·åº•æï¼Œä½†æ˜¯LFä¸ƒç‚¹å¤šå°±èƒ½å›æ¥ï¼Œä¸æ˜¯ä»–ä¹‹å‰è¯´çš„å¤§æ¦‚ä¹ç‚¹ï¼Œå› è€Œåˆå˜å›æ¶®è‚‰ã€‚å…«ç‚¹å‡ºå¤´ï¼Œæˆ‘ä»¬å°±åœ¨è¥¿ç›´é—¨çš„èšå®æºæ±‡åˆäº†ã€‚åƒæ¶®è‚‰çš„è¿‡ç¨‹ä¸­ï¼ŒèŠäº†èŠå„è‡ªçš„ç»å†ã€å¿ƒæ€ä»€ä¹ˆçš„ï¼Œä¹ŸèŠäº†èŠå…«å¦ï¼Œè¿˜æœ‰ä¸€äº›ä¸èƒ½è¨€è¯´çš„ä¸œè¥¿ã€‚åƒå®Œé¥­å·²ç»æ˜¯åç‚¹å¤šäº†ï¼Œæˆ‘ä»¬éª‘ç€è‡ªè¡Œè½¦ï¼Œå»äººæ°‘å¤§å­¦ç«™çš„åœ°é“ç«™ã€‚æ¬¢ä¹çš„æ—¶å…‰æ€»æ˜¯çŸ­æš‚çš„ï¼Œå”‰ï¼11ç‚¹å¤šï¼Œå›åˆ°äº†å‡ºç§Ÿå±‹ã€‚æ˜å¤©åˆè¦ä¸Šç­äº†å”‰ï¼ 5.27åŠ æ‹¿å¤§çš„åç«¯å®ä¹ ç”Ÿå…¥èŒäº†ã€‚åœ¨æœ¬åœ°ä¸Šæµ‹è¯•äº†llamaindexä¸­å…¶ä»–ç±»å‹çš„indexåŠ å…¥åˆ°å¤šè·¯å¬å›é‡Œé¢ï¼Œä½†æ˜¯ç”±äºè°ƒç”¨llmæ¶ˆè€—è¿‡å¤§ã€ä¼¼ä¹ä¸éllmçš„æ£€ç´¢ä¸èƒ½æ•´åˆç­‰åŸå› ï¼Œæ€»ä¹‹æ˜¯æ•´åˆå¤±è´¥äº†ã€‚çœ‹å®˜æ–¹æ–‡æ¡£çš„æ—¶å€™ï¼Œçªç„¶çœ‹åˆ°ï¼Œç”¨ä¸€ä¸ªindexå»ç”Ÿæˆä¸åŒçš„retrieverï¼Œæ‰“å¼€äº†å¦ä¸€ä¸ªæ€è·¯ã€‚äºæ˜¯åŸºäºvector indexï¼ŒåˆåŠ äº†ä¸¤ä¸ªretrieverã€‚è‡³äºæ›´å¤šçš„ï¼Œä¸æ˜¯ä¸æƒ³åŠ ï¼Œè€Œæ˜¯éƒ½éœ€è¦llmæˆ–è€…ä¹‹ç±»çš„ï¼Œæ€»ä¹‹æ˜¯å®šåˆ¶åŒ–æ”¯æŒç¨‹åº¦ä¸é«˜ï¼Œæ— æ³•å®ç°æˆ–æ˜¯å®ç°çš„ä»·å€¼ä¸å¤§ã€‚ä½†æ˜¯æ— è®ºå¦‚ä½•ï¼Œå¤šè·¯å¬å›çš„åå¤´æ€»ç®—ä¸æ˜¯è™šåäº†ï¼Œç›®å‰æ˜¯å››è·¯å¬å›ã€‚å…¶ä¸­ï¼Œä¸‰è·¯å¬å›æ˜¯å’Œembedddingæ¨¡å‹æ·±åº¦ç»‘å®šçš„ï¼Œåé¢ä¼˜åŒ–åº”è¯¥å°±æ˜¯è°ƒæ•´embeddingã€‚è¿˜æœ‰ä¸€è·¯deep memoryï¼Œä¼¼ä¹è‡ªå·±æ”¯æŒåŸºäºæ•°æ®çš„è®­ç»ƒã€‚æ— è®ºå¦‚ä½•ï¼Œå†ä¼˜åŒ–çš„è¯éœ€è¦æå¥½è®­ç»ƒæ•°æ®é›†ã€‚ç›®å‰ï¼Œè¿™ä¸ªå¤šè·¯å¬å›è¿˜æ˜¯æœ¬åœ°ï¼Œå’ŒçŸ¥è¯†åº“çš„è”åŠ¨æ²¡åšå¥½ï¼›å› è€Œï¼Œåç«¯è¿™éƒ¨åˆ†çš„ä¸šåŠ¡ï¼Œè¿˜æœ‰éœ€è¦åšçš„å°±æ˜¯æŠŠè¿™ä¸ªapiæ•´ä½“ä¸Šè·‘é€šã€‚é¢„è®¡æ˜å¤©è¿˜æ˜¯åšè¿™ä¸ªä¸œè¥¿ã€‚çœ‹äº†leaderå’Œteacheråˆ†äº«çš„RAGæ–¹é¢çš„æ¨æ–‡ä¸é¡¹ç›®ï¼Œç†è§£æ›´æ·±äº†ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»RAGç›¸å…³è®ºæ–‡&#x2F;åç«¯apiå®ç°ä¸ä¿®æ”¹ 5.28ç»§ç»­æµ‹è¯•æœ¬åœ°å¤šè·¯å¬å›çš„æ•ˆæœï¼ŒåŸºæœ¬å·²ç»å®šå‹äº†ã€‚æ™šä¸Šå¼€ä¼šè¯´ï¼Œå·®ä¸å¤šå¯ä»¥æ¨è¿›åœ¨çº¿çš„äº†ã€‚ä¹Ÿå°±æ˜¯è¯´è¦è°ƒé€šapiåˆ·äº†ä¸¤é“leetcode æ˜æ—¥ä»»åŠ¡ï¼šè°ƒæ•´åœ¨çº¿api 5.29è®°å½•ä¸€ä¸‹æŸ¥çœ‹ç«¯å£è¿›ç¨‹çš„å‘½ä»¤ï¼š 1234# æŸ¥çœ‹ç«¯å£è¿›ç¨‹netstat -anp | grep ç«¯å£å·# or netstat -tnlp | grep ç«¯å£å· å°è¯•ä¿®å¤åœ¨çº¿å¤šè·¯å¬å›çš„APIï¼Œæ­£å¦‚ä¹‹å‰å®šä½çš„é‚£æ ·ï¼Œé—®é¢˜ä»£ç åº”è¯¥å‡ºåœ¨è¿™ä¸¤è¡Œï¼š 12chroma_collection = chromadb_client.get_collection(kb_id)vector_store = ChromaVectorStore(collection_name=kb_name, collection=chroma_collection, host = &#x27;localhost&#x27;, port = 8000) collectionæ˜¾ç¤ºdocæ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯dictæœ€åä¸¤ä¸ªkeyæ˜¾ç¤ºçš„æ˜¯noneï¼š 1&#x27;data&#x27;: None, &#x27;uris&#x27;: None vectorstoreè¯»å–åï¼Œæ˜¾ç¤ºcollectionä¸ºç©ºã€‚åˆå»GitHub issueä¸Šçœ‹äº†ä¸€ä¸‹ï¼Œç»ˆäºæ˜ç™½äº†è§£å†³æ€è·¯ï¼šé¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜å…¶å®ä¸æ˜¯vector storeçš„é—®é¢˜ï¼Œè€Œæ˜¯bm25è®¡ç®—çš„é—®é¢˜ã€‚åœ¨llama indexä¸­ï¼Œbm25è®¡ç®—éœ€è¦çš„æ˜¯nodesï¼Œä¹Ÿåªèƒ½é€šè¿‡nodesè¿›è¡Œbm25çš„æ„å»ºï¼Œå¹¶æ²¡æœ‰é€‚é…ä»vector storeè½¬åŒ–åˆ°bm25çš„apiï¼Œè¿™æ˜¯æºç æœ¬èº«çš„ç¼ºé™·ã€‚é‚£ä¹ˆï¼Œè§£å†³æ€è·¯ä¹Ÿå°±å¾ˆæ˜ç¡®äº†ï¼šè¦ä¹ˆè‡ªå·±å»æ”¹æºç ï¼Œé€‚é…è¿™ä¸ªè½¬åŒ–ï¼›è¦ä¹ˆå°±æä¸€ä¸ªè¿”å›documentçš„å‡½æ•°ï¼Œç„¶ååœ¨bm25åˆ›å»ºå‰é¢è¯»å–è¿™ä¸ªè¿”å›çš„documentï¼Œå†æ„å»ºnodesä¼ å…¥ã€‚å‡ºäºæ–¹ä¾¿å’Œç¨³å®šæ€§è€ƒè™‘ï¼Œè¿˜æ˜¯é‡‡å–åè€…ï¼Œå½“ç„¶è¿™ç§åšæ³•ä¼šæµªè´¹ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºé¢„å…ˆæ„å»ºçš„åˆ‡ç‰‡ä¸èƒ½ä½¿ç”¨ï¼Œè¿˜è¦å†æ„å»ºä¸€éã€‚ä¿®æ”¹ä¹‹åï¼Œapiå¯ä»¥è·‘é€šäº†ã€‚ä½†æ˜¯æ—¶é—´èŠ±è´¹å¾ˆå¤§ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºgpuèµ„æºä¸è¶³çš„åŸå› ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç”Ÿæˆqueryã€SYNTHESIZEã€LLMä¸‰æ­¥èŠ±è´¹æ—¶é—´å·¨å¤šã€‚æ¯”è¾ƒå¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ä¹‹å‰çš„æ­¥éª¤é‡Œé¢ï¼Œç›´æ¥ä»æœ¬åœ°æ–‡æ¡£è¯»å–çš„è¯ï¼Œåè€Œä¸æ…¢ã€‚æ˜æ˜è¿™ä¿®æ”¹åçš„ä»£ç åªæ˜¯é¢å¤–ç”Ÿæˆäº†ä¸€æ¬¡bm25ï¼Œä½†æ˜¯æ—¶é—´å´å¢åŠ äº†å¥½å¤šã€‚éš¾é“æ˜¯å› ä¸ºåç»­ä¸€ç³»åˆ—æ•°å€¼è¦é‡æ–°è®¡ç®—ã€ç»“æ„è¦é‡æ–°ç”Ÿæˆï¼Ÿçœ‹æ¥åç»­æœ‰å¾ˆå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼›æ­¤å¤–ï¼Œå¾ˆæœ‰æ„æ€çš„ä¸€ç‚¹æ˜¯ï¼Œè¿™ä¸ªç”¨äºbm25çš„ã€ç”±documentè½¬åŒ–è€Œæ¥çš„nodesï¼Œå…¶æ•°æ®ç»“æ„å’Œchromaç›´æ¥è¯»å–çš„collectionä¼¼ä¹å¾ˆç›¸ä¼¼ï¼Œå‰è€…ä¼¼ä¹æ˜¯List[Dict{}]ï¼Œè€Œåè€…ä¼¼ä¹æ˜¯Dict{List[]}ï¼›æ²¡æœ‰ç»†çœ‹ï¼Œä½†æˆ–è®¸å¯ä»¥å†™ä¸€ä¸ªè½¬åŒ–å‡½æ•°ï¼Œç›´æ¥è½¬åŒ–æˆnodesçš„æ•°æ®æ ¼å¼å¯¼å…¥bm25è®¡ç®—ã€‚ æ™šä¸Šï¼Œå’ŒSHã€LTæ‰“å¤§ä¹±æ–—æã€‚ æ˜æ—¥ä»»åŠ¡ï¼šä¼¼ä¹è¦é…åˆå‰ç«¯æ¥å±•ç¤ºé¡¹ç›®æ€»ä½“çš„æ•ˆæœã€‚ 5.30æ˜¨å¤©çš„æµ‹è¯•å¯¹è¯ç»“æœå·¨æ…¢ï¼Œä½†æ˜¯ä»Šå¤©ï¼ŒåŒæ ·çš„ä¸œè¥¿ï¼Œç»“æœåè€Œå¿«äº†å¾ˆå¤šï¼Œç›´æ¥å˜æˆäº†æ˜¨å¤©æµ‹è¯•çš„åå‡ åˆ†ä¹‹ä¸€ï¼Ÿåç«¯å¯¹æ¥äº†ä¹‹å‰çš„å‰ç«¯ï¼Œåšäº†æµ‹è¯•ã€‚å‘ç°è¿™ä¸ªå‰ç«¯åŸºæœ¬éƒ½æ˜¯å†™æ­»çš„ï¼Œå¯¹è¯ã€è®¾ç½®å•¥çš„æ²¡æ³•è°ƒæ•´ï¼Œå…¶å®æ— æ³•æµ‹è¯•ç›®å‰ä¿®æ”¹çš„æ•ˆæœã€‚ä½†æ˜¯ä»fastapiå’Œå‘½ä»¤è¡Œç»“æœæ¥çœ‹ï¼Œåº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚apié‡Œé¢documentéƒ¨åˆ†å•¥çš„è¿˜éœ€è¦ä¿®æ”¹ä¸€ä¸‹ã€‚ä»Šå¤©ä¿®æ­£äº†doc_index_createè¿™ä¸ªapiã€‚ä¸‹ç­å‰å¼€ä¼š ä¸‹åˆï¼Œå¶mané˜¿å§¨çªç„¶æ‰“ç”µè¯æ¥ï¼Œè¯´å‘¨æœ«å¯ä»¥åƒé¥­ã€‚æˆ‘ä¸€å¼€å§‹çœ‹åˆ°æ²³åŒ—å»ŠåŠçš„å·ç è¿˜åœ¨å¥½å¥‡å‘¢ï¼Œä»¥ä¸ºæ˜¯è¯ˆéª—ç”µè¯å•¥çš„éƒ½æ²¡æƒ³æ¥ï¼ŒçŠ¹è±«ä¸€ä¸‹è¿˜æ˜¯æ¥äº†ï¼Œæ²¡æƒ³åˆ°æ˜¯å¶é˜¿å§¨ï¼å¶é˜¿å§¨æ˜¯æˆ‘å¹¼å„¿å›­æ—¶å€™ï¼Œåœ¨ä¿ºçˆ¹å¼€çš„å°å…¬å¸ä¸Šè¿‡ç­çš„å§å§ï¼Œåé¢è™½ç„¶èµ°äº†ï¼Œä½†æ˜¯å’Œæˆ‘å¦ˆå¦ˆå…³ç³»å¾ˆå¥½ï¼Œå¥¹ä»¬ä¸€ç›´æœ‰è”ç³»ã€‚æˆ‘ä¹Ÿæ˜¯å¤§æ¦‚å¤§ä¸‰ï¼Ÿæˆ–æ˜¯ä»€ä¹ˆæ—¶å€™æ‰åŠ ä¸Šå¥¹ï¼Œä½†æ˜¯åˆšåŠ ä¸Šçš„æ—¶å€™è¯´äº†å‡ å¥è¯ï¼Œåé¢ä¸€ç›´æ²¡è”ç³»ï¼Œæ²¡å•¥è¯´çš„æ„Ÿè§‰ã€‚è¿™æ¬¡è¶æˆ‘åœ¨åŒ—äº¬è¿™ä¸ªæœºä¼šï¼Œåƒä¸ªé¥­ï¼Œè¿™å¾ˆå¥½ï¼å®¶é‡Œå–çš„èŒ¶å¶ä¼¼ä¹æœ‰ä¸å°‘éƒ½æ˜¯å¶é˜¿å§¨ç»™çš„ã€‚å¥½ä¹…ä¸è§ï¼ä¹Ÿä¸çŸ¥é“å¦‚ä»Šèƒ½ä¸èƒ½è®¤å‡ºæ¥ï¼Œå”‰ï¼æˆ‘å°æ—¶å€™å¯¹å¥¹çš„ç›¸è²Œè®°å¿†æ˜¯ä¸€ç‚¹ä¹Ÿæ²¡æœ‰äº†ï¼å¥¹çš„å¥³å„¿åœ¨ç™¾äº¬æµ·æ·€åŒºä¸Šå­¦ï¼Œé©¬ä¸Šé«˜è€ƒäº†ï¼æˆ‘å»ï¼äº¬âœŒï¼ åˆ·äº†3é“é¢˜ï¼ŒåŸºæœ¬éƒ½æ˜¯å›æº¯ã€‚åŸºæœ¬ä¸ä¼šã€‚åŸºæœ¬çœ‹ç­”æ¡ˆã€‚éœ€è¦åŠ å¼ºã€‚ æ˜æ—¥ä»»åŠ¡ï¼šæˆ‘ä¸åˆ°å•Šï¼çœ‹ä¸€æ­¥å§ï¼ 5.31ä»Šå¤©å’Œåç«¯å®ä¹ ç”Ÿä¸€èµ·æµ‹è¯•äº†å„ç§apiï¼Œé€ä¸ªæ’æŸ¥ï¼Œä¿®æ­£äº†ä¸€äº›bugã€‚äº”éƒ¨åˆ†çš„apiï¼Œæœ‰ä¸‰ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥è·‘é€šäº†ã€‚é¡¹ç›®é‡Œé¢æœ‰ä¸€ä¸ªå°bad caseå°±æ˜¯ï¼ŒæŠŠidå’Œnameæ··æ·†äº†ï¼Œå‡½æ•°åç§°å•¥çš„æ²¡æ”¹ï¼Œåœ¨å‡½æ•°å†…éƒ¨ç”¨æŸ¥è¯¢æŠŠnameè½¬åŒ–æˆäº†idã€‚æµ‹è¯•å‰ç«¯å¯¹è¯èƒ½å¦è°ƒç”¨åç«¯ï¼Œä¸»è¦æ˜¯å¯¹è¯apiã€‚å…¶ä»–çš„å‰ç«¯å†…å®¹åŸºæœ¬ä¸Šéƒ½æ˜¯å‡çš„ã€‚å¯¹è¯æœ‰å››ç±»ï¼š 1CHAT_TYPE = [&quot;RAG_CHAT&quot;,&quot;RAG_SEARCH&quot;,&quot;LLM_CHAT&quot;,&quot;RAG_RERANK&quot;] å‰ä¸¤ä¸ªå¯¹è¯å¥½åƒæ˜¯ä¸€æ ·çš„è¿”å›ç»“æœã€‚æœ¬è´¨ä¸Šè¿™ä¿©å¯¹è¯æ²¡å•¥åŒºåˆ«ï¼Ÿç¬¬ä¸‰ã€å››ä¸ªå¯¹è¯ï¼Œç»“æœå’Œå‰ä¸¤ä¸ªä¸ä¸€æ ·ã€‚å¿«ä¸‹ç­çš„æ—¶å€™æ€»ç®—æ˜¯è·‘é€šäº†ã€‚ä¹‹å‰æ˜¯ollama æ˜¾å­˜ä¸å¤Ÿæ‰€ä»¥æ²¡è·‘é€šã€‚ ä¸‹å‘¨ä»»åŠ¡ï¼šä¼˜è´¨è§£ç­”â€”â€”æˆ‘ä¸çŸ¥é“ äº”æœˆç»“æŸäº†ï¼åˆ°åŒ—äº¬æ¥å·²ç»ä¸¤ä¸ªå¤šæœˆäº†ï¼å›é¦–è¿‡å»ï¼Œæ˜¯ä¸€æ®µä¸å¤ªç¾å¥½ï¼Œä½†åº”è¯¥è¿˜æ˜¯æ¯”è¾ƒæœ‰ä»·å€¼çš„ç»å†â€¦â€¦ï¼Ÿ","categories":[{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å¤§æ¨¡å‹","slug":"è®°å½•/å¤§æ¨¡å‹","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"},{"name":"å®ä¹ ","slug":"è®°å½•/å¤§æ¨¡å‹/å®ä¹ ","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%AE%9E%E4%B9%A0/"}],"tags":[{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://yukino256.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"éšæƒ³","slug":"éšæƒ³","permalink":"https://yukino256.github.io/tags/%E9%9A%8F%E6%83%B3/"},{"name":"å¿ƒæƒ…","slug":"å¿ƒæƒ…","permalink":"https://yukino256.github.io/tags/%E5%BF%83%E6%83%85/"}]},{"title":"DailyRecord-April","slug":"DailyRecord-April","date":"2024-04-01T08:10:59.000Z","updated":"2024-05-17T03:18:58.614Z","comments":true,"path":"2024/04/01/DailyRecord-April/","link":"","permalink":"https://yukino256.github.io/2024/04/01/DailyRecord-April/","excerpt":"","text":"4.1ä¸Šåˆï¼ŒæŠŠqwenllm&#x2F;qwençš„docker imageæ”¾åˆ°æœåŠ¡å™¨ä¸Šäº†ï¼Œä½†æ˜¯ä¸‹åˆå‘ç°æ¨¡å‹æ²¡æ”¾ï¼Œè¿˜è¦ä¸‹è½½72b-chatçš„æ¨¡å‹å†æ”¾ä¸Šå»ï¼›è€Œä¸”è¿™ä¸ªä¸œè¥¿å¥½åƒè¦è‡ªå·±å†™åº”è¯¥æœåŠ¡ç«¯pyæ–‡ä»¶ï¼Ÿä¸‹åˆå¤ä¹ äº†ä¸€ä¸‹long-contextçš„è®ºæ–‡ï¼Œçœ‹äº†retrievalçš„ä¸€äº›å¦‚longllamaï¼Œæ¸©æ•…çŸ¥æ–°ï¼Œæ²¡è·³å‡ºå·²æœ‰æ¡†æ¶çš„åŒæ—¶ï¼Œæ„Ÿè§‰ç†è§£æ›´æ·±äº†æ™šä¸Šï¼Œå’ŒSHæ‰“äº†ä¸€æŠŠæ¸¸æˆï¼Œç„¶åå’Œæ²ˆè€å¸ˆå¼€å‘¨ä¼šï¼Œæ±‡æŠ¥äº†ä¸€ä¸‹è‡ªå·±ç›®å‰çš„ä¸€äº›ç†è§£ã€‚å¾—åˆ°ä¸‹ä¸€æ­¥çš„ç ”ç©¶å†…å®¹æ˜¯ï¼šæŠŠretrieval çš„æ–¹å¼åœ¨å¤§æ¨¡å‹ä¸Šéƒ½å®ç°ä¸€ä¸‹ä¹‹åï¼Œç»§ç»­å’ŒSHã€NJä¸€èµ·æ‰“äº†å¤§ä¹±æ–— è™½ç„¶æ˜¯æ„šäººèŠ‚ï¼Œä½†æ˜¯æ— äº‹å‘ç”Ÿ æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»è®ºæ–‡ï¼›å­¦ä¹ ä¿®æ”¹å¤§æ¨¡å‹çš„æ–¹æ³• 4.2 è‰ï¼è¿™ä¸€å¤©å¹²å•¥äº†æˆ‘ç»™å¿˜äº†ï¼åŸæ¥æ—¥è®°æ¼äº†ä¸€å¤©ï¼Œ4.8æ‰å‘ç°ï¼ å¥½åƒè¿˜æ˜¯åœ¨çœ‹ä»£ç å’Œæ•™ç¨‹ï¼Ÿ 4.3ä¸Šåˆï¼Œé˜…è¯»qwençš„model_qwen.pyæ–‡ä»¶ï¼Œå°è¯•ç†è§£æ¨¡å‹ç»“æ„ï¼Œå¯»æ‰¾ä¿®æ”¹æ–¹æ³•ã€‚æœ€ç»ˆç›®çš„æ˜¯å°†kv retrievalåŠ å…¥åˆ°æ¨¡å‹ä¸­å»ï¼›ç›®å‰æ²¡ä»€ä¹ˆå¤´ç»ªï¼Œæ˜¯ç›´æ¥æ”¹modelæ–‡ä»¶ï¼Œè¿˜æ˜¯å†™ä¸ªæ–°çš„ç»§æ‰¿ä¸€ä¸‹ï¼Ÿç»§æ‰¿çš„è¯å¦‚ä½•ä¸å·²æœ‰æ–‡ä»¶ä¿æŒè”ç³»å’Œäº¤äº’ï¼Ÿqwençš„pyä»£ç æ²¡æœ‰å•¥æ³¨é‡Šï¼Œçªç„¶æƒ³åˆ°å¯ä»¥çœ‹ä¸€ä¸‹transformeråŒ…ä¸­çš„ä»£ç ï¼Œæ‹¿llamaåšå‚è€ƒï¼Œå¸Œæœ›æœ‰æ³¨é‡Šå¯ä»¥å¥½çœ‹ä¸€ç‚¹åƒäº†å¥½å¤§çš„é¥¼å°†4090æœºå™¨ä¸Šçš„qwen-72b-chatæ”¾åˆ°A800ä¸Šï¼Œå°è¯•è®©å®ƒè·‘èµ·æ¥ï¼›æ˜¨å¤©å‰è¾ˆå“¥ç”¨vllmåŠ é€Ÿä¸€äº›æ¨¡å‹ï¼ŒåŸºæœ¬ä¸Šæ²¡è·‘èµ·æ¥æŠ¥é”™ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆæƒ…å†µï¼›æ²¡æŸ¥åˆ°è§£å†³æ–¹æ¡ˆ æ˜æ—¥ä»»åŠ¡ï¼š æ˜æ—¥ä¸ªPï¼æ¸…æ˜èŠ‚å‡æœŸï¼å¥½å§ï¼Œè¿™ä¸ªé¥¼è¿˜æ˜¯æŒºä¸é”™çš„ï¼Œä¹Ÿè®¸ä¼šå‡æœŸå­¦ä¹ ä¸€ä¸‹ã€‚ä¸ä¼šçš„å¥½å¤š 4.4-4.6å‡æœŸç¬¬ä¸€å¤©ï¼šä¸Šåˆæ‰“æ¸¸æˆï¼Œä¸­åˆåƒäº†æ˜¨æ™šä¸‹ç­æ—¶ä¹°çš„ç½—æ£®ä¾¿å½“ï¼›æ™šä¸Šå»NJé‚£é‡Œï¼Œåƒäº†å·èœé¦†å­â€œæ¤’æ¦†â€ï¼ˆå¥½åƒæ˜¯è¿™ä¸ªåå­—ï¼‰ï¼Œä¸€ä¸ªç‚’é¸¡ã€ä¸€ä¸ªé»„ç„–èŒ„å­ã€ä¸€ä¸ªè’œæ³¥ç™½è‚‰ã€ä¸€ä¸ªå°é…¥è‚‰ï¼ˆæ²¡æ€ä¹ˆåƒï¼Œæ‰“åŒ…å¸¦å›å»å½“ç¬¬äºŒå¤©çš„æ—©é¥­äº†ï¼‰ï¼›ä¹‹ååœ¨é™„è¿‘è½¬äº†è½¬ï¼Œç„¶åååœ°é“å»ä¸Šåœ°ä¸€ä¸ªè¶…å¸‚é€›äº†é€›ï¼Œåƒäº†åˆä¸€å®¶æä»è±†è…ï¼Œä¸å¦‚å¾·å’Œæ–‹ï¼›æ‰“åŒ…äº†çº¢è±†åŒçš®å¥¶å’Œä¸€ä¸ªä»€ä¹ˆå¥¶å›å»ç¬¬äºŒå¤©åƒï¼›å»åœ°é“ç«™æ‰“é“å›åºœï¼Œè·¯ä¸Šçœ‹è§åŒ—ä½“çš„ä¸€ä¸ªå°ç ´é—¨ï¼Œå¦å¤–è¿˜æœ‰æ¼‚äº®MMã€‚ä¹‹ååˆ°å®¶ï¼Œå’ŒSHæ‰“äº†ä¼šå„¿æ¸¸æˆã€‚å‡æœŸç¬¬äºŒå¤©ï¼šæ‰“æ¸¸æˆçš„ä¸€å¤©å¥¥ï¼Œæ— äº‹å‘ç”Ÿï¼å’ŒSHã€NJæ‰“äº†å¥½ä¹…çš„æ¸¸æˆï¼›ä¸­åˆåƒçš„çŒªè„šé¥­ï¼Œè¿˜ä¸é”™ï¼›æ™šä¸Šåƒçš„ç‚¸è›‹èºä¸æ··ï¼Œä¹ŸæŒºä¸é”™ï¼Œç†™èºæ¹¾è¿™ç‰Œå­åœ¨ä»™æ—NJUçš„å¯¹é¢ä¹Ÿå¼€äº†ä¸€å®¶ï¼Œå¼€äº†ä¸ä¹…ï¼›æ‰€ä»¥ç‚¹çš„æ—¶å€™è¿˜æ˜¯æ¯”è¾ƒæ”¾å¿ƒçš„ã€‚å‡æœŸç¬¬ä¸‰å¤©ï¼šä¸­åˆå’ŒNJä¸€èµ·å»å®‰è´é—¨ï¼›åœ¨ä¸€å®¶å°å··å­é‡Œçš„è€é¦†å­é‡Œé¢åƒåœ°åœ°åœ°åœ°åœ°åœ°åœ°é“å„¿çš„ç™¾äº¬èœï¼å…«å¤§ç¢—ä¸­çš„ç‰›æ‚ï¼Œå¥½åƒï¼ç‰›è‚ ç…®çš„æœ€å¥½åƒï¼›ä¸€ä¸ªç‚’ç‰›å°¾ï¼Œè¿˜è¡Œï¼›ä¸€ä¸ªç¾Šæ‚ç ‚é”…ï¼Œä¸é”™ï¼Œä½†æ˜¯æ²¡ç‰›æ‚å¥½åƒï¼›ä¸€ä¸ªéº»è±†è…ï¼ŒæŒºå¥½åƒï¼Œå¾ˆæ–°å¥‡ï¼›åƒå®Œé¥­ï¼Œå»ä¹°äº†èŠ¬è¾¾ï¼Œåˆèµ·æ¥å’Œå¤§æ´‹æ˜¯æœ‰ç‚¹å·®åˆ«ï¼Œæ„Ÿè§‰å¤§æ´‹æ›´å¥½å–ä¸€ç‚¹ï¼›ç„¶åæ²¿æ²³çš„å…¬å›­é‡Œé¢æœ‰ä»€ä¹ˆèŠ±å±•ï¼Œèµ°é©¬è§‚èŠ±çš„é€›äº†é€›ã€‚å¿˜è®°ç»™NJå¸¦å¾·å’Œæ–‹æä»è±†è…äº†ï¼Œæ˜æ˜å‰å¤©æ‰å¤¸ä¸‹æµ·å£â€¦ä¸‰å¤©é‡Œï¼Œæ²¡æ€ä¹ˆå­¦ä¹ ï¼Œç½‘ç»œå°è¯´å€’æ˜¯æ²¡å°‘çœ‹ï¼›ä»£ç ä»€ä¹ˆçš„æäº†æä½†å¥½åƒæ˜¯åœ¨åšæ— ç”¨åŠŸâ€¦.. 4.7ä¸æƒ³ä¸Šç­å•Šå•Šå•Šå•Šå•Šå•Šï¼ä¸ŠåˆæŠ˜è…¾éšèº«wifiï¼Œé¡ºä¾¿æŠŠqwen-72b-chatå®Œå…¨æ”¾åˆ°äº†A800çš„æœåŠ¡å™¨ä¸Šï¼Œè·‘äº†ä¸€ä¸‹æœåŠ¡ç«¯ï¼Œæ­£å¸¸ï¼›åç»­å·¥ä½œå¯èƒ½å°±æ˜¯ï¼Œå°è¯•ä¿®æ”¹æ¨¡å‹ä¹‹ç±»çš„ï¼Œå†æŠŠåç«¯æ¥å£ä»€ä¹ˆçš„æä¸€æï¼Ÿä¸‹åˆï¼Œæœç´¢é˜…è¯»äº†ä¸€äº›è®ºæ–‡ï¼Œæ„Ÿè§‰æ”¶è·ä¸å¤§ï¼›è§‰å¾—æ˜¯è‡ªå·±çš„ä»£ç èƒ½åŠ›ä¸è¶³çš„é—®é¢˜ï¼Œæ‰¾äº†ç¯‡å¼€æºä»£ç çš„å»è¯»ï¼ŒGitHub 1k starï¼Œ ä½†æ˜¯æ²¡è¯»æ‡‚ï¼Œæ„Ÿè§‰ä»£ç å†™çš„å¥½åƒä¸å¤ªå¥½ï¼›é‚é‡æ–°é˜…è¯»transformerä¸­llamaçš„æºç ï¼›å› ä¸ºä¹‹å‰å‘ç°qwençš„ç»“æ„å’Œllamaå¾ˆç›¸ä¼¼ï¼Œå¸Œæœ›è¯»æ‡‚llamaåèƒ½å¾ˆå¿«çš„è§¦ç±»æ—é€šã€‚é‡åˆ°äº†ä¸€äº›é—®é¢˜éœ€è¦è®°å½• RoPeç¼–ç çš„å®ç°ï¼Œçœ‹çš„åŠæ‡‚ä¸æ‡‚ï¼Œæ²¡æœ‰æ·±ç©¶ï¼Œåç»­è§†æƒ…å†µçœ‹æ˜¯å¦éœ€è¦æ·±å…¥ã€‚ llama attentionæ¨¡å—ä¸­ï¼Œæœ‰è¿™ä¸¤ä¸ªå‚æ•°ï¼Œå°šæœªææ‡‚ä½œç”¨æ˜¯ä»€ä¹ˆï¼š 12cache_position: Optional[torch.LongTensor]position_ids: Optional[torch.LongTensor] = None æ™šä¸Šåœ¨DNFç¥è¿¹ä¸ŠæŠ½é»‘é’»å”®è´§æœºï¼Œå› ä¸ºæ²¡æœ‰è‡ªåŠ¨æŠ½å–çš„åŠŸèƒ½ï¼Œæ‰€ä»¥å°è¯•ç”¨pyautoguiå†™äº†ä¸ªè‡ªåŠ¨æŠ½å¥–çš„è„šæœ¬ï¼Œä½†æ˜¯å®é™…è¿è¡Œçš„æ—¶å€™å‘ç°ç§»åŠ¨ä½ç½®æ˜¯å¯¹äº†ï¼Œä½†æ— æ³•ç‚¹å‡»åˆ°æ¸¸æˆç¨‹åºå†…éƒ¨çš„ä¸œè¥¿ï¼Œåˆå‘ç°è‡ªå·±ä½¿ç”¨é¼ æ ‡ä¸€ç›´ç‚¹å‡»å€’ä¹Ÿå¯ä»¥ï¼Œäºæ˜¯åˆå¼€äº†é¼ æ ‡è¿ç‚¹å™¨ï¼Œå‘ç°é¼ æ ‡è¿ç‚¹å™¨ä¹Ÿç‚¹ä¸åˆ°æ¸¸æˆç¨‹åºå†…éƒ¨çš„ä¸œè¥¿ï¼›è¿™ä¸¤ç§ç›¸ä¼¼çš„ç°è±¡å¸¦æ¥çš„å¯å‘æ˜¯ï¼šè¿™ç§åŸºäºGUIæ¨¡æ‹Ÿç‚¹å‡»çš„ç¨‹åºï¼Œæˆ–è®¸æ²¡æœ‰èšç„¦åˆ°åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œäº¦æˆ–è€…æ˜¯DNF.exeçš„ç‰¹æ®Šæ€§ä¹‹ç±»çš„ã€‚æƒ³æ¥ä¹‹å‰åº”è¯¥æœ‰ä¸€ä¸ªè·å–æ¸¸æˆçª—å£çš„æ–¹æ³•ï¼Œä½†æ˜¯ä¸æƒ³æäº†ï¼Œå°±è¿™æ ·å§ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šç»§ç»­é˜…è¯»llamaçš„æºç  4.8ä»Šå¤©ï¼Œå‹‰å¼ºæŠŠqwençš„modelæ–‡ä»¶çœ‹å®Œï¼Œä»ç„¶æ˜¯åŠæ‡‚ä¸æ‡‚çš„çŠ¶å†µï¼Œå°¤å…¶æ˜¯generate()å’Œchat()è¿™ä¸¤ä¸ªå‡½æ•°ã€‚logitçš„å€¼æ˜ å°„åˆ°idå†æ˜ å°„åˆ°æ–‡å­—ï¼Œæ€è·¯å¾ˆå¥½æ‡‚ä½†ä»£ç æœ‰ç‚¹å¤æ‚åç»­é‡æ–°çœ‹äº†GitHubä¸Šqwençš„é¡¹ç›®ï¼Œä»¥åŠmodelscopeä¸Šqwen7bæ¨¡å‹çš„å…·ä½“å†…å®¹å’Œæ–‡ä»¶ã€‚æœ¬æ¥ä»¥ä¸ºmodelscopeä¸Šé¢çš„æ˜¯è¿è¡Œæ–‡ä»¶ä¹‹ç±»çš„ï¼ŒåŸæ¥å®ƒçœŸçš„åªæ˜¯æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹å®‰è£…ä¸€å®šæ–¹å¼ç»„ç»‡ï¼Œtransformerè¿˜æ˜¯huggingfaceä¾ç…§generation_config.jsonå’Œconfig.jsonæ¥å®Œæ•´çš„è¯»å–æ¨¡å‹ã€è¿è¡Œä¹‹ç±»çš„ã€‚è¿ç®—ã€ç”Ÿæˆä¹‹ç±»çš„å‡½æ•°ç¡®å®æ˜¯å†™åœ¨è¿™ä¸ªæ¨¡å‹é‡Œé¢çš„ï¼Œgithubä¸Šé¢çš„æ˜¯ä»‹ç»ã€ç¤ºä¾‹çš„demoã€å„ä¸ªæ•°æ®é›†ä¸Šçš„æµ‹è¯•æ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¦åœ¨æ¨¡å‹ä¸­åŠ å…¥cacheçš„retrievalï¼Œå°±è¦åœ¨modeling_qwen.pyè¿™ä¸ªæ–‡ä»¶ä¸­ç›´æ¥ä¿®æ”¹ï¼Ÿï¼ˆä½†æ˜¯æˆ‘æ›´å¸Œæœ›çš„æ˜¯ï¼Œå†™ä¸ªç»§æ‰¿çš„æ–‡ä»¶ç„¶åäº’ä¸å½±å“ï¼Ÿï¼Ÿï¼‰å¾—çœ‹çœ‹è®ºæ–‡å’Œè®ºæ–‡ä»£ç å»æ™šä¸Šï¼Œå’Œæ²ˆæ•™æˆå¼€äº†ç»„ä¼šï¼Œè¡¨æ˜ç›®å‰çš„é—®é¢˜æ˜¯ä¸çŸ¥é“æ€ä¹ˆæ”¹ä»£ç ä¸€å¤´é›¾æ°´ï¼Œç›´æ¥åœ¨æ¨¡å‹æ–‡ä»¶ä¸Šæ”¹æ„Ÿè§‰ä¸ç¨³å¦¥ï¼›ä»–å»ºè®®æˆ‘ç›´æ¥æ”¹è¯•è¯• æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»recurrent-memory-transformerï¼Œå¼€å§‹ä¿®æ”¹qwenä»£ç æ–‡ä»¶ 4.9å·¥ç¨‹å¸ˆå¤§å“¥å…¥èŒå™œï¼å¸Œæœ›èƒ½å¸¦æˆ‘é£ï¼é˜…è¯»recurrent-memory-transformerçš„æºç ï¼Œæ€è€ƒå…¶ç»“æ„å’Œä»£ç ä½œç”¨modeling_rmtæ–‡ä»¶ï¼Œå¤§è‡´ä¸Šåº”è¯¥æ˜¯æ¨¡å‹æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰äº†ä¸¤ä¸ªç±»ï¼ŒMemoryCellâ€”â€”ä¼¼ä¹æ˜¯è´Ÿè´£å‘åŸæœ‰modelä¸­åŠ å…¥MemoryCellçš„ç±»ï¼›RecurrentWrapperâ€”â€”ä¼¼ä¹æ˜¯å¯ä»¥å°†åŸæœ‰modelçš„è¾“å‡ºå†å¤„ç†ä¹‹åçš„è¾“å‡ºï¼Œè¿™æ ·çœ‹æ¥ï¼Œå¥½åƒå¯ä»¥ç›´æ¥å°†å…¶è¿ç”¨åˆ°qwenä¸­å»ï¼Ÿä¸‹åˆå’ŒGGèŠäº†ä¸€é˜µå­ï¼Œåˆ°å‡ºç§Ÿå±‹ååˆå’Œä»–èŠäº†å¤§æ¦‚ä¸€ä¸ªå°æ—¶ï¼›å’ŒNJæ‰“äº†å‡ æŠŠå¤§ä¹±æ–— æ˜æ—¥ä»»åŠ¡ï¼šç»§ç»­é˜…è¯»recurrent-memory-transformerï¼Œå¼€å§‹ä¿®æ”¹qwenä»£ç æ–‡ä»¶ 4.10ä»Šæ—¥ï¼Œæ–°å…¥èŒäº†ä¸€ä¸ªæœ¬åœ°å­¦æ ¡çš„åšæ•°æ®çš„å®ä¹ ç”Ÿä¸Šåˆï¼Œç¨å¾®æ€è€ƒäº†ä¸€ä¸‹RMTçš„ä»£ç ç»“æ„å’Œç”¨æ³•ï¼›ç„¶åå°è¯•åœ¨PCä¸Šè·‘ä¸€ä¸‹åƒé—®çš„å°æ¨¡å‹æŸ¥çœ‹æ•ˆæœé‡‡ç”¨Int4ç‰ˆæœ¬ï¼Œç»“æœæŠ¥é”™ï¼š CUDA extension not installed. å°è¯•å®‰è£…cudatoolkitï¼Œç»“æœä¾ç„¶æ²¡æœ‰è§£å†³ç ´æ¡ˆäº†ï¼Œbydä¸€ç›´å®‰è£…çš„cpuç‰ˆæœ¬çš„torchä¹‹ç±»çš„ï¼Œå¯èƒ½æ˜¯ç‰ˆæœ¬æ²¡å¯¹é½&#x2F;æ¸…åæºçš„é—®é¢˜æ¥è‡ªHXDçš„æ”¯æ´ï¼š å»ºè®®ç”¨pipåˆ«ç”¨condacondaä¸ä¼šæ£€æŸ¥ç¯å¢ƒé‡Œçš„å†²çªç›´æ¥è£…pipä¼šå…ˆçœ‹æœ‰æ²¡æœ‰è£… ä»–å¦ˆçš„ç ´æ¡ˆäº†ï¼Œpythonå’Œtorchç‰ˆæœ¬å¤ªé«˜äº† æ˜æ—¥ä»»åŠ¡ï¼šæ”¹åƒé—®æš‚åœï¼ŒååŠ©è·‘é€šRAGFLOW 4.11RAGFlowæ˜¨å¤©ä¸‹åˆå·¥ç¨‹å¸ˆè·‘äº†ï¼Œå®ƒæœ€æ–¹ä¾¿çš„åŠŸèƒ½è¿˜æ˜¯ç›´æ¥è°ƒç”¨apiï¼Œä½†å·¥ç¨‹å¸ˆå°è¯•ææ˜ç™½é˜¿é‡Œçš„apiæ€ä¹ˆç”³è¯·æ€ä¹ˆç”¨å´å¤±è´¥äº†ï¼›ä»ç¤ºä¾‹å›¾ä¸Šå¼€RAgflowå¯ä»¥æ”¯æŒæœ¬åœ°æ¨¡å‹ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬è·‘é€šçš„ç»“æœæ¥çœ‹é‚£ä¸ªå›¾ä¸Šé¢çš„é€‰é¡¹æ¶ˆå¤±äº†ï¼Œä»Šå¤©å·¥ç¨‹å¸ˆé—®ragflowçš„ç¾¤ä¸»å¾—çŸ¥ï¼Œå·²ç»ç”¨ollamaç›´æ¥å–ä»£äº†ã€‚ä¼¼ä¹ollamè°ƒç”¨æ›´æ–¹ä¾¿ï¼Ÿå‡†å¤‡éƒ¨ç½²ollamaè¯•è¯•ï¼Œä½†æ˜¯ç”±äº4090æ˜¾å­˜ä¸å¤Ÿäº†ï¼Œå› è€Œè¦å°†å…¶éƒ¨ç½²åˆ°A800ä¸Šï¼›é•œåƒçš„ä¸Šä¼ åˆæ˜¯æŠ˜ç£¨è¸©äº†ä¸€ä¸ªå‘ï¼š scpå‘½ä»¤æŒ‡å®šè¿œç¨‹ç«¯å£ï¼Œ-på…¶å®è¦å¤§å†™æˆ-Pæ‰æ˜¯æ­£ç¡®å‘½ä»¤ å¯¼å…¥ä¹‹åï¼Œæ˜¾ç¤ºåç§°ä»€ä¹ˆçš„ä¸ºnoneï¼Œéœ€è¦ä½¿ç”¨docker tagå‘½ä»¤è‡ªå·±å‘½åç»§ç»­ç¢ç£¨æ€ä¹ˆåŠ memï¼Œ æƒ³æœRMTçš„è§£ææ–‡ç« ï¼Œç»“æœæœå‡ºæ¥å‘ç°è¯´å®ƒå°±æ˜¯Transformer-XLï¼Œç„¶åå»æœtransoformer-XLï¼Œå‘ç°å®ƒæ˜¯2019å¹´çš„æ–‡ç« è¢«æ‹’ç¨¿äº†ï¼Ÿåç»­æ”¹è¿›çš„XLNetï¼Œè¿™ä¸ªå·²ç»è¢«åŠ å…¥åˆ°äº†transformerå®˜æ–¹åŒ…é‡Œé¢æŸ¥çœ‹äº†ä¸€äº›ä»£ç ï¼Œæ„Ÿè§‰åŠ ä¸è¿›å»ï¼›ä½†ä¼¼ä¹æ¸æ¸å¾—åˆ°äº†ä¸€äº›ç†è§£ï¼šè¿™äº›ç½‘ç»œç»“æ„ä»€ä¹ˆçš„å·²ç»å®šå¥½äº†ï¼ŒåŒ…æ‹¬qwenï¼Œè¿™äº›æ”¾åœ¨src&#x2F;modelä¸‹çš„modelingæ–‡ä»¶å®šä¹‰äº†æ¨¡å‹ï¼Œè€Œhuggingfaceæˆ–è€…ä»€ä¹ˆåœ°æ–¹å¯ä»¥æ‰¾åˆ°æ¨¡å‹çš„ä¸€äº›ä¸è®­ç»ƒå¥½çš„å‚æ•°ã€‚é‚£ä¹ˆå·²çŸ¥çš„æ˜¯qwenç¡®å®æ²¡æ³•æ”¹æ¨¡å‹ç»“æ„ï¼Ÿæœ€å¤šåªèƒ½åœ¨æ¨ç†çš„æ—¶å€™é‡‡å–ä¸€äº›ä¸å½±å“å®ƒæ¨¡å‹æœ¬èº«æµåŠ¨çš„trickï¼Œå¦‚lora&#x2F;adpterä¹‹ç±»çš„ä¸œè¥¿ã€‚qwen1.5é‡‡ç”¨äº†æ»‘åŠ¨çª—å£attnï¼Œå¯ä»¥æé«˜æ¨ç†æ•ˆç‡ï¼›èƒ½å¦æé«˜é•¿æ–‡æœ¬èƒ½åŠ›å°šä¸æ˜æ™°ã€‚ä¼¼ä¹å¯è¡Œçš„ä¸¤ä¸ªæ€è·¯ï¼š ä½¿ç”¨adapterï¼Œç›´æ¥å°†ä¹‹å‰çš„kv cacheæ‰åˆ°attné‡Œé¢ï¼Ÿ ç›´æ¥åœ¨æ¨¡å‹æ¨è¿›çš„æŸä¸€å±‚ï¼Œå¯¹kv cacheå’Œå¤–éƒ¨å‘é‡æ•°æ®åº“ è¿›è¡Œå‘é‡æ£€ç´¢ï¼Œç„¶åæ‰è¿›å»ï¼Ÿ ç ”ç©¶æ–¹å‘æš‚æ—¶è½¬å˜ï¼šç ”ç©¶ReAct + CoTçš„åº”ç”¨ï¼›å”‰äººåœ¨æ±Ÿæ¹–èº«ä¸ç”±å·±ï¼Œä½†å¥½åœ¨æ˜¯è¿™å›æœ‰äººæŒ‡å¯¼äº†ï¼Œå¸Œæœ›è¿™æ®µæ—¶é—´ä»£ç èƒ½åŠ›èƒ½æœ‰çªç ´ï¼›è¶Šæ¥è¶Šè§‰å¾—LLMå°¤å…¶éœ€è¦å¼ºå·¥ç¨‹èƒ½åŠ› ç”¨åƒé—®çš„apiï¼Œè·‘RAGFlowæˆåŠŸäº†ï¼Œåç»­å·¥ä½œæ˜¯æ›´æ”¹æˆæœ¬åœ°æ¨¡å‹ï¼›æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€äº›åŠŸèƒ½å¾…æ·»åŠ ï¼šèŠå¤©ç•Œé¢å¯ä»¥è¾“å…¥å›¾ç‰‡&#x2F;æ–‡ä»¶ï¼Œæ”¯æŒè¿æ¥sqlå¹¶å‘æŒ¥BIåŠŸèƒ½ å°è¯•ç”¨langchainï¼Œå°†Reactå’ŒCoTç»“åˆèµ·æ¥ æ˜æ—¥ä»»åŠ¡ï¼šlangchainçš„ReActå’ŒCoTï¼›äº†è§£ä¸€ä¸‹CoT 4.12ä»Šå¤©æ²¡ä»€ä¹ˆå°è±¡æ·±åˆ»çš„ä»»åŠ¡ï¼Œåœ¨è¯»ä¸€ç¯‡æ–°çš„è®ºæ–‡BPOï¼Œé˜…è¯»å®ƒçš„ä»£ç ã€‚ç”±äºå·¥ç¨‹èƒ½åŠ›ä¸è¶³ï¼Œé˜…è¯»ä»£ç æ€»æ˜¯åƒåŠ›åŠæ‡‚ä¸æ‡‚ï¼›æˆ–è®¸ï¼ŒLLMå­¦ä¹ å›°éš¾çš„åŸå› åœ¨äºå®éªŒæ¡ä»¶é«˜ï¼Œæˆ‘å¹³æ—¶çœŸçš„å¾ˆéš¾ä¸Šæ‰‹å»æ”¹ä¸€äº›ä¸œè¥¿å¹¶å¿«é€ŸæŸ¥çœ‹æ•ˆæœã€‚ æ™šä¸Šï¼Œä¸ZYRå’ŒSLä¸€èµ·åƒäº†èšå®æºï¼ˆè¥¿ç›´é—¨åº—ï¼‰çš„æ¶®è‚‰ï¼›è¯´å®è¯æ„Ÿè§‰ä¸€èˆ¬ï¼Œé‚£ä¸ªBéº»é…±æ ¹æœ¬ä¸é¦™ï¼æ„Ÿè§‰ä¸å¦‚ä¸€èˆ¬çš„ç«é”…æ¶®è‚‰ï¼Œäº¦æˆ–è€…ä¹‹å‰åœ¨è¥¿å®‰åƒè¿‡çš„å†°ç…®ç¾Š åƒå®Œé¥­ï¼Œä¸€èµ·å»ç´«ä»€ä¹ˆå…¬å›­é€›äº†å¤§æ¦‚ä¸€å°æ—¶ï¼›ä»Šå¤©ä¸æœ‹å‹ä»¬èŠäº†ä¸€äº›æ±‚èŒã€è¯»åšæ–¹é¢çš„äº‹æƒ…ï¼ŒèŠäº†ä¸€äº›é«˜ä¸­åŒæ ¡ã€å­¦å¼Ÿå­¦å¦¹ä»¬çš„ä¸€äº›å‘å±•ï¼›å†æ¬¡æ„Ÿå¹äººå¤–æœ‰äººï¼Œæ¯æ¬¡èŠå¤©æ€»æ˜¯èƒ½æ„Ÿå—åˆ°è‡ªå·±çš„ä¸è¶³ï¼Œå¸Œæœ›æˆ‘èƒ½èµ¶ä¸Šå»ï¼å®ä¹ å®ç°å·¥ç¨‹èƒ½åŠ›çš„å·¨å¤§æé«˜ï¼ï¼ï¼ï¼ æ˜æ—¥ä»»åŠ¡ï¼š å‡æœŸå™œï¼æ˜å¤©å’ŒLTï¼ŒNJä¸€èµ·èšä¸€ä¸‹ï¼Œåƒç­‹å¤´å·´è„‘ï¼ ä¸‹å‘¨ä»»åŠ¡ï¼š è¯»æ‡‚BPOä»£ç ï¼Œå¤ç° 4.13-4.14å‘¨å…­ä¸­åˆï¼Œå’ŒLTï¼ŒNJä¸€èµ·åœ¨è¥¿äºŒæ——åƒäº†æ¹˜èœï¼ˆç­‹å¤´å·´è„‘æ— äº†ï¼‰ï¼Œ280çš„å¥—é¤ï¼Œå¤§ä¼—ç‚¹è¯„å¥½è¯„é€æ‰‹æ’•åŒ…èœï¼›æœ‰è‡­é³œé±¼ã€æ“‚æ¤’çš®è›‹ã€å°ç‚’è‚‰ã€è¾£ç‚’èŒ¶å¹²ã€è‚˜å­è‚‰ï¼ˆåº”è¯¥ä¸æ˜¯è¿™ä¸ªï¼Œä½†æˆ‘æƒ³ä¸èµ·æ¥å…·ä½“åå­—äº†ï¼‰å’Œé¸¡è›‹çƒ§çš„ä¸€ä¸ªèœï¼›å–äº†å¯ä¹ï¼›åƒæ’‘äº†ï¼ŒLTé¥­é‡æ²¡è¡°å‡ï¼Œè€Œæˆ‘å·²ç»åƒä¸åŠ¨äº†ï¼Œå”‰ã€‚åƒå®Œé¥­ï¼Œéšä¾¿é€›äº†é€›ï¼›è·¯ä¸Šé£è™«è¿›çœ¼ï¼Œå¿™å¿™ç³Ÿç³Ÿè™šæƒŠä¸€åœºï¼›ç®€å•ç²—æš´åœ°ä¹°äº†ç“¶çŸ¿æ³‰æ°´å†²äº†ä¸€ä¸‹çœ¼ç›ã€‚å’ŒLTä¸€èµ·å»å¤©å›å…¬å›­é€›é€›ã€‚è·¯ä¸Šé—»åˆ°ä¸€äº›å‘³é“ï¼Œç»“æœå‘ç°æ˜¯æ²™æ¯”LTçš„è¡£æœé¦Šäº†ï¼›æƒ³åˆ°è‡ªå·±å½“å¹´ä¹Ÿç©¿è¿‡é¦Šçš„è¡£æœè€Œä¸è‡ªçŸ¥ï¼Œè¿˜æ˜¯äº²å¨˜å‘ç°çš„ï¼Œä¸å…æœ‰äº›å¥½ç¬‘ã€‚å¤©å›å…¬å›­è¦è´­ç¥¨ï¼Œ15ä¸€å¼ ã€‚å’ŒLTéšä¾¿é€›äº†é€›ï¼Œç”±äºä»–è¦èµ¶ç«è½¦å› è€Œèµ°é©¬è§‚èŠ±ï¼Œåªçœ‹äº†å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼›èŠäº†èŠè¿‡å»ã€ç°åœ¨ã€æœªæ¥ã€‚ä¼¼ä¹æœ‹å‹ä»¬æ²¡æ€ä¹ˆå˜ï¼Œä¼¼ä¹åˆæœ‰ç‚¹å˜åŒ–ã€‚ä½†æœ‹å‹èº«è¾¹æ€»å½’è¿˜æ˜¯å®‰å¿ƒä¸€ç‚¹ã€‚å®é™…ä¸Šï¼Œå’Œæœ‹å‹ä»¬èŠå¤©ã€è‡ªå·±å†™åšå®¢è®°å½•ï¼Œæ˜¯æˆ‘è¿·èŒ«çš„ä¸€ç§ä½“ç°ï¼Œæˆ‘æˆ–è®¸å¸Œæœ›åœ¨äº¤æµä¸­æ˜å¿ƒè§æ€§ã€è·å¾—å¥‹æ–—ä¸‹å»çš„åŠ¨åŠ›ã€‚ ä¸‹åˆå›å»ï¼Œæ‰“å‘æ—¶é—´ï¼›åˆ°äº†10.40ï¼ŒSHä¸Šå·å«æˆ‘æ‰“LOLï¼›å‘¨æ—¥çº¯èººå®¶ä¸€å¤©ï¼Œä¸‹åˆ1ç‚¹å¤šå’ŒSHæ‰“äº†ä¸¤å°æ—¶å¤§ä¹±æ–—ã€‚NJæ’ºæ‡æˆ‘ç©dota2ï¼Œæœªæœï¼›æˆ‘æš‚æ—¶ä¸æƒ³èŠ±è´¹è„‘å­åœ¨æ¸¸æˆä¸Šäº†ï¼Œæ–°æ¸¸æˆçš„å­¦ä¹ åœ¨ä¸Šå­¦çš„æ—¶å€™å¯èƒ½æ˜¯å¿«ä¹ï¼Œä½†ç°åœ¨æˆ‘æ²¡æœ‰åŠ¨åŠ›ã€‚ 4.15ä¸Šåˆåˆå…¥èŒäº†ä¸€ä½å‘˜å·¥ã€‚å¼€äº†ä¸ªä¼šï¼Œå¦ˆçš„ä¸çŸ¥é“ç°åœ¨è¦å¹²å•¥ï¼Œäº‘é‡Œé›¾é‡Œçš„ã€‚ ä¸Šåˆçœ‹äº†ä¸€äº›ä¸œè¥¿CoTçš„ä¸€äº›ä¸œè¥¿ï¼Œç»“æœä¸‹åˆåˆå‘Šè¯‰æˆ‘å›å»æé•¿æ–‡æœ¬ã€‚è¿™æ˜¯å¦æœ‰ç‚¹â€¦â€¦ä¸‹åˆï¼Œè¢«å‘ŠçŸ¥æä¸€ä¸ªé•¿æ–‡æœ¬å·¥ç¨‹æ€è·¯çš„PPTï¼Œäºæ˜¯æ¢³ç†äº†ä¸€ä¸‹æƒ³æ³•ï¼Œå·¥ç¨‹æ€è·¯åˆ†ä¸ºä¸‰ç±»ï¼Œæ¯ä¸ªç±»å¯¹åº”ç›®å‰çš„ä¸€ä¸ªå…·ä½“ä¾‹å­ã€‚çªç„¶å‘ç°ï¼Œä¹‹å‰çš„LongMemå¥½åƒå¯ä»¥å€Ÿé‰´ï¼Œäºæ˜¯é‡æ–°å»çœ‹å®ƒçš„ä»£ç ã€‚è¿™ä¸€çœ‹ä¸å¾—äº†ï¼Œä¹‹å‰çš„è®¤è¯†è¿˜æ˜¯å¤ªæµ…è–„äº†ï¼Œç°åœ¨æ„Ÿè§‰ä»–çš„ä»£ç æ€è·¯éƒ½å¾ˆæ˜æ™°ï¼Œç„¶åè™½ç„¶ç”¨çš„fairseqè¿™ä¸ªæˆ‘æ²¡æ¥è§¦è¿‡çš„packageï¼Œä½†æ˜¯åªæ˜¯ä¸ºäº†memoryçš„æ–¹ä¾¿ï¼Œå› è€Œä½¿ç”¨å®ƒçš„incremental decoderç±»ã€‚ä»å®ƒçš„eval.pyã€memoryä»¥åŠfuseç­‰æ–‡ä»¶ä¸­ï¼Œéšéšæ„Ÿè§‰åˆ°å¯ä»¥ç”¨åœ¨qwenä¸Šï¼Œä½†æˆ‘éœ€è¦æ›´è¯¦ç»†çš„å»ç†è§£ä»£ç ã€‚è¿™ä¸ªé¡¹ç›®ä¸­ä¸€ä¸ªmemory bankæ¨¡å—ï¼Œä¼¼ä¹å¯ä»¥å¾ˆæ–¹ä¾¿çš„è¿ç§»ã€‚æˆ‘å¿…é¡»ç«‹åˆ»å‘åŠ¨åŒè°ƒï¼æ²ˆæ•™æˆä»Šæ™šæœ‰äº‹ï¼Œé¢„å®šçš„å‘¨ä¼šæ¨è¿Ÿä¸€å¤©å™œã€‚æ™šä¸Šï¼Œå’ŒNJå’ŒSHå¤§ä¹±æ–—ï¼›å’ŒSHè¾“éº»äº†ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šå‘±ï¼æˆ‘è¦ç‹ ç‹ åœ°ä½¿ç”¨longmemå‘€ï¼ 4.16ä¸Šåˆç»§ç»­é˜…è¯»longmemçš„æºç ï¼›å®ƒè™½è¯´è¿›è¡Œäº†è§£è€¦ï¼Œä½†ä»ç½‘ç»œç»“æ„æ¥çœ‹ï¼Œæ˜¯è‡ªå®šä¹‰äº†ä¸€ä¸ªå±‚æ•°ä¸ºåº•æ¨¡ä¸€åŠçš„ç½‘ç»œï¼Œç„¶åè¾“å…¥ã€è®­ç»ƒã€ç”Ÿæˆmemory bankçš„ç»“æœï¼Œç„¶åä¸€ç›´å­˜ç€ä¸åŠ¨ï¼ŒåŒæ—¶åº•æ¨¡å‘å‰è¿è¡Œæ¨è¿›ï¼Œæœ€åå†åŠ ä¸€ä¸ªèåˆå±‚ï¼Ÿä¹Ÿè®¸æ˜¯æˆ‘ç†è§£ä¸åˆ°ä½ï¼Œä»£ç çœ‹é”™äº†ï¼›æ€»ä¹‹æ˜¯æœ‰ç‚¹æä¸æ‡‚çš„ã€‚æ„Ÿè§‰ä»£ç å¥½åƒæŒºä¸é”™ï¼Œä½†è½¬åŒ–åˆ°qwenä¸­æœ‰éš¾åº¦ï¼Œå› ä¸ºä»–ä¸»è¦ç”¨çš„fairseqï¼Œè€Œæˆ‘è¿˜æ²¡å­¦è¿‡ï¼Œæ„Ÿè§‰è¿™æ˜¯ä¸€ä¸ªæ·±åº¦å­¦ä¹ çš„åº“ï¼Œè‡ªå®šä¹‰æ¨¡å‹ä»€ä¹ˆçš„ã€‚ä¸‹åˆï¼Œå°è¯•è·‘ä¸€ä¸‹qwençš„memoryå¢å¼ºï¼›é¦–å…ˆè·‘äº†åŸºç¡€çš„åº•æ¨¡ï¼Œå•¥éƒ½æ²¡æ”¹ï¼Œè®©å®ƒä»è¥¿æ¸¸è®°çš„ä¸€æ®µè¯ä¸­æŠ½å–ä¸€ä¸ªä¿¡æ¯ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªå¤§æµ·æé’ˆçš„ä»»åŠ¡ï¼Œæ²¡å›ç­”å‡ºæ¥ï¼Œé‚£æˆ‘çš„æ€è·¯å°±æ˜¯è°ƒæ•´æ¨¡å‹æ–‡ä»¶æ¥æŸ¥çœ‹æ•ˆæœã€‚å…¶å®ï¼Œä¸‹åˆä¹Ÿçœ‹äº†ä¸€é˜µå­è¯„æµ‹æ•°æ®é›†çš„ä¸œè¥¿ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ç²—ç•¥çš„çœ‹çœ‹æ²¡å¤§ææ‡‚ï¼Œå¯èƒ½ä¸»è¦å› ä¸ºçœ‹çš„è¯„æµ‹æ•°æ®é›†ä¸æˆ‘é¢„æƒ³ä¸­çš„æœ‰æ‰€åŒºåˆ«ï¼ŒC-EVALä»€ä¹ˆçš„æ˜¯é€šç”¨ï¼Œä½†æ˜¯é•¿æ–‡æœ¬&#x2F;è¶…é•¿æ–‡æœ¬å¯èƒ½è¿˜è¦é‚£ç§åè‘—æ•°æ®é›†ä»€ä¹ˆçš„ï¼Œæˆ‘è®°å¾—ä¹‹å‰çœ‹è¿‡æœ‰ï¼Œä½†æ˜¯ä¸€æ—¶é—´å¿˜è®°å»æ‰¾äº†ï¼›å€’ä¹Ÿæ— æ‰€è°“ï¼Œå› ä¸ºè¿™ä¸ªqwen-1.8b-chatæ¨¡å‹æœ¬èº«å°±æ²¡æœ‰é•¿æ–‡æœ¬èƒ½åŠ›ï¼Œntkå’Œlognç¼©æ”¾éƒ½æ— ï¼Œåªæœ‰7bå’Œ14bå¥½åƒæ”¯æŒè¿™ä¸ªï¼›å› è€Œæˆ‘é‡‡ç”¨äº†ä¸Šé¢çš„ä¸€ä¸ªæµ‹è¯•æ•°æ®ã€‚ä¿®æ”¹æ¨¡å‹è¿˜æ˜¯æ²¡ä»€ä¹ˆå¤´ç»ªï¼Œlongmemç©¶ç«Ÿå¦‚ä½•åŠ è¿›å»ï¼Ÿ æ™šä¸Šï¼Œå¼€äº†å‘¨ä¾‹ä¼šï¼›å¾—åˆ°æŒ‡ç‚¹ï¼Œé¢„è®¡çœ‹ä¸‰ç¯‡è®ºæ–‡ã€ä½¿ç”¨faissæ£€ç´¢å¹¶å°†æ£€ç´¢ç»“æœåŠ å…¥promptä¸­ä½œä¸ºself-RAGçš„baselineï¼Œéœ€è¦è·‘é€šè¿™ä¸ªå®éªŒ æ˜æ—¥ä»»åŠ¡ï¼šå­¦ä¹ faissï¼Œå°†è¾“å…¥queryå…ˆåˆ‡ç‰‡ã€å†faissã€å†æ„å»ºpromptï¼Œå†è¾“å…¥åˆ°æ¨¡å‹ä¸­æŸ¥çœ‹æ•ˆæœ 4.17ä»Šæ—¥ï¼Œå°è¯•å°†query æŒ‰å¥å­åˆ‡ç‰‡ï¼›ç»“æœä½¿ç”¨nltkã€langchainç­‰åˆ‡ç‰‡éƒ½æœªæœï¼Œä¸çŸ¥ä»€ä¹ˆæƒ…å†µï¼›äºæ˜¯ä½¿ç”¨ç®€å•çš„splitæš‚ä½œåˆ‡åˆ†ï¼›ç»“æœå‘ç°æ˜¯è¿™ä¸ªæ ‡ç‚¹ç¬¦å·å¥½åƒæœ‰ç‚¹ç‰¹æ®Šï¼Œåº”è¯¥æ˜¯å¦ä¸€ç§ç¼–ç è¿˜æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿä½†æ˜¯NLTKåº”è¯¥ç¡®å®æ˜¯ä¸èƒ½è¿›è¡Œä¸­æ–‡åˆ†è¯çš„ã€‚å°è¯•äº†langchainçš„æ–‡æœ¬chunkæ–¹æ³•ï¼Œä¹Ÿæœªæœï¼Œåˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿç»ˆç©¶ï¼Œå®ç°äº†å°†queryè¿›è¡Œfaissï¼Œç„¶ååŠ å…¥åˆ°promptä¸­å»ï¼Œè¿”å›çš„ç»“æœä¸æ˜¯å¾ˆå¥½ï¼Œå¯èƒ½æ˜¯ç”±äºæ¨¡å‹æœ¬èº«çš„èƒ½åŠ›ä¸è¶³ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯promptæ¨¡æ¿éœ€è¦ä¼˜åŒ–ã€‚ä»–å¦ˆçš„ï¼å…¬å¸çš„ç½‘è¿˜æ˜¯æ²¡æ¥ä¸Šï¼æˆ‘éƒ½æ²¡åŠæ³•æµ‹è¯•çœŸæ­£çš„æ¨¡å‹çš„æ•ˆæœã€æ²¡æ³•ä¿è¯è‡ªå·±è°ƒæ•´çš„å¯ç”¨æ€§ã€‚ æ™šä¸Šå›å®¶ï¼Œæ‰“å¤§ä¹±æ–—ï¼›è¾“éº»äº†ï¼Œè¿™bæ¸¸æˆèƒ½ä¸èƒ½æ­»ä¸€æ­»ã€‚ç›®å‰å¯»æ‰¾å…¶ä»–å¯ä»¥å’Œæœ‹å‹ä¸€èµ·ç©çš„æ¸¸æˆä¸­â€¦â€¦ä½†è¿™ä¸ªæ›´æ¢æ¸¸æˆçš„é™åˆ¶å…¶å®åœ¨äºæœ‹å‹ä¹‹é—´å…±è¯†çš„è¾¾æˆã€‚ æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»å‘¨ä¼šä¸Šçš„è®ºæ–‡ï¼Œå°è¯•ä¼˜åŒ–promptï¼Œæ„å»ºæ¨¡æ¿ 4.18ä¸Šåˆï¼Œç¨å¾®è°ƒæ•´äº†ä¸€ä¸‹promptï¼Œä¹‹å‰çš„promptæ ¼å¼æœ‰ç‚¹ä¸æ­£ç¡®ï¼›ç„¶åæµ‹è¯•äº†è¥¿æ¸¸è®°ç¬¬ä¸€ç« å…¶ä¸­ä¸€èŠ‚çš„æ•ˆæœï¼Œä¼¼ä¹æœ‰æå‡ï¼Œä½†æ˜¯æ„Ÿè§‰ä¸æ˜æ˜¾ï¼Œå¯èƒ½æ˜¯å› ä¸ºæ¨¡å‹ä¸å¤ªèƒ½å¤„ç†è¿™ç§åŠå¤æ–‡çš„åŸå› ã€‚äºæ˜¯ï¼Œåˆ‡æ¢äº†å†…éƒ¨çš„æµ‹è¯•æ•°æ®ï¼Œè¿è¡ŒæŸ¥çœ‹æ•ˆæœï¼Œç¡®å®æå‡äº†æ¨¡å‹çš„æ€§èƒ½ã€‚ æ€è€ƒï¼šé¦–å…ˆè¯´ä¸€ä¸‹ç›®å‰å­˜åœ¨çš„ä¸è¶³ï¼šç›®å‰ï¼Œå¯¹äºqueryçš„faisså¤„ç†ï¼Œæ²¡æœ‰å®ç°é—®é¢˜ä¸å‰ç½®ä¿¡æ¯çš„åˆ†ç¦»ï¼Œä»…ä»…æ˜¯å°†æ•´ä¸ªqueryè¿›è¡Œcut&#x2F;chunkï¼Œç„¶åä½¿ç”¨faissæ£€ç´¢ã€è¿”å›topkçš„ç»“æœï¼Œåˆ©ç”¨å…¶æ„å»ºä¸€ä¸ªå¢å¼ºçš„queryï¼›promptæ³¨å…¥æ–¹æ³•çš„ç¼ºç‚¹å·²ç»å¾ˆæ˜æ˜¾äº†ï¼Œè¿™é‡Œè¦è¯´çš„ä¸»è¦æ˜¯æœªæ¥å¯èƒ½çš„faiss&#x2F;å…¶ä»–å‘é‡åº“æ£€ç´¢ç»“æœé”™è¯¯&#x2F;ä¸åŒ¹é…çš„é—®é¢˜ï¼Œæ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œæ²¡æœ‰å®ç°é—®é¢˜å’ŒèƒŒæ™¯çš„åˆ†ç¦»ï¼›æ­¤å¤–ï¼Œå°±ç®—å®ç°äº†åˆ†ç¦»ï¼Œé—®é¢˜å’ŒèƒŒæ™¯çŸ¥è¯†çš„å‘é‡ä¹Ÿä¸ä¸€å®šèƒ½å¤ŸåŒ¹é…ä¸Šå»ã€‚ç›®å‰çš„å®è·µï¼Œä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„testï¼Œè¿˜æœ‰è®¸å¤šç»†èŠ‚éœ€è¦è°ƒæ•´ï¼šhistoryä¸å†å²faisså‘é‡åº“çš„ä¿ç•™ç­›é€‰æœºåˆ¶ï¼›faisså‘é‡åœ¨å†…å­˜ä¸­çš„åºŸå¼ƒä¸åˆ é™¤ï¼›æœªæ¥çš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯å»ç†è§£é•¿æ–‡æœ¬ä¹ƒè‡³è¶…é•¿æ–‡æœ¬ï¼Œæˆ–è®¸è¿˜è¦æ¶‰åŠç”Ÿæˆï¼Œå› è€Œè¶…é•¿æ–‡æœ¬ä¸‹tokenã€inputã€cacheç­‰çš„é™åˆ¶ä¹Ÿéœ€è¦è€ƒè™‘ï¼Œå½“ç„¶è¿™æ˜¯åé¢çš„è¯¾é¢˜ã€‚å…¶æ¬¡ï¼Œè¯´ä¸€ä¸‹ç¡®å®å®ç°ç»“æœä¼˜åŒ–çš„å¯èƒ½åŸå› ï¼šæ­£å¦‚ä¹‹å‰æåˆ°çš„ï¼Œè¿™ç§å®è·µçš„æ–¹æ³•è®ºä¸ç†è®ºåŸºç¡€æ¯”è¾ƒä¸è¸å®ï¼Œä½†ä¸ºä»€ä¹ˆå®ç°äº†ç»“æœä¼˜åŒ–ï¼Ÿå¯èƒ½çš„åŸå› åœ¨äºï¼Œæœ€åçš„é—®é¢˜ï¼Œç”±äºå…³é”®è¯è¿˜æ˜¯è¯­ä¹‰ä¹‹ç±»çš„ï¼Œåœ¨å‘é‡åŒ–ä¹‹åç¡®å®ä¸èƒŒæ™¯ä¿¡æ¯çš„æŸä¸€éƒ¨åˆ†é«˜åº¦ç›¸å…³ï¼Œä»è€Œåœ¨queryçš„cutä¸å‘é‡åŒ–ä¹‹åå¢å¼ºäº†ç›¸å…³çš„å‘é‡ï¼ˆsentence_transformerçš„åŸç†ä¼¼ä¹åœ¨äºï¼Œè®¡ç®—å¥å­å‘é‡ä¸å…¨æ–‡å‘é‡çš„ç›¸å…³ç¨‹åº¦ï¼Œä»è€Œè¿”å›topkï¼‰ï¼Œä½¿å¾—å¤§å¤šæ•°æƒ…å†µä¸‹ç›¸å…³èƒŒæ™¯ä¿¡æ¯èƒ½å¤Ÿè¢« â€œå¤§æµ·æé’ˆâ€ï¼Œè¿™éƒ¨åˆ†topkä¿¡æ¯ï¼ŒåŠ å…¥åˆ°promptä¸­å»ï¼Œå†è¾“å…¥åˆ°LLMä¸­ï¼Œåœ¨LLMå†…éƒ¨åˆä¼šå› ä¸ºé‡ç‚¹ä¿¡æ¯çš„äºŒæ¬¡&#x2F;å¤šæ¬¡å‡ºç°å®ç°attentionçš„å¢å¼ºï¼Œä»è€Œå¢å¼ºäº†è¿”å›ç»“æœã€‚ ä¸‹åˆé˜…è¯»TransoformerFAMçš„è®ºæ–‡ï¼Œä½†æ˜¯å°šæœªç†è§£é€å½»ï¼Œä¸å¤ªèƒ½æ„æƒ³å‡ºæ¥è¿™ç§ç»“æ„åº”è¯¥æ€ä¹ˆåœ¨ä»£ç é‡Œå®ç°ã€‚è®ºæ–‡ä¸­è¯´ï¼Œå¯ä»¥ä¸å½±å“ä¹‹å‰çš„æƒé‡å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´åº”è¯¥å®šä¹‰ä¸€ä¸ªclassæ¥ä½œä¸ºcacheï¼Ÿå†…ç½‘æ¥å…¥è®¸å¯æ‰¹ä¸‹æ¥äº†ï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„æ¨¡å‹äº†ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»TransformerFAMï¼Œæµ‹è¯•æœåŠ¡å™¨ä¸Šçš„æ¨¡å‹çš„promptä¼˜åŒ–æ•ˆæœ 4.19å°è¯•å°†å†…å¤–ç½‘è®¿é—®èµ°çš„é€šé“åˆ†ç¦»ï¼Œä¸ç„¶æ¯æ¬¡è®¿é—®å†…ç½‘éƒ½è¦æ–­wifiå°±å¾ˆå‚»é€¼ã€‚ä¸‹åˆ—å‘½ä»¤éœ€è¦cmdä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ 1route -p add 172.17.39.189 mask 255.255.255.0 173.17.39.254 ä¸‰ä¸ªåœ°å€åˆ†åˆ«æ˜¯å†…ç½‘ipã€å†…ç½‘æ©ç ã€å†…ç½‘ç½‘å…³ã€‚ï¼ˆå¹¸å¥½ç½‘ç»œæ¥å…¥éœ€è¦macéªŒè¯ï¼Œä¸ç„¶æˆ‘è¿™å‘½ä»¤è¿˜ä¸å¥½æ”¾ä¸Šæ¥ï¼‰ã€‚ç½‘ä¸Šæœçš„æ•™ç¨‹è¿˜é¢å¤–æ‰€æœ‰è·¯ç”±å…¨èµ°äº†ä¸€éå†…ç½‘ï¼Œçº¯æ²™æ¯”åšæ³•æ¥çš„ï¼Œåªè¦è¿™ä¸€ä¸ªå‘½ä»¤å…¶å®å°±å¯ä»¥äº†ã€‚ çªç„¶å‘ç°è‡ªå·±é‹å­ç©¿çš„ä¸æ˜¯åŒä¸€åŒï¼Œå¥½ç¬‘ä¹‹ä½™ï¼Œåˆæœ‰ç‚¹æ„Ÿæ…¨ã€‚æˆ–è®¸æˆ‘ä»ç„¶æ²¡æœ‰é•¿å¤§ï¼Œä»ç„¶æ¯›æ¯›ç‡¥ç‡¥åœ°å»é¢å¯¹è¿™ç¤¾ä¼šçš„ä¸€åˆ‡ï¼Œæˆ–è®¸æˆ‘å°±åƒç©¿ä¸Šå¤§äººè¥¿è£…çš„èœ¡ç¬”å°æ–°ï¼Œåœ¨å‡è£…æˆç†Ÿã€‚ä¸Šæ¬¡å‘ç”Ÿç±»ä¼¼çš„äº‹æƒ…ï¼Œä¼¼ä¹æ˜¯è¢œå­è¿˜æ˜¯ä»€ä¹ˆä¸œè¥¿ç©¿çš„ä¸æ˜¯åŒä¸€åŒï¼Œå·²ç»è®°ä¸å¤ªæ¸…äº†ã€‚ ä¸‹åˆï¼Œæ•´äº†ä¸€ä¸‹åˆcurlè®¿é—®é‚£ä¸ªbæœåŠ¡å™¨æ¨¡å‹ï¼Œéƒ½å¤±è´¥äº†ï¼›å®˜æ–¹æ–‡æ¡£çš„å‘½ä»¤è¯•è¿‡äº†ä¸€ç‚¹ç”¨ä¹Ÿæ²¡æœ‰ï¼›ä½†æ˜¯ï¼Œä½¿ç”¨langchainçš„å‘½ä»¤å´æˆåŠŸäº†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼ŸåŸºæœ¬ä¸Šä¸¤å°æ—¶æµªè´¹äº†ï¼Œæˆ‘çœŸæ˜¯æ— è¯­å­ã€‚ä½†å¥½æ¶ˆæ¯æ˜¯ï¼Œè¿™ä¸ªpromptä¼˜åŒ–çš„æ•ˆæœï¼Œåœ¨7bä¸Šä¹Ÿå¾ˆæ˜æ˜¾ã€‚ä¸‹åˆè¿˜çœ‹äº†ä¸€ä¼šå„¿TransformerFAMï¼Œä¼¼ä¹æœ‰ä¸€ç‚¹å®ç°çš„æ€è·¯ï¼›ä¸çŸ¥å‘¨æœ«æ˜¯å¦ä¼šå¼€å§‹å†™ä¸€ä¸‹ ï¼ˆåŸºæœ¬ä¸å¯èƒ½ï¼‰ä»Šå¤©å‘äº†ä¸€éƒ¨åˆ†å·¥èµ„ï¼Œä¸Šä¸ªæœˆ20å·åˆ°æœ¬æœˆ10å·çš„ã€‚ æ˜æ—¥ä»»åŠ¡ï¼š å“‡è¢„ï¼é«˜ä¸€ä¸‹è‡³é«˜äºŒæœ«å°¾çš„112å¯å®¤ï¼ä¸‰åˆ†ä¹‹äºŒçš„å››äººå†èšé¦–ï¼åƒä¸€å£åœ°åœ°åœ°åœ°é“å„¿çš„ç™¾äº¬å…«å¤§ç¢—ï¼æ²¡æ¯›ç—…å¥¥è€é“ä»¬ï¼ ä¸‹å‘¨ä»»åŠ¡ï¼šåç»­å¤ç°æ~ 4.20-4.21å‘¨å…­ï¼Œå’ŒSLã€NJä¸€èµ·åƒä¹‹å‰å’ŒNJåœ¨å®‰è´é—¨åƒè¿‡çš„é‚£ä¸ªå°é¦†å­ï¼Œåœ°é“å„¿ï¼ç‚¹äº†éº»è±†è…ã€ç‚¸è˜‘è‡ã€å…«å¤§ç¢—ä¹‹ç‰›æ‚ã€è±†æ³¡ï¼ˆè¿™ä¸ªbè±†æ³¡å’Œéº»è¾£çƒ«é‚£ä¸ªå‘³é“ä¸€æ ·ï¼ŒçœŸæ˜¯è¡€äºï¼ï¼‰ã€æ‰’è‚‰æ¡ã€ç¾Šè‚‰çƒ§å–ã€è˜‘è‡å’Œè´è‹£ç‚’çš„ä¸€ä¸ªç´ èœã€‚åƒçš„æŒºå¥½ã€‚å•¥æ¯”LTç”¨ä»–ä¹‹å‰åœ¨ç¾¤é‡Œå¹çš„å‘è€æ¿è¯·å‡çš„ç†ç”±æ¥åº”ä»˜æˆ‘ä»¬ğŸ˜…ï¼Œå®¶äººä»¬çœŸæ˜¯ä¸€æ•´ä¸ªæ— è¯­ä½äº†ã€‚å•¥æ¯”SLååœ°é“ååäº†ğŸ˜…ï¼Œååˆ°ä»–å¦ˆçš„æœé˜³é—¨å»äº†ï¼Œå¤šç­‰äº†åŠå°æ—¶æ‰åƒé¥­ï¼Œç™¾äº¬âœŒåè½¦ä¸»æ‰“ä¸€ä¸ªéšå¿ƒæ‰€æ¬²è¯´æ˜¯ã€‚å¿«ä¸‹åœ°é“çš„æ—¶å€™ï¼ŒNJå‘Šè¯‰æˆ‘é™„è¿‘æœ‰cosplayçš„ä»€ä¹ˆå±•å­ï¼Œå› ä¸ºä»–åœ¨åœ°é“å£çœ‹è§äº†å¥½å‡ ä¸ªç©¿çš„å¥‡å¥‡æ€ªæ€ªçš„äººğŸ¤£ï¼›æˆ‘å‡ºåœ°é“å£çš„æ—¶å€™ï¼Œçœ‹è§äº†ä¸€ä¸ªJKçš„èƒŒå½±ï¼Œæ˜¯é‚£ç§æ—¥å¼JKï¼Œå› ä¸ºé‚£è¡£æœçš„è´¨æ„Ÿå•¥çš„ä¸€çœ‹å°±æ˜¯cosplayçš„ã€‚åƒå®Œé¥­ï¼ŒNJçŒœæµ‹cosplayçš„åœºåœ°æ˜¯åœ¨åŒ—æŠ•è´­ç‰©å…¬å›­ï¼Œäºæ˜¯æˆ‘ä»¬èµ°è¿‡å»çœ‹çœ‹çƒ­é—¹ã€‚åœ¨é‚£ä¸ªè´­ç‰©å¹¿åœºé‡Œé¢é€›äº†ç¬¬ä¸€æ¬¡ï¼Œæˆ‘æ²¡çœ‹è§ï¼Œå®å¯æ¢¦é“é¦†ä¹Ÿè¢«æŸ¥å°äº†ï¼Œä½†åœ¨æ‰¾å®å¯æ¢¦é“é¦†çš„è·¯ä¸Šçœ‹è§äº†ä¸€ç¾¤coserï¼Œçœ‹èƒŒå½±è®¤è¯†ä¸€ä¸ªé’‰ç¦é‡è”·è–‡ï¼›å‡ºäº†å•†åœºåˆ°é™„è¿‘çš„åœ°æ–¹åˆç¨å¾®è½¬äº†è½¬ï¼Œæ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼›äºæ˜¯åŸè·¯è¿”å›ï¼Œæƒ³å»æ²³è¾¹çš„å…¬å›­é‚¹æ´²ã€çœ‹ä¸€çœ‹èŠ±ï¼Œç»“æœè¿™æ—¶å€™åœ¨è´­ç‰©å¹¿åœºé‡Œé¢çœ‹è§äº†ä¸€å¤§æ‰¹coserï¼Œå±…ç„¶æœ‰å°é¸Ÿæ¸¸å…­èŠ±ï¼Œæ³ªç›®ï¼Œç»†æƒ³å·²ç»12å¹´äº†ï¼›SLè¯´çœ‹è§äº†çº¦å°”å¤ªå¤ªï¼›å½“ç„¶è¿˜çœ‹è§äº†äºŒå­—æ¸¸æˆçš„è¤å¦¹ï¼ˆwcï¼Oï¼ï¼‰ï¼›å…¶ä»–é›¶é›¶æ•£æ•£çš„coserè®°ä¸æ¸…äº†ã€‚å‡ºäº†è´­ç‰©å¹¿åœºï¼Œåˆçœ‹è§ä¸¤ä¸ªcoserè¿›å¹¿åœºï¼Œçœ‹æ¥æ˜¯çœŸæœ‰å±•å­ï¼›å…¶ä¸­ä¸€ä¸ªæ˜¯mikuï¼ˆæˆ‘å»ï¼åˆéŸ³æœªæ¥ï¼ï¼‰ï¼Œå¯æƒœå¬NJè¯´æ˜¯ä¸ªå¦å…‹ï¼›æˆ‘çœ‹çš„è¿™äº›coseréƒ½æ²¡çœ‹è§æ­£è„¸ï¼Œå…¨æ˜¯èƒŒå½±ã€‚åœ¨bç«™ä¼šå‘˜è´­ä¸ŠæŸ¥äº†æŸ¥ï¼Œå‘ç°çœŸæ˜¯ä¸ªå±•å­ï¼Œé—¨ç¥¨80çš„coserå±•ï¼Œçº¯cosplayäº¤æµä¹‹ç±»çš„ï¼Œæ— åŒäººå¿—å•¥çš„ï¼Œæ„Ÿè§‰æ²¡æ„æ€ï¼Œä¹Ÿæ²¡æœ‰å•¥å£°ä¼˜ç»™æˆ‘çœ‹ï¼ˆ**æ¨‹å£å††é¦™ä½ å¸¦æˆ‘èµ°å§ğŸ˜­*ï¼‰ï¼Œå°±ä¸å»çœ‹äº†ï¼›å»æ²³è¾¹å…¬å›­é€›äº†é€›ï¼Œæ­‡äº†æ­‡ï¼Œå¸®SLçœ‹ä¸€ä¸‹ä»–ç¢§è“èˆªçº¿çš„è£…å¤‡å’Œé…é˜Ÿï¼›å·®ä¸å¤š14ç‚¹çš„æ—¶å€™ï¼Œå„è‡ªæ‰“åˆ°å›åºœäº†ã€‚ä¸‹åˆï¼ŒNJå‘äº†æ·˜å®é“¾æ¥ç»™æˆ‘ï¼Œæ˜¯å¤§çª‘æ‰“æŠ˜ï¼Œ3450mlåªè¦8.9rï¼Œäºæ˜¯é€Ÿé€Ÿä¸‹å•ï¼›åˆé—®ä»–è¿˜æœ‰æ— æ¨èï¼Œç»™æˆ‘æ¨èäº†7æœˆä¸´æœŸçš„ç›æ±½æ°´ï¼Œä¹°äº†ï¼›åˆ°å‡ºç§Ÿå±‹ä¹‹åï¼Œèººã€çœ‹å°è¯´ã€åˆ·è§†é¢‘ã€æ‰“åŠ£è´¨æ¸¸æˆã€‚æ™šä¸Š10ç‚¹å¤šï¼ŒæŸ¥å…¬ä¸»é“¾æ¥EX5çš„ä½œä¸šï¼ŒæŸ¥åˆ°ä¸€ä¸ªå¥½åƒèƒ½æŠ„ï¼Œé‚å†³å¿ƒæˆ˜æ–—ï¼›è€—è´¹2kæ¯çŒªçŸ³ã€8Eç›å¨œï¼Œä¸€ä¸ªå¤šå°æ—¶ã€SLåå‡ æ¬¡ï¼Œç»ˆäºé€šå…³EX5ï¼› å‘¨æ—¥ï¼Œæ··ï¼›ä¸­åˆåƒçš„çƒ¤è‚‰é¥­å¤–å–ï¼Œæ™šä¸Šåƒçš„èº å¸ æ··ï¼›å’ŒSHæ‰“å¤§ä¹±æ–—ï¼›ä»–å¦ˆçš„ï¼è¿”å›ç™¾äº¬çš„ç¥¨æ²¡æŠ¢åˆ°ï¼å…¨æ˜¯å€™è¡¥ï¼äº”ä¸€èŠ‚å›ä¸äº†å®¶ä»€ä¹ˆçš„é‚£ç§äº‹æƒ…ä¸è¦å•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šå•Šï¼å¦‚æœæ²¡åŠæ³•ï¼Œåªèƒ½è¯·ä¸€ä¸¤å¤©çš„å‡å»¶è¿Ÿå›ç™¾äº¬äº†æ™šä¸Š8ã€9ç‚¹çš„æ—¶å€™æ„Ÿè§‰çœ¼ç›æœ‰ç‚¹ä¸èˆ’æœï¼Œå¹²æ¶©ï¼Œåˆæœ‰ç‚¹å›°ï¼Œäºæ˜¯æ—©æ—©ç¡äº†ï¼› 4.22å‘¨æœ«çš„æ—¶å€™ï¼Œåä¸ºçš„ç§»åŠ¨wifiåˆ°äº†ï¼ŒåŠ ä¸Šä¹‹å‰ç½‘ç®¡è¿‡æ¥æ¥ç½‘çº¿ä½†å•¥äº‹å„¿éƒ½æ²¡è§£å†³åè€ŒæŠŠæœåŠ¡å™¨çš„å¤–ç½‘æƒé™ç»™æ–­äº†ğŸ˜…ï¼ˆç™¾äº¬çš„å›½ä¼âœŒå°±æ˜¯çˆ·ï¼ï¼‰ï¼Œå› è€ŒæœåŠ¡å™¨å’ŒPCéƒ½ä¼šé€šè¿‡è¿™ä¸ªwifiç›¸è¿ï¼ˆç»ˆäºä¸ç”¨æˆ‘å¼€çƒ­ç‚¹äº†ï¼ï¼‰ã€‚ä¸Šåˆï¼Œé˜…è¯»Infini-Attentionçš„è®ºæ–‡ï¼Œç¨å¾®çœ‹äº†ä¸€ä¸‹æºç ã€‚è¿™ä¸ªç¤ºä¾‹ä»£ç æ˜¯åŸºäºqwen2MoEæ¨¡å‹çš„ï¼Œè¿ç§»åˆ°qwen-chatä¸Šåº”è¯¥æ¯”è¾ƒå®¹æ˜“ã€‚ä½†æ˜¯è¯åˆè¯´å›æ¥ï¼ŒMoEæ¨¡å‹ä¸chatæ¨¡å‹çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Œè¿˜éœ€è¦é˜…è¯»ä¸€ä¸‹æºç ã€‚å¯èƒ½çš„å¥½æ¶ˆæ¯æ˜¯ï¼ŒInifini-attentionæœ¬ä½“çš„ä»£ç è¿˜æŒºçŸ­çš„ã€‚åœ¨é˜…è¯»è®ºæ–‡ä¸­çš„ä¸€ä¸ªç–‘é—®å°±æ˜¯ï¼šè®ºæ–‡ä¸­Memory cacheçš„æ›´æ–°ï¼Œä¼¼ä¹æ˜¯å¢é‡å¾ªç¯ï¼ŒåŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­memoryæ²¡æœ‰Normï¼Œè¿™æ ·ä¼šä¸ä¼šæ•°å€¼æº¢å‡ºï¼Ÿ é”™è¯¯çš„ï¼Œæ²¡ç–‘é—®äº†ï¼Œactivationå’Œnormå‘ç”Ÿåœ¨åé¢retrieval attentionçš„è®¡ç®—ä¸æ£€ç´¢ä¸Šé¢ã€‚ ä¸‹åˆï¼Œæ¯”è¾ƒinfiniå’Œqwen2-moeåŸç”Ÿattentionä¹‹é—´çš„ä¸åŒï¼›ä»£ç å’Œæ€è·¯åº”è¯¥æ˜¯ç®€å•çš„ï¼Œå°±æ˜¯æŠŠé¢å¤–çš„memoryåŠ åˆ°attn_outputé‡Œé¢å»ï¼›ä½†æ˜¯ ä¸º å•¥ qwen2-moe çš„ attention ä¸ åš softmax å’Œ norm ï¼Ÿ é“¸å¸äº†ï¼Œä¸æ˜¯åœ¨è¿™å„¿åŠ addå’Œnormçš„ï¼›qwenè¿™ä¸ªattentionï¼Œåœ¨è®¡ç®—å®Œattentionä¹‹åï¼Œåˆå¯¹å®ƒé¢å¤–åšäº†ä¸ªnn.linearã€‚è¿™ä¸ªæ“ä½œçš„å‡ºå¤„æ˜¯å“ªå„¿ï¼Ÿæˆ‘æŸ¥äº†llamaçš„æºç ï¼Œå‘ç°å®ƒä¹Ÿæ˜¯è¿™ä¹ˆåšçš„â€”â€”â€”â€”å“¦tmdï¼Œåˆé“¸å¸äº†ï¼ŒåŸæ¥è¿™æ˜¯MHAï¼Œå¤šå¤´concatåˆ°ä¸€èµ·ä¹‹åå†ç”¨linearå±‚èåˆä¸€ä¸‹ã€‚ç†è®ºåˆ°å®è·µä¹‹é—´çš„è·ç¦»è¿˜éœ€è¦å»åŠªåŠ›å¼¥è¡¥ï¼çœ‹ä»£ç çš„æ—¶å€™çªç„¶æƒ³åˆ°ï¼Œè®ºæ–‡ä¸­åšäº†cacheæ¶ˆè€—çš„å¯¹æ¯”ï¼Œinfiniåªç”¨é¢å¤–çš„1.5Mï¼Œè€Œmemorizing transformerç”¨äº†183Mï¼Œä¸ºå•¥ä¼šå·®è¿™ä¹ˆå¤šï¼Ÿåªåœ¨æŸä¸€å±‚åŠ å…¥cacheæœ‰é‚£ä¹ˆå¤§çš„æ¶ˆè€—å—ï¼Ÿçœ‹å®Œäº†é¡¹ç›®é‡Œé¢çš„modelæ–‡ä»¶ï¼Œå¯¹ç…§qwenåŸæ–‡ä»¶ä¹‹åï¼Œç¡®å®šäº†è¦æ”¹çš„åœ°æ–¹ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æœ‰M_Zè¿™ä¸ªå‚æ•°çš„åœ°æ–¹ï¼›å…¶ä»–çš„ä¸‰ä¸ªæ–‡ä»¶è¿˜æ²¡çœ‹ã€‚æ™šä¸Šï¼Œå’Œæ²ˆæ•™æˆé‚£è¾¹å¼€äº†å‘¨ä¾‹ä¼šï¼Œå†æ¬¡æ˜ç¡®æ¥ä¸‹æ¥çš„ä»»åŠ¡æ˜¯æ— è¯¯çš„ã€‚å’ŒSHå¤§ä¹±æ–—ï¼Œè¾“èµ¢å‚åŠå§ï¼Œå°±æ˜¯é‡åˆ°æ²™æ¯”é€‰Cä½†æ˜¯Cä¸èµ·æ¥æŒºæ— è¯­çš„ã€‚æ™šä¸Šï¼Œå’ŒZZKèŠäº†ä¸€ä¼šå„¿å·¥ä½œçš„äº‹æƒ…ï¼Œä»–ç°åœ¨åœ¨ä¸Šæµ·çš„æ»´æ»´å®ä¹ ï¼Œå’Œæˆ‘åæ§½æˆ¿å­ä¸å¥½ã€å¤©å¤©åŠ ç­ã€èŠ‚å‡æ—¥ä¹ŸåŠ ç­ã€å®ä¹ å·¥èµ„ä½ã€å­¤ç‹¬ã€ç²¾æ°”ç¥è€—å°½å‡æœŸä¹Ÿä¸æƒ³åŠ¨â€¦â€¦æˆ‘æ„ŸåŒèº«å—ï¼Œè¿˜æ˜¯é‚£å¥è¯ï¼Œå¤§å®¶å¯¹ä¸Šç­çš„æ„Ÿå—éƒ½æ˜¯ä¸€æ ·çš„ï¼›å†æ¬¡æ„Ÿå—åˆ°äººçš„å¤©æ€§å°±æ˜¯åŒæ¶å·¥ä½œçš„ã€‚ä¸Šå®Œè¿™ä¸ªBç­ï¼Œå›å®¶å¾€å‡ºç§Ÿå±‹ä¸€èººï¼Œå°±æ„Ÿè§‰è¿™è¾ˆå­å®Œè¾£ğŸ˜…ã€‚å…¶å®ï¼Œå†™åšå®¢ã€åœ¨åšå®¢ä¸­æ”¾é£è‡ªæˆ‘ï¼ˆæŒ‡çå‡ æŠŠè¯´ã€ç²—ä¿—ç”¨è¯­ï¼‰ï¼Œæ˜¯æˆ‘åœ¨è¿·èŒ«ã€å­¤ç‹¬æ—¶çš„ä¸€ç§æ’è§£æ‰‹æ®µå§ï¼›ç»™è‡ªå·±æ‰¾ä¸€ä¸ªèƒ½çœ‹è§è¿›åº¦çš„ã€åšèµ·æ¥ä¸å¤ªéº»çƒ¦ã€æœ‰ç‚¹å„¿åŠ¨åŠ›åšçš„äº‹æƒ…åšï¼Œå¯ä»¥ä»ä¸­æ„Ÿåˆ°ä¸€ç‚¹æ´»ç€çš„æ„ä¹‰ã€‚è®°å½•æ—¥å¸¸ï¼Œä¸€æ–¹é¢æ˜¯çœ‹çœ‹è‡ªå·±æ˜¯ä¸æ˜¯çœŸçš„æœ‰è¿›æ­¥ï¼Ÿå¦ä¸€æ–¹é¢ï¼Œä¹Ÿæ˜¯è®°å½•ä¸€äº›éš¾ä»¥å¤åˆ»çš„ç»å†ä¸å¿ƒå¢ƒï¼Œé¿å…è‡ªå·±é—å¿˜ä¸€äº›ä¸œè¥¿ï¼Œåƒæ˜¯å¼‚åœ°çš„æ ¼æ ¼ä¸å…¥ã€å¤§åŸå¸‚çš„è‡ªå‘ä¹‹ç±»çš„ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šçœ‹å¦å¤–ä¸‰ä¸ªæ–‡ä»¶ï¼Œå°è¯•ä¿®æ”¹æœ¬åœ°çš„æ¨¡å‹ 4.23çªç„¶å‘ç°infini-attentionçš„é¡¹ç›®ä¸æ˜¯å®˜æ–¹çš„ï¼Œè€Œæ˜¯ä¸ªäººè‡ªå·±å†™çš„ï¼›githubä¸Šè¿˜æœ‰å‡ ä¸ªå®ç°çš„é¡¹ç›®ã€‚å¥½å¥‡æ€ªæï¼Œä¸ºä»€ä¹ˆé‚£ç¯‡TransformerFAMæ²¡æœ‰äººå†™ä»£ç ï¼Ÿå¯¹ç…§ç€é¡¹ç›®ï¼Œå°è¯•ä¿®æ”¹qwençš„modelæ–‡ä»¶ï¼Œç»“æœå‘ç°ï¼Œç¤ºä¾‹çš„å®ç°ä»£ç æ˜¯åŸºäºqwen1.5çš„ï¼Œè¿™ä¸ªä»£ç æ›´åŠ ç®€æ´ï¼Œç›¸æ¯”ä¹‹ä¸‹qwençš„modelæ›´åŠ æ‚ä¹±&#x2F;å†—ä½™ï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆè¯´ï¼Œå› ä¸ºè¿˜æ²¡æœ‰çœ‹åˆ°qwen1.5çš„å…¶ä»–modelæºç ã€‚ä½†æ˜¯åè¿‡æ¥è¯´ï¼Œä¿®æ”¹qwençš„modelå°½ç®¡å¯èƒ½æ›´åŠ å›°éš¾ï¼Œä½†ç›¸æ¯”ä¹‹ä¸‹åº”è¯¥æ›´èƒ½æå‡æˆ‘çš„å·¥ç¨‹èƒ½åŠ›ã€åŠ æ·±æˆ‘å¯¹å¤§æ¨¡å‹æµç¨‹å’Œä»£ç çš„ç†è§£ï¼Œè¿˜æ˜¯ä¸èƒ½ç•éš¾æ”¾å¼ƒï¼ ä¸‹åˆï¼Œå°è¯•ä¿®æ”¹qwençš„modelæ–‡ä»¶ï¼Œå¯¹ç…§infini attentionã€qwenæºæ–‡ä»¶ã€qwen1.5æºæ–‡ä»¶ä¿®æ”¹ï¼›qwen1åœ¨ç¡®å®šåœ¨å“ªå„¿èåˆmemoryä¸Šé¢æœ‰éš¾åº¦ï¼ŒæŒ‰ç†è¯´åº”è¯¥åœ¨å®æ–½äº†RoPEä¸”åŠ å…¥åˆ°cacheçš„qã€kã€vè¿™ä¸€æ­¥æ“ä½œä¹‹åï¼Œå†åˆ©ç”¨è¿™ä¸ªcacheè¿›è¡Œmemoryèåˆï¼Œä½†è¿™ä¸ªä»£ç æœ‰ç‚¹æ‚ä¹±ï¼Œclassé‡Œé¢ä¸ºäº†å®ç°attentionåˆå†™äº†å‡ ä¸ªmethodï¼Œç„¶è€Œåœ¨qwen1.5é‡Œé¢å°±çº¯æ²¡æœ‰é¢å¤–æ–¹æ³•ä¸€æ­¥åˆ°ä½äº†ï¼Œå®ç°çš„å¾ˆæ¸…çˆ½ï¼Œåœ¨1é‡Œé¢æœ‰äº›æ‚ä¹±ï¼›æ€»ä¹‹ï¼ŒåºŸäº†ä¸å°‘åŠ›æ°”å®šä½äº†memoryåŠ å…¥çš„ä½ç½®åï¼Œå´åˆå‘ç°äº†å¦ä¸€ä¸ªé—®é¢˜ï¼šinfinié‡Œé¢ä½¿ç”¨çš„æ˜¯GQAï¼Œè¿™ä¸ªæ‰€éœ€è¦çš„å‚æ•°ï¼Œåœ¨1.5é‡Œé¢é€šè¿‡configå¯ä»¥å®šä¹‰ã€æ˜¯å­˜åœ¨çš„ã€‚ä½†æ˜¯åœ¨1é‡Œé¢ï¼Œconfig.jsonæ–‡ä»¶é‡Œé¢å¹¶æ²¡æœ‰è¿™ä¸ªå‚æ•°çš„å½±å­ï¼›ä¹Ÿå°±æ˜¯è¯´ï¼Œqwen1æ˜¯ä¸æ”¯æŒGQAçš„ã€‚è¿™ä¸ªå‚æ•°æ˜¯ï¼š num_key_value_heads åœ¨1.5é‡Œé¢ï¼ŒGQAä¸­ï¼Œéœ€è¦è®¡ç®—groupçš„æ•°å€¼ï¼Œè¿™ä¸ªæ•°å€¼æ˜¯è¿™ä¹ˆè®¡ç®—å‡ºæ¥çš„ï¼š 1self.num_key_value_groups = self.num_heads // self.num_key_value_heads ç›®å‰æœ‰ä¸¤ç§æ€è·¯ï¼Œä¸€æ˜¯ä¸è¦GQAï¼Œå¦ä¸€ç§æ˜¯è‡ªå·±åŠ ä¸Šè¿™ä¸ªå‚æ•°ã€‚åœ¨æŸ¥çœ‹qwen1.5çš„configuration_qwen2.pyä¹‹åï¼Œå‘ç°äº†è¿™ä¸ªæ–°å¢å‚æ•°å®ƒæœ‰ä¸€ä¸ªé»˜è®¤åˆå§‹åŒ–çš„å€¼ï¼Œåˆå§‹åŒ–ä»£ç å¦‚ä¸‹ï¼š 12if num_key_value_heads is None: num_key_value_heads = num_attention_heads ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœnum_key_value_headsæ²¡æœ‰å®šä¹‰ï¼Œå°±é»˜è®¤ç­‰äºnum_attention_headsã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥qwen1çš„ä»£ç é‡Œé¢è®©å®ƒç›¸ç­‰ï¼›è¿™ç§æ–¹æ³•å®é™…ä¸Šå’Œä¸è¦GQAæ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œå°±æ˜¯æŠŠinfiniçš„ä»£ç æŠ„è¿‡æ¥æ¯”è¾ƒæ–¹ä¾¿ç½¢äº†ã€‚åŸä»¥ä¸ºéš¾å…³å·²ç»è¢«æ”»ç ´äº†ï¼Œä½†åœ¨repeat_kvçš„æ—¶å€™åˆå‘ç°äº†é—®é¢˜ï¼šé¦–å…ˆï¼Œqwen1é‡Œé¢æ˜¯æ²¡è¿™ä¸ªç©æ„å„¿çš„ï¼Œä¹Ÿå°±æ˜¯è¯´1ä¹Ÿä¸æ”¯æŒéœ€è¦repeat_kvçš„ä¸€ç³»åˆ—æ“ä½œï¼›è¿™æ˜¯å°äº‹ï¼Œåªè¦å»1.5é‡Œé¢æŠŠè¿™ä¸ªå‡½æ•°æŠ„è¿‡æ¥å°±è¡Œäº†ï¼›ä½†å…³é”®çš„æ˜¯1é‡Œé¢å¥½åƒä¹Ÿæ²¡æœ‰å¯¹vè¿›è¡Œcacheï¼Œä»…ä»…cacheäº†qå’Œkï¼Œæœ‰query_listå’Œkey_listï¼Œè‡³å°‘æˆ‘åˆæ­¥çœ‹æ¥æ˜¯è¿™æ ·çš„ï¼›æˆ‘å¾—å†ä»”ç»†çœ‹çœ‹ï¼ŒçœŸè¦æ²¡cache_vçš„è¯ï¼Œæ”¹çš„å·¥ç¨‹é‡å°±å¤ªå¤§äº†ï¼›è¿˜æ˜¯ç›´æ¥å»æ”¹1.5çš„å¥½ã€‚ä¼¼ä¹ï¼Œå¦‚æœå‚æ•°use_cache&#x3D;Trueçš„æƒ…å†µä¸‹ï¼Œqã€kã€væ˜¯éƒ½ä¼šç¼“å­˜çš„ï¼Ÿè€Œä¸”ç›´æ¥å°±ç”¨queryã€keyã€valueå°±è¡Œäº†ï¼Ÿå¦ï¼šinfiniçš„ä»£ç æ›´æ–°äº†ï¼Œä¹‹å‰ä¸€äº›M_Zçš„æ”¹åŠ¨ä¼¼ä¹æ˜¯ä¸å¿…è¦çš„ï¼Œä»–å°†å…¶åˆ é™¤äº†ï¼ˆè¿™æ²™æ¯”owenerä»£ç æœ‰ä¸ªmistakeï¼Œæˆ‘issueå‘Šè¯‰ä»–ï¼Œç»“æœä»–å›å¤è¯´â€œæ²¡é—®é¢˜~~â€ï¼Œç„¶åç«‹åˆ»è¿›è¡Œä¸€ä¸ªissueçš„å…³ï¼Œç»“æœæˆ‘å†çœ‹ä»£ç å‘ç°ä»–å·å·æŠŠé‚£ä¸ªmistakeç»™æ”¹äº†ğŸ˜…ï¼ŒçœŸæ²™æ¯”ï¼‰ã€‚æ”¹å¥½äº†ä»£ç ï¼Œæƒ³è¦åœ¨æœ¬æœºä¸Šæµ‹è¯•æ•ˆæœï¼›ç»“æœcuda out of memoryï¼Œéš¾èšŒï¼›ç›®å‰ä¸¤ä¸ªåŠæ³•ï¼šä¸€æ˜¯æ¢æˆ0.5b-int4å†è¯•è¯•ï¼ŒäºŒæ˜¯åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²è·‘ä¸€ä¸‹ï¼›è€ƒè™‘åˆ°åç»­æ–¹ä¾¿çš„é—®é¢˜ï¼Œè¿˜æ˜¯ç”¨æœåŠ¡å™¨å§ï¼›ä½†æ˜¯conda createçš„æ—¶å€™æŠ¥é”™äº†ï¼›è§£å†³ingâ€¦â€¦ä»–å¦ˆçš„ç ´æ¡ˆäº†ï¼æœåŠ¡å™¨çš„å†…å­˜å’Œç¡¬ç›˜éƒ½çˆ†æ‰äº†ï¼ä¸‹ç­æ—¶é—´åˆ°äº†æ˜æ—¥å†æˆ˜ï¼ æ˜æ—¥ä»»åŠ¡ï¼šåœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•ä¿®æ”¹åçš„æ¨¡å‹æ•ˆæœ æ™šä¸Šï¼Œåœ¨å‡ºç§Ÿå±‹æ··æ—¶é—´ï¼Œæ²¡æœ‰æ‰“LOLï¼›è€Œæ˜¯åˆæ‹¾èµ·äº†âœŒæœ€çˆ±çš„æ€€æ—§é¡µæ¸¸ï¼ï¼ˆå¦‚æœWQçœ‹åˆ°ï¼Œåˆè¦æé‚£å„¿éª‚æˆ‘å±±çŒªåƒä¸äº†ç»†ç³ å•¦ï¼å“ˆå“ˆï¼ï¼‰è¿™æ¸¸æˆæ—¶ä¸æ—¶å°±æƒ³æ¡èµ·æ¥ç©ä¸€é˜µå­ï¼Œç„¶åçªç„¶æ„Ÿè§‰æ— å‘³ã€å› è€Œæœæ–­æŠ›å¼ƒï¼Œå¾€å¾€ä¸‹å®šå†³å¿ƒå†ä¹Ÿä¸ç¢°ï¼Œå´åˆå¶å°”æƒ³èµ·ã€å¿ƒç—’éš¾è€ã€‚æˆ‘æ‰¿è®¤æˆ‘æ˜¯ä¸€ä¸ªå¾ˆæ€€æ—§çš„äººï¼Œæˆ‘æˆ–è®¸ä¸€ç›´æ— æ³•è„±ç¦»è¿‡å»çš„å…‰å½±ã€‚ 4.24ä¸Šåˆï¼ŒæŒ‰ç…§è®¡åˆ’ã€å°è¯•åœ¨æœåŠ¡å™¨ä¸Šæµ‹è¯•ä¿®æ”¹åçš„æ¨¡å‹çš„æ•ˆæœï¼›åœ¨éƒ¨ç½²ç¯å¢ƒçš„é—´æ­‡ä¹‹ä½™ï¼Œçœ‹äº†ä¸€ä¸‹qwen1.5çš„modelæ–‡ä»¶ï¼Œå¼€å¤´è·ƒå…¥çœ¼å¸˜çš„å°±æ˜¯rotray embeddingè¿™ä¸ªclassï¼›å…¶å®ï¼Œçœ‹è¿‡çš„modelæ–‡ä»¶ï¼Œå¤§å¤šéƒ½åƒè¿™æ ·å°†å…¶æ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ï¼›è€Œä¸”ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä¸€æ ·çš„å†™æ³•ï¼Œä¼¼ä¹éƒ½æ˜¯ä»llamaæˆ–è€…ä»€ä¹ˆåŸåˆæ¨¡å‹ä¸­copyè¿‡æ¥çš„ï¼›é‰´äºä¹‹å‰å¹¶æ²¡æœ‰å¤ªææ‡‚å…¶åŸç†ã€ä»£ç ï¼Œåªæ˜¯äº†è§£äº†äº”å…­åˆ†ï¼Œå› è€Œåˆæ‰“ç®—å†çœ‹çœ‹ï¼›èŠ±äº†ä¸€é˜µå­æ—¶é—´ï¼Œçœ‹çš„çœ¼èŠ±ç¼­ä¹±ï¼Œæœ€ç»ˆæ”¶è·å´ä¸å¦‚æƒ³è±¡ä¹‹ä¸­é‚£ä¹ˆå¤§ï¼Œè¿˜æ˜¯æ²¡æœ‰æ˜æ™°ã€‚ç»ˆäºï¼Œåœ¨ç¯å¢ƒéƒ¨ç½²å¥½ä¹‹åï¼Œå°è¯•è¿è¡Œcli_demo.pyï¼Œè¿è¡ŒæˆåŠŸäº†ï¼é—®ç­”ä¹Ÿèƒ½æ­£ç¡®è¾“å‡ºï¼ è™½ç„¶ç»“æœä¸æ˜¯å¾ˆå¥½ï¼Œä½†æ˜¯è€ƒè™‘åˆ°æ¨¡å‹æœ¬èº«ã€ä»¥åŠåŠ å…¥çš„attentionè¿˜æ²¡æœ‰ç»è¿‡ftæˆ–è€…ä»€ä¹ˆæ“ä½œï¼Œå› è€Œå·²ç»å¾ˆæ»¡æ„äº†ï¼å¸Œæœ›è¿™ä¸ªç°è±¡ä»£è¡¨çš„æ˜¯ï¼šä¿®æ”¹çš„å†…å®¹æ˜¯æˆåŠŸçš„ï¼Œåç»­æ˜¯å¯ä»¥æ¨è¿›çš„ã€‚ æ¥ä¸‹æ¥è¦è€ƒè™‘çš„ï¼Œä¸»è¦æœ‰ä¸¤æ–¹é¢ï¼š input queryè¿‡é•¿æ—¶çš„segmentå’Œretrievalã€æˆ–è®¸è¿˜æœ‰chat historyçš„ç›¸å…³æ“ä½œï¼› infiniçš„æ·±å…¥ç†è§£ï¼Œä¸å¾®è°ƒå¯èƒ½ï¼› åœ¨ä¸Šè¿°åšå®Œä¹‹åï¼Œqwen1.5çš„ä¿®æ”¹ä¸å°è¯•åº”è¯¥å°±æ˜¯æ°´åˆ°æ¸ æˆçš„äº‹æƒ…äº† ä»Šå¤©ä¸­åˆï¼Œåˆå‘äº†ä¸€éƒ¨åˆ†å·¥èµ„ï¼Œä¸Šä¸ªæœˆ20å·åˆ°æœ¬æœˆ20å·çš„ã€‚ ä¸‹åˆï¼Œçœ‹äº†ä¸€ä¸‹å…¶ä»–çš„è®ºæ–‡ã€‚å‡†å¤‡çœ‹streaming-llmçš„ä»£ç ï¼Œä½†æ˜¯è¿™ä¸ªä»£ç ç»“æ„æˆ‘å¾—æ¢³ç†ä¸€ä¸‹ã€‚å› ä¸ºè‹¹æœåƒå®Œäº†ï¼Œæ‰€ä»¥åœ¨æ¥¼ä¸‹lawsonä¹°äº†ä¸¤ä¸ªé¥­å›¢å½“æ™šé¥­ï¼›é¥­å›¢è¿˜åœ¨æ‰“æŠ˜ï¼Œå¥½è€¶ï¼åˆ°å‡ºç§Ÿå±‹ï¼Œä¾ç„¶æ··æ—¶é—´ï¼›å’ŒSHæ‰“äº†ä¸¤ä¸‰ä¸ªæ¶ˆå¤±çš„å¤§ä¹±æ–—ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šé˜…è¯»streaming-llmæºç ï¼Œçœ‹LLMæ•™ç¨‹ã€‚ 4.25ä»Šå¤©ä¸Šåˆï¼Œåˆå…¥èŒäº†ä¸€ä½å§‘å¨˜ï¼Œä¼¼ä¹æ˜¯åŒ—å¤§çš„ï¼Œå’Œä¸Šå‘¨å…¥èŒçš„è€å“¥è®¤è¯†ï¼›æå¦ˆï¼Œç™¾äº¬çœŸæ˜¯å§è™è—é¾™ã€‚æ„Ÿè§‰è‡ªå·±è¢«Top2åŒ…å›´äº†ã€‚çœ‹streaming-llmçš„kv-cacheéƒ¨åˆ†çš„ä»£ç ï¼Œç»“åˆè®ºæ–‡çœ‹ï¼Œè¿˜æ˜¯æœ‰ç‚¹éš¾æ‡‚æã€‚æ˜¨å¤©åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºäº†è€é•¿æ—¶é—´çš„ç¯å¢ƒç»™nmä¸çŸ¥é“æ˜¯è°ç»™åˆ äº†ğŸ˜…ğŸ˜…ğŸ˜…ğŸ˜…ã€‚ä¸­åˆï¼Œçªç„¶æƒ³èµ·æ¥æ˜¨å¤©æ”¹çš„qwen-infiniä»£ç ä¼¼ä¹æœ‰é—®é¢˜ï¼›å»æŸ¥çœ‹ä¹‹åæœç„¶å¦‚æ­¤ï¼›è¿™ä¹ˆæƒ³æ¥ï¼Œæ˜¨å¤©çš„cuda out of memoryåº”è¯¥æ˜¯ä¸€ä¸ªå¤±è¯¯ï¼Œè€Œä¸æ˜¯ä¿®æ”¹æ¨¡å‹æˆåŠŸè¿è¡Œçš„ä¿¡å·ã€‚äºæ˜¯ï¼Œä¸‹åˆç»§ç»­ç¢ç£¨ä¿®æ”¹ï¼›é‡åˆ°äº†è®¸å¤šé—®é¢˜ã€‚ä¸‹é¢åˆ—å‡ºæœ€ä¸¥é‡çš„é—®é¢˜ï¼š åœ¨infini-attentionçš„åˆå§‹åŒ–æ¨¡å—ä¸­register_bufferäº†Må’Œzï¼ŒåŒæ—¶å¯¹å…¶è¿›è¡Œkaimingåˆå§‹åŒ–ï¼Œä½†æ˜¯åç»­forwardçš„æ—¶å€™ï¼Œå´æ˜¾ç¤ºMå’Œzæ˜¯NoneTypeï¼šå¦‚æœä¸å¯¹Må’Œzè¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™å›åœ¨è®¡ç®—logitçš„æ—¶å€™æŠ¥é”™ï¼Œå› ä¸ºlogitå€¼éƒ½ä¸º0ï¼›è¿™è¾¹æµ‹è¯•äº†ä¸€ä¸‹åˆå§‹åŒ–ä»£ç çš„å†™æ³•ï¼Œè‡³å°‘å¯ä»¥ä¿è¯çš„æ˜¯ï¼Œinitå‡½æ•°ä¸­çš„Må’Œzæ˜¯æ­£ç¡®åˆå§‹åŒ–çš„ã€æ­£ç¡®ç™»è®°çš„ï¼ˆï¼Ÿï¼‰â€”â€”â€”â€”åŸå› ï¼šå¦‚æœæ¨¡å‹æƒé‡æ–‡ä»¶é‡Œé¢æ²¡æœ‰è¿™ä¸ªbufferï¼Œå°±ç®—æˆ‘åˆå§‹åŒ–äº†ï¼ŒåŠ è½½æƒé‡ä¹‹åä¹Ÿä¼šæ˜¯nonetypeï¼›æ‰€ä»¥éœ€è¦åœ¨ä½¿ç”¨ä¹‹å‰å†å¼ºåˆ¶åˆå§‹åŒ–ä¸€ä¸‹ã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¼¼ä¹æ˜¯å› ä¸ºç²¾åº¦é—®é¢˜å¯¼è‡´çš„é”™è¯¯ï¼šprobability tensor contains either inf, nan or element &lt; 0ï¼šå¯èƒ½é‡åŒ–çš„æ¨¡å‹éƒ½å®¹æ˜“å‡ºç°è¿™ä¸ªé—®é¢˜ï¼Œç™¾å·æœ‰ä¸€ä¸ªissueä¼¼ä¹å¯ä»¥è§£å†³ï¼›ä½†æ˜¯ä¸€ä¸ªä¸‹åˆçœ‹çš„å¤´æ˜è„‘èƒ€ï¼Œä¸æƒ³å†åŠ ç­çš„ï¼Œæ˜å¤©å†æå§ã€‚ å¥¥ç‰›é€¼ï¼Œå·¥ç¨‹å¸ˆå¤§å“¥é¼ æ ‡çµæ•åº¦è´¼ä½ï¼Œç»“æœnmæ˜¯LOLç”µä¸€å‰äºŒåï¼Ÿï¼Ÿï¼Ÿ æ˜æ—¥ä»»åŠ¡ï¼šè§£å†³é—®é¢˜ 4.26ç»§ç»­å°è¯•ä¿®æ”¹é”™è¯¯ï¼Œé¦–å…ˆç¡®å®šå…·ä½“é—®é¢˜æ‰€åœ¨ï¼Œæ ¹æ®æŠ¥é”™ç»“æœï¼Œå»ä¿®æ”¹ä»£ç ï¼ŒprintæŠ¥é”™ä¹‹å‰çš„ç›¸å…³ä¿¡æ¯ï¼Œå…¶probså’Œsoftmaxä¹‹åçš„ç»“æœæ‰“å°å¦‚ä¸‹ï¼š 12345#probstensor([[-inf, -inf, -inf, ..., -inf, -inf, -inf]], device=&#x27;cuda:0&#x27;, dtype=torch.float16)#prob_after_softmaxï¼š tensor([[0., 0., 0., ..., 0., 0., 0.]], device=&#x27;cuda:0&#x27;, dtype=torch.float16) å¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æœï¼Œå¯èƒ½æ˜¯ç¬¬ä¸€ä¸ªtokenå¼€å§‹è¿™ä¸ªæ¦‚ç‡æ•°å€¼å°±å‡ºé”™äº†ï¼›æ­£å¦‚æ˜¨æ—¥æ‰€è¯´ï¼Œåº”è¯¥æ˜¯ç²¾åº¦è½¬åŒ–çš„è¿‡ç¨‹ä¸­å‡ºç°äº†é—®é¢˜ã€‚å°è¯•Qwenä¸‹é¢ä¸€ä¸ªissueçš„å›ç­”ï¼Œç»“æœè¿è¡Œäº†å¾ˆé•¿æ—¶é—´ï¼Œè¿”å›ç»“æœå¦‚ä¸‹ï¼šä¸€å¼€å§‹è¿è¡Œçš„æ—¶å€™æ˜¾å¡é£æ‰‡å’”å’”å¹ï¼Œæˆ‘è¿˜ä»¥ä¸ºé™·å…¥æ­»å¾ªç¯äº†å‘¢ï¼Œæ²¡æƒ³åˆ°è¿˜æ˜¯ç»™æˆ‘è¿”å›äº†ç»“æœã€‚è¿™ä¸ªç»“æœå¤§è‡´ä¸Šç¬¦åˆé¢„æœŸå§ï¼Œå› ä¸ºç…§ç€ä¸Šé¢ä¿®æ”¹äº†ä»£ç ä¹‹åï¼Œç›´æ¥é€‰æ‹©æ¦‚ç‡æœ€å¤§çš„ä½œä¸ºdecodeçš„å€¼ï¼Œä½†æ˜¯ä»ä¸€å¼€å§‹åˆ°æœ€æœ«å°¾ï¼Œæ¦‚ç‡å€¼éƒ½ä¸º0çš„æƒ…å†µä¸‹ï¼Œè‡ªç„¶æ‰€æœ‰decodeå‡ºæ¥çš„tokenéƒ½æ˜¯ç›¸åŒçš„ï¼›qwenä¸­è¿™ä¸ªéƒ½æ˜¯0è§£å‡ºæ¥å°±æ˜¯â€œï¼â€ï¼Œåº”è¯¥æ˜¯è¿™æ ·çš„ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç»“æœæ˜¯å¥½çš„ï¼Œè¯´æ˜ä¿®æ”¹ä»£ç æ²¡æœ‰é—®é¢˜ï¼Œåªæ˜¯ç²¾åº¦è½¬åŒ–çš„é—®é¢˜ã€‚ä»£ç æ˜¯å¯ä»¥æ­£å¸¸è·‘é€šã€ä¸€ç›´decodeåˆ°æœ€åçš„ï¼›åé¢è¦åšçš„å°±æ˜¯è¿›è¡Œå¾®è°ƒä¹‹ç±»çš„ä¸œè¥¿äº†ï¼›åç»­çš„é—®é¢˜ï¼Œç­‰åˆ°å®æˆ˜çš„æ—¶å€™å†è¯´å§ï¼ä¸‹åˆï¼Œå€Ÿç”¨åŒæ—¶çš„è®¾å¤‡ï¼Œæ¥å…¥äº†å…¬å¸çš„ç½‘ï¼Œå¯ä»¥ä½¿ç”¨A800äº†ã€‚ç›®å‰æ”¶åˆ°çš„ä»»åŠ¡æ˜¯ï¼Œåœ¨A800ä¸Šï¼Œå¯¹ä¿®æ”¹åçš„æ¨¡å‹æ–‡ä»¶è¿›è¡Œè°ƒæ•´ã€è¯„æµ‹æ•ˆæœå¯¹æ¯”ã€‚åŒæ—¶æ¥å…¥äº†wifiå’Œä»¥å¤ªç½‘ï¼ŒèŠ±äº†å¥½é•¿å»æœå¦‚ä½•è®©sshé»˜è®¤èµ°ä»¥å¤ªç½‘è€Œéwifiï¼Œç»“æœå¤±è´¥äº†ï¼Œæš‚æ—¶åªèƒ½ç‰©ç†åˆ‡æ¢äº†ã€‚ä¸‹è½½qwen-7b-chatçš„æ¨¡å‹æ–‡ä»¶ï¼Œä¿®æ”¹modelæ–‡ä»¶ï¼Œè¿˜éœ€è¦ä»æœ¬åœ°copyåˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œå› ä¸ºé‚£å„¿ä¸èƒ½è¿æ¥å¤–ç½‘ã€‚ æ²¡äº‹å„¿äº†ï¼Œä¸‹è½½ä¸€ä¼šå„¿çªç„¶æƒ³èµ·æ¥modelscopeä¸æ˜¯å¤–ç½‘ï¼Œå¯ä»¥ç›´æ¥ä¸‹ï¼›å¯¹äºæœåŠ¡å™¨é‡Œé¢æ²¡æœ‰git-lfsï¼Œä¹Ÿæ— æ³•ä½¿ç”¨rootæƒé™è°ƒç”¨apt-getå‘½ä»¤è¿›è¡Œå®‰è£…çš„é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨condaå®‰è£…ï¼š 1conda install git-lfs æ„Ÿè°¢ä¹‹å‰çš„è‡ªå·±æŠŠcondaä»€ä¹ˆçš„å›½å†…é•œåƒæºéƒ½æ¢å¥½äº†ğŸ¥°ğŸ¥°æ­¤å¤–ï¼Œæ²¡æƒ³åˆ°ä¹‹å‰æå¾—ç¯å¢ƒæœ‰é—®é¢˜ï¼Œå®‰è£…ä¸äº†faissï¼ŒåŸå› åœ¨äºpythonç‰ˆæœ¬å¤ªé«˜äº†ã€‚é‡å†™æäº†ä¸ªç¯å¢ƒï¼Œå¹¸å¥½é€Ÿåº¦å¾ˆå¿«ï¼æå¥½äº†ç¯å¢ƒä¹‹åï¼Œæ²¡é‡åŒ–çš„ç‰ˆæœ¬è¿”å›ç»“æœæ˜¯è¿™æ ·çš„ï¼šä¹±è¯´ä¸€é€šï¼ä½†ç¡®å®æ˜¯é‡åŒ–çš„é—®é¢˜å¥¥ï¼æ²¡æ¯›ç—…å¥¥è€é“ä»¬ã€‚ æ˜æ—¥ä»»åŠ¡ï¼š æˆ‘æ¨è°ƒä¼‘ï¼æ”¾ä¸èµ·å°±åˆ«æ”¾ï¼æ˜å¤©èººå°¸ä¸€å¤©ï¼ ä¸‹å‘¨åå¤©ä»»åŠ¡ï¼šA800ä¸Šçš„æ¨¡å‹è®­ç»ƒ~ 4.27å‘¨æœ«ï¼Œåœ¨å‡ºç§Ÿå±‹èººå°¸ä¸€å¤©ã€‚æœ¬æ¥æ‰“ç®—ä¸­åˆç¡ä¸ªåˆè§‰ã€ä¸‹åˆå†å‡ºå»éª‘è¡Œä¸€ä¸¤å°æ—¶ï¼Œç»“æœä¸‹åˆç™¾äº¬ç«Ÿç„¶ä¸‹é›¨äº†ï¼Œè®¡åˆ’æ³¡æ±¤ã€‚ä¸­åˆå’ŒSHæ‰“äº†å‡ æŠŠå¤§ä¹±æ–—ï¼Œå¥½åƒä¸€ç›´åœ¨èµ¢ã€‚æ˜¨æ™šå’Œä»Šå¤©ï¼Œçœ‹ã€Šé­”éƒ½ç²¾å…µçš„å¥´éš¶ã€‹ï¼Œä¸»è¦æ˜¯çœ‹æ¼«ç”»ï¼ŒåŠ¨æ¼«ä¹Ÿçœ‹äº†ä¸€ç‚¹ï¼›ä¸å¾—ä¸è¯´å¾ˆåˆæˆ‘çš„èƒƒå£ï¼Œçº¯çˆ±å–è‚‰ç•ªsukiæğŸ¥°ğŸ¥°ã€‚çœ‹åˆ°äº†118è¯ï¼Œç¦æ¼«ä¸Šé¢çš„æ›´æ–°åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œä¼¼ä¹è¿˜å¯ä»¥ç»§ç»­çœ‹åå‡ äºŒåè¯æ¥ç€ï¼Œä½†æ˜¯æˆ‘çœ‹å°è¯´ã€è¿½å‰§ä¹‹ç±»çš„æ—¶å€™ï¼Œæ€»å–œæ¬¢ç•™ä¸€ç‚¹ï¼Œæœ‰ç§æ¾é¼ å­˜æ¾æœçš„é‚£ç§æ„æ€ï¼Œå¥½çœ‹çš„ä¸èƒ½çœ‹å®Œï¼Œå¾—å­˜ç€ç•™ç‚¹å¿µæƒ³ï¼ˆé™¤éå¿ä¸ä½ï¼‰ã€‚æ€€æ—§é¡µæ¸¸æ¸¸ç©è¿‡ç¨‹ä¸­é‡åˆ°äº†ä¸€ç‚¹å°æŒ«æŠ˜æã€‚ 4.28ä»–å¦ˆçš„è°ƒä¼‘ï¼æˆ‘ï¼è¦ï¼æ€ï¼ä½ ï¼ä¸€ï¼ä¸‡ï¼éï¼ä¹Ÿï¼ä¸ï¼å¤Ÿï¼ï¼çœ‹qwençš„finetuneæ–‡ä»¶ï¼Œçœ‹çœ‹è¿™ä¸ªå‚æ•°æ€ä¹ˆå†»ç»“ã€æ€ä¹ˆè°ƒã€‚æˆ‘ç™»è®°äº†ä¸€ä¸ªparamï¼Œåä¸ºbetaï¼Œä¸¤ä¸ªbufferï¼Œåä¸ºMå’Œzï¼›åœ¨ä¸€å¼€å§‹ï¼Œæˆ‘ä»¥ä¸ºè¦è®­ç»ƒbetaï¼Œå’ŒMã€zçš„åˆå§‹åˆ†å¸ƒï¼Œå…¶ä»–çš„å‚æ•°è¿›è¡Œå†»ç»“ï¼Œäºæ˜¯æˆ‘å°è¯•æŸ¥çœ‹è¿™ä¸¤ä¸ªå‚æ•°åœ¨å“ªå„¿ã€‚ 123456# æŸ¥çœ‹paramfor name, param in model.named_parameters(): print(name, param.requires_grad)# æŸ¥çœ‹bufferfor name, buf in model.named_buffers(): print(name) ç»“æœå‘ç°ï¼Œparamåˆ—è¡¨é‡Œé¢æœ‰betaï¼Œä½†æ˜¯bufferåˆ—è¡¨é‡Œé¢æ²¡æœ‰Må’Œzã€‚æˆ‘æ„Ÿåˆ°å¾ˆå¥‡æ€ªï¼Œä¸ºä»€ä¹ˆMå’Œzæ²¡æœ‰åŠ ä¸Šå»ï¼Ÿéš¾é“æ˜¯æˆ‘å“ªé‡Œå†™é”™äº†ï¼Ÿäºæ˜¯ï¼Œå»æœé›†å¦‚ä½•è¿›è¡Œfinetuneçš„æ•™ç¨‹ï¼Œç»ˆäºå‘ç°ï¼Œåªæœ‰paramæ˜¯å¯ä»¥è°ƒæ•´çš„å‚æ•°ï¼Œbufferåªæ˜¯å¸¸æ•°ç½¢äº†ï¼›å› è€Œï¼Œæ­£ç¡®çš„è°ƒæ•´æ–¹æ³•åº”è¯¥æ˜¯ï¼šè°ƒæ•´æ¯ä¸€å±‚çš„betaå‚æ•°å’Œæ‰€æœ‰transformerç»“æŸåçš„å…¨è¿æ¥å±‚ã€‚é‚£ä¹ˆï¼Œé—®é¢˜æ˜¯ï¼Œä¸ºä»€ä¹ˆæˆ‘ä¼šè§‰å¾—Må’Œzæ˜¯å¯ä»¥è°ƒå‚çš„å‘¢ï¼Ÿè¿™ä¸ªè¯¯åŒºçš„åŸå› åœ¨äºï¼Œåœ¨infiniä»£ç ä¸­ï¼ŒMå’Œzæ˜¯ä¸€ä¸ªç±»ä¼¼RNNçš„æ›´æ–°æœºåˆ¶ï¼Œè¿™ä¸ªæ›´æ–°å®é™…ä¸Šæ˜¯æ ¹æ®æ¯ä¸€å±‚çš„Qã€Kã€Vè¿›è¡Œçš„ï¼›ä¹‹å‰ï¼Œåœ¨åŠ è½½æ¨¡å‹çš„æ—¶å€™ï¼Œå› ä¸ºé¢„è®­ç»ƒæ¨¡å‹ä¸­æ²¡æœ‰Må’Œzã€å› è€Œè¢«è®¾ç½®ä¸ºNoneäº†ï¼Œæ‰€ä»¥æˆ‘åœ¨ä»£ç é‡Œé¢åˆåŠ å…¥äº†åˆå§‹åŒ–Må’Œzçš„åˆ†å¸ƒï¼›å½“æ—¶æƒ³çš„æ˜¯ï¼Œåé¢æ­£å¸¸è®­ç»ƒå¥½çš„æ¨¡å‹ï¼ŒMå’Œzåº”è¯¥æ˜¯æœ‰ä¸€ä¸ªåˆ†å¸ƒçš„ï¼›ä½†æ˜¯ä¸æ˜¯è¿™æ ·çš„ï¼Œæ­£å¦‚ä¸Šé¢æ‰€è¨€ï¼ŒMå’Œzæ˜¯Qã€Kã€VåŸºäºç±»ä¼¼RNNçš„æ–¹æ³•å¾—å‡ºçš„ï¼Œæ˜¯å›ºå®šçš„ç”Ÿæˆæµç¨‹ï¼›ä¸å›ºå®šçš„ï¼Œåªæœ‰é—¨æ§å‚æ•°betaç½¢äº†ï¼›ä½†æ˜¯ï¼Œç°åœ¨è¿˜æœ‰ä¸€ä¸ªå¯èƒ½çš„é—®é¢˜å°±æ˜¯ï¼Œæ—¢ç„¶Må’Œzåœ¨æ¨ç†è¿‡ç¨‹ä¸­è¢«è®¾ç½®ä¸ºNoneï¼Œé‚£ä¹ˆæˆ‘è®­ç»ƒçš„æ—¶å€™ä¼šä¸ä¼šä¹Ÿæ˜¯Noneã€å› è€Œæ— æ³•æ“ä½œï¼Ÿåœ¨æœåŠ¡å™¨ç«¯ï¼Œå°†å†æ¬¡åˆå§‹åŒ–çš„æ“ä½œåˆ é™¤åï¼Œè¿è¡Œæœç„¶æŠ¥é”™ï¼›ä½†æ˜¯ï¼Œåœ¨å°†inité‡Œé¢çš„åˆå§‹åŒ–ä¸­çš„kaimingåˆ†å¸ƒå»æ‰åï¼Œå…¨ç”¨zeroçš„åˆ†å¸ƒåè€Œä¸ä¼šæŠ¥é”™æ­£å¸¸è¿è¡Œï¼Œåªæ˜¯ç»“æœä¸å¤ªå¥½ç½¢äº†ï¼Œä½†æ˜¯ä¹Ÿä¸ä¼šä¹±è¯´ä¸€é€šã€‚äºæ˜¯ï¼Œåœ¨finetune.pyæ–‡ä»¶ä¸­ï¼Œåœ¨æ¨¡å‹åŠ è½½å’ŒååŠ å…¥ä»¥ä¸‹ä»£ç ï¼Œç†è®ºä¸Šå°±å¯ä»¥è¿è¡Œqwenè‡ªå¸¦çš„bashè„šæœ¬è¿›è¡Œè°ƒå‚ï¼š 12345for name, param in model.named_parameters():if not(&#x27;beta&#x27; in name or &#x27;ln_f&#x27; in name or &#x27;lm_head&#x27; in name): param.requires_grad = Falseelse: print(name, param.requires_grad) åœ¨è®­ç»ƒæ•°æ®é›†çš„é€‰å–ä¸Šï¼Œåˆ™éœ€è¦è¿›è¡Œæ–Ÿé…Œï¼šqwenæåˆ°è‡ªå·±å¯¹å¤šä¸ªæ•°æ®é›†è¿›è¡Œäº†æ‰“æ¦œï¼›é‚£ä¹ˆï¼Œè¿™äº›æ•°æ®é›†æ˜¯å¯ä»¥å‚è€ƒçš„ï¼Œç›®å‰å¯èƒ½ä½•æ—¶çš„ï¼Œæ˜¯C-EVAlä»¥åŠä¸­æ–‡é•¿æ–‡æœ¬æ•°æ®é›†ï¼›ä½†æ˜¯é•¿æ–‡æœ¬æ–¹é¢ï¼Œå¯¹è¾“å…¥è¿›è¡Œsegmentçš„ä»£ç è¿˜æ²¡å†™ï¼Œå› è€Œæš‚å®šä½¿ç”¨C-EVALè¿›è¡Œè®­ç»ƒå’Œè¯„æµ‹ã€‚ä»”ç»†æ€è€ƒäº†ä¸€ä¸‹ï¼Œç°åœ¨æ˜¯æ¨¡å‹çš„åŸºç¡€èƒ½åŠ›å› ä¸ºæ–°åŠ å…¥å‚æ•°å’Œè®¡ç®—çš„åŸå› æœ‰æ‰€ä¸‹é™ï¼Œå› è€Œéœ€è¦è®­ç»ƒå…¶åŸºæœ¬çš„é—®ç­”èƒ½åŠ›ï¼Œè‡³äºè¯„æµ‹é›†ï¼Œæˆ‘è®¤ä¸ºåº”è¯¥åœ¨åŸºç¡€èƒ½åŠ›æ»¡è¶³ä¹‹åè¿›è¡Œè¿›ä¸€æ­¥çš„è°ƒæ•´ã€‚ä½¿ç”¨ä»€ä¹ˆæ•°æ®é›†å‘¢ï¼Ÿæˆ‘ç›´æ¥å¼€å§‹æ‘‡äººï¼æ²ˆæ•™æˆæ¨èäº†æŒ‡ä»¤å¾®è°ƒæ•°æ®é›†COIG-PCã€‚ä¸€å¼€å§‹åœ¨æ£€ç´¢çš„æ—¶å€™æˆ‘è¢«å¯¼å‘äº†åŒä¸€ä¸ªæœºæ„ä¸‹çš„æ—©æœŸæ•°æ®é›†COIGï¼Œè¿™ä¸ªæ•°æ®é›†æ¯”è¾ƒå°ï¼›è€ŒCOIG-PCè¶³è¶³æœ‰126Gã€‚COIG-PCè¿™ä¸ªæ•°æ®é›†è¿˜éœ€è¦ç”³è¯·ï¼Œæ˜¯gatedçš„ï¼Œå¹¸å¥½ç”³è¯·çš„æµç¨‹å¾ˆç®€å•ã€‚ç”±äºæ¨¡å‹å¤ªå¤§ï¼Œå› è€Œæˆ‘å¸Œæœ›ç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œä½†æ˜¯æœåŠ¡å™¨ä¸Šåˆè¿ä¸ä¸Šå¤–ç½‘ï¼Œäºæ˜¯æœç´¢huggingfaceé•œåƒç«™ã€‚æ•°æ®é›†åœ°å€åœ¨è¿™é‡Œï¼›æ­¤å¤–ï¼Œç”±äºæ•°æ®é›†æ˜¯gatedçš„ï¼Œå› è€Œéœ€è¦åœ¨æœ¬ç«™ä¸Šç”³è¯·ä¸€ä¸ªaccess tokenï¼Œåœ¨å‘½ä»¤è¡Œçš„æ—¶å€™æŠŠè¿™ä¸ªä¼ è¿›å»ï¼Œæ‰èƒ½gitä¸‹æ¥ã€‚ç›¸å…³æ•™ç¨‹åœ¨ç½‘ç«™é¦–é¡µä¸Šæœ‰ã€‚æ€»çš„æ¥è¯´ï¼Œå‘½ä»¤åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š 123pip install -U huggingface_hubexport HF_ENDPOINT=https://hf-mirror.comhuggingface-cli download --token hf_access --resume-download --repo-type dataset BAAI/COIG-PC --save-dir COIG-PC --local-dir-use-symlinks False ä¸‹å§ï¼126Gå‘¢ï¼è¯¥è¯´ä¸è¯´æœåŠ¡å™¨å¢™å†…ä¸‹è½½é€Ÿåº¦è¿˜æ˜¯å¿«çš„ã€‚ä¸‹å®Œä¹‹åï¼Œæ¢³ç†äº†è¿™ä¸ªæ•°æ®é›†çš„æƒ…å†µï¼šHugging Faceä¸Šé¢çš„datacardæ˜¾ç¤ºè¯´ï¼Œæ–‡ä»¶æ˜¯jsonlã€è¿˜ç»™å‡ºäº†ç›¸å…³æ–‡ä»¶çš„å‘½åï¼›èµ·åˆï¼Œæˆ‘ä»¥ä¸ºç›´æ¥å¯¹jsonlæ–‡ä»¶å¤„ç†å³å¯ï¼Œä½†äº‹å®ä¸æ˜¯ã€‚ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å…¨æ˜¯parquetæ ¼å¼ï¼Œæ˜¯pandasçš„æ•°æ®æ ¼å¼ï¼Œè€Œä¸”å‘½åä¸datacardä¸­çš„å®Œå…¨ä¸ä¸€æ ·ï¼ï¼›åˆ—åé‡Œé¢æœ‰filenameï¼Œä½†æˆ‘å®Œå…¨æä¸æ‡‚è¿™ä¸ªç©æ„å„¿çš„æ„ä¹‰ä½•åœ¨ï¼š 1filename 00001-001-000-named_entity_recognition.jsonl æ€»ä¹‹ï¼Œå€ŸåŠ©GPTå¤§äººçš„åŠ›é‡ï¼Œå†™äº†ä¸€ä¸ªå¤„ç†æ•°æ®çš„è„šæœ¬ï¼Œç”¨äºéå†æ–‡ä»¶ã€æå–trainä¸”æ˜¯ç”¨äºâ€™æ¨ç†â€™æ•°æ®ã€å¹¶å½¢æˆæœ€ç»ˆçš„è®­ç»ƒæ•°æ®æ ¼å¼ã€‚ç†è®ºä¸Šæ¥è®²ï¼Œè¿™ä¸€æ­¥æå¥½ä¹‹åï¼Œç›´æ¥è°ƒç”¨è®­ç»ƒçš„shè„šæœ¬å°±å¯ä»¥äº†ã€‚å”¯ä¸€æ‹…å¿ƒçš„é—®é¢˜å°±æ˜¯RAMå¯èƒ½ä¸å¤Ÿï¼Œä½†å¥½åƒæ˜¯æˆ‘å¤šè™‘äº†ï¼Œç™½ç™½èŠ±äº†ä¸€äº›æ—¶é—´çº ç»“åˆ†æ®µå­˜å‚¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import pyarrow.parquet as pqimport globimport pandas as pd import json# è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶è·¯å¾„file_paths = glob.glob(&#x27;data/*train*.parquet&#x27;)samples_list = []idx = 0query = &#x27;&#x27;answer = &#x27;&#x27;def update_sample(idx, query, answer): sample = &#123; &quot;id&quot;: idx, &quot;conversations&quot;: [ &#123; &quot;from&quot;: &quot;user&quot;, &quot;value&quot;: query &#125;, &#123; &quot;from&quot;: &quot;assistant&quot;, &quot;value&quot;: answer &#125; ] &#125; return sample# éå†æ¯ä¸ªæ–‡ä»¶å¹¶è¯»å–æ•°æ®# f_idx = 0for file_path in file_paths: # è¯»å– Parquet æ–‡ä»¶ # print(&#x27;æ­£åœ¨è¯»å–æ–‡ä»¶ï¼š&#123;&#125;&#x27;.format(file_path[5:])) # file_path = file_paths[-5] data = pd.read_parquet(file_path) # å‘ç°æ•°æ®ï¼Œæ„å»ºæ•°æ® print(&#x27;æ­£åœ¨éå†æ–‡ä»¶ï¼š&#123;&#125;&#x27;.format(file_path[5:])) for index, row in data.iterrows(): # print(row) # print(idx,row) is_correct_file = False for r_str in row[&#x27;task_type&#x27;][&#x27;major&#x27;]: if &#x27;æ¨ç†&#x27; in r_str: # print(&#x27;find!&#x27;) query = row[0] + row[1] answer = row[2] sample = update_sample(idx, query, answer) samples_list.append(sample) idx += 1 is_correct_file = True elif &#x27;ä¿¡æ¯æŠ½å–&#x27; == r_str: query = row[0] + row[1] answer = row[2] sample = update_sample(idx, query, answer) samples_list.append(sample) idx += 1 is_correct_file = True if not is_correct_file: break if not is_correct_file: break print(&#x27;æ–‡ä»¶ï¼š&#123;&#125;å¤„ç†å®Œæ¯•ï¼&#x27;.format(file_path[5:])) # breakwith open(&#x27;train_data_2.json&#x27;, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as file: json.dump(samples_list, file, ensure_ascii=False,indent=2) æˆ–è®¸åŸºäºfile_nameè¿™ä¸ªä¸œè¥¿èƒ½æ›´è½»æ¾ï¼Ÿæˆ‘ä¸çŸ¥é“ï¼Œåæ­£è¿™æ ·å°±è¡Œäº†ï¼Œèƒ½å®ç°ç›®çš„ï¼ŒèŠ±è´¹å‡ ååˆ†é’Ÿä¹Ÿä¸å¤ªæ…¢è‰ï¼å¾—å››ä¸ªå¤šå°æ—¶ï¼ã€‚åŠ ç­ï¼Œç­‰æ•°æ®å¤„ç†å¥½åˆ°21ç‚¹ã€‚æˆ‘è‰ï¼å¿˜è®°import jsonäº†ï¼å°¼ç›ç™½ç­‰äº†ï¼ä¸ºäº†å¿«é€Ÿï¼Œè§‚å¯Ÿåˆ°æ¯ä¸ªæ–‡ä»¶é‡Œé¢æ•°æ®çš„ç”¨é€”ä¼¼ä¹éƒ½æ˜¯ç›¸åŒçš„ï¼›ç®€å•åœ°ä»ç¬¬ä¸€æ¡æ•°æ®å¼€å§‹åˆ¤æ–­å§ï¼æ²¡æœ‰å°±è·³è¿‡ï¼ä½†æ˜¯å¤±è´¥äº†ï¼Œç»“æœæ˜¯ç©ºçš„ï¼æ­¤å¤–ï¼Œè¿˜çŠ¯äº†ä¸¥é‡é”™è¯¯ï¼šæ²¡æœ‰copyå˜é‡è€Œæ˜¯ç›´æ¥åœ¨å˜é‡ä¸Šä¿®æ”¹ï¼Œå¯¼è‡´æœ€ålistå…¨æ˜¯ä¸€ä¸ªå˜é‡ï¼ æ˜æ—¥ä»»åŠ¡ï¼šè§£å†³é—®é¢˜ï¼Œå‡†å¤‡å¥½æ•°æ®ï¼å¼€å§‹è®­ç»ƒï¼ 4.29é¦–å…ˆï¼Œæ˜¨å¤©ç¡®å®šçš„æ€è·¯æ˜¯ï¼š æŸ¥çœ‹æ˜¨æ™šçš„jsonæ•°æ®æ˜¯å¦æ­£ç¡® å¦‚æœæ­£ç¡®ï¼Œåˆ™å¼€å§‹å°è¯•è®­ç»ƒæ¨¡å‹ï¼›ä¸æ­£ç¡®ï¼Œåˆ™æ”¹å†™æ­£ç¡®çš„è„šæœ¬ï¼ŒåŒæ—¶å…ˆç”¨æ•°ä¸ªæµ‹è¯•æ•°æ®æ„æˆè®­ç»ƒæ•°æ®é›†ï¼Œæµ‹è¯•ftæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚ æ ¹æ®æ˜¨å¤©æ™šä¸Šï¼Œè¿è¡Œè®­ç»ƒçš„shè„šæœ¬å¤±è´¥çš„é—®é¢˜ï¼Œæ’æŸ¥åŸå› ã€‚ é—æ†¾çš„æ˜¯ï¼Œæ˜¨å¤©çš„ä»£ç è¿˜æœ‰ä¸ªå°é”™è¯¯ï¼Œå¯¼è‡´æ•°æ®æœªæ­£ç¡®æå–ï¼›è¿™ä¹Ÿæ˜¯æ˜¨å¤©â€œä»ç¬¬ä¸€æ¡æ•°æ®å¼€å§‹åˆ¤æ–­è¯¥æ–‡ä»¶æ˜¯å¦æ˜¯æ‰€éœ€æ•°æ®é›†çš„æ–‡ä»¶ï¼Œè¿”å›ç»“æœä¸ºç©ºçš„åŸå› â€â€”â€”str in liståªä¼šæŸ¥çœ‹listå…ƒç´ ï¼Œè€Œä¸ä¼šæŸ¥çœ‹å…ƒç´ ä¸­æ˜¯å¦å«æœ‰ç›¸å…³å­—ç¬¦ä¸²ã€‚æ€»ä¹‹ï¼Œæ•°æ®æ€»ç®—æ˜¯æ­£ç¡®æå–äº†ï¼å°è¯•è¿è¡Œbashè„šæœ¬ï¼ŒæŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š 1234FAILED: multi_tensor_adam.cuda.o/usr/bin/nvcc --generate-dependencies-with-compile --dependency-output multi_tensor_adam.cuda.o.d -DTORCH_EXTENSION_NAME=fused_adam -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE=\\&quot;_gcc\\&quot; -DPYBIND11_STDLIB=\\&quot;_libstdcpp\\&quot; -DPYBIND11_BUILD_ABI=\\&quot;_cxxabi1011\\&quot; -I/home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/deepspeed/ops/csrc/includes -I/home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/deepspeed/ops/csrc/adam -isystem /home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/torch/include -isystem /home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/torch/include/torch/csrc/api/include -isystem /home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/torch/include/TH -isystem /home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/torch/include/THC -isystem /home/zhangshuo/.conda/envs/QwenMem/include/python3.8 -D_GLIBCXX_USE_CXX11_ABI=0 -D__CUDA_NO_HALF_OPERATORS__ -D__CUDA_NO_HALF_CONVERSIONS__ -D__CUDA_NO_BFLOAT16_CONVERSIONS__ -D__CUDA_NO_HALF2_OPERATORS__ --expt-relaxed-constexpr -gencode=arch=compute_80,code=compute_80 -gencode=arch=compute_80,code=sm_80 --compiler-options &#x27;-fPIC&#x27; -O3 -DVERSION_GE_1_1 -DVERSION_GE_1_3 -DVERSION_GE_1_5 -lineinfo --use_fast_math -gencode=arch=compute_80,code=sm_80 -gencode=arch=compute_80,code=compute_80 -DBF16_AVAILABLE -U__CUDA_NO_BFLOAT16_OPERATORS__ -U__CUDA_NO_BFLOAT162_OPERATORS__ -std=c++17 -c /home/zhangshuo/.conda/envs/QwenMem/lib/python3.8/site-packages/deepspeed/ops/csrc/adam/multi_tensor_adam.cu -o multi_tensor_adam.cuda.onvcc fatal : Unknown option &#x27;-generate-dependencies-with-compile&#x27;ninja: build stopped: subcommand failed. æŠ¥é”™çœ‹ä¸æ‡‚â€¦.å¤´æ™•æã€‚æ‰‹å¿™è„šä¹±äº†ä¸€ä¸‹åˆï¼Œåœ¨ç—…æ€¥ä¹±æŠ•åŒ»çš„æƒ…å†µä¸‹ï¼Œè¿è¡Œäº†æŸ¥çœ‹cudaçš„å‘½ä»¤: 1echo $CUDA_HOME ç»“æœå‘ç°è¾“å‡ºä¸ºç©ºï¼ŒåŒæ—¶åˆæ³¨æ„åˆ°nvcc -Væ˜¾ç¤ºçš„cudaæ˜¯æ ¹ç›®å½•è€Œéè™šæ‹Ÿç¯å¢ƒä¸‹çš„cudaï¼Œè¿™æ˜¯å¦æ„å‘³ç€ï¼Œè™šæ‹Ÿç¯å¢ƒçš„cudaæ²¡æœ‰å®‰è£…&#x2F;å®‰è£…å¤±è´¥ï¼Ÿå®‰è£…cuda çš„å‘½ä»¤ï¼Œæœé›†äº†åŠå¤©ï¼Œè¸©äº†ä¸å°‘å‘ï¼Œæœ€ç»ˆç¡®å®šæ˜¯è¿™ä¸ªï¼š 1conda install cuda -c nvidia/label/cuda-12.1.0 è™½ç„¶echoçš„ç»“æœè¿˜æ˜¯ç©ºï¼Œä½†æ˜¯nvcc -Væ˜¾ç¤ºçš„cudaç‰ˆæœ¬æ˜¯12.1ï¼Œå¯¹äº†ï¼å†æ¬¡å°è¯•è¿è¡Œï¼Œç»“æœæŠ¥é”™ï¼š 1KeyError: &#x27;conversations&#x27; æœäº†ä¸€ä¸‹ï¼Œè¯´æ˜¯æ•°æ®æ ¼å¼çš„é—®é¢˜ã€‚æ¥ä¸‹æ¥è¦è°ƒæ•´æ•°æ®æ ¼å¼ã€‚ç»“æœå‘ç°è‡ªå·±é“¸å¸ï¼Œdictä¸­çš„conversationså°‘æ‰“äº†ä¸€ä¸ªsğŸ˜…ã€‚ä¸€åˆ‡è°ƒæ•´å¥½ä¹‹åï¼Œè¿è¡Œç»ˆäºæˆåŠŸäº†ï¼è®©å®ƒåœ¨A800ä¸Šè·‘ç€å§ï¼ä¸å¯¹ï¼Œ10å¤©å¤ªé•¿äº†ï¼æˆ‘åº”è¯¥å…ˆæŠ½å–ä¸€ç‚¹æ•°æ®ï¼Œæš‚å®š4wæ¡å§ï¼Œè¿›è¡Œè®­ç»ƒè¯•è¯•ï¼›æ•°æ®é›†è¿™ä¸€å—å„¿çš„é€‰å–å…¶å®è¿˜éœ€è¦ä»”ç»†æ–Ÿé…Œã€‚æŠ½å–äº†æ•°æ®ï¼Œè®­ç»ƒå¤§æ¦‚éœ€è¦7å°æ—¶ï¼›æ˜å¤©çœ‹ä¸€ä¸‹ç»“æœï¼ å¥½å§ï¼æ¥è‡ªæ²ˆæ•™æˆçš„åœºå¤–æ”¯æ´ï¼æˆ‘è¶…å‚æ•°ç”¨çš„é»˜è®¤çš„ï¼Œè¿™è¿™ä¸å¯¹ã€‚ç°åœ¨å…¨æ•°æ®ä¹Ÿåªè¦è®­17å°æ—¶ï¼æ˜å¤©ä¸­åˆå°±å¥½äº†ï¼ æ˜æ—¥ä»»åŠ¡ï¼šæŸ¥çœ‹è®­ç»ƒç»“æœï¼Œæ€è€ƒåç»­ä¼˜åŒ–æ–¹å‘ï¼ˆæ›´å¥½çš„æ•°æ®é›†ï¼Ÿï¼‰ 4.30æ¢³ç†ä¸€ä¸‹ç›®å‰çš„æ€è·¯å§ï¼š é¦–å…ˆï¼Œå¯¹äºç›®å‰é•¿æ–‡æœ¬çš„è§£å†³æ€è·¯ï¼Œæœ‰ä¸¤ç§ï¼Œä¸€æ˜¯é‡‡ç”¨faissä¹‹ç±»çš„å‘é‡åº“ï¼Œå¯¹è¾“å…¥çš„queryè¿›è¡Œé‡æ„ã€æ£€ç´¢ã€å¢å¼ºï¼›è¿™ç§æ–¹æ³•è§æ•ˆå¿«ï¼Œä½†æ˜¯å—åˆ°æ¨¡å‹æœ¬èº«åŠŸèƒ½çš„é™åˆ¶ï¼›å¦‚æœæ¨¡å‹é•¿æ–‡æœ¬èƒ½åŠ›ã€ç†è§£ä¸æç‚¼èƒ½åŠ›æœ¬èº«ä¸è¶³çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•é‡åˆ°ç“¶é¢ˆä¹‹åå°±æ— æ³•æå‡äº†ã€‚å…¶æ¬¡ï¼Œåˆ™æ˜¯å¯¹æ¨¡å‹åº•å±‚è¿›è¡Œé‡æ„ã€ä¿®æ”¹ï¼Œè¿™ç§æ–¹æ³•ç†è®ºä¸Šå¯èƒ½æ€§æ˜¯æ— é™çš„ï¼Œä½†æ˜¯ï¼Œåœ¨å®è·µè¿‡ç¨‹ä¸­çš„é—®é¢˜åœ¨äºï¼Œå¤§æ¨¡å‹å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªé»‘ç®±ã€‚æ­£å¦‚ä¸Šé¢æ‰€æåˆ°çš„ï¼Œåœ¨åŠ å…¥infini-attnçš„æ—¶å€™ï¼Œæ¨¡å‹çš„åŸºæœ¬å¯¹è¯èƒ½åŠ›å¤§å¤§ä¸‹é™äº†ï¼›æ–°å¢çš„å‚æ•°ï¼Œä¼šå¯¹é¢„è®­ç»ƒå¥½çš„æƒé‡é€ æˆå½±å“ï¼Œå› è€Œéœ€è¦è¿›è¡Œftï¼Œè¿™é‡Œçš„é—®é¢˜åœ¨äºï¼šè®­ç»ƒæ•°æ®å¦‚ä½•é€‰å–ï¼Ÿå¦‚ä½•è®­ç»ƒï¼Ÿè¯„æµ‹é›†æ˜¯ä»€ä¹ˆï¼Ÿ ä¸€ä¸ªé‡ç‚¹æ˜¯ï¼Œä¸Šé¢æåˆ°çš„ä¸¤ç§æ–¹æ³•ï¼Œéƒ½éœ€è¦ä½¿ç”¨åˆ°ï¼šå¯¹äºinput queryçš„segment&#x2F;cutï¼Œä»¥åŠä¹‹åçš„èåˆã€‚åŸå› åœ¨äºï¼Œå¯¹äºå‰è€…æ¥è¯´ï¼Œqueryé•¿åº¦å½“ç„¶æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬æ‰€è¿½æ±‚çš„ç›®æ ‡æ˜¯åœ¨æœ‰é™çš„queryé•¿åº¦ä¸­æ„å»ºæœ€å¥½çš„promptï¼Œå¯¹äºé•¿æ–‡æœ¬ï¼Œåˆ™å¯èƒ½éœ€è¦åˆ†æ®µç²¾ç‚¼å†æ•´åˆã€å¾ªç¯å¾€å¤ï¼›è€Œå¯¹äºåè€…ï¼Œå°½ç®¡ä¸éœ€è¦åœ¨prompté˜¶æ®µè€—è´¹å¤§é‡ç»å†ï¼Œä½†æ˜¯æ¨¡å‹æœ¬èº«çš„è¾“å…¥ä¹Ÿæ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ã€‚ç›®å‰ä¸çŸ¥é“è¿™ä¸ªé•¿åº¦é™åˆ¶èƒ½å¦è®¾ç½®å»æ”¹å˜ï¼Œä»¥Qwen-7B-Chatä¸ºä¾‹ï¼Œå®ƒçš„è¾“å…¥é•¿åº¦å°±æ˜¯512ä¸ªtokenã€‚åŠ å…¥infiniä¹‹åï¼Œç†è®ºä¸Šå¯ä»¥æ¥å—æ— é™é•¿çš„æ•°æ®ï¼Œä½†æ˜¯éœ€è¦åœ¨generate&#x2F;chatæˆ–è€…å“ªä¸ªä¼ å…¥queryçš„æ—¶å€™å¯¹queryè¿›è¡Œsliceï¼Œä¸€æ®µæ®µçš„å–‚å…¥ã€‚æ•ˆæœä¸Šæ¥è¯´å’Œå…¨éƒ¨è¾“å…¥æ²¡æœ‰åŒºåˆ«ï¼Œä½†æ˜¯å› ä¸ºæ¨¡å‹é™åˆ¶ï¼Œéœ€è¦ä¸€æ®µæ®µä¼ å…¥ï¼ˆç»†æƒ³ä¸€ä¸‹ä¸åº”è¯¥è¿™æ ·ï¼Œæˆ–è®¸å¯ä»¥è®¾ç½®è¾“å…¥æ— é™é•¿ï¼Ÿï¼‰ ä»Šæ—©çš„åæ¶ˆæ¯æ˜¯ï¼šæ˜¨å¤©çš„trainçš„ä¸œè¥¿ï¼Œä¼¼ä¹åœ¨æˆ‘è¿™è¾¹sshæ–­å¼€ä¹‹åå°±åœæ­¢äº†ï¼Ÿæ€»è€Œè¨€ä¹‹ï¼Œé¢„å®šçš„ä¸­åˆè®­ç»ƒå®Œæˆæ˜¯æ²¡æœ‰çš„ã€‚æˆ‘åªå¥½å†æ¬¡ä»é‡Œé¢æå–æ›´å°‘çš„30wæ¡æ•°æ®ï¼Œè¿›è¡Œè®­ç»ƒï¼Œéœ€è¦ä¸‰å°æ—¶ï¼Œé¢„è®¡ä»Šå¤©ä¸­åˆå®Œæˆã€‚ä»Šæ—©ï¼Œå‡ºäºåŒäº‹ä»¬æ¥å…¥A800æœåŠ¡å™¨çš„éœ€æ±‚ï¼Œçªç„¶æƒ³åˆ°å¯ä»¥æŠŠæˆ‘ç›®å‰åœ¨ç”¨çš„è½¬æ¥çš„è¿™ä¸ªethç»™æ¥åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æœåŠ¡å™¨å¯ä»¥ç›´è¿å…¬å¸å¤–ç½‘å’ŒA800ï¼›åŒæ—¶ï¼Œæˆ‘ä»¬çš„ethè™½ç„¶ä¸èƒ½è®¿é—®å…¬å¸å¤–ç½‘ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡å†…ç½‘è¿æ¥åˆ°æœåŠ¡å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦è¿™æ ·åšï¼Œå°±å¯ä»¥éƒ½æ­£å¸¸ä½¿ç”¨A800äº†ï¼è¯•äº†è¯•æœç„¶æˆåŠŸäº†ï¼æ˜¨å¤©è°ƒç”¨train.shçš„æ—¶å€™ï¼Œä¸€ä¸ªæœ‰è¶£çš„ç°è±¡æ˜¯ï¼šå®‰è£…flash-attentionåè„šæœ¬ä¼šæŠ¥é”™ï¼›è¿™æ˜¯å› ä¸ºæˆ‘åœ¨modelé‡Œé¢æ²¡æ”¹flash-attentionçš„å‡½æ•°ï¼Œå› è€ŒåŠ å…¥çš„å‚æ•°çŸ©é˜µä¼¼ä¹å› ä¸ºshapeä¸åŒ¹é…æ— æ³•ç›¸ä¹˜ã€ä½¿ç”¨flash-attnåŠ é€Ÿï¼Œå¸è½½ä¹‹åå°±å¥½äº†ã€‚å½“æ—¶æƒ³è¦ç”¨flashçš„åŸå› åœ¨äºï¼Œ10å¤©çš„è®­ç»ƒæ—¶é—´å¤ªé•¿è¾£ï¼ä½†æ˜¯åæ¥å¤šäºæ²ˆæ•™æˆçš„æ”¯æ´ï¼Œè®©æˆ‘åœ¨å®è·µä¸­å¯¹LLMä¸­ftçš„è¶…å‚å’Œä½œç”¨æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚é¡ºä¾¿è®°å½•ä¸€ä¸‹åç»­åº”è¯¥ä¼šå¸¸ç”¨çš„å‘½ä»¤ï¼š 1234# nvidia-smiå®æ—¶åˆ·æ–°watch -n 5 nvidia-smi# æŸ¥çœ‹æ–‡ä»¶å¤¹ä¸‹æ–‡ä»¶åŠå…¶å¤§å°ls -lht åªä¼šæ˜¾ç¤ºçª—å£å¤§å°å†…å¯ä»¥æ”¾ä¸‹çš„gpuçŠ¶æ€ï¼Œå¦‚ç¼©ç•¥çŠ¶æ€æ˜¯0-3å¡ï¼Œå…¨å±åŒ–åªä¼šæ˜¯0-7å¡ã€‚æŸ¥çœ‹qwençš„å„ç§æ–‡ä»¶ï¼Œä¸»è¦æ˜¯configæ–‡ä»¶å’Œchatæ–¹æ³•ï¼ŒæŸ¥çœ‹queryçš„å¤„ç†æµç¨‹ï¼Œä¼¼ä¹æ¨¡å‹é‡Œé¢queryè¿›è¡Œsplitä¸å¤ªéš¾ï¼Ÿåˆä¼‘è¿‡åï¼Œæ¨¡å‹è·‘å®Œäº†ï¼Œå‡†å¤‡åŠ è½½æ¨¡å‹å¹¶æ£€éªŒæ•ˆæœï¼Œç»“æœå‡ºç°äº†å¦‚ä¸‹æŠ¥é”™ï¼š 1ValueError: Trying to set a tensor of shape torch.Size([64, 32, 128, 128]) in &quot;M&quot; (which has shape torch.Size([32, 128, 128])), this look incorrect. å¯¹æ­¤ï¼ŒGPTå¤§äººçš„ç­”å¤æ˜¯ï¼š 1è¿™ä¸ªé”™è¯¯æç¤ºè¡¨æ˜ä½ æ­£åœ¨å°è¯•å°†ä¸€ä¸ªå½¢çŠ¶ä¸º [64, 32, 128, 128] çš„å¼ é‡è®¾ç½®åˆ°ä¸€ä¸ªå½¢çŠ¶ä¸º [32, 128, 128] çš„å¼ é‡ä¸­ ç¢ç£¨äº†ä¸€ä¸ªå°æ—¶ä¸å¾—å…¶è§£ã€‚ä¸åŒäº‹è®¨è®ºä¹‹åï¼Œå»ä¸Šäº†ä¸ªå•æ‰€ï¼Œæ€¥èºçš„å¿ƒç•¥æœ‰å¹³é™ã€‚çµå…‰ä¸€ç°ï¼Œé—®é¢˜è§£å†³äº†ï¼é¦–å…ˆï¼Œæœ€å¥‡æ€ªçš„æ˜¯ï¼Œè¿™ä¸ªMæ˜¯register_bufferçš„cacheï¼ŒæŒ‰ç†æ¥è¯´ä¸æ˜¯ä¸€ä¸ªå¯å­¦ä¹ çš„å‚æ•°ï¼Œåœ¨initä¸­è®¾ç½®çš„åˆå§‹å½¢çŠ¶å°±æ˜¯ä¸‰ç»´çš„ã€‚è€Œè¿™é‡Œæ˜¾ç¤ºçš„æ˜¯å››ç»´tensorè½½å…¥åˆ°Mã€‚è¿™å¸¦æ¥çš„é—®é¢˜æ˜¯ï¼šMä¸åº”è¯¥è¢«ä¿å­˜åˆ°æ¨¡å‹ä¸­ï¼Œè€Œæ˜¯åº”è¯¥åœ¨æ¯æ¬¡queryè¾“å…¥&#x2F;å¯¹è¯å¼€å§‹çš„æ—¶å€™è¢«é‡æ–°åˆå§‹åŒ–ã€‚åŒæ—¶ï¼Œè¿™ä¸ªå››ç»´tensorçš„ç¬¬ä¸€ç»´åº¦å¤§å°æ˜¯64ï¼Œè¿™ä¸ª64æ˜¯batch sizeï¼Œæ˜¯æˆ‘æ˜¨å¤©è°ƒæ•´çš„æ—¶å€™è®¾ç½®çš„ã€‚é‚£ä¹ˆï¼Œç»“åˆä¸Šé¢çš„é€»è¾‘ï¼Œè¿™ä¸ª64ç»´å‡ºç°åœ¨è¿™é‡Œï¼Œåº”è¯¥æ˜¯è®­ç»ƒçš„æ—¶å€™ï¼Œbatchä¸­æœ‰64ä¸ªæ ·æœ¬ï¼Œå¯¹åº”64ä¸ªMï¼Œå› è€Œæœ€åï¼Œregister_bufferä¿å­˜çš„æ˜¯è¿™ä¸ªå½¢çŠ¶çš„tensorã€‚åœ¨åŠ è½½æ¨¡å‹çš„æ—¶å€™ï¼ŒMåˆå§‹åŒ–åº”è¯¥æ˜¯ä¸‰ç»´çš„ï¼Œä½†æ˜¯æ¨¡å‹æ–‡ä»¶é‡Œé¢å®ƒæƒ³ä»safetensoré‡Œé¢åŠ è½½Må‡ºé”™äº†ï¼ŒåŸå› åœ¨äºå½¢çŠ¶ä¸ç¬¦åˆã€‚é‚£ä¹ˆï¼Œé—®é¢˜çš„å…³é”®åœ¨äºï¼Œregister bufferçš„è¿™ä¸¤ä¸ªå‚æ•°ä¸åº”è¯¥è¢«è®°å½•åˆ°æ¨¡å‹æ–‡ä»¶ä¸­å»ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•ï¼Œpersistentå‚æ•°è®¾ç½®ä¸ºFalseå³å¯ã€‚è§£å†³è¿™ä¸ªé—®é¢˜åï¼Œç”¨ä¸€ä¸ªæ•°æ®è¿›è¡Œæ¨¡å‹çš„è®­ç»ƒã€ä¿å­˜ï¼Œå¹¶æœ€åè¿›è¡Œæ¨¡å‹åŠ è½½ä¸å¯¹è¯ï¼ŒæˆåŠŸäº†ï¼é‡æ–°ç”¨ä¹‹å‰å‡†å¤‡å¥½çš„æ•°æ®å»è®­ç»ƒæ¨¡å‹çš„æ—¶é—´å·²ç»ä¸å¤Ÿäº†ï¼Œäºæ˜¯æˆ‘é‡æ–°å‡†å¤‡äº†COIG-PCä¸­å‘½åå®ä½“è¯†åˆ«é¢†åŸŸçš„10wæ¡æ•°æ®ï¼Œåªéœ€è¦70åˆ†é’Ÿå³å¯è®­ç»ƒå®Œæˆã€‚åŒæ—¶ï¼Œç”±äºCOIG-PCä¸­è¿™ä¸ªæ•°æ®é›†æ ·æœ¬çš„æ–‡æœ¬éƒ½æ¯”è¾ƒé•¿ï¼Œæ„Ÿè§‰ä¹Ÿå¯ä»¥åŒæ—¶è®­ç»ƒä¸€ç‚¹é•¿æ–‡æœ¬å’Œå¯¹è¯èƒ½åŠ›ã€‚ä¸€ä¸ªå‚è€ƒæ ·æœ¬æ•°æ®å¦‚ä¸‹ï¼š å½“ç»™ä¸€ä¸ªæ²¡æœ‰æ ‡æ³¨çš„ä¸­æ–‡æ–‡æœ¬æ·»åŠ å®ä½“æ ‡è®°æ—¶ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹ç®€æ˜æŒ‡ç¤ºè¿›è¡Œæ“ä½œï¼š é˜…è¯»å¹¶ç†è§£å¾…æ ‡æ³¨çš„æ–‡æœ¬ï¼Œè¯†åˆ«å‡ºå…¶ä¸­çš„å®ä½“ï¼ŒåŒ…æ‹¬æ—¶é—´ã€åœ°ç‚¹ã€äººåã€ç»„ç»‡åã€å…¬å¸åå’Œäº§å“åã€‚ æ ¹æ®å®ä½“çš„ç±»å‹ï¼Œåœ¨å®ä½“æ–‡æœ¬ä¸¤ä¾§ä½¿ç”¨åŒå¤§æ‹¬å·ï¼ˆ&#123;&#123;&#125;&#125;ï¼‰è¿›è¡Œæ ‡è®°ã€‚ åœ¨åŒå¤§æ‹¬å·å†…éƒ¨ï¼Œä½¿ç”¨å®ä½“ç±»å‹å’Œå†’å·åˆ†éš”å®ä½“æ–‡æœ¬ï¼Œæ ¼å¼ä¸ºï¼š&#123;&#123;å®ä½“ç±»å‹: å®ä½“æ–‡æœ¬&#125;&#125;ã€‚ æ ¹æ®å®é™…æƒ…å†µï¼Œä½¿ç”¨ä»¥ä¸‹æ ‡è®°ç±»å‹æ¥è¡¨ç¤ºä¸åŒçš„å®ä½“ï¼š æ—¶é—´ï¼š&#123;&#123;time: 2023å¹´5æœˆ29æ—¥&#125;&#125; åœ°ç‚¹ï¼š&#123;&#123;location: åŒ—äº¬&#125;&#125; äººåï¼š&#123;&#123;person_name: å¼ ä¸‰&#125;&#125; ç»„ç»‡åï¼š&#123;&#123;org_name: ä¸­å›½å…±äº§å…š&#125;&#125; å…¬å¸åï¼š&#123;&#123;company_name: è…¾è®¯&#125;&#125; äº§å“åï¼š&#123;&#123;product_name: iPhone 13&#125;&#125; åœ¨æ•´ä¸ªæ–‡æœ¬ä¸­ï¼Œé€šè¿‡æ·»åŠ å®ä½“æ ‡è®°å°†æ‰€æœ‰è¯†åˆ«å‡ºçš„å®ä½“è¿›è¡Œæ ‡æ³¨ã€‚ ç¡®ä¿å®ä½“æ ‡è®°çš„æ ¼å¼ç»Ÿä¸€ã€å‡†ç¡®ï¼Œå¹¶ä¸å®ä½“æ–‡æœ¬å¯¹åº”ã€‚ è¯·æŒ‰ç…§å¦‚ä¸ŠæŒ‡ç¤ºæ ‡è®°ä¸‹é¢æ–‡æœ¬ï¼šæµ™æ±Ÿåœ¨çº¿æ­å·4æœˆ25æ—¥è®¯ï¼ˆè®°è€… æ–½å®‡ç¿” é€šè®¯å‘˜ æ–¹è‹±ï¼‰æ¯’è´©å¾ˆâ€œæ—¶é«¦â€ï¼Œç”¨å¾®ä¿¡äº¤æ˜“æ¯’å“ã€‚æ²¡æ–™æƒ³è­¦æ–¹ä¹Ÿå¾ˆâ€œæ½®â€ï¼Œå°†è®¡å°±è®¡ï¼Œä¸€ä¸¾å°†å…¶æ“’è·ã€‚è®°è€…ä»æ­å·æ±Ÿå¹²åŒºå…¬å®‰åˆ†å±€äº†è§£åˆ°ï¼Œç»è¿‡ä¸€ä¸ªå¤šæœˆçš„ä¾¦æŸ¥å·¥ä½œï¼Œæ±Ÿå¹²åŒºç¦æ¯’ä¸“æ¡ˆç»„æŠ“è·å¸è´©æ¯’äººå‘˜5åï¼Œç¼´è·â€œå†°æ¯’â€400ä½™å…‹ï¼Œæ¯’èµ„30000ä½™å…ƒï¼Œæ‰£æŠ¼æ±½è½¦ä¸€è¾†ã€‚é»‘é¾™æ±Ÿç±ç”·å­é’±æŸé•¿æœŸè½è„šäºå®¾é¦†ã€å•èº«å…¬å¯“ï¼Œç»å¸¸å˜æ¢ä½å€ã€‚ä»–æœ‰ä¸€è¾†è½¦ï¼Œç»å¸¸åŠå¤œé©¾è½¦æ¥å¾€äºæ­å·ä¸»åŸåŒºçš„å„å¤§å®¾é¦†å’Œå•èº«å…¬å¯“ï¼Œå¹¶ä¸”å¸¸è¦æ´»åŠ¨åˆ°å‡Œæ™¨6ã€7ç‚¹é’Ÿï¼Œç™½å¤©åˆ™åœ¨å®¶é‡Œå‘¼å‘¼å¤§ç¡ã€‚é’±æŸä¸å¯»å¸¸çš„ç‰¹å¾ï¼Œå¼•èµ·äº†è­¦æ–¹æ³¨æ„ã€‚ç¦æ¯’å¤§é˜Ÿé€šè¿‡ä¾¦æŸ¥ï¼Œå‘ç°é’±æŸå®é™…ä¸Šæ˜¯åœ¨å‘è½è„šäºå®¾é¦†å’Œå•èº«å…¬å¯“çš„å¸æ¯’äººå‘˜è´©é€â€œå†°æ¯’â€ã€‚ è®­å®Œä¹‹åï¼Œå¯ä»¥åœ¨å¯¹è¯ä¸­ç›´æ¥ç”¨è¿™ä¸ªæ ·æœ¬æµ‹è¯•ä¸€ä¸‹æ•ˆæœã€‚å¥½å§ï¼Œç”±äºæµ‹è¯•æ•°æ®å¾ˆå•ä¸€ï¼Œç»“æœä¸å¥½ï¼ˆæµ‹è¯•æ•°æ®æ˜¯å¥æ³•åˆ†æå¥½åƒæ˜¯ï¼‰æˆ‘å°†ä¼šç”¨å…¨æ•°æ®å»è°ƒä¸€ä¸‹ï¼Œçœ‹çœ‹æ•ˆæœã€‚ç†è®ºä¸Šè¯´ï¼Œè¿™ä¸ªinfini-attnçš„ç»“æ„ï¼Œç”¨äºå•ä¸€åœºæ™¯åº”è¯¥æ˜¯è§æ•ˆå¾ˆå¿«çš„ã€‚è®­ç»ƒæ•°æ®å¯èƒ½éœ€è¦å¤šæ ·æ€§ã€åŒ…å«å¯¹è¯ä¹‹ç±»çš„ã€‚è¿™ä¸ªç»“æ„è¯´å®è¯ä¸å¤ªæœ‰è¶£ã€‚æˆ‘å¸Œæœ›èƒ½å°½é‡ä¸å¯¹å·²æœ‰å‚æ•°é€ æˆå½±å“ï¼Œè€Œæ˜¯å¢å¼ºã€‚130Gå…¨æ•°æ®A800ä¹Ÿæ”¾ä¸ä¸‹ï¼Œåªèƒ½ç”¨Top200çš„æ•°æ®ï¼Œå¤šè·‘å‡ ä¸ªepochäº†ã€‚ æ˜æ—¥ä»»åŠ¡ï¼šæŸ¥çœ‹è®­ç»ƒç»“æœï¼Œæ€è€ƒåç»­ä¼˜åŒ–æ–¹å‘ï¼ˆæ›´å¥½çš„æ•°æ®é›†ï¼Ÿï¼‰","categories":[{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å¤§æ¨¡å‹","slug":"è®°å½•/å¤§æ¨¡å‹","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"},{"name":"å®ä¹ ","slug":"è®°å½•/å¤§æ¨¡å‹/å®ä¹ ","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%AE%9E%E4%B9%A0/"}],"tags":[{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://yukino256.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"éšæƒ³","slug":"éšæƒ³","permalink":"https://yukino256.github.io/tags/%E9%9A%8F%E6%83%B3/"},{"name":"å¿ƒæƒ…","slug":"å¿ƒæƒ…","permalink":"https://yukino256.github.io/tags/%E5%BF%83%E6%83%85/"}]},{"title":"DailyRecord-March","slug":"DailyRecord-March","date":"2024-03-20T12:16:21.000Z","updated":"2024-05-07T01:23:59.055Z","comments":true,"path":"2024/03/20/DailyRecord-March/","link":"","permalink":"https://yukino256.github.io/2024/03/20/DailyRecord-March/","excerpt":"","text":"3.20å…¥èŒçš„ç¬¬ä¸€å¤©ï¼Œæ¥åˆ°çš„ä»»åŠ¡æ˜¯ï¼šæŠŠé—»è¾¾çš„demoåœ¨æœåŠ¡å™¨ä¸Šç”¨dockerç»™æ­å»ºå‡ºæ¥ã€‚äºæ˜¯æˆ‘åœ¨æœåŠ¡å™¨ä¸Šå…ˆåˆ›å»ºäº†ä¸€ä¸ªminiconda3çš„dockerï¼Œç„¶åä½¿ç”¨condaå®‰è£…äº†ä¸€äº›ä¾èµ–ã€gité¡¹ç›®ç­‰ï¼›å…¶é—´é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼šdocker+condaåï¼Œå°½ç®¡bashä¸Šæ˜¾ç¤ºæ˜¯rootï¼Œä½†æ˜¯å¥½åƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„rootï¼Œæ²¡æœ‰sudoç­‰çš„æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦é‡æ–°å®‰è£…ä¸€ä¸‹ã€‚æ­¤å¤–ï¼Œå…¬å¸çš„ç½‘æœ‰ç‚¹å·®ï¼Œæ¸…åæº1Mbã€ä¸ç”¨æ¸…åæºåªæœ‰å‡ åkbã€‚å› è€Œè¿›å±•è¾ƒæ…¢éƒ¨ç½²æ­¥éª¤è¿›è¡Œåˆ°äº†æ¨¡å‹ä¸‹è½½è¿™ä¸€æ­¥ï¼Œä½†æ˜¯å› ä¸ºç½‘ä¸å¥½æ‰€ä»¥è¿ä¸ä¸Šhugging faceï¼Œéœ€è¦æ­æ¢¯å­ã€‚ä¸‹ç­äº†ï¼Œæ˜å¤©å†æï¼ æ˜æ—¥ä»»åŠ¡ï¼šæå®šæ¢¯å­ï¼Œä¸‹è½½å¥½ç”Ÿæˆæ¨¡å‹å’Œembeddingæ¨¡å‹ï¼Œæœ€ç»ˆå®Œæˆdemoï¼Œå¹¶è°ƒæ•´è¿œç¨‹è®¿é—®å±•ç¤º 3.21ä»Šå¤©ç­¾åˆåŒäº†ã€‚æ­æ¢¯å­é—®é¢˜å¡äº†å¥½ä¹…ğŸ˜¡ã€‚è¿™å›½ä¼æ˜¯ä¸€å¤©ä¹Ÿä¸èƒ½å¾…äº†ï¼Œç½‘å·®çš„è¦æ­»ã€‚æœ€åè¿˜æ˜¯å‰è¾ˆå“¥å¸®å¿™è§£å†³çš„ã€‚ä½†æ˜¯terminalçš„å‘½ä»¤ï¼Œä¸‹è½½çš„é‚£äº›æ€ä¹ˆéƒ½é‚£ä¹ˆå‡ æŠŠæ…¢å•Šï¼ç½‘é€Ÿæ˜¯å‹åŠ›ä¹‹æºï¼æ›´æ‚²å‰§çš„æ˜¯ï¼šä»Šæ—¥é—»è¾¾demoéƒ¨ç½²è‡³æœ€åä¸€æ­¥æ— æ³•è¿è¡Œâ€¦â€¦â€¦â€¦..å¯èƒ½æ˜¯dockerçš„é—®é¢˜ï¼Œå› è€Œå°†å…¶åˆ é™¤ä»å¤´å¼€å§‹æ­å»ºã€‚å¦‚æœæ˜å¤©ä»ç„¶ä¸è¡Œï¼Œåˆ™å°è¯•ä¸ç”¨dockerç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½² ä»–å¦ˆçš„ï¼ç‹—æ—¥çš„åŒ—äº¬é€šå‹¤å¤ªç—›è‹¦äº†ï¼ æ˜æ—¥ä»»åŠ¡ï¼šwendaçš„demoã€‚å“æˆ‘çœŸä½›äº†è¿™ä¸ªbæœåŠ¡å™¨ + dockerå¥½éš¾ç”¨ï¼Œä¸èƒ½ç›´æ¥åœ¨æœåŠ¡å™¨å®‰è£…condaå—ï¼Œcondaåˆ›å»ºè™šæ‹Ÿç¯å¢ƒä¸ä¹ŸæŒºæ–¹ä¾¿çš„ 3.22åˆ›å»ºäº†ä¸€ä¸ªgitçš„containerï¼Œä½†æ˜¯åœ¨å®‰è£…lfsçš„æ—¶å€™å‡ºäº†é—®é¢˜ï¼Œéœ€è¦ç”¨sudoç­‰ä¸€äº›å‘½ä»¤ï¼Œä½†æ˜¯aptä¸‹è½½å¾ˆæ…¢ï¼Œä¼¼ä¹éœ€è¦åœ¨docker fileæ–‡ä»¶ä¸­å°±æ›´æ¢é•œåƒæºäº†è§£äº†dockerä¸­ä¸å®¿ä¸»æœºç›¸äº’cpæ–‡ä»¶ã€dockeråœ¨åˆ›å»ºæ—¶éœ€è¦ç”¨GPUå¯¹å®¹å™¨å¯è§çš„å‘½ä»¤ï¼› docker run -it â€“net&#x3D;host â€“gpus all â€“name å®¹å™¨å -e NVIDIA_DRIVER_CAPABILITIES&#x3D;compute,utility -e NVIDIA_VISIBLE_DEVICES&#x3D;all é•œåƒå é—»è¾¾demoç»ˆäºæ— æŠ¥é”™å®‰è£…èµ·æ¥äº†ä½†æ˜¯è¿è¡Œçš„æ—¶å€™ï¼Œæ¨¡å‹ä¼¼ä¹å¡ä½&#x2F;æ­»å¾ªç¯ï¼Ÿä¸è¿”å›è®¡ç®—ç»“æœã€‚ ä»–å¦ˆçš„ï¼å‹åŠ›ä¸€å¤©æ¯”ä¸€å¤©å¤§ï¼EMOäº†è¦ï¼ ä»Šå¤©ç¾å¥½çš„äº‹æƒ…ï¼šä¸SLã€ZYRä¸€èµ·åœ¨é™„è¿‘é‚£å•¥æ‹›å¾…æ‰€åƒå·èœã€‚å‘³é“ä¸é”™ï¼Œå°±æ˜¯ç¯å¢ƒæœ‰ç‚¹çƒ­ã€èœæœ‰ç‚¹è¾£ã€‚æ­¤å¤–ï¼Œå’ŒZYRä¸€èµ·è‡ªè¡Œè½¦éª‘è¡Œï¼Œä»–ä¸€è·¯è®²è§£ï¼ŒèŠçš„å¾ˆå¼€å¿ƒï¼åˆ°åŒ—äº¬ä»¥æ¥ä¸ºæ•°ä¸å¤šçš„å¿«ä¹æ—¶é—´ã€‚SLéª‘ç€ä»–é‚£ç ´ç”µç“¶è½¦ï¼Œæœ¬æ¥è·Ÿæˆ‘ä»¬ä¸€èµ·çš„ï¼ŒåŠè·¯ç»™äº¤è­¦ç½šæ¬¾äº†ï¼Œå°±è®©ä»–å›å»äº†ï¼Œå”‰ï¼Œæˆ‘å¥½éš¾è¿‡ ä¸‹å‘¨ä»»åŠ¡ï¼šè°ƒæ•´é—»è¾¾demo 3.23-3.24 å‘¨æœ«ï¼æ—©ä¸Šä¹˜ååœ°é“åˆ°æ¸…æ²³ï¼Œå’ŒNJæ±‡åˆï¼Œä¸€èµ·å»æ¸…æ²³åšäº†åŠå°æ—¶ç«è½¦åˆ°æ€€æ¥è¾£ï¼æ¯”åŒ—äº¬é€šå‹¤è¿˜å¿«ã€‚ä¸‹äº†ç«è½¦æœ‰ä¸€ç§ç»ˆäºé€ƒç¦»å‹åŠ›ä¹‹æºçš„èˆ’ç•…æ„Ÿã€‚ä¸­æ–‡åœ¨é¥­åº—åƒäº†ä»€ä¹ˆæ´‹è‘±å’Œç¾Šè‚‰ç‚’çš„ä¸œè¥¿ï¼Œå‘³é“ä¸é”™ï¼›ç„¶åè¿˜åƒäº†èœé¢ã€ç‚’æ‰è±†è§’ï¼›å–äº†è¥å…»å¿«çº¿å‘³çš„é…¸å¥¶ã€æä»éœ²ã€‚æä»éœ²å‘³é“ä¸é”™ï¼ŒåŠ çƒ­å’Œä¸åŠ çƒ­æ˜¯ä¸¤ä¸ªå‘³é“åƒå®Œé¥­å’ŒNJä¸€èµ·é¡ºè·¯å»èœå¸‚åœºä¹°äº†ç‚¹ç²‘ç²‘æŸ‘ï¼ˆæœ€åä¸€å£æ²¡åƒå¸¦å›åŒ—äº¬äº†ï¼‰ã€‚ç„¶åä¸è¡Œä¸€é˜µå­å»äº†å®¾é¦†ï¼ŒåŒäººé—´ä¸€æ™š90ï¼Œæ¡ä»¶è¿˜æŒºä¸é”™â€¦.è¦å“­äº†ç¡äº†åˆè§‰ï¼Œç„¶åå‡ºå»æ‰¾ç½‘å§æ‰“äº†å‡ æŠŠå¤§ä¹±æ–—ï¼›ä¸‹äº†æ–°èµ›å­£çš„ç¬¬ä¸€æŠŠäº‘é¡¶ï¼Œç©ä¸æ˜ç™½å¥½ç—›è‹¦ï¼Œè€å…­è€ä¸ƒå‡ºå±€ã€‚ç„¶åå‡ºå»è½¬äº†è½¬ï¼Œçœ‹äº†ä¸€ä¸‹å¿åŸçš„é£åœŸäººæƒ…ï¼Œä¹°äº†è¥¿å®‰ç‰¹äº§ç”‘ç³•ï¼Œå‘³é“ä¹Ÿä¸é”™ã€‚å¤©æ°”ä¸å¥½ï¼Œé˜´æ²‰å¤©ç©ºä½¿æˆ‘ä¸å¤ªå¼€å¿ƒã€‚ç›¸å¯¹äºè€å®¶ï¼Œè¿™é‡Œæ˜æ˜¾æ›´è’å‡‰ä¸€äº›ï¼Œæ²¡æœ‰äººã€æ²¡æœ‰å¹´è½»äººã€‚æ™šä¸Šåƒäº†ç ‚é”…ã€‚é…¸èœç™½è‚‰å’Œç«¹ç¬‹ç‚–è…Šè‚‰çš„ç ‚é”…ï¼›ç‚¹äº†å‚€å„¡ï¼ˆåœŸè±†å’Œé¢çš„æ··åˆç‰©ä½œä¸ºä¸»é£Ÿï¼Ÿï¼‰ï¼Œå’¸å’¸çš„ï¼Œæœ‰è‘±èŠ±ã€‚ç‚¹äº†å†°ç³–èŠ¦èŸï¼Œå’Œæ¤°æœç½å¤´ä¸€ä¸ªå‘³å„¿ã€‚åƒå®Œåˆè½¬äº†è½¬ã€‚å›åˆ°å®¾é¦†ç©äº†æŠŠé‡‘é“²é“²ï¼Œç„¶åä¸‹å»ä¹°äº†10æ–¤çš„åŠä¸ªè¥¿ç“œå’Œå‹ºå­ã€‚åƒäº†ä¸€ç‚¹ï¼Œå¤§å¤´ç»™NJåƒäº†ï¼ˆçœŸèƒ½åƒå•Šè¿™Bï¼‰ç¡äº†ä¸€æ™šï¼Œç¬¬äºŒå¤©æ—©ä¸Šåƒäº†è±†é¢è¿˜æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œç„¶åèµ°è·¯å»ä¹°äº†ä¸ªåŠç‚‰çƒ§é¥¼åˆ†ç€å°å°ï¼›NJç‚¹äº†é©´è‚‰å’Œé©´è‚ ç«çƒ§çš„å¤–å–ï¼Œå¸¦å›åŒ—äº¬åƒäº†å’ŒNJå›åŒ—äº¬äº†ï¼ŒBYDå¸¦æˆ‘åœ¨æµ·æ·€åŒºéª‘äº†å¥½ä¹…çš„è‡ªè¡Œè½¦ï¼Œæœ€ååœ¨ä¸€å®¶æ–°ç–†é¦†å­åƒäº†æŠ“é¥­å’Œç¾Šè‚‰ä»€ä¹ˆé¦ï¼Œå–äº†åŒ—äº¬çš„æ±½æ°´ï¼ˆå’ŒèŠ¬è¾¾ä¸€ä¸ªå‘³ï¼‰ï¼Œåƒçš„æŒºå¥½ã€‚å°±æ˜¯è¿™bäººå¸¦æˆ‘è½¬æ¥è½¬å»æœ€ååƒè¿™ç§å¿«é¤å±å®æ²¡ç»·ä½ 3.25é—»è¾¾demoéƒ¨ç½²å®Œæ¯•è¾£ï¼æ¥ä¸‹æ¥éœ€è¦ï¼šå°è¯•æ›´æ¢é€šä¹‰7B&#x2F;14Bçš„æ¨¡å‹ï¼›æŸ¥çœ‹é—»è¾¾å‰ç«¯æŠ€æœ¯æ ˆï¼Œä¸å‰ç«¯åšäº¤æ¥è®©å…¶ä¿®æ”¹ï¼›éƒ¨ç½²å¦ä¸€ä¸ª&#x2F;å‡ ä¸ªé¡¹ç›®ï¼ˆä¼¼ä¹è¦åŠ ç­ï¼Œtmdï¼ï¼‰å·²ç»å°†åº•æ¨¡æ›´æ–°ä¸º7Bï¼Œä½†æ˜¯14Bå¯èƒ½éœ€è¦åŒå¡ï¼Œè¿˜ä¸äº†è§£ä»–è¿™ä¸ªæ¡†æ¶æ€ä¹ˆæ”¾åˆ°åŒå¡ä¸Šï¼›å‰ç«¯æ¡†æ¶ä¸å¤ªæ¸…æ¥šï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªäºŒæ¬¡å¼€å‘çš„å‰ç«¯æ¡†æ¶æ­£åœ¨å°è¯•ï¼Œä½†æ˜¯æœåŠ¡å™¨ç½‘ä¸å¥½ï¼Œnodejså®‰è£…å›°éš¾ã€‚ä¸‹åˆçœ‹äº†Bç«™ä¸Šçš„ä¸€ä¸ªä»é›¶å¼€å§‹å¤§æ¨¡å‹ï¼Œæ„Ÿè§‰æœ‰ç‚¹æ”¶è·ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†æ²¡çœ‹å®Œ æ˜æ—¥ä»»åŠ¡ï¼šæˆ–è®¸éœ€è¦çœ‹ä¸€ä¸‹å¦ä¸€ä¸ªagentä»£ç†çš„éƒ¨ç½²ï¼›çœ‹langchainå’ŒLLMçš„ç›¸å…³æ•™ç¨‹è§†é¢‘ï¼›RAGç›®å‰ä¼¼ä¹æœ‰ä¸€å¥—å®è·µæ¨¡æ¿ï¼ŒåŸºäºfaissæ£€ç´¢ï¼Ÿ 3.26æ—©ä¸Šçœ‹langchainçš„è§†é¢‘æ•™ç¨‹ä¸‹åˆéƒ¨ç½²äº†wendaçš„äºŒæ¬¡å¼€å‘webuiï¼Œå…¶ä¸­æœ‰æŠ¥é”™ï¼›èƒ½ä¿è¯åŸºæœ¬çš„å¯¹è¯ï¼Œä½†æ˜¯æ–‡æ¡£å¯¹è¯åŠŸèƒ½ç”¨ä¸äº†ä¸‹åˆæŠ½ç©ºå»é¢äº†è…¾è®¯çš„NLPåº”ç”¨ç ”ç©¶å®ä¹ ç”Ÿï¼Œä»–ä»¬æ˜¯åšè…¾è®¯è§†é¢‘å‰§æœ¬ç†è§£ä¸æ™ºèƒ½åŠ©æ‰‹çš„ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€ã€‚èŠ±äº†114å®šäº†é’Ÿç‚¹æˆ¿ï¼Œå¯æƒœé¢è¯•çš„æ—¶å€™ç½‘ä¸å¥½ã€ä»£ç é¢˜ï¼ˆæ‰‹å†™äº¤å‰ç†µã€åŒæŒ‡é’ˆ&#x2F;æ»‘åŠ¨æ•°ç»„è§£å†³listä¸­æ»¡è¶³å’Œä¸ºnçš„æœ€å°è¿ç»­é•¿åº¦ï¼‰ä¹Ÿæ²¡æ•²å‡ºæ¥ï¼ŒBERTçš„æŸå¤±å‡½æ•°ã€äº¤å‰ç†µä¹Ÿæ²¡å›ç­”å¥½ã€‚ å’ŒSHäº¤æµäº†ä¸€ä¸‹é¢è¯•çš„ç»å†ï¼Œä»–ç›®å‰çš„å®ä¹ äº§å“ç»ç†ä¼¼ä¹å·¥èµ„ä½ä½†æ˜¯å¾ˆè½»æ¾ã€‚ä»–è¯´TXé¢è¯•ç»“æœå¾ˆå¿«ä¼šå‡ºï¼Œå°±å¯ä»¥å†æŠ•äº†ï¼Œä½†æ˜¯æˆ‘åˆ°ç¬¬äºŒå¤©ä¹Ÿæ²¡çœ‹åˆ°ç»“æœéƒ¨ç½²äº†langchain-chatchatï¼Œå¯ä»¥åŸºæœ¬è¿è¡Œï¼Œä½†å­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œå¦‚çŸ¥è¯†åº“æ£€ç´¢ä¼¼ä¹æ²¡æœ‰å·¥ä½œã€æ¨¡å‹æ›´æ¢æ²¡æœ‰å‰ç«¯ï¼Œéœ€è¦åœ¨åç«¯å°è¯•ä¿®æ”¹ å›å®¶ï¼Œåœ°é“ä¸Šå’ŒZJXåæ§½å·¥ä½œçš„äº‹æƒ…ï¼Œäº¤æµä¸­å¾—åˆ°ç‰‡åˆ»çš„å®‰æ…°ï¼›åˆ°å®¶åï¼Œå’ŒNJç”µè¯èŠäº†èŠï¼Œå¤§è¯‰è‹¦æ°´ï¼Œå¾—åˆ°äº†ä¸€äº›å¼€å¯¼å’Œå»ºè®®ï¼Œå¥½å…„å¼Ÿï¼ï¼›å¤œé‡Œèººåœ¨åºŠä¸Šï¼Œå’ŒLFèŠäº†èŠä»–çš„ç¦»èŒå’Œèµ°å…¨å¥–å»ç¾å›½è¯»PHDèººå¹³5å¹´ã€‚å”å˜˜ä¹‹ä½™ï¼Œæœ‰ç‚¹ç¾¡æ…• ä¼¼ä¹ï¼Œä¸Šç­çš„äººçŠ¶å†µéƒ½ä¸æ˜¯å¾ˆå¥½ï¼šZYRç²¾ç¥è¡°å¼±åƒè¯ã€LFå‹åŠ›å¤§æ€¼é¢†å¯¼è¾èŒã€SXå¤©å¤©emoä¸æƒ³åŠ¨ï¼Œæˆ‘è‡ªå·±çš„ç²¾ç¥çŠ¶æ€ä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Œå”‰ã€‚å”‰ï¼ æ˜æ—¥ä»»åŠ¡ï¼šè°ƒæ•´éƒ¨ç½²é¡¹ç›®ï¼Œå­¦ä¹  3.27æ—©ä¸Šç»™é¢†å¯¼æ¼”ç¤ºäº†ä¸€ä¸‹ä¸¤ä¸ªdemoï¼Œè¾¹ä¸Šçš„å‰è¾ˆå“¥éƒ¨ç½²çš„DB-GPTä¹Ÿçœ‹äº†ï¼›è¿™ä¸ªæ•ˆæœæŒºå¥½ï¼Œä½†æ˜¯ä¹Ÿæœ‰è¦è°ƒæ•´çš„åœ°æ–¹ã€‚å¦‚æœåŠ¡å™¨ä¸Šéƒ¨ç½²æ¨¡å‹çš„APIè°ƒç”¨ç­‰ä»Šå¤©çœ‹é˜¿é‡ŒQwençš„vllmæ•™ç¨‹è§†é¢‘ï¼Œå¤§æœ‰æ”¶è·é“¸å¸å§ï¼ŒLLMèŠå¤©ä¸€ä¸ªå­—ä¸€ä¸ªå­—æ˜¾ç¤ºçš„æ•ˆæœåŸæ¥æ˜¯æ¸…å±+ æ‰“å°å•Šï¼å‰ç«¯æˆ–è®¸å°±æ˜¯&lt;div&gt;å†…éƒ¨çš„åå¤åˆ·æ–°ï¼Ÿ æ˜æ—¥ä»»åŠ¡ï¼šè°ƒæ•´éƒ¨ç½²é¡¹ç›®ï¼Œå­¦ä¹  æ™šä¸Šï¼Œå’Œå¦ˆå¦ˆèŠäº†èŠå¤©ï¼Œå€¾è¯‰äº†ä¸€ä¸‹ã€‚å¾—çŸ¥å¦¹å¦¹çš„å¥¶å¥¶è‚¿ç˜¤æ™šæœŸï¼Œçªç„¶æœ‰ä¸€ç§ææƒ§å’Œæ‚²ä¼¤ç¬¼ç½©å¿ƒå¤´ã€‚å¸®å¦ˆå¦ˆç½‘ä¸Šå¡«å†™äº†æ£€æŸ¥éœ€è¦çš„ææ–™ï¼Œç›¸å…³ææ–™ä¹Ÿè¿›è¡Œäº†ä¿å­˜ã€‚ä¸SHã€LMDä¸€èµ·æ‰“äº†å¤§ä¹±æ–—ï¼Œç‰‡åˆ»çš„å¼€å¿ƒï¼Œä½†æ˜¯è¿‡ç¨‹ä¸­æ²¡æœ‰å®Œå…¨æ”¾æ¾ã€‚ 3.28ç»§ç»­å­¦ä¹ qwen+vllmçš„å®è—upä¸»ã€‚å¯¹asyncioçš„å†…å®¹æœ‰äº›ä¸ç†è§£ã€‚è¿™ä¸ªupä¸»å¥½åƒæ˜¯c++ã€javaé«˜æ‰‹ï¼Œå­¦ä¹ å¤§æ¨¡å‹ç›¸å…³å†…å®¹ä¸Šæ‰‹ä¹Ÿå¾ˆå¿«ï¼Œæˆ‘æ„Ÿåˆ°å¾ˆæŒ«è´¥ã€‚å°ç±³é¢è¯•ï¼Œé—®Qquantè¿˜æ˜¯å•¥çš„é‡åŒ–ä¸äº†è§£ï¼Œadapterä¸äº†è§£ï¼Œä»£ç é¢˜ä¸€æ˜¯nä¸ªå…¨æ’åˆ—ä¸­kä¸ªé€†åºå¯¹æ•°é‡ï¼Œå®Œå…¨ä¸ä¼šï¼›ä¸€ä¸ªæ˜¯å†™æ¢¯åº¦ä¸‹é™æ±‚ç®—æœ¯å¹³æ–¹æ ¹ï¼Œåˆå§‹åŒ–å€¼ã€lrå’Œåå‘ä¼ æ’­è¿™äº›éƒ½å†™çš„ä¸å¤ªå¥½ä¸‹åˆï¼Œè§†é¢‘çœ‹çš„å·®ä¸å¤šäº†ï¼Œå‡†å¤‡çœ‹ä¸€ä¸‹Difyæ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿æ™šä¸Šï¼Œæ‰“SHã€NJæ‰“æ¸¸æˆï¼Œå’Œå¦ˆå¦ˆè§†é¢‘ï¼Œå¼€æ£®å’Œæ²ˆæ™“å®‡è€å¸ˆçš„å¸ˆå§èŠäº†èŠåŸå¸‚ã€èŒä¸šè§„åˆ’ã€æœªæ¥å‘å±•ï¼Œæ„Ÿè§‰è®¤çŸ¥æ›´æ¸…æ™°äº† æ˜æ—¥ä»»åŠ¡ï¼šå­¦ä¹  æ‚²è‹¦è¦ç»•å¿ƒå¤´ï¼Œä¸èƒ½æ•£å»ã€‚å¯èƒ½çœŸçš„æ˜¯æˆ¿å­ä½çš„è¿˜æ˜¯æœ‰ç‚¹è¿œï¼Œæ¯å¤©é€šå‹¤1.5å°æ—¶ã€‚æˆ–è®¸æˆ‘éœ€è¦æ¢ç§Ÿäº†ã€‚ 3.28ä¸Šåˆçœ‹äº†ä¸€ä¼šå„¿è§†é¢‘ï¼Œç„¶åæ£é¼“4090é‚£å°æœºå­çš„dockerå’Œcondaï¼Œæ²¡æ£é¼“å‡ºä¸œè¥¿æ¥ã€‚ä¸‹åˆé—®äº†å‰è¾ˆï¼Œäº†è§£æ€ä¹ˆæäº†ï¼Œç¨å¾®æäº†ä¸€ç‚¹ä¸‹åˆï¼Œæäº†ä¼šlangchain-chatchatï¼Œå‘ç°æ¨ç†æ…¢çš„åŸå› å¯èƒ½æ˜¯gpuè¢«å äº†ï¼›æ²¡æ‰¾åˆ°å¦‚ä½•æ›´æ¢æ¨¡å‹ä¸ºqwen ä¸‹å‘¨ä»»åŠ¡ï¼šqwenllm&#x2F;qwençš„docker imageæœ¬åœ°ä¸‹è½½å¥½å¹¶ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œè¿è¡ŒæŸ¥çœ‹æ•ˆæœ åˆ æ”¾ å‡ è¾£ ï¼ 3.30-3.31 å‘¨æœ«ï¼å‘¨å…­æ—©ä¸Šï¼Œå’ŒSHæ‰“äº†LOLï¼Œä¸­åˆå‡ºå»åƒäº†å‰é‡å®¶ï¼›ä¸‹åˆèººäº†ä¸€ä¼šå„¿ï¼Œç„¶åæ™šä¸Šå’ŒNJå»é€›äº†å¤ç©å¸‚åœºï¼Œæ„Ÿè§‰æœ‰ç‚¹åŒè´¨åŒ–ã€‚ä¹‹ååƒäº†ç™½ç³–æ±å„¿çš„æä»è±†è…ï¼Œç„¶ååƒäº†æ°¸å’Œå¤§ç‹çš„å¿«é¤ï¼Œèµ¶ç´§èµ¶åœ°é“å›æ¥å‚åŠ TXçš„ç¬”è¯•é¢˜ã€‚ä½†å®é™…ä¸Šæˆ‘ä¸€é¢å·²ç»æŒ‚äº†ï¼Œç»“æœç°åœ¨æ‰å‡ºæ¥ï¼Œè¿™é¢˜å°±æ²¡å¿…è¦åšäº†å®é™…ä¸Šï¼Œè€Œä¸”äº”é¢˜åªåšå‡ºæ¥ç¬¬ä¸€é¢˜ï¼Œä¼¼ä¹æ‰“ç«èµ›çš„æ‰èƒ½åšå¾—å‡ºæ¥å¤šé¢˜ï¼Œå”‰â€¦åˆå’ŒSHæ‰“äº†ä¸€ä¼šå„¿å¤§ä¹±æ–—çœ‹å°è¯´ï¼Œç¡è§‰ï¼","categories":[{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å¤§æ¨¡å‹","slug":"è®°å½•/å¤§æ¨¡å‹","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"},{"name":"å®ä¹ ","slug":"è®°å½•/å¤§æ¨¡å‹/å®ä¹ ","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%AE%9E%E4%B9%A0/"}],"tags":[{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://yukino256.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"éšæƒ³","slug":"éšæƒ³","permalink":"https://yukino256.github.io/tags/%E9%9A%8F%E6%83%B3/"},{"name":"å¿ƒæƒ…","slug":"å¿ƒæƒ…","permalink":"https://yukino256.github.io/tags/%E5%BF%83%E6%83%85/"}]},{"title":"ç¬¬ä¸€æ¬¡å®ä¹ å‰çš„ä¸€äº›å‡†å¤‡å·¥ä½œä¸çŸ¥è¯†å‚¨å¤‡","slug":"å®ä¹ å‡†å¤‡","date":"2024-03-14T13:52:22.000Z","updated":"2024-03-17T13:53:12.026Z","comments":true,"path":"2024/03/14/å®ä¹ å‡†å¤‡/","link":"","permalink":"https://yukino256.github.io/2024/03/14/%E5%AE%9E%E4%B9%A0%E5%87%86%E5%A4%87/","excerpt":"","text":"åƒå¸†æ¯åŸç”Ÿåº”ç”¨æŒ‘æˆ˜èµ› å¤§èµ›ä¸»æ—¨ï¼šå¤§èµ›ä»¥â€œåˆ›æ„æ— é™Â·ç”Ÿæˆæœªæ¥â€ä¸ºä¸»é¢˜ï¼Œç´§å¯†å›´ç»•å½“å‰AIæŠ€æœ¯çš„å‰æ²¿åŠ¨æ€å’Œåº”ç”¨è¶‹åŠ¿ï¼Œå€ŸåŠ©ç™¾åº¦æ™ºèƒ½äº‘åƒå¸†AppBuilderå’ŒModelBuilderä¸¤å¤§æ™ºèƒ½å¼€å‘åŠ©æ‰‹ï¼Œé¼“åŠ±å‚èµ›è€…æ‰“é€ å‡ºæ›´å¤šå…·æœ‰åˆ›æ–°æ€§ã€å®ç”¨æ€§å’Œç¤¾ä¼šä»·å€¼çš„AIåŸç”Ÿåº”ç”¨ ç¬¬ä¸€æœŸï¼šæ¸¸ä¹åœºæ’é˜Ÿè§„åˆ’åŠ©æ‰‹ï¼šèµ›é¢˜èšç„¦æ˜¥èŠ‚å‡æœŸæ¸¸ä¹å›­æ’é˜Ÿæ•ˆç‡é—®é¢˜ï¼Œé¼“åŠ±å¼€å‘è€…åˆ©ç”¨ AI èƒ½åŠ›æ–½å±•â€œæ—¶é—´é­”æ³•â€ï¼Œæ‰“é€ ä¸€æ¬¾å…·æœ‰å®ç”¨æ€§çš„â€œæ¸¸ä¹åœºæ’é˜Ÿè§„åˆ’åŠ©æ‰‹â€ï¼Œå¸®åŠ©æ¸¸å®¢æ›´å¥½åœ°äº†è§£ä¹å›­çš„æ’é˜Ÿæƒ…å†µï¼Œè®¾è®¡ä¸ªæ€§åŒ–çš„æ¸¸ç©è·¯çº¿ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…è·å¾—æœ€â€œHighâ€çš„ä½“éªŒï¼ŒåŒæ—¶ä¸ºç®¡ç†è€…æä¾›ä¼˜åŒ–è¿è¥ç­–ç•¥çš„å†³ç­–æ”¯æŒã€‚ æ­¤å¤§èµ›æ²¡æœ‰è§„å®šæ•°æ®é›†ï¼Œéœ€æ±‚æˆæœæ˜¯ä½¿ç”¨ä¸»åŠæ–¹æ¡†æ¶çš„åº”ç”¨ç¨‹åºã€‚å‚èµ›è€…éœ€è¦è‡ªå·±è·å–ç›¸å…³æ•°æ®ï¼Œå¦‚å¤§èµ›ç¬¬ä¸€åä½¿ç”¨çš„æ˜¯é¦™æ¸¯è¿ªå£«å°¼æ•°æ® ç¬¬äºŒæœŸï¼šç”Ÿæˆä¸€ä¸ªå¯åˆ¶ä½œè´ºå²æ–‡æ¡ˆå†…å®¹çš„ç²¾è°ƒæ¨¡å‹ï¼ˆé™å®šä½¿ç”¨ERNIE Speedï¼Œé€šè¿‡å¯¹æ¨¡å‹ç²¾è°ƒä½¿å…¶ä¿æŒåŸæœ‰èƒ½åŠ›çš„åŒæ—¶ï¼Œå…·å¤‡å‡†ç¡®ç†è§£å¹¶æ‰§è¡Œæ–‡æ¡ˆåˆ›ä½œä¸­åˆ›ä½œé•¿åº¦ç›¸å…³æŒ‡ä»¤çš„èƒ½åŠ›ï¼‰ã€‚ æ­¤å¤§èµ›æä¾›äº†å°‘é‡æ•°æ®é›†ï¼ˆ56ï¼‰æ¡ï¼ŒåŒæ—¶è¦æ±‚å¯¹æ•°æ®é›†è¿›è¡Œæ‰©å±•ï¼ˆæœ€ç»ˆè‡³å°‘éœ€è¦100æ¡æ•°æ®ï¼‰ï¼Œæ•°æ®ä¸ºjsonå½¢å¼ ä¸ç¬¬ä¸€æœŸä¸åŒï¼Œæ­¤æœŸæ˜¯æ–¹å‘ç‰¹åŒ–çš„å¾®è°ƒæ¨¡å‹å¼€å‘ï¼Œéœ€è¦ä½¿ç”¨ä¸»åŠæ–¹æ¡†æ¶ å¤§èµ›å½¢å¼ï¼š ç¬¬ä¸€æœŸï¼šåŸºäºAppBuilderå¹³å°æä¾›çš„å¼ºå¤§å¼€å‘å¥—ä»¶å’Œèµ„æºç¯å¢ƒï¼Œä½¿ç”¨å¹³å°é¢„ç½®çš„Agentæ¡†æ¶ï¼Œä»¥é›¶ä»£ç çš„æ–¹å¼åˆ›å»ºAgentæ™ºèƒ½ä½“ï¼Œè‡ªåŠ¨åŒ–è°ƒç”¨å„ç§å·¥å…·æ‰“é€ æ¸¸ä¹åœºæ’é˜Ÿè§„åˆ’åŠ©æ‰‹AIåŸç”Ÿåº”ç”¨ã€‚ æ¸¸å®¢åªéœ€è¦è¾“å…¥æ—¶é—´é¢„ç®—å’Œæ¸¸ç©å–œå¥½ï¼ŒAgentæ™ºèƒ½ä½“å°±èƒ½ç”Ÿæˆå¹¶æ‰§è¡ŒPythonä»£ç ï¼Œæ±‚è§£ä¼˜åŒ–é—®é¢˜ï¼Œæ™ºèƒ½è§„åˆ’å‡ºæ¸¸ç©é¡¹ç›®è·¯çº¿ã€‚â€”â€”â€”â€”â€”â€”â€”â€”ç”Ÿæˆpythonï¼Œæ±‚è§£optimizationé—®é¢˜çš„agent ç¬¬äºŒæœŸï¼šé€šè¿‡åœ¨åƒå¸†å¤§æ¨¡å‹å¹³å°ä½¿ç”¨å¹³å°ä¸Šçš„å„ç§æ¨¡å‹è°ƒä¼˜å·¥å…·ï¼Œç»“åˆç›¸å…³æ•°æ®ï¼ŒåŸºäºERNIE-Speedè°ƒä¼˜ç”Ÿæˆç¬¦åˆèµ›é¢˜ä¸»é¢˜è¦æ±‚ä¸”æ•ˆæœä¼˜ç§€çš„æ¨¡å‹ã€‚ ä½œå“ä¿¡æ¯éœ€åŒ…å«ï¼š å¾®è°ƒåçš„æ¨¡å‹æ•ˆæœå±•ç¤ºï¼ˆè¾“å…¥è¾“å‡ºç¤ºä¾‹æˆªå›¾ï¼‰ éƒ¨ç½²åçš„æ¨¡å‹APIæ–‡æ¡£ï¼ˆåŒ…å«urlåœ°å€ã€è¶…å‚é…ç½®å’Œæ­¥éª¤æè¿°ï¼‰ access_tokenï¼› é˜¿é‡Œå¤©æ± ç«èµ›1. åŸºäºLLMæ™ºèƒ½é—®ç­”ç³»ç»Ÿå­¦ä¹ èµ› èµ›é¢˜æ€æƒ³ï¼šæœªæ¥é‡‘èç§‘æŠ€é¢†åŸŸå°†æ·±åˆ»ä½“ç°Agentçš„ä»·å€¼ï¼Œå³ä¸€ä¸ªæ™ºèƒ½ä»£ç†èƒ½æ ¹æ®ç”¨æˆ·éœ€æ±‚è¿›è¡Œæ„å›¾è¯†åˆ«å’Œå†³ç­–ã€‚æœ¬æ¬¡å¤§èµ›çš„èµ›é¢˜è™½ä¸ºå•ä¸€ï¼Œä½†èåˆäº†æ•°æ®æŸ¥è¯¢ä¸æ–‡æœ¬ç†è§£ä¸¤å¤§ä»»åŠ¡ï¼Œå……åˆ†ä½“ç°äº†Agentæ ¸å¿ƒæ€æƒ³ï¼šæ ¹æ®ä¸ç¡®å®šè¾“å…¥ï¼Œåˆ¤æ–­ç”¨æˆ·æ„å›¾ï¼Œå¹¶è°ƒç”¨ç›¸åº”æœåŠ¡æˆ–åŠŸèƒ½ç”Ÿæˆç­”æ¡ˆã€‚ æ¨¡å‹ä½¿ç”¨ï¼šä¸é™åˆ¶é€‰æ‰‹çš„æ¨¡å‹ä½¿ç”¨ï¼Œé€‰æ‰‹å¯ä»¥é€‰æ‹©å•†ä¸šåŒ–æ¨¡å‹æˆ–è€…å¼€æºæ¨¡å‹ï¼Œä¹Ÿå¯ä»¥ç»“åˆå¤šä¸ªæ¨¡å‹ï¼Œå…±åŒåˆ›å»ºä¸€ä¸ªé—®ç­”ç³»ç»Ÿã€‚å¯ä»¥é‡‡ç”¨Prompt Engineeringæ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤–éƒ¨æ•°æ®å¯¹æ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚æ¨èä½¿ç”¨â€œé€šä¹‰åƒé—®é‡‘èå¤§æ¨¡å‹â€æˆ–â€œé€šä¹‰åƒé—®7Bæ¨¡å‹â€ä½œä¸ºåŸºç¡€å¤§æ¨¡å‹ï¼Œ ä»»åŠ¡ç›®æ ‡ï¼šæ•°æ®æŸ¥è¯¢é¢˜â€”â€”æ ¹æ®ç”¨æˆ·çš„é—®é¢˜ï¼Œç”Ÿæˆç›¸åº”çš„SQLæŸ¥è¯¢è¯­å¥ï¼Œç²¾å‡†æŸ¥è¯¢é—®é¢˜ç»“æœï¼›æ–‡æœ¬ç†è§£é¢˜ï¼šå¯¹é•¿æ–‡æœ¬è¿›è¡Œç»†è‡´æ£€ç´¢ä¸è§£è¯»ï¼Œé«˜æ•ˆæå–å…³é”®ä¿¡æ¯ã€‚ æ•°æ®é›†æè¿°ï¼šèµ›äº‹ä¸»åŠæ–¹æä¾›ä¸‰ç±»æ•°æ®ã€‚ä¸€ä¸ªæ˜¯10å¼ æ•°æ®è¡¨ï¼ˆsqliteï¼‰ï¼Œä¸€ä¸ªæ˜¯æ‹›è‚¡è¯´æ˜ä¹¦ï¼ˆpdfæ–‡ä»¶ï¼Œæ ‡å‡†çš„æ‹›è‚¡è¯´æ˜ä¹¦å½¢å¼ï¼Œæ²¡æœ‰è¿›è¡Œæ•°æ®å¤„ç†ï¼‰ï¼Œä»¥åŠå°†æ‹›è‚¡è¯´æ˜ä¹¦pdfè§£æåçš„txtæ–‡ä»¶ã€‚ å¤§æ¨¡å‹æ‹“å±•æ“ä½œï¼šæ‰©å±•é‡‘èè¡Œä¸šè¯è¡¨ï¼›å¢é‡è®­ç»ƒè¡Œä¸šé‡‘è200Bè§„æ¨¡ï¼Œæ¶µç›–ä¸­è‹±æ–‡è´¢æŠ¥ã€ç ”æŠ¥ã€æ–°é—»ã€ä¹¦ç±ã€è®ºå›ç­‰å¤šç§ç±»å‹æ•°æ®ï¼›è®­ç»ƒä¸Šä¸‹æ–‡æ‰©å±•åˆ°16Kï¼Œå€ŸåŠ©NTKå’ŒLogNç­‰æŠ€æœ¯ï¼Œæ¨ç†é•¿åº¦å¯ä»¥æ‰©å±•åˆ°64K 2. é€šä¹‰åƒé—®AIæŒ‘æˆ˜èµ› - Code Qwenèƒ½åŠ›ç®—æ³•èµ›é“ ç›®çš„ï¼šå¦‚ä½•é€šè¿‡é«˜è´¨é‡çš„æ•°æ®å¾®è°ƒæå‡åŸºç¡€è¯­è¨€æ¨¡å‹çš„ä»£ç èƒ½åŠ›ï¼Ÿâ€”â€”èšç„¦äºé€šä¹‰åƒé—®å¤§æ¨¡å‹å¾®è°ƒè®­ç»ƒçš„ç«èµ›ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯é€šè¿‡é«˜è´¨é‡çš„æ•°æ®æ¢ç´¢å’Œæ‹“å±•å¼€æºæ¨¡å‹ Qwen 1.8B åŠ Qwen 72B çš„ä»£ç èƒ½åŠ›ä¸Šé™ã€‚é«˜è´¨é‡çš„æ•°æ®æ˜¯å¤§æ¨¡å‹æå‡æ•ˆæœçš„å…³é”®ï¼Œåˆèµ›é˜¶æ®µä¸»è¦èšç„¦åœ¨å¦‚ä½•é€šè¿‡ SFT æå‡åŸºç¡€æ¨¡å‹çš„ä»£ç èƒ½åŠ›ã€‚éœ€è¦é€‰æ‰‹åŸºäºæœ€æ–°å¼€æºçš„ Qwen 1.8 æ¨¡å‹ä½œä¸ºåŸºç¡€æ¨¡å‹ï¼Œåœ¨æä¾›çš„è®­ç»ƒæ¡†æ¶ä¸Šè‡ªè¡Œè¿›è¡Œæ•°æ®æ”¶é›†ä¸å¾®è°ƒï¼Œè®­ç»ƒå®Œæˆåå°†è¿›è¡Œè‡ªåŠ¨è¯„ä¼°ï¼Œè¿”å›æœ€ç»ˆç»“æœè¿›è¡Œæ’åï¼› æ•°æ®é›†ç‰¹å¾ Evol-instruction-66kï¼š åŸºäºå¼€æºopen-evol-instruction-80kè¿‡æ»¤ä½è´¨é‡ï¼Œé‡å¤å’Œhuman evalç›¸ä¼¼çš„æ•°æ®åå¾—åˆ°çš„é«˜è´¨é‡ä»£ç ç±»å¾®è°ƒæ•°æ® e.x.{ â€œinstructionâ€: â€œUsing the text file from the link, https://norvig.com/big.txt, use the SpellChecker module from the pyspellchecker package in Python to find spelling mistakes in the text file. Additionally, measure the efficiency of the implemented spell checker. Report the number of false positives and false negatives, and provide a way to visualize these instances. Also, improve the spell checker by using custom dictionaries or other natural language processing techniques to reduce these errors.â€, â€œoutputâ€: â€œHere is an outline of how to address this problem:\\n(Note we will need to install pyspellchecker and requests dependencies if not present already). You can install it using:\\n\\npip install pyspellchecker requests\\n\\n\\npython\\nimport requests\\nfrom spellchecker import SpellChecker\\n\\n# Get the text file\\nurl = \\&quot;https://norvig.com/big.txt\\&quot;\\nresponse = requests.get(url)\\ntext = response.text\\n\\n# Remove punctuation and special characters\\ntext = &#39;&#39;.join(e for e in text if e.isalnum() or e.isspace())\\n\\n# Tokenize text (naive method)\\nwords = text.split()\\n\\n# Initialize spell checker\\nspell = SpellChecker()\\n\\n# Find misspelled words\\nmisspelled = spell.unknown(words)\\n\\n# Print result\\nprint(f\\&quot;Number of misspelled words: &#123;len(misspelled)&#125;\\&quot;)\\n\\nThis snippet will output a number of misspelled words found in the text.\\n\\nIn order to measure the efficiency in terms of false negatives and false positives, you need to know the true positives and true negatives, which requires the ground truth that in this case would be some kind of â€˜cleanâ€™ version of the text without typos. \\n\\nWe can perform a counter-example with a small list that has good and bad spelled word:\\npython\\n# Assuming we have two lists which contain correctly spelled and incorrectly spelled words.\\ncorrectly_spelled = [&#39;apple&#39;, &#39;banana&#39;, &#39;pear&#39;]\\nincorrectly_spelled = [&#39;aple&#39;, &#39;banan&#39;, &#39;per&#39;]\\n\\n# Everything the spellchecker says is fine should be in the correctly spelled list.\\nfalse_negatives = [word for word in correctly_spelled + incorrectly_spelled if word not in spell.known([word])]\\n\\n# Everything the spellchecker says is wrong should be in the incorrectly spelled list.\\nfalse_positives = [word for word in correctly_spelled + incorrectly_spelled if word not in spell.unknown([word])]\\n\\nprint(f\\&quot;False Negatives: &#123;false_negatives&#125;\\&quot;)\\nprint(f\\&quot;False Positives: &#123;false_positives&#125;\\&quot;)\\n\\n\\nVisualizing results can be done in many ways depending on your preferences and exact needs. In simple cases, you could list the incorrectly spelled words found by the spell checker, but you could also create a plot using matplotlib, or a word cloud using the WordCloud module.\\n\\nTo improve the spell checker, you can add words to its dictionary. The pyspellchecker has a corpus we can add our words, as shown below:\\n\\npython\\nupdated_dictionary = set(list(spell.word_frequency.dictionary.keys()) + [\\&quot;additional\\&quot;, \\&quot;dictionary\\&quot;, \\&quot;words\\&quot;])\\nspell.word_frequency.load_words(updated_dictionary)\\n\\n\\nIf you have a custom dictionary, you can just load this directly.\\n\\nPyspellchecker probabilities are based on the occurrence of a word in the text. As a result, the more domain-specific text you can provide it, the more accurate it becomes.\\n\\nAnother optimization could be to apply a stemming algorithm before comparing words to the dictionary since the dictionary typically includes only root words.\\n\\nIn addition, you can use Machine Learning or Natural Language Processing techniques to improve spell check. Techniques such as:\\n1. Using a context-based spelling correction by using BERT model. \\n2. Training a customized spell-check model using a dataset relevant to your problem.\\n3. Using N-gram approach, where the context of the word is used for the correction (this is used in Google\\u2019s spell checker as of 2010).\\n4. Use of phonetic algorithms (e.g., Soundex, Metaphone, etc.) which are used to correct phonetically misspelled words.â€} CodeExercise-Python-27kï¼š åŸºäºchatgptç”Ÿæˆçš„é«˜è´¨é‡pythonç»ƒä¹ é¢˜æ•°æ® e.x.{â€œdata_nameâ€: â€œCodeExercise-Pyâ€, â€œidâ€: 0, â€œchat_roundsâ€: [{â€œroleâ€: â€œhumanâ€, â€œcontentâ€: â€œWrite a Python function named &quot;add_numbers&quot; that takes two parameters, &quot;num1&quot; and &quot;num2&quot;, and returns the sum of the two numbers.\\nInput: Noneâ€, â€œchat_round_idâ€: 0}, {â€œroleâ€: â€œbotâ€, â€œcontentâ€: â€œpython\\ndef add_numbers(num1, num2):\\n \\&quot;\\&quot;\\&quot;\\n This function takes two numbers as input and returns their sum.\\n\\n Parameters:\\n num1 (int or float): The first number.\\n num2 (int or float): The second number.\\n\\n Returns:\\n int or float: The sum of num1 and num2.\\n \\&quot;\\&quot;\\&quot;\\n return num1 + num2\\n\\n# Example usage\\nresult = add_numbers(5, 3)\\nprint(result) # Output: 8\\n\\n\\nâ€œ, â€œchat_round_idâ€: 1}]} é—»è¾¾ï¼šä¸€ä¸ªå¤§è§„æ¨¡è¯­è¨€æ¨¡å‹è°ƒç”¨å¹³å°1. çŸ¥è¯†åº“æ£€ç´¢å¢å¼º sentence_transformers + æ£€ç´¢ï¼Œæ”¯æŒfaiss&#x2F;fessæ£€ç´¢ï¼Œå¯ä»¥é€‰æ‹©æœ¬åœ°&#x2F;åœ¨çº¿æ£€ç´¢ã€ç´¢å¼•é¢„å…ˆ&#x2F;å®æ—¶æ„å»º æ²¡æœ‰æåˆ°é•¿æ–‡æœ¬èƒ½åŠ›ï¼Œä»…ä»…æ˜¯å–å†³äºmodelæœ¬èº«çš„åŠŸèƒ½ DeepBI1. å®šä¹‰&#x2F;åº•æ¨¡ åŸºäºOPENAI GPT4 æ¨¡å‹å¼€å‘çš„BIç³»ç»Ÿï¼Œå¯ä»¥è‡ªåŠ¨ç”Ÿæˆsqlä¸å›¾è¡¨ æ ¸å¿ƒé—®é¢˜æ˜¯ï¼šå¦‚ä½•åœ¨é€šè¿‡APIçš„æƒ…å†µä¸‹ä¼˜åŒ–SQLç”Ÿæˆä¸ç»“æœåˆ†æï¼Ÿå›¾è¡¨ç”Ÿæˆæ˜¯æ¨¡å‹ç”Ÿæˆè¿˜æ˜¯è°ƒç”¨æŸäº›åº“æ–¹æ³•ï¼Ÿ åˆæ­¥åˆ¤æ–­æ˜¯ç”¨äº†pythonçš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå¦‚pyechartsç­‰è¿›è¡Œå›¾è¡¨ç”Ÿæˆï¼›å®Œå…¨è°ƒç”¨GPT4 APIï¼Œä¼¼ä¹ä»…åœ¨promptä¸Šåšäº†ä¸€äº›ç®€å•çš„å¤„ç†ï¼Ÿ è¿˜æ˜¯midwareçš„æ€æƒ³ï¼›åœ¨ä»£ç ç”Ÿæˆä¸Šï¼Œæ²¡æœ‰åšåˆ°äº¤å‰ç”Ÿæˆï¼Œpythonå’Œsqlç”Ÿæˆæ˜¯åˆ†å¼€çš„ CodeT5+ æ¨¡å‹ç»“æ„ï¼šencoder-decoderç»“æ„ ç¼–ç å™¨å­¦ä¹ ä»ä»£ç &#x2F;æ–‡æœ¬åºåˆ—ï¼ˆå®Œæ•´ã€éƒ¨åˆ†æˆ–è·¨åº¦å±è”½åºåˆ—ï¼‰ä¸­å¯¹ä¸Šä¸‹æ–‡è¡¨ç¤ºè¿›è¡Œç¼–ç ã€‚ æ ¹æ®é¢„è®­ç»ƒå­¦ä¹ ä»»åŠ¡ï¼Œè§£ç å™¨è¢«è®­ç»ƒä»¥ç”Ÿæˆä¸åŒç±»å‹çš„è¾“å‡ºã€‚ é¢„è®­ç»ƒä»»åŠ¡çš„æ··åˆä½¿æ¨¡å‹èƒ½å¤Ÿå­¦ä¹ ä»£ç ä¸Šä¸‹æ–‡çš„æœ‰æ„ä¹‰çš„è¡¨ç¤ºï¼Œå¹¶åœ¨ä¸åŒçº§åˆ«æ¢å¤ä¸¢å¤±çš„ä¿¡æ¯ï¼šä»£ç è·¨åº¦ã€éƒ¨åˆ†ç¨‹åºå’Œå®Œæ•´ç¨‹åºã€‚ è®­ç»ƒç­–ç•¥ï¼šå¤šä»»åŠ¡æ··åˆ ç›®çš„æ˜¯å¢å¼ºLLMçš„ç†è§£èƒ½åŠ› ç»“åˆäº†ä¸åŒç±»å‹çš„å­¦ä¹ ä»»åŠ¡ï¼ŒåŒ…æ‹¬span denoising, causal language modeling (CLM), text-code contrastive learning, and matching tasksï¼ˆè·¨åº¦å»å™ªã€å› æœè¯­è¨€å»ºæ¨¡ï¼ˆCLMï¼‰ã€æ–‡æœ¬ä»£ç å¯¹æ¯”å­¦ä¹ å’ŒåŒ¹é…ä»»åŠ¡ï¼‰ã€‚ä»–ä»¬å‘ç°ï¼Œå¦‚æ­¤å¹¿æ³›çš„é¢„è®­ç»ƒä»»åŠ¡é›†å¯ä»¥å¸®åŠ©æ¨¡å‹ä»ä»£ç å’Œæ–‡æœ¬æ•°æ®ä¸­å­¦ä¹ ä¸°å¯Œçš„è¡¨ç¤ºï¼Œå¹¶å¼¥åˆå„ç§åº”ç”¨ä¸­çš„é¢„è®­ç»ƒå¾®è°ƒå·®è·ã€‚ å¦‚ä½•å®ç°é€šè¿‡å¯¹æ¨¡å‹è¿›è¡Œè°ƒæ•´åŠ é€Ÿè®­ç»ƒï¼Ÿâ€”â€”â€”â€”â€”shallow encoder and deep decoderç­–ç•¥ keep the small encoder and the cross-attention layers trainable while freezing the deep decoder LLM. â€”â€”â€”â€”Such architecture is designed with the intuition that the decoder is often employed to deal with a higher level of complexity in generation tasks and requires a larger number of neural parameters. è®­ç»ƒtrick unimodal code data and bimodal code-text data.ï¼ˆçº¯ä»£ç  + ä»£ç ä¸æ³¨é‡Šï¼Ÿï¼‰ äºŒé˜¶æ®µé¢„è®­ç»ƒç­–ç•¥ï¼ˆå®è·µè¯æ˜å¯ä»¥å¢å¼ºæ›´ä¸°å¯Œçš„æ–‡æœ¬è¡¨ç¤ºï¼‰ ç¬¬ä¸€é˜¶æ®µåªé‡‡ç”¨çº¯ä»£ç è®­ç»ƒï¼šä»GitHubç­‰å¼€æºå¹³å°è·å¾—äº†æ•°æ®ï¼ˆè®¸å¯è¯ï¼‰ã€‚æ€»å…±é‡‡ç”¨äº†ä¹ç§ç¼–ç¨‹è¯­è¨€çš„å¤šè¯­è¨€åŸ¹è®­æ•°æ®ã€‚ ç¬¬äºŒé˜¶æ®µé‡‡ç”¨ä»£ç +æ–‡æœ¬ä½œä¸ºè®­ç»ƒæ•°æ®ï¼šæ¯ä¸ªæ•°æ®æ ·æœ¬éƒ½åŒ…å«ä¸€ä¸ªæ–‡æœ¬ä»£ç å¯¹ï¼Œå…¶ä¸­åŒ…æ‹¬ä¸€ä¸ªä»£ç å‡½æ•°åŠå…¶ç›¸åº”çš„æè¿°å‡½æ•°è¯­ä¹‰çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚ Instruction Tuning tuning the models with synthetic instruction-following tasks ä¸‹åˆ—ä¸ºå¯èƒ½å‚è€ƒåˆ°çš„è®ºæ–‡åŠå¯å‘ç‚¹â€”â€”â€”â€”LLM agent for generating code with python and SQL1. CleanAgent: Automating Data Standardization with LLM-based Agents æå‡ºä¸€ä¸ªå…·æœ‰å£°æ˜æ€§ã€ç»Ÿä¸€ API çš„ Python åº“ï¼Œç”¨äºæ ‡å‡†åŒ–åˆ—ç±»å‹ï¼Œé€šè¿‡ç®€æ´çš„ API è°ƒç”¨ç®€åŒ– LLM çš„ä»£ç ç”Ÿæˆã€‚ ç±»ä¼¼ä¸midwareçš„æ€æƒ³ï¼ŒåŠ äº†ä¸€ä¸ªä¸­é—´å±‚æ–¹ä¾¿tuningï¼Œå®é™…ä»·å€¼ä¼¼ä¹ä¸å¤§ 2. LiveCodeBench: Holistic and Contamination Free Evaluation of Large Language Models for Code ä¸€å¥—code generationæ•ˆæœè¯„ä»·æ–¹æ³•ï¼ŒMITä¼¯å…‹åˆ©å¤§å­¦å‡ºå“ï¼Œæˆ–è®¸å¯ä»¥ä¸€è¯• 3. KnowCoder: Coding Structured Knowledge into LLMs for Universal Information Extraction ä¸­å›½ç§‘å­¦é™¢å¤§å­¦CAS Key Laboratory of Network Data Science and Technologyå‡ºå“ æ—¨åœ¨å¼€å‘ä¸€ç§LLMæ˜“äºç†è§£çš„ç»Ÿä¸€æ¨¡å¼è¡¨ç¤ºï¼Œä»¥åŠé¼“åŠ±LLMéµå¾ªæ¨¡å¼å¹¶å‡†ç¡®æå–ç»“æ„åŒ–çŸ¥è¯†çš„æœ‰æ•ˆå­¦ä¹ æ¡†æ¶ï¼ˆUniversal Information Extraction (UIE) taskï¼‰ å·²æœ‰UIEæ–¹æ³•çš„ä¸€äº›ä¸è¶³ï¼šåœ¨ç±»åˆ«åŠå…¶å½’å±çš„åˆ¤å®šä¸Šã€å…³è”ä¸å®ä½“çš„å­˜åœ¨æ¡ä»¶åˆ¤æ–­ä¸Šä¸è¶³ï¼›classification label&#x2F;è‡ªç„¶è¯­è¨€ å¯¹LLMæ¥è¯´éœ€è¦æ›´å¤šèµ„æºå»ç†è§£ï¼›ç¼ºä¹é€šç”¨æ€§ æ­¤æ–‡ç« å®é™…ä¸Šæ˜¯ç”¨pythonä»£ç æ¥è¡¨ç¤ºçŸ¥è¯†å’Œä¿¡æ¯ï¼Œæ˜¯information to pythonå†to knowledgeçš„è¿‡ç¨‹","categories":[],"tags":[]},{"title":"äº‘æœåŠ¡å™¨ä½¿ç”¨åŠQQæœºå™¨äººæ­å»º","slug":"PcrQQbot","date":"2023-06-15T10:36:51.000Z","updated":"2023-06-15T11:12:36.159Z","comments":true,"path":"2023/06/15/PcrQQbot/","link":"","permalink":"https://yukino256.github.io/2023/06/15/PcrQQbot/","excerpt":"","text":"1. æœåŠ¡å™¨é€‰æ‹©ä¸‰ä¸ªä¸»æµçš„ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€‚èŒæ–°çš„æˆ‘éœ€è¦ä¸‰é€‰ä¸€åä¸ºäº‘æ²¡ç”¨è¿‡ã€‚é˜¿é‡Œäº‘å­¦ç”Ÿè®¤è¯å¯ä»¥ç™½å«–ï¼Œè…¾è®¯äº‘å­¦ç”Ÿè®¤è¯æ˜¯æ‰“æŠ˜ï¼Œçœ‹ç€è›®ä¾¿å®œï¼Œä½†æ˜¯è¿™ä¸ªæ—¶é—´ä¹°æ˜¯1.9æŠ˜ï¼Œå»å¹´11æœˆæ˜¯1.1æŠ˜ã€‚ æœåŠ¡å™¨ä½¿ç”¨é˜¿é‡Œäº‘ï¼Œå› ä¸ºå¯ä»¥ç™½å«–7ä¸ªæœˆï¼Œæ–°æ‰‹ä¸Šè·¯è¿˜æ˜¯æ‰¾å…è´¹çš„è¯•ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œéšä¾¿é€ ï¼Œé€ åäº†ä¹Ÿä¸å¿ƒç–¼ã€‚ cpuã€å†…å­˜è¿™äº›ä¸œè¥¿å°±æ˜¯çœ‹é’±çš„å•¦ï¼Œæ ¹æ®éœ€è¦è´­ä¹°åˆé€‚çš„å°±è¡Œã€‚ç³»ç»Ÿè¿™ä¸ªä¸œè¥¿ï¼Œä¸å¤ªæ¸…æ¥šæ˜¯æ€ä¹ˆé€‰æ‹©çš„ã€‚æœ¬äººé€‰æ‹©Ubuntuçš„ä¾æ®æ˜¯ï¼šå°½ç®¡windowså¾ˆç†Ÿæ‚‰ï¼Œä½†æ˜¯å‡ ä¸ªèµ„æ·±ç¨‹åºå‘˜çš„å“¥ä»¬å„¿ç”¨çš„éƒ½æ˜¯Linuxå†…æ ¸ç³»ç»Ÿï¼›æ­¤å¤–ï¼ŒLiunxç›¸å¯¹äºwindowsçš„å†…å­˜å ç”¨è¦å°å¤ªå¤šäº†ï¼ŒæœåŠ¡å™¨è¿˜æ˜¯è¦æŠ æŠ æœæœä¸€ç‚¹ã€‚Linuxæä¾›æœåŠ¡å¥½åƒä¹Ÿè›®æ–¹ä¾¿çš„ 2. æœåŠ¡å™¨æ“ä½œè·Ÿç€é˜¿é‡Œçš„æ•™ç¨‹èµ°ä¸‹æ¥ï¼ŒåŸºæœ¬ä¸Šå°±ä¼šæ€ä¹ˆæ“çºµæœåŠ¡å™¨äº†ã€‚è¿œç¨‹è¿æ¥æœåŠ¡å™¨æœ‰ä¸¤ç§æ–¹å¼ï¼šWorkbenchå’ŒVNCï¼Œå‰è€…ä¼¼ä¹åªèƒ½ç”¨å‘½ä»¤è¡Œè¾“å…¥ï¼Œåè€…åˆ™å¯ä»¥å®‰è£…GUIã€‚ å®é™…ä¸Šï¼Œä¸åŒäº‘æœåŠ¡å•†å¯¹äºè‡ªå·±äº‘æœåŠ¡å™¨çš„åç§°å’Œæ“çºµæ–¹å¼æ˜¯æœ‰æ‰€ä¸åŒçš„ã€‚ 3. å›¾å½¢ç•Œé¢çš„å®‰è£…æˆ‘çš„ä¸€ä¸ªæœ‹å‹å¯¹æˆ‘è¯´ï¼Œåªæœ‰å½“ä½ èƒ½å¤Ÿç”¨å‘½ä»¤è¡Œå®Œæˆä½ æƒ³è¦çš„æ‰€æœ‰æ“ä½œåï¼Œä½ æ‰ç®—æ˜¯çœŸæ­£æ‡‚è®¡ç®—æœºï¼Œæˆ‘è§‰å¾—å¾ˆæœ‰é“ç†ã€‚ç›®å‰è¿˜æ²¡æœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œå…ˆç”¨å¸¦GUIçš„VNCè¯•ä¸€ä¸‹ï¼Œåç»­éœ€è¦ç†è§£Workbenchçš„å‘½ä»¤è¡Œæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œå¦‚ä½•æ“ä½œã€‚å…¶å®ç›®å‰åœ¨æ²¡æœ‰GUIçš„æƒ…å†µä¸‹æ— æ³•ç†è§£ç³»ç»Ÿå†…éƒ¨ç»“æ„ã€‚ GUIå®‰è£…æµç¨‹çš„æ–¹æ³•ï¼Œé˜¿é‡Œäº‘æœ¬èº«æœ‰æä¾›ï¼Œæœ€ç»ˆé€‰æ‹©çš„ç³»ç»Ÿæ˜¯Ubuntun20.04ã€‚ä¸€å¼€å§‹é€‰æ‹©çš„18.04çš„é€ äº†åŠå¤©pythonå®‰è£…è¿˜æ˜¯å‡ºé—®é¢˜ã€‚å› ä¸ºæœºå™¨äººéœ€æ±‚3.8çš„pythonï¼Œ18.04é»˜è®¤æ˜¯3.6ï¼Œå‡çº§è¿‡ç¨‹ä¸­ä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ã€‚ 4. PCRä¼šæˆ˜æœºå™¨äººçš„é€‰æ‹©ä¹‹å‰ä¸»æµæ˜¯yobotï¼Œä½†æ˜¯ä¼šæˆ˜æ”¹ç‰ˆåç”¨ä¸äº†äº†ï¼Œå¼€å‘è€…ä¸æ›´æ–°äº†ã€‚HoshinoBotæ˜¯æˆ‘ä¸€å¼€å§‹é…ç½®çš„ï¼Œç»“æœç”¨ä¸äº†ä¼šæˆ˜åŠŸèƒ½ï¼Œä½†æ˜¯å…¶ä»–èŠ±é‡Œèƒ¡å“¨çš„ä¼¼ä¹æŒºå…¨ã€‚é…ç½®æ–¹æ³•æŒ‰ç…§è¿™ä¸ªLiunxçš„å®‰è£…æµç¨‹èµ°å°±æ˜¯äº†ã€‚ å®é™…ä¸Šå¥½åƒåœ¨å“ªé‡Œéƒ½æ— æ‰€è°“ï¼Ÿä½†æ˜¯éƒ¨ç½²åœ¨è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œè¿è¡Œ.batçš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œæ˜¾ç¤ºçš„æ˜¯ï¼š é¡¶çº§éš¾èšŒï¼š18.04åœ¨numpyä¸Šå®‰è£…ç–¯ç‹‚å¤±è´¥ï¼Œ20.04ä¸€è·¯ç»¿ç¯ğŸ˜… æˆ‘è¿™ä¸ªæœåŠ¡å™¨çš„å¸¦å®½ä½ï¼Œä¸ç”¨æ¸…åé•œåƒçš„æ—¶å€™å¾ˆæ…¢ã€‚åº”è¯¥åŠ ä¸Šé•œåƒè®¾ç½®çš„å‘½ä»¤ğŸ˜‡ 1`python3.8 -m pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt` yobot_remixæ˜¯yoboté’ˆå¯¹æ–°ç‰ˆå…¬ä¼šæˆ˜çš„é­”æ”¹ï¼Œå®æµ‹å…¬ä¼šæˆ˜èƒ½ç”¨ã€‚ç”±äºæ˜¯åŸºäºyobotæ”¹çš„ï¼Œå‘½ä»¤å’Œéƒ¨ç½²æ–¹æ³•å¤§ä½“ä¹Ÿå’Œyobotç›¸åŒ 5. æœºå™¨äººæ²¡å“åº”å…¸ä¸­å…¸ï¼Œè¢«é£æ§äº†ï¼Œå¯ä»¥è‡ªè¡Œæœç´¢è§£å†³æ–¹æ³•ã€‚è¿™ä¸ªé‡Œé¢çš„é«˜èµå›ç­”å¾ˆæœ‰ç”¨ åè®° é˜¿é‡Œäº‘ç»™æˆ‘ç™½å«–7ä¸ªæœˆâ€¦åº”è¯¥å°½å¿«å­¦ä¹ Dockerçš„ç”¨æ³•ï¼Œæ–¹ä¾¿åç»­è¿ç§»ğŸ˜‹","categories":[{"name":"python","slug":"python","permalink":"https://yukino256.github.io/categories/python/"},{"name":"Liunx","slug":"python/Liunx","permalink":"https://yukino256.github.io/categories/python/Liunx/"},{"name":"Ubuntu20.04","slug":"python/Liunx/Ubuntu20-04","permalink":"https://yukino256.github.io/categories/python/Liunx/Ubuntu20-04/"}],"tags":[{"name":"QQbot","slug":"QQbot","permalink":"https://yukino256.github.io/tags/QQbot/"},{"name":"é˜¿é‡Œäº‘","slug":"é˜¿é‡Œäº‘","permalink":"https://yukino256.github.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"},{"name":"cloud_server","slug":"cloud-server","permalink":"https://yukino256.github.io/tags/cloud-server/"}]},{"title":"AIç»˜ç”»åˆæ­¥å°è¯•ï¼šStable Difussionæœ¬åœ°éƒ¨ç½²åŠWebUIä½¿ç”¨","slug":"AIdrawing","date":"2023-04-25T06:10:31.000Z","updated":"2023-04-25T07:30:37.718Z","comments":true,"path":"2023/04/25/AIdrawing/","link":"","permalink":"https://yukino256.github.io/2023/04/25/AIdrawing/","excerpt":"","text":"1. å®‰è£…condaã€gitã€cudaCudaç‰ˆæœ¬éœ€è¦é¦–å…ˆæŸ¥çœ‹è‡ªå·±nvidaæ˜¾å¡å‚æ•°ï¼Œä¸èƒ½é«˜äºå‚æ•°ä¸Šçš„ç‰ˆæœ¬ 2. Condaåˆ›å»ºç¯å¢ƒï¼Œpythonç‰ˆæœ¬æ ¹æ®GitHubä¸Šçš„è¯´æ˜æ¥é€‰æ‹© 1`conda create --name sdweb python=3.10.6` 3. è¿›å…¥åˆ›å»ºçš„è™šæ‹Ÿç¯å¢ƒ1`conda activate sdweb` 4. åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹å…‹éš†é¡¹ç›®ï¼Œæ³¨æ„ï¼šå‘½ä»¤è¡Œéœ€è¦cdåˆ°è™šæ‹Ÿç¯å¢ƒçš„ç›®å½•ï¼Œä¸ç„¶ä¼šé»˜è®¤gitåˆ°cç›˜â€¦.1`git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git` å®é™…ä¸Šå¥½åƒåœ¨å“ªé‡Œéƒ½æ— æ‰€è°“ï¼Ÿä½†æ˜¯éƒ¨ç½²åœ¨è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œè¿è¡Œ.batçš„æ—¶å€™ï¼Œå‘½ä»¤è¡Œæ˜¾ç¤ºçš„æ˜¯ï¼š 123`Creating venv in directory D:\\Anaconda3\\envs\\sdweb\\stable-diffusion-webui\\venv using python &quot;D:\\Anaconda3\\python.exe&quot;``venv &quot;D:\\Anaconda3\\envs\\sdweb\\stable-diffusion-webui\\venv\\Scripts\\Python.exe&quot;``Python 3.10.9 | packaged by Anaconda, Inc. | (main, Mar 1 2023, 18:18:15) [MSC v.1916 64 bit (AMD64)]` æ²¡æœ‰ç”¨è™šæ‹Ÿç¯å¢ƒä¸‹çš„pythonç‰ˆæœ¬å“â€¦.ä½†æ˜¯å­˜å‚¨ä½ç½®å¥½æ­¹æ˜¯å¯¹äº† ğŸ˜‡ ä¸å¯¹ï¼æˆ–è®¸åº”è¯¥åœ¨è™šæ‹Ÿç¯å¢ƒä¸‹ç”¨å‘½ä»¤è¡Œè¿è¡Œè¿™ä¸ª.batè€Œä¸æ˜¯ç‚¹å‡»ï¼ ç¯å¢ƒå¯¹äº†ï¼Œä½†æ˜¯è¿è¡Œæ—¶ç³»ç»Ÿçªç„¶å¡æ­»ä¸€æ®µæ—¶é—´â€¦â€¦ä¸æ•¢åŠ¨ä¸æ•¢åŠ¨ ğŸ˜°é”™è¯¯æ˜¾ç¤ºæ˜¯Torchå®‰è£…å¤±è´¥ï¼Œè¿™ä¸ªæ–‡ç« æœ‰æåˆ°æŠŠ.batçš„ä»£ç æ”¹ä¸€ä¸‹ï¼Œå°è¯•ä¹‹ã€‚ ç¬¬å…­è¡Œæ”¹ä¸ºï¼š 1`set COMMANDLINE_ARGS=--lowvram --precision full --no-half --skip-torch-cuda-test` è¿™ä¸ª.batæ–‡ä»¶æ˜¯å¦ä¸€ä¸ª.batçš„å‚æ•°ä¼ å…¥æ–‡ä»¶ã€‚ åˆå¯„å•¦ï¼Œè€Œä¸”é€”ä¸­å¾ˆå¡ ğŸ˜… 5. è¿˜æ˜¯çœ‹çœ‹ç”µå­ä½›ç¥–å¸ƒæ–½çš„æ³•å™¨å§å˜‰äººä»¬ ğŸ˜‹ ã€AIç»˜ç”»ã€‘Stable Diffusionæ•´åˆåŒ…v4 BV1iM4y1y7oA","categories":[{"name":"python","slug":"python","permalink":"https://yukino256.github.io/categories/python/"},{"name":"algorithm","slug":"python/algorithm","permalink":"https://yukino256.github.io/categories/python/algorithm/"}],"tags":[{"name":"AI","slug":"AI","permalink":"https://yukino256.github.io/tags/AI/"},{"name":"Stable Difussion","slug":"Stable-Difussion","permalink":"https://yukino256.github.io/tags/Stable-Difussion/"},{"name":"æœ¬åœ°éƒ¨ç½²","slug":"æœ¬åœ°éƒ¨ç½²","permalink":"https://yukino256.github.io/tags/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/"}]},{"title":"è®°å½•è‡ªå·±çš„åˆæ¬¡æ­å»ºåšå®¢çš„ç»å†â€”â€”æµç¨‹ã€è·¯å¾„ä¸æ„Ÿæ‚Ÿ","slug":"BlogBuilding","date":"2023-04-24T07:30:58.000Z","updated":"2024-05-09T01:24:39.864Z","comments":true,"path":"2023/04/24/BlogBuilding/","link":"","permalink":"https://yukino256.github.io/2023/04/24/BlogBuilding/","excerpt":"","text":"å®‰è£…æµç¨‹å¯ä»¥å‚è§ è¿™ç¯‡æ–‡ç« éƒ¨ç½²æ—¶å°¤å…¶éœ€è¦æ³¨æ„çš„è®¾ç½®ï¼šå°†hexoè®¾ç½®é‡Œé¢çš„åˆ†æ”¯åç§°æ”¹æˆä¸GitHubä¸€è‡´ï¼Œå› ä¸ºå‰ä¸¤å¹´GitHubæŠŠmain branchåå­—æ”¹äº†.. 1.ç½‘ç«™éƒ¨ç½²çš„åŸç†å’Œé€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿåœ¨æœ€å¼€å§‹ï¼Œé¢å¯¹å„ç§æ­å»ºç½‘ç«™çš„æ¡†æ¶ï¼Œæœ¬äººå…¶å®æ˜¯è¿·èŒ«çš„ï¼Œå› ä¸ºæˆ‘ä¸€æ—¶é—´æ— æ³•ç†è§£ä¸ºä»€ä¹ˆç»è¿‡è¿™äº›æ­¥éª¤å°±èƒ½å¤Ÿäº§å‡ºä¸€ä¸ªå¯ä»¥è¢«è®¿é—®çš„é¡µé¢ï¼Ÿç›´åˆ°æˆ‘åœ¨ç«™ç‚¹å¿«æ­å»ºå®Œæˆæ—¶ï¼Œæˆ‘æ‰çªç„¶æ˜ç™½å…¶åŸç†ï¼Œæˆ–è®¸æ¥ä¸‹æ¥çš„è¦è¯´ç†è§£æœ‰ç‚¹ä¸å‡†ç¡®ï¼Œä½†æ˜¯ä»ç„¶åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹ï¼š é¦–å…ˆï¼Œéœ€è¦ç†è§£çš„å°±æ˜¯ï¼Œç½‘ç»œä¸Šæ‰€æœ‰çš„èµ„æºéƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼ä¼ è¾“çš„ï¼Œç½‘ç«™ä¹Ÿæ˜¯è¿™æ ·ï¼Œä¼ è¾“çš„æ˜¯010101çš„æ•°æ®æµï¼Œè€Œä¸æ˜¯ç›´æ¥å°†é¡µé¢å‘ˆç°åœ¨ç”µè„‘ä¸Šã€‚æ•°æ®åœ¨ç»è¿‡ç½‘ç»œä¼ è¾“è‡³æœ¬åœ°çš„æ—¶å€™ï¼Œéœ€è¦æœ¬åœ°åˆ©ç”¨æŸç§â€œè§£ç è½¯ä»¶â€å°†å…¶è½¬æ¢æˆæ›´é«˜çº§çš„ã€ä¾¿äºç”¨æˆ·é˜…è¯»ã€è¾“å…¥çš„æ¨¡å¼ã€‚æµè§ˆå™¨å…¶å®å°±æ˜¯å°†01æ•°æ®è§£ææˆhtmlç­‰ä»£ç ï¼Œç„¶åå†é€šè¿‡æ¸²æŸ“ã€ä»£ç æ‰§è¡Œï¼Œå°†æ•°æ®ä»¥GUIçš„å½¢å¼å‘ˆç°å‡ºæ¥çš„è§£æå™¨ã€‚ é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå¯ä»¥å°†é¡µé¢æ–‡ä»¶å¤¹çš„ä¸€æ•´ä¸ªæ•°æ®åŒ…æ‰˜ç®¡è‡³æŸä¸ªæœåŠ¡å™¨ï¼Œä»è€Œèƒ½å¤Ÿå¯¹å¤–å¯è§å‘¢ï¼Ÿåœ¨GitHubä¸­ï¼Œå¦‚æœä½ å»ºç«‹ä¸€ä¸ªä»“åº“ï¼Œå¹¶å°†ç½‘ç«™æ•°æ®ä¸Šä¼ è‡³ä»“åº“ï¼Œåˆ©ç”¨GitHub PagesåŠŸèƒ½å°±å¯ä»¥å°†ä¸ªäººåšå®¢å‘å¸ƒåœ¨äº’è”ç½‘ä¸Šã€‚å®é™…ä¸Šï¼Œé€šè¿‡ç»™ä»“åº“å¼€é€šPagesåŠŸèƒ½ï¼Œåœ¨è¾“å…¥ â€œç”¨æˆ·å.github.ioâ€œ æ—¶ï¼Œä½ å®é™…è®¿é—®çš„æ˜¯GitHubé¡µé¢ä¸‹ä½ ä»“åº“çš„åœ°å€ï¼ˆè¿™ä¹ˆè¯´ä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Ÿï¼‰ï¼Œç„¶åGitHubåœ¨ä½ è®¿é—®çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥ä»“åº“ä¸­æ˜¯å¦æœ‰index.htmlè¿™ä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å‘Šè¯‰æµè§ˆå™¨ï¼Œè®©æµè§ˆå™¨è§£æä»“åº“å†…çš„æ•°æ®èµ„æºï¼Œä»è€Œä½¿å¾—é¡µé¢èƒ½å¤Ÿå‘ˆç°å‡ºæ¥ã€‚ ä¸ºä»€ä¹ˆæ˜¯index.htmlï¼Ÿå› ä¸ºå…¶æ˜¯æ‰€æœ‰ç½‘ç«™å»ºè®¾è€…çº¦å®šä¿—æˆçš„ä¸€ä¸ªæœ€åˆå§‹çš„å…¥å£æ–‡ä»¶ï¼Œå°±å¥½åƒpythonåŒ…ä¸­çš„__init__.pyä¸€æ ·ã€‚ åœ¨ç†æ¸…ä¸Šè¿°é€»è¾‘ä¹‹åï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç†è§£åˆ°ä¸€ä¸ªäº‹å®ï¼šç«™ç‚¹éƒ¨ç½²åœ¨å“ªé‡Œéƒ½æ˜¯æ— æ‰€è°“çš„ï¼Œåªè¦ç«™ç‚¹æ‰˜ç®¡çš„åœ°æ–¹èƒ½å¤Ÿæä¾›è¿™æ ·ä¸€ç§â€åˆ¤æ–­â€ â€œè§£æâ€çš„æœåŠ¡å³å¯ï¼Œè‡ªå·±çš„ç”µè„‘ä¹Ÿå¯ä»¥ä½œä¸ºserverã€‚åªæ˜¯PCç»å¸¸ä¿æŒä¸åœ¨çº¿çš„çŠ¶æ€ï¼Œä¼šå½±å“ç”¨æˆ·è®¿é—®ã€‚æ‰€ä»¥è´­ä¹°ä¸€ä¸ªä¸“é—¨è´Ÿè´£å‘é€æ•°æ®çš„æœåŠ¡å™¨æˆä¸ºç½‘ç«™æ­å»ºçš„å¿…è¦æ­¥éª¤ï¼Œè¿™ç§æœåŠ¡å™¨ä¸“é—¨å¤„ç†è®¿é—®ç½‘ç«™çš„è¯·æ±‚ï¼Œæ•ˆç‡ä¸Šç›¸å¯¹äºPCé«˜å¾—å¤šã€‚ 2.ç«™ç‚¹éƒ¨ç½²åœ¨å“ªï¼ŸGithub Pagesï¼Œéƒ¨ç½²åœ¨è¿™é‡Œçš„åŸå› æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯å…è´¹ï¼ŒäºŒæ˜¯é¡ºå¸¦å­¦ä¹ ä¸€ä¸‹Githubçš„ç”¨æ³• éƒ¨ç½²åœ¨è¿™ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å›½å†…è®¿é—®ä¸ç¨³å®š 3.éƒ¨ç½²æ­¥éª¤ï¼Ÿ gitå·¥å…·çš„å®‰è£…ã€npmå®‰è£…ã€Node.jså®‰è£…ï¼ˆï¼Ÿï¼‰Node.jså’Œnpmåˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿâ€”â€”â€”â€”é—®é—®chatGPTå§ï¼ ä½¿ç”¨gitå°†æœ¬åœ°ç”µè„‘ä¸GitHubè´¦æˆ·ç»‘å®š åˆ›å»ºä¸€ä¸ªGithubä»“åº“ï¼Œå‘½åæ ¼å¼ä¸¥æ ¼è¦æ±‚ä¸ºï¼šç”¨æˆ·å.github.io ä½¿ç”¨gitå‘½ä»¤è¡Œï¼Œå°†æœ¬åœ°ç”µè„‘çš„æŸä¸ªåœ°å€ä¸githubä»“åº“å…³è”ï¼Œè¿™ä¸ªåœ°å€å³æ˜¯åšå®¢çš„æ–‡ä»¶æ‰€åœ¨ï¼Œæˆ‘å‘½åä¸ºBlog åœ¨Blogä¸‹ï¼Œç”¨git bashå®‰è£…Hexo ä½¿ç”¨Hexoå‘½ä»¤ï¼Œåˆ›å»ºã€æµ‹è¯•ã€éƒ¨ç½² 4.ä¸»é¢˜ä¸ªæ€§åŒ–ä¿®æ”¹ é€‰æ‹©ä¸€ä¸ªä¸»é¢˜å¹¶æ ¹æ®githubä¸Šé¢æä¾›çš„ä¸»é¢˜ä½¿ç”¨æ–¹æ³•è¿›è¡Œé…ç½®ï¼Œæ­¤æ­¥éª¤gitå‘½ä»¤å¾€å¾€æ˜¯åœ¨Blogè¿™ä¸ªæ ¹ç›®å½•ä¸‹è¿›è¡Œ ä¸»é¢˜ç›®å½•å‚è§Hexoä¸»é¢˜å®˜æ–¹é›†åˆ ç»è¿‡ä¸€ç³»åˆ—å°è¯•ï¼Œæœ€ç»ˆä½¿ç”¨butterflyä¸»é¢˜ ä¸ªæ€§åŒ–è®¾ç½®å‚è§butterflyå®˜æ–¹æ–‡æ¡£é›†ï¼Œè¿™æ˜¯åˆ›ä½œè€…çš„åšå®¢ï¼Œåšæ–‡å…¨æ˜¯è¯¦ç»†çš„è®¾ç½®å¦‚ä½•è°ƒæ•´ 5.åšæ–‡ä¸Šä¼ ä¸ä¿®æ”¹ éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒHexoæ¡†æ¶æ‰æ˜¯ä¸ªäººåšå®¢çš„æ¶æ„ï¼Œåšå®¢å‘è¡¨ã€ä¿®æ”¹ç­‰åº”è¯¥ä½¿ç”¨Hexoå‘½ä»¤æ¥æ‰§è¡Œ butterflyåªæ˜¯ä¸€ä¸ªç¾åŒ–çš„æ¡†æ¶ï¼Œè´Ÿè´£æ˜¾ç¤ºæ•ˆæœçš„æ¸²æŸ“å’Œè°ƒæ•´ ä½¿ç”¨hexoå‘½ä»¤åˆ›å»ºæ–°åšæ–‡åï¼Œåœ¨sourceæ–‡ä»¶å¤¹ä¸‹å¯ä»¥æ‰¾åˆ°ã€‚åšæ–‡éœ€è¦ä»¥mdæ ¼å¼å†™ä½œï¼Œæœ¬äººä½¿ç”¨VScodeç¼–å†™ mdè¯­æ³•å†™ä½œè§„èŒƒï¼šMarkdownå®˜æ–¹æ•™ç¨‹ 6.è¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ä»“åº“ä¸­README.mdæ–‡ä»¶ï¼Œåœ¨depolyåä¸€ç›´è¢«é¡¶æ›¿ï¼Œä»“åº“é¡µé¢æ˜¾ç¤ºä¸å‡ºmdçš„æè¿°æ¥è¿™ä¸ªé—®é¢˜æ˜¯Hexoçš„è®¾ç½®é—®é¢˜ï¼Œä¸çŸ¥é“å®˜æ–¹æ–‡æ¡£æœ‰æ²¡æœ‰æåˆ°ï¼Œä½†æ˜¯è§£å†³æ–¹æ³•æ˜¯ï¼šåœ¨Hexoç›®å½•ä¸‹çš„sourceæ ¹ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ªREADME.mdã€‚ä¿®æ”¹Hexoç›®å½•ä¸‹çš„_config.ymlã€‚å°†skip_renderå‚æ•°çš„å€¼è®¾ç½®ä¸Šã€‚skip_render: README.mdä¿å­˜é€€å‡ºå³å¯ã€‚ä½¿ç”¨hexo d å‘½ä»¤å°±ä¸ä¼šåœ¨æ¸²æŸ“ README.md è¿™ä¸ªæ–‡ä»¶äº†ã€‚ æ— æ³•åœ¨ä»“åº“ä¸­æ‰‹åŠ¨æ·»åŠ README.md,å› ä¸ºéƒ¨ç½²æ—¶å€™ä¼šå°†ä»“åº“å†…å®¹å®Œå…¨é¡¶æ›¿ä¸ºæœ¬åœ°å†…å®¹ï¼Œåªæœ‰åœ¨æœ¬åœ°æ–‡ä»¶ä¸­ä¹Ÿè®¾ç½®READMEæ‰è¡Œã€‚ ç½‘ç«™åœ¨æœ¬åœ°æµ‹è¯•æ¸²æŸ“å¤±è´¥å¯èƒ½æ˜¯ç¼ºå°‘ç›¸åº”çš„åŒ…ï¼Œé‡æ–°å®‰è£…ä¸€éå³å¯ï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±ä»å¤´éƒ½è¯•ä¸€ä¸‹é€šå¸¸è€Œè¨€ï¼Œåº”è¯¥å®‰è£…çš„åŒ…æœ‰ï¼šHexoæ‰€éœ€çš„åŒ…+æ‰€ç”¨ä¸»é¢˜æ¸²æŸ“æ‰€éœ€çš„åŒ… å¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šåŒ…çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ ä¸»é¢˜åŒ…ï¼šhexo-theme-fluid æ˜¯åŠ å…¥ä¸»é¢˜ æ¸²æŸ“åŒ…ï¼šhexo-renderer-scss æ˜¯åŠ å…¥æ¸²æŸ“å¼•æ“ï¼Œå› ä¸ºHexoé‡Œé¢å¯èƒ½å¹¶ä¸æ”¯æŒä¸»é¢˜å†…çš„ä¸€äº›æ ·å¼ åˆå¼•å‡ºä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸æ”¯æŒï¼ŸHexoç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿæœ¬äººå°šæœªäº†è§£ï¼Œä½†æ˜¯å¯ä»¥å‚è§Hexoå®˜æ–¹æ–‡æ¡£ ç½‘ç«™æœ¬åœ°æµ‹è¯•æˆåŠŸï¼Œéƒ¨ç½²åˆ°GitHubåè¿œç¨‹æ¸²æŸ“å¤±è´¥ï¼ŸæŒ‰F12ï¼ŒæŸ¥çœ‹consoleï¼Œå‘ç°æŠ¥é”™æ˜¯Failed to load resource: the server responded with a status of 404 ()åŸå› åœ¨äºå›½å†…ä¸GitHubçš„è¿æ¥çŠ¯æŠ½â€¦â€¦..ä¸€äº›æ–‡ä»¶æ²¡ä¸‹è½½å›æ¥å› è€Œæ— æ³•åŠ è½½ å› ä¸ºè¿™ä¸ªé”™è¯¯æ¢äº†å¥½å¤šä¸»é¢˜â€¦.æœ¬æ¥å…¶ä»–ä¸»é¢˜ä¹Ÿè›®æ¼‚äº®çš„å”‰â€¦ ä½†æ˜¯æ–°é¡µé¢è¿˜æœ‰é—®é¢˜ï¼Œå¯èƒ½åœ¨æˆ‘ä¸çŸ¥é“çš„åœ°æ–¹èµ·äº†ä½œç”¨ï¼Œå°½ç®¡æ˜¾ç¤ºæ²¡æœ‰é—®é¢˜ï¼šError with Permissions-Policy header: Origin trial controlled feature not enabled: â€˜interest-cohortâ€™. å…¶å®åœ¨é€”ä¸­è¿˜é‡åˆ°ä¸€ä¸ªé”™è¯¯ï¼Œç¨€é‡Œç³Šæ¶‚å°±æ²¡æœ‰äº†ã€‚ 7.åç»­è€ƒè™‘åŠ å…¥çš„åŠŸèƒ½åšå®¢å®šæ—¶è‡ªåŠ¨æ›´æ–°å¾ˆç®€å•ï¼Œæ²¡ææ˜¯å› ä¸ºæ²¡å¿…è¦ï¼Œå­¦ä¹ æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œä¸éœ€è¦é¢‘ç¹æ›´æ–°â€¦â€¦. åŠ¨æ€é¡µé¢çœŸæ­£ç†è§£Hexoçš„åº•å±‚åŸç†8.ä¸€äº›æ„Ÿæƒ³ åœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°è¿‡å¾ˆå¤šæŠ¥é”™ã€å’Œä¸äº†è§£çš„åœ°æ–¹ï¼Œç›´æ¥æœç´¢æŠ¥é”™ç»“æœå›ºç„¶å¯ä»¥æ‰¾åˆ°è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯å¾ˆå¤šå¯ä»¥æŸ¥é˜…å®˜æ–¹æ–‡æ¡£æ¥è§£å†³ã€‚æŸ¥é˜…å›ºç„¶å¿«ï¼Œä½†å¾€å¾€ä¼šä½¿å¾—â€çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶â€ã€‚ç›´æ¥æœç­”æ¡ˆçš„è¿‡ç¨‹å’Œè¯¢é—®chatGPTå¾ˆç±»ä¼¼ï¼Œå·¥ç¨‹æ€§çš„é—®é¢˜åªç­”å¤è§£å†³æ­¥éª¤ï¼Œè€Œä¸åˆ†æèƒŒååŸç† Hexoä¹Ÿè®¸æ˜¯ä¸€å¥—ç¨‹åºï¼Œè‡ªåŠ¨æä¾›ä¸€å¥—æ¡†æ¶ï¼ŒåŠŸèƒ½æ˜¯å°†æˆ‘ä»¬æäº¤çš„æ–‡æœ¬ï¼ŒæŒ‰ç…§æ¨¡æ¿æˆ–è€…è‡ªå·±è®¾å®šçš„æ ·å­æ¸²æŸ“å‡ºæ¥ã€‚åŒæ ·åŠŸèƒ½çš„è¿˜è¦jekellï¼Œä½†æ˜¯å¥½åƒæ˜¯Linuxä¸Šæ¯”è¾ƒå¥½ç”¨ã€‚Hexoæ˜¯é™æ€ç½‘é¡µæ¡†æ¶ï¼Œå¯¹äºåšå®¢å¤Ÿç”¨ï¼Œä½†æ˜¯åŠ¨æ€ç½‘é¡µæ¡†æ¶æ‰æ˜¯æœªæ¥çš„é€‰æ‹©ã€‚ åœ¨ç¼–å†™mdçš„æ—¶å€™è¿˜è¯¯ç”¨äº†ä¸­æ–‡ç¬¦å·å¯¼è‡´mdè¯­æ³•å‡ºé”™â€¦â€¦.wssb éƒ¨ç½²åå‘ç°é¡µé¢æ²¡æ›´æ–°ï¼Ÿåˆ·æ–°è¯•è¯•ï¼å†ä¸ç„¶å°±å¼€æ¢¯å­åˆ·æ–°è¯•è¯•ï¼ åŸæ¥å†™æ­£æ–‡çš„æ—¶å€™ä¸ç”¨è‡ªåŠ¨æ¢è¡Œâ€¦.å¦åˆ™ä¼šçªç„¶æ¢è¡Œï¼Œå¾ˆéš¾çœ‹.. Markdownè¯­æ³•ï¼šåŠ ç²—è¿™ç±»ä¿®é¥°è¯­æ³•ï¼Œå‰åå¦‚æœæœ‰æ ‡ç‚¹ç¬¦å·ï¼Œåˆ™è¦è§†æƒ…å†µåŠ ç©ºæ ¼â€¦â€¦ æ¯æ¬¡æ›´æ–°ï¼Œcleanã€gã€dä¸‰æ¡å‘½ä»¤å¿…é¡»èµ°ä¸€è¶Ÿå•Šâ€¦.æˆ‘è¿˜ä»¥ä¸ºç”¨æ›´æ–°ç”¨gã€då°±è¡Œäº†å‘¢ bolgå†…æ’å…¥å›¾ç‰‡å¤±è´¥â€¦è§£å†³æ–¹æ³•æ˜¯è¿™ç¯‡åšå®¢","categories":[{"name":"markdown","slug":"markdown","permalink":"https://yukino256.github.io/categories/markdown/"},{"name":"js","slug":"markdown/js","permalink":"https://yukino256.github.io/categories/markdown/js/"},{"name":"css","slug":"markdown/js/css","permalink":"https://yukino256.github.io/categories/markdown/js/css/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"https://yukino256.github.io/tags/Hexo/"},{"name":"Blog","slug":"Blog","permalink":"https://yukino256.github.io/tags/Blog/"},{"name":"Git","slug":"Git","permalink":"https://yukino256.github.io/tags/Git/"},{"name":"Github","slug":"Github","permalink":"https://yukino256.github.io/tags/Github/"}]},{"title":"Yukinoã®Blog","slug":"bolgname","date":"2023-04-20T03:33:24.000Z","updated":"2023-04-24T07:24:32.896Z","comments":true,"path":"2023/04/20/bolgname/","link":"","permalink":"https://yukino256.github.io/2023/04/20/bolgname/","excerpt":"","text":"è¿™æ˜¯æ­å»ºè‡ªå·±ç¬¬ä¸€ä¸ªåšå®¢åçš„ç¬¬ä¸€ç¯‡æ–‡ç« ","categories":[],"tags":[]},{"title":"Hello World","slug":"hello-world","date":"2023-04-20T03:30:32.320Z","updated":"2023-04-20T03:30:32.320Z","comments":true,"path":"2023/04/20/hello-world/","link":"","permalink":"https://yukino256.github.io/2023/04/20/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[{"name":"è®°å½•","slug":"è®°å½•","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/"},{"name":"å¤§æ¨¡å‹","slug":"è®°å½•/å¤§æ¨¡å‹","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/"},{"name":"å®ä¹ ","slug":"è®°å½•/å¤§æ¨¡å‹/å®ä¹ ","permalink":"https://yukino256.github.io/categories/%E8%AE%B0%E5%BD%95/%E5%A4%A7%E6%A8%A1%E5%9E%8B/%E5%AE%9E%E4%B9%A0/"},{"name":"python","slug":"python","permalink":"https://yukino256.github.io/categories/python/"},{"name":"Liunx","slug":"python/Liunx","permalink":"https://yukino256.github.io/categories/python/Liunx/"},{"name":"Ubuntu20.04","slug":"python/Liunx/Ubuntu20-04","permalink":"https://yukino256.github.io/categories/python/Liunx/Ubuntu20-04/"},{"name":"algorithm","slug":"python/algorithm","permalink":"https://yukino256.github.io/categories/python/algorithm/"},{"name":"markdown","slug":"markdown","permalink":"https://yukino256.github.io/categories/markdown/"},{"name":"js","slug":"markdown/js","permalink":"https://yukino256.github.io/categories/markdown/js/"},{"name":"css","slug":"markdown/js/css","permalink":"https://yukino256.github.io/categories/markdown/js/css/"}],"tags":[{"name":"æ—¥è®°","slug":"æ—¥è®°","permalink":"https://yukino256.github.io/tags/%E6%97%A5%E8%AE%B0/"},{"name":"éšæƒ³","slug":"éšæƒ³","permalink":"https://yukino256.github.io/tags/%E9%9A%8F%E6%83%B3/"},{"name":"å¿ƒæƒ…","slug":"å¿ƒæƒ…","permalink":"https://yukino256.github.io/tags/%E5%BF%83%E6%83%85/"},{"name":"QQbot","slug":"QQbot","permalink":"https://yukino256.github.io/tags/QQbot/"},{"name":"é˜¿é‡Œäº‘","slug":"é˜¿é‡Œäº‘","permalink":"https://yukino256.github.io/tags/%E9%98%BF%E9%87%8C%E4%BA%91/"},{"name":"cloud_server","slug":"cloud-server","permalink":"https://yukino256.github.io/tags/cloud-server/"},{"name":"AI","slug":"AI","permalink":"https://yukino256.github.io/tags/AI/"},{"name":"Stable Difussion","slug":"Stable-Difussion","permalink":"https://yukino256.github.io/tags/Stable-Difussion/"},{"name":"æœ¬åœ°éƒ¨ç½²","slug":"æœ¬åœ°éƒ¨ç½²","permalink":"https://yukino256.github.io/tags/%E6%9C%AC%E5%9C%B0%E9%83%A8%E7%BD%B2/"},{"name":"Hexo","slug":"Hexo","permalink":"https://yukino256.github.io/tags/Hexo/"},{"name":"Blog","slug":"Blog","permalink":"https://yukino256.github.io/tags/Blog/"},{"name":"Git","slug":"Git","permalink":"https://yukino256.github.io/tags/Git/"},{"name":"Github","slug":"Github","permalink":"https://yukino256.github.io/tags/Github/"}]}